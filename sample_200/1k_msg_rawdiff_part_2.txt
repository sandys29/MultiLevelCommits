{
    "Add note about S3AFileSystem \\' buffer . dir \\' property": "diff --git a/docs/setup/aws.md b/docs/setup/aws.md\nindex 156b4f0c068..ce1dcfa1ad9 100644\n--- a/docs/setup/aws.md\n+++ b/docs/setup/aws.md\n@@ -95,13 +95,20 @@ There are two popular S3 file system implementations available:\n \n This is the recommended S3 FileSystem implementation to use. It uses Amazon's SDK internally and works with IAM roles (see [Configure Access Credential](#configure-access-credentials)).\n \n-You need to point Flink to a valid Hadoop configuration, which contains the following property in `core-site.xml`:\n+You need to point Flink to a valid Hadoop configuration, which contains the following properties in `core-site.xml`:\n \n ```xml\n <property>\n   <name>fs.s3.impl</name>\n   <value>org.apache.hadoop.fs.s3a.S3AFileSystem</value>\n </property>\n+\n+<!-- Comma separated list of local directories used to buffer\n+     large results prior to transmitting them to S3. -->\n+<property>\n+  <name>fs.s3.buffer.dir</name>\n+  <value>/tmp</value>\n+</property>\n ```\n \n This registers `S3AFileSystem` as the default FileSystem for URIs with the `s3://` scheme.\n@@ -311,3 +318,24 @@ Caused by: org.jets3t.service.impl.rest.HttpException [...]\n ```\n \n {% top %}\n+\n+### NullPointerException at org.apache.hadoop.fs.LocalDirAllocator\n+\n+This Exception is usually caused by skipping the local buffer directory configuration `fs.s3.buffer.dir` for the `S3AFileSystem`. Please refer to the [S3AFileSystem configuration](#s3afilesystem-recommended) section to see how to configure the `S3AFileSystem` properly.\n+\n+```\n+[...]\n+Caused by: java.lang.NullPointerException at\n+o.a.h.fs.LocalDirAllocator$AllocatorPerContext.confChanged(LocalDirAllocator.java:268) at\n+o.a.h.fs.LocalDirAllocator$AllocatorPerContext.getLocalPathForWrite(LocalDirAllocator.java:344) at\n+o.a.h.fs.LocalDirAllocator$AllocatorPerContext.createTmpFileForWrite(LocalDirAllocator.java:416) at\n+o.a.h.fs.LocalDirAllocator.createTmpFileForWrite(LocalDirAllocator.java:198) at\n+o.a.h.fs.s3a.S3AOutputStream.<init>(S3AOutputStream.java:87) at\n+o.a.h.fs.s3a.S3AFileSystem.create(S3AFileSystem.java:410) at\n+o.a.h.fs.FileSystem.create(FileSystem.java:907) at\n+o.a.h.fs.FileSystem.create(FileSystem.java:888) at\n+o.a.h.fs.FileSystem.create(FileSystem.java:785) at\n+o.a.f.runtime.fs.hdfs.HadoopFileSystem.create(HadoopFileSystem.java:404) at\n+o.a.f.runtime.fs.hdfs.HadoopFileSystem.create(HadoopFileSystem.java:48) at\n+... 25 more\n+```",
    "Add nodes translators structure": "diff --git a/runners/spark-structured-streaming/src/main/java/org/apache/beam/runners/spark/structuredstreaming/translation/BatchPipelineTranslator.java b/runners/spark-structured-streaming/src/main/java/org/apache/beam/runners/spark/structuredstreaming/translation/BatchPipelineTranslator.java\ndeleted file mode 100644\nindex e66555c803..0000000000\n--- a/runners/spark-structured-streaming/src/main/java/org/apache/beam/runners/spark/structuredstreaming/translation/BatchPipelineTranslator.java\n+++ /dev/null\n@@ -1,20 +0,0 @@\n-package org.apache.beam.runners.spark.structuredstreaming.translation;\n-\n-import org.apache.beam.sdk.Pipeline;\n-import org.apache.beam.sdk.runners.TransformHierarchy;\n-import org.apache.beam.sdk.values.PValue;\n-\n-public class BatchPipelineTranslator extends PipelineTranslator {\n-\n-\n-  @Override public CompositeBehavior enterCompositeTransform(TransformHierarchy.Node node) {\n-    return super.enterCompositeTransform(node);\n-  }\n-\n-\n-  @Override public void visitPrimitiveTransform(TransformHierarchy.Node node) {\n-    super.visitPrimitiveTransform(node);\n-  }\n-\n-\n-}\ndiff --git a/runners/spark-structured-streaming/src/main/java/org/apache/beam/runners/spark/structuredstreaming/translation/batch/BatchPipelineTranslator.java b/runners/spark-structured-streaming/src/main/java/org/apache/beam/runners/spark/structuredstreaming/translation/batch/BatchPipelineTranslator.java\nnew file mode 100644\nindex 0000000000..2f7ac23990\n--- /dev/null\n+++ b/runners/spark-structured-streaming/src/main/java/org/apache/beam/runners/spark/structuredstreaming/translation/batch/BatchPipelineTranslator.java\n@@ -0,0 +1,66 @@\n+package org.apache.beam.runners.spark.structuredstreaming.translation.batch;\n+\n+import java.util.HashMap;\n+import java.util.Map;\n+import javax.annotation.Nullable;\n+import org.apache.beam.runners.core.construction.PTransformTranslation;\n+import org.apache.beam.runners.spark.structuredstreaming.translation.PipelineTranslator;\n+import org.apache.beam.sdk.Pipeline;\n+import org.apache.beam.sdk.runners.TransformHierarchy;\n+import org.apache.beam.sdk.transforms.PTransform;\n+\n+/** {@link Pipeline.PipelineVisitor} for executing a {@link Pipeline} as a Spark batch job. */\n+\n+public class BatchPipelineTranslator extends PipelineTranslator {\n+\n+\n+  // --------------------------------------------------------------------------------------------\n+  //  Transform Translator Registry\n+  // --------------------------------------------------------------------------------------------\n+\n+  @SuppressWarnings(\"rawtypes\")\n+  private static final Map<String, BatchTransformTranslator>\n+      TRANSLATORS = new HashMap<>();\n+\n+  static {\n+    TRANSLATORS.put(PTransformTranslation.COMBINE_PER_KEY_TRANSFORM_URN,\n+        new CombinePerKeyTranslatorBatch());\n+    TRANSLATORS\n+        .put(PTransformTranslation.GROUP_BY_KEY_TRANSFORM_URN, new GroupByKeyTranslatorBatch());\n+    TRANSLATORS.put(PTransformTranslation.RESHUFFLE_URN, new ReshuffleTranslatorBatch());\n+\n+    TRANSLATORS\n+        .put(PTransformTranslation.FLATTEN_TRANSFORM_URN, new FlattenPCollectionTranslatorBatch());\n+\n+    TRANSLATORS\n+        .put(PTransformTranslation.ASSIGN_WINDOWS_TRANSFORM_URN, new WindowAssignTranslatorBatch());\n+\n+    TRANSLATORS.put(PTransformTranslation.PAR_DO_TRANSFORM_URN, new ParDoTranslatorBatch());\n+\n+    TRANSLATORS.put(PTransformTranslation.READ_TRANSFORM_URN, new ReadSourceTranslatorBatch());\n+  }\n+\n+  /** Returns a translator for the given node, if it is possible, otherwise null. */\n+  private static BatchTransformTranslator<?> getTranslator(TransformHierarchy.Node node) {\n+    @Nullable PTransform<?, ?> transform = node.getTransform();\n+    // Root of the graph is null\n+    if (transform == null) {\n+      return null;\n+    }\n+    @Nullable String urn = PTransformTranslation.urnForTransformOrNull(transform);\n+    return (urn == null) ? null : TRANSLATORS.get(urn);\n+  }\n+\n+\n+  @Override public CompositeBehavior enterCompositeTransform(TransformHierarchy.Node node) {\n+    return super.enterCompositeTransform(node);\n+    //TODO impl\n+  }\n+\n+\n+  @Override public void visitPrimitiveTransform(TransformHierarchy.Node node) {\n+    super.visitPrimitiveTransform(node);\n+    //TODO impl\n+  }\n+\n+  }\ndiff --git a/runners/spark-structured-streaming/src/main/java/org/apache/beam/runners/spark/structuredstreaming/translation/batch/BatchTransformTranslator.java b/runners/spark-structured-streaming/src/main/java/org/apache/beam/runners/spark/structuredstreaming/translation/batch/BatchTransformTranslator.java\nnew file mode 100644\nindex 0000000000..ab0cf68323\n--- /dev/null\n+++ b/runners/spark-structured-streaming/src/main/java/org/apache/beam/runners/spark/structuredstreaming/translation/batch/BatchTransformTranslator.java\n@@ -0,0 +1,11 @@\n+package org.apache.beam.runners.spark.structuredstreaming.translation.batch;\n+\n+import org.apache.beam.sdk.transforms.PTransform;\n+\n+public interface BatchTransformTranslator<TransformT extends PTransform> {\n+\n+  /** A translator of a {@link PTransform} in batch mode. */\n+\n+  void translateNode(TransformT transform, BatchTranslationContext context);\n+  }\n+\ndiff --git a/runners/spark-structured-streaming/src/main/java/org/apache/beam/runners/spark/structuredstreaming/translation/batch/BatchTranslationContext.java b/runners/spark-structured-streaming/src/main/java/org/apache/beam/runners/spark/structuredstreaming/translation/batch/BatchTranslationContext.java\nnew file mode 100644\nindex 0000000000..554beeab16\n--- /dev/null\n+++ b/runners/spark-structured-streaming/src/main/java/org/apache/beam/runners/spark/structuredstreaming/translation/batch/BatchTranslationContext.java\n@@ -0,0 +1,36 @@\n+package org.apache.beam.runners.spark.structuredstreaming.translation.batch;\n+\n+import java.util.HashMap;\n+import java.util.Map;\n+import org.apache.beam.runners.spark.structuredstreaming.SparkPipelineOptions;\n+import org.apache.beam.sdk.runners.AppliedPTransform;\n+import org.apache.beam.sdk.values.PValue;\n+import org.apache.spark.sql.Dataset;\n+import org.apache.spark.sql.SparkSession;\n+\n+/**\n+ * Keeps track of the {@link Dataset} and the step the translation is in.\n+ */\n+public class BatchTranslationContext {\n+  private final Map<PValue, Dataset<?>> datasets;\n+\n+  /**\n+   * For keeping track about which DataSets don't have a successor. We need to terminate these with\n+   * a discarding sink because the Beam model allows dangling operations.\n+   */\n+  private final Map<PValue, Dataset<?>> danglingDataSets;\n+\n+  private final SparkSession sparkSession;\n+  private final SparkPipelineOptions options;\n+\n+  private AppliedPTransform<?, ?, ?> currentTransform;\n+\n+\n+  public BatchTranslationContext(SparkSession sparkSession, SparkPipelineOptions options) {\n+    this.sparkSession = sparkSession;\n+    this.options = options;\n+    this.datasets = new HashMap<>();\n+    this.danglingDataSets = new HashMap<>();\n+  }\n+\n+}\ndiff --git a/runners/spark-structured-streaming/src/main/java/org/apache/beam/runners/spark/structuredstreaming/translation/batch/CombinePerKeyTranslatorBatch.java b/runners/spark-structured-streaming/src/main/java/org/apache/beam/runners/spark/structuredstreaming/translation/batch/CombinePerKeyTranslatorBatch.java\nnew file mode 100644\nindex 0000000000..6099fbca7d\n--- /dev/null\n+++ b/runners/spark-structured-streaming/src/main/java/org/apache/beam/runners/spark/structuredstreaming/translation/batch/CombinePerKeyTranslatorBatch.java\n@@ -0,0 +1,14 @@\n+package org.apache.beam.runners.spark.structuredstreaming.translation.batch;\n+\n+import org.apache.beam.sdk.transforms.PTransform;\n+import org.apache.beam.sdk.values.KV;\n+import org.apache.beam.sdk.values.PCollection;\n+\n+class CombinePerKeyTranslatorBatch<K, InputT, AccumT, OutputT> implements BatchTransformTranslator<PTransform<PCollection<KV<K, InputT>>, PCollection<KV<K, OutputT>>>> {\n+\n+  @Override public void translateNode(\n+      PTransform<PCollection<KV<K, InputT>>, PCollection<KV<K, OutputT>>> transform,\n+      BatchTranslationContext context) {\n+\n+  }\n+}\ndiff --git a/runners/spark-structured-streaming/src/main/java/org/apache/beam/runners/spark/structuredstreaming/translation/batch/FlattenPCollectionTranslatorBatch.java b/runners/spark-structured-streaming/src/main/java/org/apache/beam/runners/spark/structuredstreaming/translation/batch/FlattenPCollectionTranslatorBatch.java\nnew file mode 100644\nindex 0000000000..281eda9087\n--- /dev/null\n+++ b/runners/spark-structured-streaming/src/main/java/org/apache/beam/runners/spark/structuredstreaming/translation/batch/FlattenPCollectionTranslatorBatch.java\n@@ -0,0 +1,13 @@\n+package org.apache.beam.runners.spark.structuredstreaming.translation.batch;\n+\n+import org.apache.beam.sdk.transforms.PTransform;\n+import org.apache.beam.sdk.values.PCollection;\n+import org.apache.beam.sdk.values.PCollectionList;\n+\n+class FlattenPCollectionTranslatorBatch<T> implements BatchTransformTranslator<PTransform<PCollectionList<T>, PCollection<T>>> {\n+\n+  @Override public void translateNode(PTransform<PCollectionList<T>, PCollection<T>> transform,\n+      BatchTranslationContext context) {\n+\n+  }\n+}\ndiff --git a/runners/spark-structured-streaming/src/main/java/org/apache/beam/runners/spark/structuredstreaming/translation/batch/GroupByKeyTranslatorBatch.java b/runners/spark-structured-streaming/src/main/java/org/apache/beam/runners/spark/structuredstreaming/translation/batch/GroupByKeyTranslatorBatch.java\nnew file mode 100644\nindex 0000000000..bb0ccc1da9\n--- /dev/null\n+++ b/runners/spark-structured-streaming/src/main/java/org/apache/beam/runners/spark/structuredstreaming/translation/batch/GroupByKeyTranslatorBatch.java\n@@ -0,0 +1,14 @@\n+package org.apache.beam.runners.spark.structuredstreaming.translation.batch;\n+\n+import org.apache.beam.sdk.transforms.PTransform;\n+import org.apache.beam.sdk.values.KV;\n+import org.apache.beam.sdk.values.PCollection;\n+\n+class GroupByKeyTranslatorBatch<K, InputT> implements BatchTransformTranslator<PTransform<PCollection<KV<K, InputT>>, PCollection<KV<K, Iterable<InputT>>>>> {\n+\n+  @Override public void translateNode(\n+      PTransform<PCollection<KV<K, InputT>>, PCollection<KV<K, Iterable<InputT>>>> transform,\n+      BatchTranslationContext context) {\n+\n+  }\n+}\ndiff --git a/runners/spark-structured-streaming/src/main/java/org/apache/beam/runners/spark/structuredstreaming/translation/batch/ParDoTranslatorBatch.java b/runners/spark-structured-streaming/src/main/java/org/apache/beam/runners/spark/structuredstreaming/translation/batch/ParDoTranslatorBatch.java\nnew file mode 100644\nindex 0000000000..4477853d7d\n--- /dev/null\n+++ b/runners/spark-structured-streaming/src/main/java/org/apache/beam/runners/spark/structuredstreaming/translation/batch/ParDoTranslatorBatch.java\n@@ -0,0 +1,13 @@\n+package org.apache.beam.runners.spark.structuredstreaming.translation.batch;\n+\n+import org.apache.beam.sdk.transforms.PTransform;\n+import org.apache.beam.sdk.values.PCollection;\n+import org.apache.beam.sdk.values.PCollectionTuple;\n+\n+class ParDoTranslatorBatch<InputT, OutputT> implements BatchTransformTranslator<PTransform<PCollection<InputT>, PCollectionTuple>> {\n+\n+  @Override public void translateNode(PTransform<PCollection<InputT>, PCollectionTuple> transform,\n+      BatchTranslationContext context) {\n+\n+  }\n+}\ndiff --git a/runners/spark-structured-streaming/src/main/java/org/apache/beam/runners/spark/structuredstreaming/translation/batch/ReadSourceTranslatorBatch.java b/runners/spark-structured-streaming/src/main/java/org/apache/beam/runners/spark/structuredstreaming/translation/batch/ReadSourceTranslatorBatch.java\nnew file mode 100644\nindex 0000000000..a30fa70fb5\n--- /dev/null\n+++ b/runners/spark-structured-streaming/src/main/java/org/apache/beam/runners/spark/structuredstreaming/translation/batch/ReadSourceTranslatorBatch.java\n@@ -0,0 +1,12 @@\n+package org.apache.beam.runners.spark.structuredstreaming.translation.batch;\n+\n+import org.apache.beam.sdk.transforms.PTransform;\n+import org.apache.beam.sdk.values.PBegin;\n+import org.apache.beam.sdk.values.PCollection;\n+\n+class ReadSourceTranslatorBatch<T> implements BatchTransformTranslator<PTransform<PBegin, PCollection<T>>> {\n+\n+  @Override public void translateNode(PTransform<PBegin, PCollection<T>> transform, BatchTranslationContext context) {\n+\n+  }\n+}\ndiff --git a/runners/spark-structured-streaming/src/main/java/org/apache/beam/runners/spark/structuredstreaming/translation/batch/ReshuffleTranslatorBatch.java b/runners/spark-structured-streaming/src/main/java/org/apache/beam/runners/spark/structuredstreaming/translation/batch/ReshuffleTranslatorBatch.java\nnew file mode 100644\nindex 0000000000..6283fdbafb\n--- /dev/null\n+++ b/runners/spark-structured-streaming/src/main/java/org/apache/beam/runners/spark/structuredstreaming/translation/batch/ReshuffleTranslatorBatch.java\n@@ -0,0 +1,11 @@\n+package org.apache.beam.runners.spark.structuredstreaming.translation.batch;\n+\n+import org.apache.beam.sdk.transforms.Reshuffle;\n+\n+class ReshuffleTranslatorBatch<K, InputT> implements BatchTransformTranslator<Reshuffle<K, InputT>> {\n+\n+  @Override public void translateNode(Reshuffle<K, InputT> transform,\n+      BatchTranslationContext context) {\n+\n+  }\n+}\ndiff --git a/runners/spark-structured-streaming/src/main/java/org/apache/beam/runners/spark/structuredstreaming/translation/batch/WindowAssignTranslatorBatch.java b/runners/spark-structured-streaming/src/main/java/org/apache/beam/runners/spark/structuredstreaming/translation/batch/WindowAssignTranslatorBatch.java\nnew file mode 100644\nindex 0000000000..21b71b9afd\n--- /dev/null\n+++ b/runners/spark-structured-streaming/src/main/java/org/apache/beam/runners/spark/structuredstreaming/translation/batch/WindowAssignTranslatorBatch.java\n@@ -0,0 +1,12 @@\n+package org.apache.beam.runners.spark.structuredstreaming.translation.batch;\n+\n+import org.apache.beam.sdk.transforms.PTransform;\n+import org.apache.beam.sdk.values.PCollection;\n+\n+class WindowAssignTranslatorBatch<T> implements BatchTransformTranslator<PTransform<PCollection<T>, PCollection<T>>> {\n+\n+  @Override public void translateNode(PTransform<PCollection<T>, PCollection<T>> transform,\n+      BatchTranslationContext context) {\n+\n+  }\n+}\ndiff --git a/runners/spark-structured-streaming/src/main/java/org/apache/beam/runners/spark/structuredstreaming/translation/StreamingPipelineTranslator.java b/runners/spark-structured-streaming/src/main/java/org/apache/beam/runners/spark/structuredstreaming/translation/streaming/StreamingPipelineTranslator.java\nsimilarity index 53%\nrename from runners/spark-structured-streaming/src/main/java/org/apache/beam/runners/spark/structuredstreaming/translation/StreamingPipelineTranslator.java\nrename to runners/spark-structured-streaming/src/main/java/org/apache/beam/runners/spark/structuredstreaming/translation/streaming/StreamingPipelineTranslator.java\nindex 2058b37ab0..547083ca5f 100644\n--- a/runners/spark-structured-streaming/src/main/java/org/apache/beam/runners/spark/structuredstreaming/translation/StreamingPipelineTranslator.java\n+++ b/runners/spark-structured-streaming/src/main/java/org/apache/beam/runners/spark/structuredstreaming/translation/streaming/StreamingPipelineTranslator.java\n@@ -1,5 +1,7 @@\n-package org.apache.beam.runners.spark.structuredstreaming.translation;\n+package org.apache.beam.runners.spark.structuredstreaming.translation.streaming;\n \n-public class StreamingPipelineTranslator extends PipelineTranslator {\n+import org.apache.beam.runners.spark.structuredstreaming.translation.PipelineTranslator;\n \n+public class StreamingPipelineTranslator extends PipelineTranslator {\n+//TODO impl\n }",
    "Add x86 - 64 MingW to README": "diff --git a/README b/README\nindex 63f43ac60..ca5eb5d8d 100644\n--- a/README\n+++ b/README\n@@ -1,7 +1,7 @@\n Status\n ======\n \n-libffi-3.0.9 was released on December 31, 2009. Check the libffi web\n+libffi-3.0.10 was released on XXXXXXXXXX, 2010. Check the libffi web\n page for updates: <URL:http://sourceware.org/libffi/>.\n \n \n@@ -80,6 +80,7 @@ tested:\n | X86-64       | FreeBSD          |\n | X86-64       | Linux            |\n | X86-64       | OpenBSD          |\n+| X86-64       | Windows/MingW    |\n |--------------+------------------|\n \n Please send additional platform test results to\ndiff --git a/patches/stand-alone b/patches/stand-alone\nindex 5852f5eda..5ee06a974 100644\n--- a/patches/stand-alone\n+++ b/patches/stand-alone\n@@ -43650,13 +43650,26 @@ Index: libffi/README\n ===================================================================\n --- libffi.orig/README\n +++ libffi/README\n-@@ -1,6 +1,3 @@\n+@@ -1,10 +1,7 @@\n -This directory contains the libffi package, which is not part of GCC but\n -shipped with GCC as convenience.\n -\n  Status\n  ======\n  \n+-libffi-3.0.9 was released on December 31, 2009. Check the libffi web\n++libffi-3.0.10 was released on XXXXXXXXXX, 2010. Check the libffi web\n+ page for updates: <URL:http://sourceware.org/libffi/>.\n+ \n+ \n+@@ -83,6 +80,7 @@ tested:\n+ | X86-64       | FreeBSD          |\n+ | X86-64       | Linux            |\n+ | X86-64       | OpenBSD          |\n++| X86-64       | Windows/MingW    |\n+ |--------------+------------------|\n+ \n+ Please send additional platform test results to\n Index: libffi/testsuite/Makefile.am\n ===================================================================\n --- libffi.orig/testsuite/Makefile.am",
    "no functional change . . reformating and fix some checkstyle warnings .": "diff --git a/java/org/apache/catalina/core/AsyncContextImpl.java b/java/org/apache/catalina/core/AsyncContextImpl.java\nindex 83aebb56ec..ca531dbc4a 100644\n--- a/java/org/apache/catalina/core/AsyncContextImpl.java\n+++ b/java/org/apache/catalina/core/AsyncContextImpl.java\n@@ -1,13 +1,13 @@\n-/*\n+/**\n  * Licensed to the Apache Software Foundation (ASF) under one or more\n  * contributor license agreements.  See the NOTICE file distributed with\n  * this work for additional information regarding copyright ownership.\n  * The ASF licenses this file to You under the Apache License, Version 2.0\n  * (the \"License\"); you may not use this file except in compliance with\n  * the License.  You may obtain a copy of the License at\n- * \n+ *\n  *      http://www.apache.org/licenses/LICENSE-2.0\n- * \n+ *\n  * Unless required by applicable law or agreed to in writing, software\n  * distributed under the License is distributed on an \"AS IS\" BASIS,\n  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n@@ -40,19 +40,21 @@ import org.apache.catalina.connector.Request;\n import org.apache.coyote.ActionCode;\n import org.apache.juli.logging.Log;\n import org.apache.juli.logging.LogFactory;\n+\n /**\n- * \n+ *\n  * @author fhanik\n  *\n  */\n public class AsyncContextImpl implements AsyncContext {\n-    \n+\n     public static enum AsyncState {\n-        NOT_STARTED, STARTED, DISPATCHING, DISPATCHED, COMPLETING, TIMING_OUT, ERROR_DISPATCHING\n+        NOT_STARTED, STARTED, DISPATCHING,\n+        DISPATCHED, COMPLETING, TIMING_OUT, ERROR_DISPATCHING\n     }\n-    \n+\n     private static final Log log = LogFactory.getLog(AsyncContextImpl.class);\n-    \n+\n     private ServletRequest servletRequest = null;\n     private ServletResponse servletResponse = null;\n     private List<AsyncListenerWrapper> listeners = new ArrayList<AsyncListenerWrapper>();\n@@ -62,12 +64,15 @@ public class AsyncContextImpl implements AsyncContext {\n     private AtomicReference<AsyncState> state = new AtomicReference<AsyncState>(AsyncState.NOT_STARTED);\n     private long timeout = -1;\n     private AsyncEvent event = null;\n-    \n+\n     private Request request;\n-    \n+\n     public AsyncContextImpl(Request request) {\n         if (log.isDebugEnabled()) {\n-            log.debug(\"AsyncContext created[\"+request.getRequestURI()+\"?\"+request.getQueryString()+\"]\", new DebugException());\n+            log.debug(\"AsyncContext created[\" \n+                + request.getRequestURI() \n+                + \"?\" + request.getQueryString() + \"]\",\n+                new DebugException());\n         }\n         //TODO SERVLET3 - async\n         this.request = request;\n@@ -76,81 +81,102 @@ public class AsyncContextImpl implements AsyncContext {\n     @Override\n     public void complete() {\n         if (log.isDebugEnabled()) {\n-            log.debug(\"AsyncContext Complete Called[\"+state.get()+\"; \"+request.getRequestURI()+\"?\"+request.getQueryString()+\"]\", new DebugException());\n+            log.debug(\"AsyncContext Complete Called[\" \n+                + state.get() + \"; \"\n+                + request.getRequestURI()\n+                + \"?\" + request.getQueryString() + \"]\",\n+                new DebugException());\n         }\n-        if (state.get()==AsyncState.COMPLETING) {\n+        if (state.get() == AsyncState.COMPLETING) {\n             //do nothing\n-        } else if (state.compareAndSet(AsyncState.DISPATCHED, AsyncState.COMPLETING) ||\n-                   state.compareAndSet(AsyncState.STARTED, AsyncState.COMPLETING)) {\n+        } else if (state.compareAndSet(AsyncState.DISPATCHED, AsyncState.COMPLETING)\n+                   || state.compareAndSet(AsyncState.STARTED, AsyncState.COMPLETING)) {\n             // TODO SERVLET3 - async\n             AtomicBoolean dispatched = new AtomicBoolean(false);\n-            request.getCoyoteRequest().action(ActionCode.ACTION_ASYNC_COMPLETE,dispatched);\n-            if (!dispatched.get()) doInternalComplete(false);\n+            request.getCoyoteRequest().action(\n+                ActionCode.ACTION_ASYNC_COMPLETE, dispatched);\n+            if (!dispatched.get()) {\n+                doInternalComplete(false);\n+            }\n         } else {\n-            throw new IllegalStateException(\"Complete not allowed. Invalid state:\"+state.get());\n+            throw new IllegalStateException(\n+                \"Complete not allowed. Invalid state:\" + state.get());\n         }\n-       \n+\n     }\n \n     @Override\n     public void dispatch() {\n-        HttpServletRequest sr = (HttpServletRequest)getServletRequest();\n+        HttpServletRequest sr = (HttpServletRequest) getServletRequest();\n         String path = sr.getRequestURI();\n-        String cpath = sr.getContextPath();\n-        if (cpath.length()>1) path = path.substring(cpath.length());\n+        final String cpath = sr.getContextPath();\n+        if (cpath.length() > 1) {\n+            path = path.substring(cpath.length());\n+        }\n         dispatch(path);\n     }\n \n     @Override\n-    public void dispatch(String path) {\n-        dispatch(request.getServletContext(),path);\n+    public void dispatch(final String path) {\n+        dispatch(request.getServletContext(), path);\n     }\n \n     @Override\n-    public void dispatch(ServletContext context, String path) {\n+    public void dispatch(final ServletContext dispachContext,\n+        final String path) {\n         if (log.isDebugEnabled()) {\n-            log.debug(\"AsyncContext Dispatch Called[\"+state.get()+\"; \"+path+\"; \"+request.getRequestURI()+\"?\"+request.getQueryString()+\"]\", new DebugException());\n+            log.debug(\"AsyncContext Dispatch Called[\"\n+                    + state.get() + \"; \"\n+                    + path + \"; \"\n+                    + request.getRequestURI()\n+                    + \"?\" + request.getQueryString() + \"]\",\n+                    new DebugException());\n         }\n \n         // TODO SERVLET3 - async\n-        if (state.compareAndSet(AsyncState.STARTED, AsyncState.DISPATCHING) ||\n-            state.compareAndSet(AsyncState.DISPATCHED, AsyncState.DISPATCHING)) {\n-\n-            if (request.getAttribute(ASYNC_REQUEST_URI)==null) {\n-                request.setAttribute(ASYNC_REQUEST_URI, request.getRequestURI()+\"?\"+request.getQueryString());\n-                request.setAttribute(ASYNC_CONTEXT_PATH, request.getContextPath());\n-                request.setAttribute(ASYNC_SERVLET_PATH, request.getServletPath());\n-                request.setAttribute(ASYNC_QUERY_STRING, request.getQueryString());\n+        if (state.compareAndSet(AsyncState.STARTED, AsyncState.DISPATCHING)\n+            || state.compareAndSet(AsyncState.DISPATCHED, AsyncState.DISPATCHING)) {\n+\n+            if (request.getAttribute(ASYNC_REQUEST_URI) == null) {\n+                request.setAttribute(ASYNC_REQUEST_URI,\n+                    request.getRequestURI() + \"?\" + request.getQueryString());\n+                request.setAttribute(ASYNC_CONTEXT_PATH,\n+                    request.getContextPath());\n+                request.setAttribute(ASYNC_SERVLET_PATH,\n+                    request.getServletPath());\n+                request.setAttribute(ASYNC_QUERY_STRING,\n+                    request.getQueryString());\n             }\n-            final RequestDispatcher requestDispatcher = context.getRequestDispatcher(path);\n-            final HttpServletRequest servletRequest = (HttpServletRequest)getRequest();\n-            final HttpServletResponse servletResponse = (HttpServletResponse)getResponse();\n+            final RequestDispatcher requestDispatcher = dispachContext.getRequestDispatcher(path);\n+            final HttpServletRequest sRequest = (HttpServletRequest) getRequest();\n+            final HttpServletResponse sResponse = (HttpServletResponse) getResponse();\n             Runnable run = new Runnable() {\n                 public void run() {\n-                    DispatcherType type = (DispatcherType)request.getAttribute(Globals.DISPATCHER_TYPE_ATTR);\n+                    DispatcherType type = (DispatcherType) request.getAttribute(Globals.DISPATCHER_TYPE_ATTR);\n                     try {\n                         //piggy back on the request dispatcher to ensure that filters etc get called.\n                         //TODO SERVLET3 - async should this be include/forward or a new dispatch type\n                         //javadoc suggests include with the type of DispatcherType.ASYNC\n                         request.setAttribute(Globals.DISPATCHER_TYPE_ATTR, DispatcherType.ASYNC);\n-                        requestDispatcher.include(servletRequest, servletResponse);\n-                    }catch (Exception x) {\n+                        requestDispatcher.include(sRequest, sResponse);\n+                    } catch (Exception x) {\n                         //log.error(\"Async.dispatch\",x);\n                         throw new RuntimeException(x);\n-                    }finally {\n+                    } finally {\n                         request.setAttribute(Globals.DISPATCHER_TYPE_ATTR, type);\n                     }\n                 }\n             };\n             this.dispatch = run;\n             AtomicBoolean dispatched = new AtomicBoolean(false);\n-            request.getCoyoteRequest().action(ActionCode.ACTION_ASYNC_DISPATCH, dispatched );\n+            request.getCoyoteRequest().action(\n+                ActionCode.ACTION_ASYNC_DISPATCH, dispatched);\n             if (!dispatched.get()) {\n                 try {\n                     doInternalDispatch();\n-                }catch (ServletException sx) {\n+                } catch (ServletException sx) {\n                     throw new RuntimeException(sx);\n-                }catch (IOException ix) {\n+                } catch (IOException ix) {\n                     throw new RuntimeException(ix);\n                 }\n             }\n@@ -158,7 +184,8 @@ public class AsyncContextImpl implements AsyncContext {\n                 complete();\n             }\n         } else {\n-            throw new IllegalStateException(\"Dispatch not allowed. Invalid state:\"+state.get());\n+            throw new IllegalStateException(\n+               \"Dispatch not allowed. Invalid state:\" + state.get());\n         }\n     }\n \n@@ -175,51 +202,59 @@ public class AsyncContextImpl implements AsyncContext {\n     @Override\n     public void start(final Runnable run) {\n         if (log.isDebugEnabled()) {\n-            log.debug(\"AsyncContext Start Called[\"+state.get()+\"; \"+request.getRequestURI()+\"?\"+request.getQueryString()+\"]\", new DebugException());\n+            log.debug(\"AsyncContext Start Called[\"\n+                    + state.get() + \"; \"\n+                    + request.getRequestURI()\n+                    + \"?\" + request.getQueryString() + \"]\",\n+                    new DebugException());\n         }\n \n-        if (state.compareAndSet(AsyncState.STARTED, AsyncState.DISPATCHING) ||\n-            state.compareAndSet(AsyncState.DISPATCHED, AsyncState.DISPATCHING)) {\n+        if (state.compareAndSet(AsyncState.STARTED, AsyncState.DISPATCHING)\n+            || state.compareAndSet(AsyncState.DISPATCHED, AsyncState.DISPATCHING)) {\n             // TODO SERVLET3 - async\n             final ServletContext sctx = getServletRequest().getServletContext();\n             Runnable r = new Runnable() {\n                 public void run() {\n-                    //TODO SERVLET3 - async - set context class loader when running the task.\n+                    //TODO SERVLET3 -\n+                    //async - set context class loader when running the task.\n                     try {\n-                        \n+\n                         run.run();\n-                    }catch (Exception x) {\n-                        log.error(\"Unable to run async task.\",x);\n+                    } catch (Exception x) {\n+                        log.error(\"Unable to run async task.\", x);\n                     }\n                 }\n             };\n             this.dispatch = r;\n             AtomicBoolean dispatched = new AtomicBoolean(false);\n-            request.getCoyoteRequest().action(ActionCode.ACTION_ASYNC_DISPATCH, dispatched );\n+            request.getCoyoteRequest().action(\n+                ActionCode.ACTION_ASYNC_DISPATCH, dispatched);\n             if (!dispatched.get()) {\n                 try {\n                     doInternalDispatch();\n-                }catch (ServletException sx) {\n+                } catch (ServletException sx) {\n                     throw new RuntimeException(sx);\n-                }catch (IOException ix) {\n+                } catch (IOException ix) {\n                     throw new RuntimeException(ix);\n                 }\n             }\n         } else {\n-            throw new IllegalStateException(\"Dispatch not allowed. Invalid state:\"+state.get());\n+            throw new IllegalStateException(\n+                \"Dispatch not allowed. Invalid state:\" + state.get());\n         }\n     }\n-    \n+\n     @Override\n-    public void addListener(AsyncListener listener) {\n+    public void addListener(final AsyncListener listener) {\n         AsyncListenerWrapper wrapper = new AsyncListenerWrapper();\n         wrapper.setListener(listener);\n         listeners.add(wrapper);\n     }\n \n     @Override\n-    public void addListener(AsyncListener listener, ServletRequest servletRequest,\n-            ServletResponse servletResponse) {\n+    public void addListener(final AsyncListener listener,\n+            final ServletRequest sRequest,\n+            final ServletResponse sResponse) {\n         AsyncListenerWrapper wrapper = new AsyncListenerWrapper();\n         wrapper.setListener(listener);\n         listeners.add(wrapper);\n@@ -240,7 +275,7 @@ public class AsyncContextImpl implements AsyncContext {\n         }\n         return listener;\n     }\n-    \n+\n     public void recycle() {\n         servletRequest = null;\n         servletResponse = null;\n@@ -253,15 +288,18 @@ public class AsyncContextImpl implements AsyncContext {\n     }\n \n     public boolean isStarted() {\n-        return (state.get() == AsyncState.STARTED || state.get() == AsyncState.DISPATCHING || state.get() == AsyncState.DISPATCHED);\n+        return (state.get() == AsyncState.STARTED ||\n+                state.get() == AsyncState.DISPATCHING ||\n+                state.get() == AsyncState.DISPATCHED);\n     }\n \n     public void setStarted(Context context) {\n         if (state.compareAndSet(AsyncState.NOT_STARTED, AsyncState.STARTED) ||\n-                state.compareAndSet(AsyncState.DISPATCHED, AsyncState.STARTED)) {\n+            state.compareAndSet(AsyncState.DISPATCHED, AsyncState.STARTED)) {\n             this.context = context;\n         } else {\n-            throw new IllegalStateException(\"Start illegal. Invalid state: \"+state.get());\n+            throw new IllegalStateException(\"Start illegal. Invalid state: \" +\n+               state.get());\n         }\n     }\n \n@@ -278,7 +316,8 @@ public class AsyncContextImpl implements AsyncContext {\n         return hasOriginalRequestAndResponse;\n     }\n \n-    public void setHasOriginalRequestAndResponse(boolean hasOriginalRequestAndResponse) {\n+    public void setHasOriginalRequestAndResponse(\n+            boolean hasOriginalRequestAndResponse) {\n         this.hasOriginalRequestAndResponse = hasOriginalRequestAndResponse;\n     }\n \n@@ -289,11 +328,12 @@ public class AsyncContextImpl implements AsyncContext {\n     public void setCompleted() {\n         this.state.set(AsyncState.NOT_STARTED);\n     }\n-    \n+\n     public void doInternalDispatch() throws ServletException, IOException {\n-        if (this.state.compareAndSet(AsyncState.TIMING_OUT, AsyncState.COMPLETING)) {\n-        \tif( log.isDebugEnabled())\n-        \t    log.debug(\"TIMING OUT!\");\n+        if (this.state.compareAndSet(\n+                AsyncState.TIMING_OUT, AsyncState.COMPLETING)) {\n+      ",
    "add toString ( ) s to Metrics classes .": "diff --git a/runners/core-construction-java/src/main/java/org/apache/beam/runners/core/construction/metrics/MetricKey.java b/runners/core-construction-java/src/main/java/org/apache/beam/runners/core/construction/metrics/MetricKey.java\nindex f4d1e9d4ac..4bfabe0c12 100644\n--- a/runners/core-construction-java/src/main/java/org/apache/beam/runners/core/construction/metrics/MetricKey.java\n+++ b/runners/core-construction-java/src/main/java/org/apache/beam/runners/core/construction/metrics/MetricKey.java\n@@ -34,6 +34,11 @@ public abstract class MetricKey implements Serializable {\n   /** The name of the metric. */\n   public abstract MetricName metricName();\n \n+  @Override\n+  public String toString() {\n+    return String.format(\"%s:%s\", stepName(), metricName());\n+  }\n+\n   public static MetricKey create(String stepName, MetricName metricName) {\n     return new AutoValue_MetricKey(stepName, metricName);\n   }\ndiff --git a/runners/core-java/src/main/java/org/apache/beam/runners/core/metrics/MetricsContainerStepMap.java b/runners/core-java/src/main/java/org/apache/beam/runners/core/metrics/MetricsContainerStepMap.java\nindex f2c6f03da7..6a73e679aa 100644\n--- a/runners/core-java/src/main/java/org/apache/beam/runners/core/metrics/MetricsContainerStepMap.java\n+++ b/runners/core-java/src/main/java/org/apache/beam/runners/core/metrics/MetricsContainerStepMap.java\n@@ -212,6 +212,11 @@ public class MetricsContainerStepMap implements Serializable {\n       };\n     }\n \n+    @Override\n+    public String toString() {\n+      return queryMetrics(null).toString();\n+    }\n+\n     @Override\n     public MetricQueryResults queryMetrics(@Nullable MetricsFilter filter) {\n       return new QueryResults(filter);\ndiff --git a/sdks/java/core/src/main/java/org/apache/beam/sdk/metrics/MetricName.java b/sdks/java/core/src/main/java/org/apache/beam/sdk/metrics/MetricName.java\nindex 3ffea6ec80..ae23ff0c23 100644\n--- a/sdks/java/core/src/main/java/org/apache/beam/sdk/metrics/MetricName.java\n+++ b/sdks/java/core/src/main/java/org/apache/beam/sdk/metrics/MetricName.java\n@@ -50,6 +50,11 @@ public abstract class MetricName implements Serializable {\n   /** The name of this metric. */\n   public abstract String getName();\n \n+  @Override\n+  public String toString() {\n+    return String.format(\"%s:%s\", getNamespace(), getName());\n+  }\n+\n   /**\n    * The name of this metric.\n    *\ndiff --git a/sdks/java/core/src/main/java/org/apache/beam/sdk/metrics/MetricQueryResults.java b/sdks/java/core/src/main/java/org/apache/beam/sdk/metrics/MetricQueryResults.java\nindex baae446174..359c6904f1 100644\n--- a/sdks/java/core/src/main/java/org/apache/beam/sdk/metrics/MetricQueryResults.java\n+++ b/sdks/java/core/src/main/java/org/apache/beam/sdk/metrics/MetricQueryResults.java\n@@ -18,8 +18,10 @@\n package org.apache.beam.sdk.metrics;\n \n import com.google.auto.value.AutoValue;\n+import java.util.List;\n import org.apache.beam.sdk.annotations.Experimental;\n import org.apache.beam.sdk.annotations.Experimental.Kind;\n+import org.apache.beam.vendor.grpc.v1p13p1.com.google.common.collect.ImmutableList;\n \n /**\n  * The results of a query for metrics. Allows accessing all of the metrics that matched the filter.\n@@ -36,6 +38,46 @@ public abstract class MetricQueryResults {\n   /** Return the metric results for the getGauges that matched the filter. */\n   public abstract Iterable<MetricResult<GaugeResult>> getGauges();\n \n+  static <T> void printMetrics(String type, Iterable<MetricResult<T>> metrics, StringBuilder sb) {\n+    List<MetricResult<T>> metricsList = ImmutableList.copyOf(metrics);\n+    if (!metricsList.isEmpty()) {\n+      sb.append(type).append(\"(\");\n+      boolean first = true;\n+      for (MetricResult<T> metricResult : metricsList) {\n+        if (first) {\n+          first = false;\n+        } else {\n+          sb.append(\", \");\n+        }\n+        MetricName name = metricResult.getName();\n+        sb.append(metricResult.getStep())\n+            .append(\":\")\n+            .append(name.getNamespace())\n+            .append(\":\")\n+            .append(name.getName())\n+            .append(\": \")\n+            .append(metricResult.getAttempted());\n+        try {\n+          T committed = metricResult.getCommitted();\n+          sb.append(\", \").append(committed);\n+        } catch (UnsupportedOperationException ignored) {\n+        }\n+      }\n+      sb.append(\")\");\n+    }\n+  }\n+\n+  @Override\n+  public String toString() {\n+    StringBuilder sb = new StringBuilder();\n+    sb.append(\"MetricQueryResults(\");\n+    printMetrics(\"Counters\", getCounters(), sb);\n+    printMetrics(\"Distributions\", getDistributions(), sb);\n+    printMetrics(\"Gauges\", getGauges(), sb);\n+    sb.append(\")\");\n+    return sb.toString();\n+  }\n+\n   public static MetricQueryResults create(\n       Iterable<MetricResult<Long>> counters,\n       Iterable<MetricResult<DistributionResult>> distributions,",
    "Provides some chat room fixes and improvements including the / me command and TAB key .": "diff --git a/src/net/java/sip/communicator/impl/gui/main/chat/ChatConversationPanel.java b/src/net/java/sip/communicator/impl/gui/main/chat/ChatConversationPanel.java\nindex 49529033b..1ecdeccae 100755\n--- a/src/net/java/sip/communicator/impl/gui/main/chat/ChatConversationPanel.java\n+++ b/src/net/java/sip/communicator/impl/gui/main/chat/ChatConversationPanel.java\n@@ -815,9 +815,9 @@ private String processKeyword(  String message,\n             String keywordMatch = m.group().trim();\n \n             msgBuffer.append(endPlainTextTag);\n-            msgBuffer.append(\"<h7>\");\n+            msgBuffer.append(\"<b>\");\n             msgBuffer.append(keywordMatch);\n-            msgBuffer.append(\"</h7>\");\n+            msgBuffer.append(\"</b>\");\n             msgBuffer.append(startPlainTextTag);\n         }\n \n@@ -1414,4 +1414,99 @@ public void loadSkin()\n \n         getRightButtonMenu().loadSkin();\n     }\n+\n+    /**\n+     * Highlights the string in multi user chat.\n+     * \n+     * @param message the message to process\n+     * @param contentType the content type of the message\n+     * @param keyWord the keyword to highlight\n+     * @return the message string with the keyword highlighted\n+     */\n+    public String processChatRoomHighlight(String message, String contentType,\n+        String keyWord)\n+    {\n+        return processKeyword(message, contentType, keyWord);\n+    }\n+    \n+    public String processMeCommand(ChatMessage chatMessage)\n+    {\n+        String contentType = chatMessage.getContentType();\n+        String message = chatMessage.getMessage();\n+\n+        String msgID = \"message\";\n+        String chatString = \"\";\n+        String endHeaderTag = \"\";\n+\n+        String startDivTag = \"<DIV identifier=\\\"\" + msgID + \"\\\">\";\n+        String endDivTag = \"</DIV>\";\n+\n+        String startPlainTextTag;\n+        String endPlainTextTag;\n+\n+        if (HTML_CONTENT_TYPE.equals(contentType))\n+        {\n+            startPlainTextTag = \"\";\n+            endPlainTextTag = \"\";\n+        }\n+        else\n+        {\n+            startPlainTextTag = START_PLAINTEXT_TAG;\n+            endPlainTextTag = END_PLAINTEXT_TAG;\n+        }\n+\n+        if (message.length() > 4 && message.substring(0, 4).equals(\"/me \"))\n+        {\n+            chatString = startDivTag + \"<B><I>\";\n+\n+            endHeaderTag = \"</I></B>\" + endDivTag;\n+\n+            chatString +=\n+\n+                processHTMLChars(\"*** \" + chatMessage.getContactName() + \" \"\n+                    + message.substring(4))\n+                    + endHeaderTag;\n+\n+            Map<String, ReplacementService> listSources =\n+                GuiActivator.getReplacementSources();\n+\n+            Iterator<Entry<String, ReplacementService>> entrySetIter =\n+                listSources.entrySet().iterator();\n+            StringBuffer msgStore = new StringBuffer(chatString);\n+\n+            for (int i = 0; i < listSources.size(); i++)\n+            {\n+                Map.Entry<String, ReplacementService> entry =\n+                    entrySetIter.next();\n+\n+                ReplacementService source = entry.getValue();\n+\n+                boolean isSmiley = source instanceof SmiliesReplacementService;\n+                if (isSmiley)\n+                {\n+                    String sourcePattern = source.getPattern();\n+                    Pattern p =\n+                        Pattern.compile(sourcePattern, Pattern.CASE_INSENSITIVE\n+                            | Pattern.DOTALL);\n+                    Matcher m = p.matcher(msgStore);\n+\n+                    StringBuffer msgTemp = new StringBuffer(chatString);\n+\n+                    while (m.find())\n+                    {\n+                        msgTemp.insert(m.start(), startPlainTextTag);\n+                        msgTemp.insert(m.end() + startPlainTextTag.length(),\n+                            endPlainTextTag);\n+\n+                    }\n+                    if (msgTemp.length() != msgStore.length())\n+                        msgStore = msgTemp;\n+                }\n+            }\n+\n+            return msgStore.toString();\n+        }\n+        else\n+            return \"\";\n+    }\n }\ndiff --git a/src/net/java/sip/communicator/impl/gui/main/chat/ChatPanel.java b/src/net/java/sip/communicator/impl/gui/main/chat/ChatPanel.java\nindex 362abe66b..fbaa37512 100644\n--- a/src/net/java/sip/communicator/impl/gui/main/chat/ChatPanel.java\n+++ b/src/net/java/sip/communicator/impl/gui/main/chat/ChatPanel.java\n@@ -55,6 +55,7 @@ public class ChatPanel\n                 ChatConversationContainer,\n                 ChatRoomMemberRoleListener,\n                 ChatRoomLocalUserRoleListener,\n+                ChatRoomMemberPropertyChangeListener,\n                 FileTransferStatusListener,\n                 Skinnable\n {\n@@ -278,6 +279,9 @@ else if (chatSession instanceof ConferenceChatSession)\n             confSession.addLocalUserRoleListener(this);\n             confSession.addMemberRoleListener(this);\n \n+            ((ChatRoomWrapper) chatSession.getDescriptor())\n+                .getChatRoom().addMemberPropertyChangeListener(this);\n+\n             subjectPanel\n                 = new ChatRoomSubjectPanel((ConferenceChatSession) chatSession);\n \n@@ -766,6 +770,29 @@ private void appendChatMessage(ChatMessage chatMessage)\n         String processedMessage\n             = this.conversationPanel.processMessage(chatMessage);\n \n+        if (chatSession instanceof ConferenceChatSession)\n+        {\n+            if (chatMessage.getMessageType().equals(Chat.INCOMING_MESSAGE))\n+            {\n+                String keyWord =\n+                    ((ChatRoomWrapper) chatSession.getDescriptor())\n+                        .getChatRoom().getUserNickname();\n+\n+                processedMessage =\n+                    this.conversationPanel\n+                        .processChatRoomHighlight(processedMessage,\n+                            chatMessage.getContentType(), keyWord);\n+            }\n+\n+            String meCommandMsg\n+                = this.conversationPanel.processMeCommand(chatMessage);\n+\n+            if (meCommandMsg.length() > 0)\n+            {\n+                processedMessage = meCommandMsg;\n+            }\n+        }\n+\n         this.conversationPanel.appendMessageToEnd(processedMessage);\n     }\n \n@@ -791,7 +818,19 @@ private String processHistoryMessage(String contactName,\n         ChatMessage chatMessage = new ChatMessage(contactName, date,\n             messageType, message, contentType);\n \n-        return this.conversationPanel.processMessage(chatMessage);\n+        String processedMessage =\n+            this.conversationPanel.processMessage(chatMessage);\n+        if (chatSession instanceof ConferenceChatSession)\n+        {\n+            String tempMessage =\n+                conversationPanel.processMeCommand(chatMessage);\n+            if (tempMessage.length() > 0)\n+            {\n+                processedMessage = tempMessage;\n+            }\n+        }\n+\n+        return processedMessage;\n     }\n \n     /**\n@@ -983,7 +1022,17 @@ public void removeChatEditorKeyListener(KeyListener l)\n      */\n     public String getMessage()\n     {\n-        return writeMessagePanel.getEditorPane().getText();\n+        Document writeEditorDoc\n+            = writeMessagePanel.getEditorPane().getDocument();\n+\n+        try\n+        {\n+            return writeEditorDoc.getText(0, writeEditorDoc.getLength());\n+        }\n+        catch (BadLocationException e)\n+        {\n+            return writeMessagePanel.getEditorPane().getText();\n+        }\n     }\n \n     /**\n@@ -2419,4 +2468,18 @@ public void loadSkin()\n         }\n         loadHistory();\n     }\n+\n+    /**\n+     *  Notifies the user if any member of the chatroom changes nickname\n+     */\n+    public void chatRoomPropertyChanged(ChatRoomMemberPropertyChangeEvent event)\n+    {\n+        this.conversationPanel\n+            .appendMessageToEnd(\n+                \"<DIV identifier=\\\"message\\\" style=\\\"color:#707070;\\\">\"\n+                + event.getOldValue()\n+                + \" is now known as \"\n+                + event.getNewValue() + \"</DIV>\");\n+        \n+    }\n }\n\\ No newline at end of file\ndiff --git a/src/net/java/sip/communicator/impl/gui/main/chat/ChatWritePanel.java b/src/net/java/sip/communicator/impl/gui/main/chat/ChatWritePanel.java\nindex a58699d03..3ded2ff4e 100755\n--- a/src/net/java/sip/communicator/impl/gui/main/chat/ChatWritePanel.java\n+++ b/src/net/java/sip/communicator/impl/gui/main/chat/ChatWritePanel.java\n@@ -27,6 +27,7 @@\n import net.java.sip.communicator.util.*;\n import net.java.sip.communicator.util.skin.*;\n import net.java.sip.communicator.util.swing.*;\n+import net.java.sip.communicator.impl.gui.main.chat.conference.*;\n \n /**\n  * The <tt>ChatWritePanel</tt> is the panel, where user writes her messages.\n@@ -540,6 +541,105 @@ else if ((e.getModifiers() & KeyEvent.CTRL_MASK) == KeyEvent.CTRL_MASK\n             if (undo.canRedo())\n                 redo();\n         }\n+        else if(e.getKeyCode() == KeyEvent.VK_TAB)\n+        {\n+            if(!(chatPanel.getChatSession() instanceof ConferenceChatSession))\n+                return;\n+\n+            e.consume();\n+            int index = ((JEditorPane)e.getSource()).getCaretPosition();\n+\n+            StringBuffer message = new StringBuffer(chatPanel.getMessage());\n+\n+            int position = index-1;\n+\n+            while (position > 0 && (message.charAt(position) != ' '))\n+            {\n+                position--;\n+            }\n+\n+            if(position != 0)\n+                position++;\n+\n+            String sequence = message.substring(position, index);\n+\n+            Iterator<ChatContact<?>> iter = chatPanel.getChatSession()\n+                                             .getParticipants();\n+            ArrayList<String> contacts = new ArrayList<String>();\n+            while(iter.hasNext())\n+            {\n+                ChatContact c = iter.next();\n+                if(c.getName().length() >= (index-position) && \n+                    c.getName().substring(0,index-position).equals(sequence))\n+                {\n+                    message.replace(position, index, c.getName()\n+                        .substring(0,index-position));\n+                    contacts.add(c.getName());\n+                }\n+            }\n+\n+            if(contacts.size() > 1)\n+            {\n+                char key = contacts.get(0).charAt(index-position-1);\n+                int pos = index-position-1;\n+                boolean flag = true;\n+\n+                while(flag)\n+                {\n+                    try\n+                    {\n+                        for(String name : contacts)\n+                        {\n+                            if(key != name.charAt(pos))\n+                            {\n+                                flag = false;\n+                            }\n+                        }\n+\n+                        if(flag)\n+                        {\n+                            pos++;\n+                            key = contacts.get(0).charAt(pos);\n+                        }\n+                    }\n+                    catch(IndexOutOfBoundsException exp)\n+                    {\n+                        flag = false;\n+                    }\n+                }\n+\n+                message.replace(position, index, contacts.get(0)\n+                    .substring(0,pos));\n+\n+                Iterator<String> contactIter = contacts.iterator();\n+                String contactList = \"<DIV align='left'><h5>\";\n+                while(contactIter.hasNext()) \n+                {\n+                    contactList += contactIter.next() + \" \";\n+                }\n+                contactList += \"</h5></DIV>\";\n+\n+                chatPanel.getChatConversationPanel()\n+                    .appendMessageToEnd(contactList);\n+            }\n+            else if(contacts.size() == 1)\n+            {\n+                String limiter = (position == 0) ? \": \" : \"\";\n+                message.replace(position, index, contacts.get(0) + limiter);\n+            }\n+\n+            try\n+            {\n+                ((JEditorPane)e.getSource()).getDocument().remove(0, \n+                    ((JEditorPane)e.getSource()).getDocument().getLength());\n+                ((JEditorPane)e.getSource()).getDocument().insertString(0, \n+                    message.toString(), null);\n+            }\n+            catch (BadLocationException ex)\n+            {\n+                ex.printStackTrace();\n+            }\n+        }\n     }\n \n     public void keyReleased(KeyEvent e) {}\ndiff --git a/src/net/java/sip/communicator/impl/gui/main/chat/conference/ConferenceChatManager.java b/src/net/java/sip/communicator/impl/gui/main/chat/conference/ConferenceChatManager.java\nindex 87a6a5c8a..8a7f7c5fd 100644\n--- a/src/net/java/sip/communicator/impl/gui/main/chat/conference/ConferenceChatManager.java\n+++ b/src/net/java/sip/communicator/impl/gui/main/chat/conference/ConferenceChatManager.java\n@@ -176,7 +176,7 @@ public void messageDelivered(ChatRoomMessageDeliveredEvent evt)\n             Message msg = evt.getMessage();\n",
    "Hide debug navigation buttons when there is no debug hit .": "diff --git a/modules/web/js/debugger/tools.js b/modules/web/js/debugger/tools.js\nindex 5abdaa9044e..edc4a5da09f 100644\n--- a/modules/web/js/debugger/tools.js\n+++ b/modules/web/js/debugger/tools.js\n@@ -37,18 +37,21 @@ define(['jquery', 'backbone', 'lodash', 'log', 'event_channel', './debug-manager\n             + '</div>'             \n             + '<div class=\"\">'\n             + '<button type=\"button\" class=\"btn btn-default btn-debug-action\" data-action=\"Stop\"  title=\"Stop Debug ( Alt + P )\"><i class=\"fw fw-stop\" /></button>' \n-            + '<button type=\"button\" class=\"btn btn-default btn-debug-action\" data-action=\"Resume\"  title=\"Resume ( Alt + R )\"><i class=\"fw fw-start \" /></button>' \n-            + '<button type=\"button\" class=\"btn btn-default btn-debug-action\" data-action=\"StepOver\"  title=\"Step Over ( Alt + O )\"><i class=\"fw fw-stepover \" /></button>' \n-            + '<button type=\"button\" class=\"btn btn-default btn-debug-action\" data-action=\"StepIn\"  title=\"Step In ( Alt + I )\"><i class=\"fw fw-stepin \" /></button>' \n-            + '<button type=\"button\" class=\"btn btn-default btn-debug-action\" data-action=\"StepOut\"  title=\"Step Out ( Alt + U )\"><i class=\"fw fw-stepout \" /></button>'\n+            + '<button type=\"button\" class=\"btn btn-default btn-debug-action <% if (!navigation) { %>disabled<%}%>\" data-action=\"Resume\"  title=\"Resume ( Alt + R )\"><i class=\"fw fw-start \" /></button>' \n+            + '<button type=\"button\" class=\"btn btn-default btn-debug-action <% if (!navigation) { %>disabled<%}%>\" data-action=\"StepOver\"  title=\"Step Over ( Alt + O )\"><i class=\"fw fw-stepover \" /></button>' \n+            + '<button type=\"button\" class=\"btn btn-default btn-debug-action <% if (!navigation) { %>disabled<%}%>\" data-action=\"StepIn\"  title=\"Step In ( Alt + I )\"><i class=\"fw fw-stepin \" /></button>' \n+            + '<button type=\"button\" class=\"btn btn-default btn-debug-action <% if (!navigation) { %>disabled<%}%>\" data-action=\"StepOut\"  title=\"Step Out ( Alt + U )\"><i class=\"fw fw-stepout \" /></button>'\n             + '</div><% } %>');\n \n         this.connectionDialog = $(\"#modalDebugConnection\");\n+        this.navigation = false;\n \n         $('.debug-connect-button').on(\"click\", _.bindKey(this, 'connect'));  \n         DebugManager.on(\"session-terminated\", _.bindKey(this, 'connectionError'));\n         DebugManager.on(\"session-started\",_.bindKey(this, 'connectionStarted'));      \n         DebugManager.on(\"session-ended\",_.bindKey(this, 'render'));\n+        DebugManager.on(\"debug-hit\",_.bindKey(this, 'enableNavigation'));\n+        DebugManager.on(\"resume-execution\",_.bindKey(this, 'disableNavigation'));\n     };\n \n     Tools.prototype = Object.create(EventChannel.prototype);\n@@ -75,10 +78,14 @@ define(['jquery', 'backbone', 'lodash', 'log', 'event_channel', './debug-manager\n     Tools.prototype.render = function () {\n         var context = {};\n         context.active = DebugManager.active;\n+        context.navigation = this.navigation;\n         this.container.html(this.compiled(context));\n     };\n \n     Tools.prototype.handleActions = function(event){\n+        if($(event.currentTarget).hasClass('disabled')){\n+            return;\n+        } \n         var actionName = $(event.currentTarget).data('action');\n         switch(actionName){\n             case 'Resume':\n@@ -151,7 +158,17 @@ define(['jquery', 'backbone', 'lodash', 'log', 'event_channel', './debug-manager\n \n        return true;\n \n-    }\n+    };\n+\n+    Tools.prototype.enableNavigation = function(message) {\n+        this.navigation = true;\n+        this.render();        \n+    };\n+\n+    Tools.prototype.disableNavigation = function() {\n+        this.navigation = false;\n+        this.render();\n+    };    \n \n     return (instance = (instance || new Tools() ));\n });\n\\ No newline at end of file",
    "Improved instances of static class loading by making references package - relative for better resilience to package renaming .": "diff --git a/src/main/java/org/thymeleaf/standard/serializer/StandardJavaScriptSerializer.java b/src/main/java/org/thymeleaf/standard/serializer/StandardJavaScriptSerializer.java\nindex c05f47442..12b7c259a 100644\n--- a/src/main/java/org/thymeleaf/standard/serializer/StandardJavaScriptSerializer.java\n+++ b/src/main/java/org/thymeleaf/standard/serializer/StandardJavaScriptSerializer.java\n@@ -82,16 +82,22 @@ public final class StandardJavaScriptSerializer implements IStandardJavaScriptSe\n \n     private static final Logger logger = LoggerFactory.getLogger(StandardJavaScriptSerializer.class);\n \n-    // This will be used to conditionally initialize support for JSR310 (java.time) serialization in Jackson\n-    private static final String JACKSON_JAVA_TIME_MODULE_CLASS_NAME = \"com.fasterxml.jackson.datatype.jsr310.JavaTimeModule\";\n-\n \n     private final IStandardJavaScriptSerializer delegate;\n \n \n \n-    private static boolean isJacksonPresent() {\n-        return ClassLoaderUtils.isClassPresent(\"com.fasterxml.jackson.databind.ObjectMapper\");\n+    private String computeJacksonPackageNameIfPresent() {\n+        // We will try to know whether Jackson is present in a way that is as resilient as possible with\n+        // dependency package renaming, so we will return the package name.\n+        try {\n+            final Class<?> objectMapperClass = ObjectMapper.class;\n+            final String objectMapperPackageName = objectMapperClass.getPackage().getName();\n+            return objectMapperPackageName.substring(0, objectMapperPackageName.length() - \".databind\".length());\n+        } catch (final Throwable ignored) {\n+            // Nothing bad - simply Jackson is not in the classpath\n+            return null;\n+        }\n     }\n \n \n@@ -102,11 +108,13 @@ public StandardJavaScriptSerializer(final boolean useJacksonIfAvailable) {\n \n         IStandardJavaScriptSerializer newDelegate = null;\n \n-        if (useJacksonIfAvailable && isJacksonPresent()) {\n+        final String jacksonPrefix = (useJacksonIfAvailable? computeJacksonPackageNameIfPresent() : null);\n+\n+        if (jacksonPrefix != null) {\n \n             try {\n \n-                newDelegate = new JacksonStandardJavaScriptSerializer();\n+                newDelegate = new JacksonStandardJavaScriptSerializer(jacksonPrefix);\n \n             } catch (final Exception e) {\n                 handleErrorLoggingOnJacksonInitialization(e);\n@@ -142,7 +150,7 @@ private static final class JacksonStandardJavaScriptSerializer implements IStand\n         private final ObjectMapper mapper;\n \n \n-        JacksonStandardJavaScriptSerializer() {\n+        JacksonStandardJavaScriptSerializer(final String jacksonPrefix) {\n \n             super();\n \n@@ -157,7 +165,8 @@ private static final class JacksonStandardJavaScriptSerializer implements IStand\n              * Now try to (conditionally) initialize support for Jackson serialization of JSR310 (java.time) objects,\n              * by making use of the 'jackson-datatype-jsr310' optional dependency.\n              */\n- ",
    "Remove NOFP indicator when registering the base64 HotSpot stub .": "diff --git a/compiler/src/org.graalvm.compiler.hotspot/src/org/graalvm/compiler/hotspot/meta/HotSpotHostForeignCallsProvider.java b/compiler/src/org.graalvm.compiler.hotspot/src/org/graalvm/compiler/hotspot/meta/HotSpotHostForeignCallsProvider.java\nindex 4141d57e105..7a3cae5be30 100644\n--- a/compiler/src/org.graalvm.compiler.hotspot/src/org/graalvm/compiler/hotspot/meta/HotSpotHostForeignCallsProvider.java\n+++ b/compiler/src/org.graalvm.compiler.hotspot/src/org/graalvm/compiler/hotspot/meta/HotSpotHostForeignCallsProvider.java\n@@ -400,7 +400,7 @@ public abstract class HotSpotHostForeignCallsProvider extends HotSpotForeignCall\n             registerForeignCall(GHASH_PROCESS_BLOCKS, c.ghashProcessBlocks, NativeCall, DESTROYS_REGISTERS, LEAF, REEXECUTABLE_ONLY_AFTER_EXCEPTION, NamedLocationIdentity.any());\n         }\n         if (c.useBase64Intrinsics()) {\n-            registerForeignCall(BASE64_ENCODE_BLOCK, c.base64EncodeBlock, NativeCall, DESTROYS_REGISTERS, LEAF_NOFP, REEXECUTABLE_ONLY_AFTER_EXCEPTION, NamedLocationIdentity.any());\n+            registerForeignCall(BASE64_ENCODE_BLOCK, c.base64EncodeBlock, NativeCall, DESTROYS_REGISTERS, LEAF, REEXECUTABLE_ONLY_AFTER_EXCEPTION, NamedLocationIdentity.any());\n         }\n         if (c.useMulAddIntrinsic()) {\n             registerForeignCall(MUL_ADD, c.mulAdd, NativeCall, DESTROYS_REGISTERS, LEAF_NOFP, REEXECUTABLE_ONLY_AFTER_EXCEPTION, NamedLocationIdentity.getArrayLocation(JavaKind.Int));",
    "create plugin from archetype": "diff --git a/retrolambda-maven-plugin/pom.xml b/retrolambda-maven-plugin/pom.xml\nnew file mode 100644\nindex 0000000..d6674d6\n--- /dev/null\n+++ b/retrolambda-maven-plugin/pom.xml\n@@ -0,0 +1,111 @@\n+<project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n+  xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\">\n+  <modelVersion>4.0.0</modelVersion>\n+\n+  <groupId>net.orfjackal.retrolambda</groupId>\n+  <artifactId>retrolambda-maven-plugin</artifactId>\n+  <version>1.1.5-SNAPSHOT</version>\n+  <packaging>maven-plugin</packaging>\n+\n+  <name>retrolambda-maven-plugin Maven Plugin</name>\n+\n+  <!-- FIXME change it to the project's website -->\n+  <url>http://maven.apache.org</url>\n+\n+  <properties>\n+    <project.build.sourceEncoding>UTF-8</project.build.sourceEncoding>\n+  </properties>\n+\n+  <dependencies>\n+    <dependency>\n+      <groupId>org.apache.maven</groupId>\n+      <artifactId>maven-plugin-api</artifactId>\n+      <version>2.0</version>\n+    </dependency>\n+    <dependency>\n+      <groupId>org.apache.maven.plugin-tools</groupId>\n+      <artifactId>maven-plugin-annotations</artifactId>\n+      <version>3.2</version>\n+      <scope>provided</scope>\n+    </dependency>\n+    <dependency>\n+      <groupId>org.codehaus.plexus</groupId>\n+      <artifactId>plexus-utils</artifactId>\n+      <version>3.0.8</version>\n+    </dependency>\n+    <dependency>\n+      <groupId>junit</groupId>\n+      <artifactId>junit</artifactId>\n+      <version>4.8.2</version>\n+      <scope>test</scope>\n+    </dependency>\n+  </dependencies>\n+\n+  <build>\n+    <plugins>\n+      <plugin>\n+        <groupId>org.apache.maven.plugins</groupId>\n+        <artifactId>maven-plugin-plugin</artifactId>\n+        <version>3.2</version>\n+        <configuration>\n+          <goalPrefix>retrolambda-maven-plugin</goalPrefix>\n+          <skipErrorNoDescriptorsFound>true</skipErrorNoDescriptorsFound>\n+        </configuration>\n+        <executions>\n+          <execution>\n+            <id>mojo-descriptor</id>\n+            <goals>\n+              <goal>descriptor</goal>\n+            </goals>\n+          </execution>\n+          <execution>\n+            <id>help-goal</id>\n+            <goals>\n+              <goal>helpmojo</goal>\n+            </goals>\n+          </execution>\n+        </executions>\n+      </plugin>\n+    </plugins>\n+  </build>\n+  <profiles>\n+    <profile>\n+      <id>run-its</id>\n+      <build>\n+\n+        <plugins>\n+          <plugin>\n+            <groupId>org.apache.maven.plugins</groupId>\n+            <artifactId>maven-invoker-plugin</artifactId>\n+            <version>1.7</version>\n+            <configuration>\n+              <debug>true</debug>\n+              <cloneProjectsTo>${project.build.directory}/it</cloneProjectsTo>\n+              <pomIncludes>\n+                <pomInclude>*/pom.xml</pomInclude>\n+              </pomIncludes>\n+              <postBuildHookScript>verify</postBuildHookScript>\n+              <localRepositoryPath>${project.build.directory}/local-repo</localRepositoryPath>\n+              <settingsFile>src/it/settings.xml</settingsFile>\n+              <goals>\n+                <goal>clean</goal>\n+                <goal>test-compile</goal>\n+              </goals>\n+            </configuration>\n+            <executions>\n+              <execution>\n+                <id>integration-test</id>\n+                <goals>\n+                  <goal>install</goal>\n+                  <goal>integration-test</goal>\n+                  <goal>verify</goal>\n+                </goals>\n+              </execution>\n+            </executions>\n+          </plugin>\n+        </plugins>\n+\n+      </build>\n+    </profile>\n+  </profiles>\n+</project>\ndiff --git a/retrolambda-maven-plugin/src/it/settings.xml b/retrolambda-maven-plugin/src/it/settings.xml\nnew file mode 100644\nindex 0000000..c8f77f0\n--- /dev/null\n+++ b/retrolambda-maven-plugin/src/it/settings.xml\n@@ -0,0 +1,55 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+\n+<!--\n+Licensed to the Apache Software Foundation (ASF) under one\n+or more contributor license agreements.  See the NOTICE file\n+distributed with this work for additional information\n+regarding copyright ownership.  The ASF licenses this file\n+to you under the Apache License, Version 2.0 (the\n+\"License\"); you may not use this file except in compliance\n+with the License.  You may obtain a copy of the License at\n+\n+  http://www.apache.org/licenses/LICENSE-2.0\n+\n+Unless required by applicable law or agreed to in writing,\n+software distributed under the License is distributed on an\n+\"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+KIND, either express or implied.  See the License for the\n+specific language governing permissions and limitations\n+under the License.\n+-->\n+\n+<settings>\n+  <profiles>\n+    <profile>\n+      <id>it-repo</id>\n+      <activation>\n+        <activeByDefault>true</activeByDefault>\n+      </activation>\n+      <repositories>\n+        <repository>\n+          <id>local.central</id>\n+          <url>@localRepositoryUrl@</url>\n+          <releases>\n+            <enabled>true</enabled>\n+          </releases>\n+          <snapshots>\n+            <enabled>true</enabled>\n+          </snapshots>\n+        </repository>\n+      </repositories>\n+      <pluginRepositories>\n+        <pluginRepository>\n+          <id>local.central</id>\n+          <url>@localRepositoryUrl@</url>\n+          <releases>\n+            <enabled>true</enabled>\n+          </releases>\n+          <snapshots>\n+            <enabled>true</enabled>\n+          </snapshots>\n+        </pluginRepository>\n+      </pluginRepositories>\n+    </profile>\n+  </profiles>\n+</settings>\ndiff --git a/retrolambda-maven-plugin/src/it/simple-it/pom.xml b/retrolambda-maven-plugin/src/it/simple-it/pom.xml\nnew file mode 100644\nindex 0000000..a229afc\n--- /dev/null\n+++ b/retrolambda-maven-plugin/src/it/simple-it/pom.xml\n@@ -0,0 +1,34 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n+  xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\">\n+  <modelVersion>4.0.0</modelVersion>\n+\n+  <groupId>net.orfjackal.retrolambda.it</groupId>\n+  <artifactId>simple-it</artifactId>\n+  <version>1.0-SNAPSHOT</version>\n+\n+  <description>A simple IT verifying the basic use case.</description>\n+\n+  <properties>\n+    <project.build.sourceEncoding>UTF-8</project.build.sourceEncoding>\n+  </properties>\n+\n+  <build>\n+    <plugins>\n+      <plugin>\n+        <groupId>@project.groupId@</groupId>\n+        <artifactId>@project.artifactId@</artifactId>\n+        <version>@project.version@</version>\n+        <executions>\n+          <execution>\n+            <id>touch</id>\n+            <phase>validate</phase>\n+            <goals>\n+              <goal>touch</goal>\n+            </goals>\n+          </execution>\n+        </executions>\n+      </plugin>\n+    </plugins>\n+  </build>\n+</project>\ndiff --git a/retrolambda-maven-plugin/src/it/simple-it/verify.groovy b/retrolambda-maven-plugin/src/it/simple-it/verify.groovy\nnew file mode 100644\nindex 0000000..7b307c7\n--- /dev/null\n+++ b/retrolambda-maven-plugin/src/it/simple-it/verify.groovy\n@@ -0,0 +1,3 @@\n+File touchFile = new File( basedir, \"target/touch.txt\" );\n+\n+assert touchFile.isFile()\ndiff --git a/retrolambda-maven-plugin/src/main/java/net/orfjackal/retrolambda/maven/MyMojo.java b/retrolambda-maven-plugin/src/main/java/net/orfjackal/retrolambda/maven/MyMojo.java\nnew file mode 100644\nindex 0000000..694a59d\n--- /dev/null\n+++ b/retrolambda-maven-plugin/src/main/java/net/orfjackal/retrolambda/maven/MyMojo.java\n@@ -0,0 +1,84 @@\n+package net.orfjackal.retrolambda.maven;\n+\n+/*\n+ * Copyright 2001-2005 The Apache Software Foundation.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+import org.apache.maven.plugin.AbstractMojo;\n+import org.apache.maven.plugin.MojoExecutionException;\n+\n+import org.apache.maven.plugins.annotations.LifecyclePhase;\n+import org.apache.maven.plugins.annotations.Mojo;\n+import org.apache.maven.plugins.annotations.Parameter;\n+import org.apache.maven.plugins.annotations.ResolutionScope;\n+\n+import java.io.File;\n+import java.io.FileWriter;\n+import java.io.IOException;\n+\n+/**\n+ * Goal which touches a timestamp file.\n+ *\n+ * @deprecated Don't use!\n+ */\n+@Mojo( name = \"touch\", defaultPhase = LifecyclePhase.PROCESS_SOURCES )\n+public class MyMojo\n+    extends AbstractMojo\n+{\n+    /**\n+     * Location of the file.\n+     */\n+    @Parameter( defaultValue = \"${project.build.directory}\", property = \"outputDir\", required = true )\n+    private File outputDirectory;\n+\n+    public void execute()\n+        throws MojoExecutionException\n+    {\n+        File f = outputDirectory;\n+\n+        if ( !f.exists() )\n+        {\n+            f.mkdirs();\n+        }\n+\n+        File touch = new File( f, \"touch.txt\" );\n+\n+        FileWriter w = null;\n+        try\n+        {\n+            w = new FileWriter( touch );\n+\n+            w.write( \"touch.txt\" );\n+        }\n+        catch ( IOException e )\n+        {\n+            throw new MojoExecutionException( \"Error creating file \" + touch, e );\n+        }\n+        finally\n+        {\n+            if ( w != null )\n+            {\n+                try\n+                {\n+                    w.close();\n+                }\n+                catch ( IOException e )\n+                {\n+                    // ignore\n+                }\n+            }\n+        }\n+    }\n+}",
    "Propagate exceptions from AdditionalAnswers <issue_id> legatesTo .": "diff --git a/src/org/mockito/internal/stubbing/defaultanswers/ForwardsInvocations.java b/src/org/mockito/internal/stubbing/defaultanswers/ForwardsInvocations.java\nindex b3cd3e883..3087fc3b0 100644\n--- a/src/org/mockito/internal/stubbing/defaultanswers/ForwardsInvocations.java\n+++ b/src/org/mockito/internal/stubbing/defaultanswers/ForwardsInvocations.java\n@@ -8,6 +8,7 @@ import org.mockito.invocation.InvocationOnMock;\n import org.mockito.stubbing.Answer;\n \n import java.io.Serializable;\n+import java.lang.reflect.InvocationTargetException;\n import java.lang.reflect.Method;\n \n /**\n@@ -28,6 +29,11 @@ public class ForwardsInvocations implements Answer<Object>, Serializable {\n \tpublic Object answer(InvocationOnMock invocation) throws Throwable {\n \t\tMethod method = invocation.getMethod() ;\n \n-        return method.invoke(delegatedObject, invocation.getArguments());\n-\t}\n+        try {\n+            return method.invoke(delegatedObject, invocation.getArguments());\n+        } catch (InvocationTargetException e) {\n+            // propagate the original exception from the delegate\n+            throw e.getCause();\n+        }\n+    }\n }\n\\ No newline at end of file\ndiff --git a/test/org/mockitousage/stubbing/StubbingWithDelegate.java b/test/org/mockitousage/stubbing/StubbingWithDelegate.java\nindex 426f3a714..1031c2dde 100644\n--- a/test/org/mockitousage/stubbing/StubbingWithDelegate.java\n+++ b/test/org/mockitousage/stubbing/StubbingWithDelegate.java\n@@ -74,4 +74,22 @@ public class StubbingWithDelegate {\n             assertThat(e.toString()).doesNotContain(\"org.mockito\");\n         }\n     }\n+\n+    @Test\n+    public void exception_should_be_propagated_from_delegate() throws Exception {\n+        final RuntimeException failure = new RuntimeException(\"angry-method\");\n+        IMethods methods = mock(IMethods.class, delegatesTo(new MethodsImpl() {\n+            @Override\n+            public String simpleMethod() {\n+                throw failure;\n+            }\n+        }));\n+\n+        try {\n+            methods.simpleMethod(); // delegate throws an exception\n+            fail();\n+        } catch (RuntimeException e) {\n+            assertThat(e).isEqualTo(failure);\n+        }\n+    }\n }",
    "Added table schema for CYCLE_TAG and CYCLE_LINK": "diff --git a/modules/activiti-cycle/src/main/resources/org/activiti/db/cycle/create/activiti.h2.create.sql b/modules/activiti-cycle/src/main/resources/org/activiti/db/cycle/create/activiti.h2.create.sql\nindex f1c8cf03b2..bd7125eee0 100644\n--- a/modules/activiti-cycle/src/main/resources/org/activiti/db/cycle/create/activiti.h2.create.sql\n+++ b/modules/activiti-cycle/src/main/resources/org/activiti/db/cycle/create/activiti.h2.create.sql\n@@ -3,4 +3,27 @@ create table CYCLE_CONFIG (\n     VALUE_ varchar,\n     REV_ integer,\n     primary key (ID_)\n-);\n\\ No newline at end of file\n+);\n+\n+create table CYCLE_LINK (\n+\tID_ bigint,\n+\tSOURCE_ARTIFACT_ID_ varchar,\n+\tSOURCE_ELEMENT_ID_ varchar DEFAULT NULL,\n+\tSOURCE_ELEMENT_NAME_ varchar,\n+\tSOURCE_REVISION_ bigint DEFAULT NULL,\n+\tTARGET_ARTIFACT_ID_ varchar,\n+\tTARGET_ELEMENT_ID_ varchar DEFAULT NULL,\n+\tTARGET_ELEMENT_NAME_ varchar,\n+\tTARGET_REVISION_ bigint DEFAULT NULL,\n+\tLINK_TYPE_ varchar,\n+\tDESCRIPTION_ varchar,\n+\tLINKED_BOTH_WAYS_ boolean,\n+\tprimary key (ID_)\n+);\n+\n+create table CYCLE_TAG (\n+\tID_ bigint,\n+\tNAME_ varchar,\n+\tALIAS_ varchar,\n+\tprimary key(ID_)\n+)\n\\ No newline at end of file\ndiff --git a/modules/activiti-cycle/src/main/resources/org/activiti/db/cycle/create/activiti.mysql.create.sql b/modules/activiti-cycle/src/main/resources/org/activiti/db/cycle/create/activiti.mysql.create.sql\nindex 585c7bcd82..d673a9dfb1 100644\n--- a/modules/activiti-cycle/src/main/resources/org/activiti/db/cycle/create/activiti.mysql.create.sql\n+++ b/modules/activiti-cycle/src/main/resources/org/activiti/db/cycle/create/activiti.mysql.create.sql\n@@ -3,4 +3,27 @@ create table CYCLE_CONFIG (\n     VALUE_ text,\n     REV_ integer,\n     primary key (ID_)\n+) TYPE=InnoDB;\n+\n+create table CYCLE_LINK (\n+\tID_ bigint,\n+\tSOURCE_ARTIFACT_ID_ varchar(255),\n+\tSOURCE_ELEMENT_ID_ varchar(255) DEFAULT NULL,\n+\tSOURCE_ELEMENT_NAME_ varchar(255),\n+\tSOURCE_REVISION_ bigint DEFAULT NULL,\n+\tTARGET_ARTIFACT_ID_ varchar(255),\n+\tTARGET_ELEMENT_ID_ varchar(255) DEFAULT NULL,\n+\tTARGET_ELEMENT_NAME_ varchar(255),\n+\tTARGET_REVISION_ bigi nt DEFAULT NULL,\n+\tLINK_TYPE_ varchar(255),\n+\tDESCRIPTION_ varchar(255),\n+\tLINKED_BOTH_WAYS_ boolean,\n+\tprimary key (ID_)\n+) TYPE=InnoDB;\n+\n+create table CYCLE_TAG (\n+\tID_ bigint,\n+\tNAME_ varchar(255),\n+\tALIAS_ varchar(255),\n+\tprimary key(ID_)\n ) TYPE=InnoDB;\n\\ No newline at end of file\ndiff --git a/modules/activiti-cycle/src/main/resources/org/activiti/db/cycle/create/activiti.oracle.create.sql b/modules/activiti-cycle/src/main/resources/org/activiti/db/cycle/create/activiti.oracle.create.sql\nindex bf8be6ebb9..1473b43e6a 100644\n--- a/modules/activiti-cycle/src/main/resources/org/activiti/db/cycle/create/activiti.oracle.create.sql\n+++ b/modules/activiti-cycle/src/main/resources/org/activiti/db/cycle/create/activiti.oracle.create.sql\n@@ -3,4 +3,27 @@ create table CYCLE_CONFIG (\n     VALUE_ NVARCHAR2(2000),\n     REV_ INTEGER,\n     primary key (ID_)\n+);\n+\n+create table CYCLE_LINK (\n+\tID_ bigint,\n+\tSOURCE_ARTIFACT_ID_ NVARCHAR2(64),\n+\tSOURCE_ELEMENT_ID_ NVARCHAR2(2000) DEFAULT NULL,\n+\tSOURCE_ELEMENT_NAME_ NVARCHAR2(2000),\n+\tSOURCE_REVISION_ bigint DEFAULT NULL,\n+\tTARGET_ARTIFACT_ID_ NVARCHAR2(2000),\n+\tTARGET_ELEMENT_ID_ NVARCHAR2(2000) DEFAULT NULL,\n+\tTARGET_ELEMENT_NAME_ NVARCHAR2(2000),\n+\tTARGET_REVISION_ bigi nt DEFAULT NULL,\n+\tLINK_TYPE_ NVARCHAR2(2000),\n+\tDESCRIPTION_ NVARCHAR2(2000),\n+\tLINKED_BOTH_WAYS_ boolean,\n+\tprimary key (ID_)\n+);\n+\n+create table CYCLE_TAG (\n+\tID_ bigint,\n+\tNAME_ NVARCHAR2(2000),\n+\tALIAS_ NVARCHAR2(2000),\n+\tprimary key(ID_)\n );\n\\ No newline at end of file\ndiff --git a/modules/activiti-cycle/src/main/resources/org/activiti/db/cycle/drop/activiti.h2.drop.sql b/modules/activiti-cycle/src/main/resources/org/activiti/db/cycle/drop/activiti.h2.drop.sql\nindex c78b646f25..5f248b0771 100644\n--- a/modules/activiti-cycle/src/main/resources/org/activiti/db/cycle/drop/activiti.h2.drop.sql\n+++ b/modules/activiti-cycle/src/main/resources/org/activiti/db/cycle/drop/activiti.h2.drop.sql\n@@ -1 +1,3 @@\n-drop table CYCLE_CONFIG if exists;\n\\ No newline at end of file\n+drop table CYCLE_CONFIG if exists;\r\n+drop table CYCLE_LINK if exists;\r\n+drop table CYCLE_TAG if exists;\n\\ No newline at end of file\ndiff --git a/modules/activiti-cycle/src/main/resources/org/activiti/db/cycle/drop/activiti.mysql.drop.sql b/modules/activiti-cycle/src/main/resources/org/activiti/db/cycle/drop/activiti.mysql.drop.sql\nindex a311e91a72..17b17038bd 100644\n--- a/modules/activiti-cycle/src/main/resources/org/activiti/db/cycle/drop/activiti.mysql.drop.sql\n+++ b/modules/activiti-cycle/src/main/resources/org/activiti/db/cycle/drop/activiti.mysql.drop.sql\n@@ -1 +1,3 @@\n-drop table if exists CYCLE_CONFIG;\n\\ No newline at end of file\n+drop table if exists CYCLE_CONFIG;\r\n+drop table if exists CYCLE_LINK;\r\n+drop table if exists CYCLE_TAG;\n\\ No newline at end of file\ndiff --git a/modules/activiti-cycle/src/main/resources/org/activiti/db/cycle/drop/activiti.oracle.drop.sql b/modules/activiti-cycle/src/main/resources/org/activiti/db/cycle/drop/activiti.oracle.drop.sql\nindex 4936961084..c79f079668 100644\n--- a/modules/activiti-cycle/src/main/resources/org/activiti/db/cycle/drop/activiti.oracle.drop.sql\n+++ b/modules/activiti-cycle/src/main/resources/org/activiti/db/cycle/drop/activiti.oracle.drop.sql\n@@ -1 +1,3 @@\n-drop table CYCLE_CONFIG;\n\\ No newline at end of file\n+drop table CYCLE_CONFIG;\r\n+drop table CYCLE_LINK;\r\n+drop table CYCLE_TAG;\n\\ No newline at end of file",
    "create user preferences lazily .": "diff --git a/findbugs/src/java/edu/umd/cs/findbugs/FindBugs.java b/findbugs/src/java/edu/umd/cs/findbugs/FindBugs.java\nindex 310cb9cec..a884ac759 100644\n--- a/findbugs/src/java/edu/umd/cs/findbugs/FindBugs.java\n+++ b/findbugs/src/java/edu/umd/cs/findbugs/FindBugs.java\n@@ -508,7 +508,7 @@ public class FindBugs implements Constants2, ExitCodes, IFindBugsEngine {\n \tpublic FindBugs() {\n \t\t\n \t\tthis.relaxedReportingMode = false;\n-\t\tthis.userPreferences = UserPreferences.createDefaultUserPreferences();\n+\n \t\tthis.classObserverList = new LinkedList<IClassObserver>();\n \n \t\t// Create a no-op progress callback.\n@@ -821,6 +821,8 @@ public class FindBugs implements Constants2, ExitCodes, IFindBugsEngine {\n \t * @see edu.umd.cs.findbugs.IFindBugsEngine#getUserPreferences()\n \t */\n \tpublic UserPreferences getUserPreferences() {\n+\t\tif (userPreferences == null)\n+\t\t\tuserPreferences = UserPreferences.createDefaultUserPreferences();\n \t\treturn userPreferences;\n \t}\n \t",
    "Fixes an issue generating bad relationship data .": "diff --git a/community/import-tool/src/test/java/org/neo4j/tooling/SimpleDataGeneratorBatch.java b/community/import-tool/src/test/java/org/neo4j/tooling/SimpleDataGeneratorBatch.java\nindex 8c47544f161..8227af4aae0 100644\n--- a/community/import-tool/src/test/java/org/neo4j/tooling/SimpleDataGeneratorBatch.java\n+++ b/community/import-tool/src/test/java/org/neo4j/tooling/SimpleDataGeneratorBatch.java\n@@ -93,10 +93,7 @@ class SimpleDataGeneratorBatch<T>\n                 break;\n             case START_ID: case END_ID:\n                 Object id = idValueForRelationship( entry, abs( random.nextLong() ) % nodeCount );\n-                if ( id != null )\n-                {\n-                    deserialization.handle( entry, id );\n-                }\n+                deserialization.handle( entry, id );\n                 break;\n             case TYPE:\n                 deserialization.handle( entry, randomRelationshipType( random ) );\ndiff --git a/community/import-tool/src/test/java/org/neo4j/tooling/StringDeserialization.java b/community/import-tool/src/test/java/org/neo4j/tooling/StringDeserialization.java\nindex 8be790fac67..89946fd434e 100644\n--- a/community/import-tool/src/test/java/org/neo4j/tooling/StringDeserialization.java\n+++ b/community/import-tool/src/test/java/org/neo4j/tooling/StringDeserialization.java\n@@ -35,6 +35,7 @@ class StringDeserialization implements Deserialization<String>\n {\n     private final StringBuilder builder = new StringBuilder();\n     private final Configuration config;\n+    private int field;\n \n     StringDeserialization( Configuration config )\n     {\n@@ -49,7 +50,7 @@ class StringDeserialization implements Deserialization<String>\n     @Override\n     public void handle( Entry entry, Object value )\n     {\n-        if ( builder.length() > 0 )\n+        if ( field > 0 )\n         {\n             builder.append( config.delimiter() );\n         }\n@@ -57,6 +58,7 @@ class StringDeserialization implements Deserialization<String>\n         {\n             stringify( value );\n         }\n+        field++;\n     }\n \n     private void stringify( Object value )\n@@ -124,6 +126,7 @@ class StringDeserialization implements Deserialization<String>\n     public void clear()\n     {\n         builder.delete( 0, builder.length() );\n+        field = 0;\n     }\n \n     public static Function<SourceTraceability,Deserialization<String>> factory( final Configuration config )\ndiff --git a/community/import-tool/src/test/java/org/neo4j/tooling/StringDeserializationTest.java b/community/import-tool/src/test/java/org/neo4j/tooling/StringDeserializationTest.java\nnew file mode 100644\nindex 00000000000..6bc68b597de\n--- /dev/null\n+++ b/community/import-tool/src/test/java/org/neo4j/tooling/StringDeserializationTest.java\n@@ -0,0 +1,70 @@\n+/*\n+ * Copyright (c) 2002-2017 \"Neo Technology,\"\n+ * Network Engine for Objects in Lund AB [http://neotechnology.com]\n+ *\n+ * This file is part of Neo4j.\n+ *\n+ * Neo4j is free software: you can redistribute it and/or modify\n+ * it under the terms of the GNU General Public License as published by\n+ * the Free Software Foundation, either version 3 of the License, or\n+ * (at your option) any later version.\n+ *\n+ * This program is distributed in the hope that it will be useful,\n+ * but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+ * GNU General Public License for more details.\n+ *\n+ * You should have received a copy of the GNU General Public License\n+ * along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+ */\n+package org.neo4j.tooling;\n+\n+import org.junit.Test;\n+\n+import org.neo4j.csv.reader.Extractors;\n+import org.neo4j.unsafe.impl.batchimport.input.csv.Configuration;\n+import org.neo4j.unsafe.impl.batchimport.input.csv.Header;\n+import org.neo4j.unsafe.impl.batchimport.input.csv.Type;\n+\n+import static org.junit.Assert.assertEquals;\n+\n+public class StringDeserializationTest\n+{\n+    private final Configuration configuration = Configuration.COMMAS;\n+    private final Extractors extractors = new Extractors( configuration.arrayDelimiter() );\n+    private final Header.Entry entry1 = new Header.Entry( null, Type.START_ID, null, extractors.int_() );\n+    private final Header.Entry entry2 = new Header.Entry( null, Type.TYPE, null, extractors.string() );\n+    private final Header.Entry entry3 = new Header.Entry( null, Type.END_ID, null, extractors.int_() );\n+\n+    @Test\n+    public void shouldProvideDelimiterAfterFirstEmptyField() throws Exception\n+    {\n+        // given\n+        StringDeserialization deserialization = new StringDeserialization( configuration );\n+\n+        // when\n+        deserialization.handle( entry1, null );\n+        deserialization.handle( entry2, \"MyType\" );\n+        deserialization.handle( entry3, 123 );\n+        String line = deserialization.materialize();\n+\n+        // then\n+        assertEquals( line, \",MyType,123\" );\n+    }\n+\n+    @Test\n+    public void shouldProvideDelimiterBeforeLastEmptyField() throws Exception\n+    {\n+        // given\n+        StringDeserialization deserialization = new StringDeserialization( configuration );\n+\n+        // when\n+        deserialization.handle( entry1, 123 );\n+        deserialization.handle( entry2, \"MyType\" );\n+        deserialization.handle( entry3, null );\n+        String line = deserialization.materialize();\n+\n+        // then\n+        assertEquals( line, \"123,MyType,\" );\n+    }\n+}",
    "add config to toggle SparseCommonPropsHolder .": "diff --git a/litho-core/src/main/java/com/facebook/litho/Component.java b/litho-core/src/main/java/com/facebook/litho/Component.java\nindex 0b10d89bc1..0b0cbeed9a 100644\n--- a/litho-core/src/main/java/com/facebook/litho/Component.java\n+++ b/litho-core/src/main/java/com/facebook/litho/Component.java\n@@ -728,7 +728,11 @@ public abstract class Component extends ComponentLifecycle\n \n   private CommonProps getOrCreateCommonProps() {\n     if (mCommonProps == null) {\n-      mCommonProps = new CommonPropsHolder();\n+      if (ComponentsConfiguration.isSparseCommonPropsHolderIsEnabled) {\n+        mCommonProps = new SparseCommonPropsHolder();\n+      } else {\n+        mCommonProps = new CommonPropsHolder();\n+      }\n     }\n \n     return mCommonProps;\ndiff --git a/litho-core/src/main/java/com/facebook/litho/config/ComponentsConfiguration.java b/litho-core/src/main/java/com/facebook/litho/config/ComponentsConfiguration.java\nindex f80351d831..1754386828 100644\n--- a/litho-core/src/main/java/com/facebook/litho/config/ComponentsConfiguration.java\n+++ b/litho-core/src/main/java/com/facebook/litho/config/ComponentsConfiguration.java\n@@ -221,9 +221,12 @@ public class ComponentsConfiguration {\n \n   public static boolean shouldIncreaseThreadPriorityToUrgentDisplay = false;\n \n-  /** Sets the if the internal node should be persisted */\n+  /** Sets if the internal node should be persisted */\n   public static boolean isPersistenceEnabled;\n \n+  /** Sets if SparseCommonPropsHolder should be used */\n+  public static boolean isSparseCommonPropsHolderIsEnabled;\n+\n   /** set the size of the extra memory internal node tree should take */\n   public static int extraMemorySize = 0;\n ",
    "Include asciistream in implementation only .": "diff --git a/metrics/src/vespa/metrics/state_api_adapter.cpp b/metrics/src/vespa/metrics/state_api_adapter.cpp\nindex 28e0e277af7..d675d3fa763 100644\n--- a/metrics/src/vespa/metrics/state_api_adapter.cpp\n+++ b/metrics/src/vespa/metrics/state_api_adapter.cpp\n@@ -1,7 +1,9 @@\n // Copyright 2016 Yahoo Inc. Licensed under the terms of the Apache 2.0 license. See LICENSE in the project root.\n-#include \"state_api_adapter.h\"\n-#include <vespa/metrics/metricmanager.h>\n #include \"jsonwriter.h\"\n+#include \"state_api_adapter.h\"\n+#include \"metricmanager.h\"\n+#include <vespa/vespalib/stllike/asciistream.h>\n+\n \n namespace metrics {\n ",
    "Allow dateFormat in default comment generator": "diff --git a/core/mybatis-generator-core/src/main/java/org/mybatis/generator/config/PropertyRegistry.java b/core/mybatis-generator-core/src/main/java/org/mybatis/generator/config/PropertyRegistry.java\nindex 4f3c6d0d..9e990acc 100644\n--- a/core/mybatis-generator-core/src/main/java/org/mybatis/generator/config/PropertyRegistry.java\n+++ b/core/mybatis-generator-core/src/main/java/org/mybatis/generator/config/PropertyRegistry.java\n@@ -67,4 +67,5 @@ public class PropertyRegistry {\n     public static final String COMMENT_GENERATOR_SUPPRESS_DATE = \"suppressDate\"; //$NON-NLS-1$\n     public static final String COMMENT_GENERATOR_SUPPRESS_ALL_COMMENTS = \"suppressAllComments\"; //$NON-NLS-1$\n     public static final String COMMENT_GENERATOR_ADD_REMARK_COMMENTS = \"addRemarkComments\"; //$NON-NLS-1$\n+    public static final String COMMENT_GENERATOR_DATE_FORMAT = \"dateFormat\"; //$NON-NLS-1$\n }\ndiff --git a/core/mybatis-generator-core/src/main/java/org/mybatis/generator/internal/DefaultCommentGenerator.java b/core/mybatis-generator-core/src/main/java/org/mybatis/generator/internal/DefaultCommentGenerator.java\nindex 9a9a2c83..57f3c515 100644\n--- a/core/mybatis-generator-core/src/main/java/org/mybatis/generator/internal/DefaultCommentGenerator.java\n+++ b/core/mybatis-generator-core/src/main/java/org/mybatis/generator/internal/DefaultCommentGenerator.java\n@@ -17,6 +17,7 @@ package org.mybatis.generator.internal;\n \n import static org.mybatis.generator.internal.util.StringUtility.isTrue;\n \n+import java.text.SimpleDateFormat;\n import java.util.Date;\n import java.util.Properties;\n \n@@ -56,6 +57,8 @@ public class DefaultCommentGenerator implements CommentGenerator {\n     /** The addition of table remark's comments.\n      * If suppressAllComments is true, this option is ignored*/\n     private boolean addRemarkComments;\n+    \n+    private SimpleDateFormat dateFormat;\n \n     /**\n      * Instantiates a new default comment generator.\n@@ -129,6 +132,11 @@ public class DefaultCommentGenerator implements CommentGenerator {\n \n         addRemarkComments = isTrue(properties\n                 .getProperty(PropertyRegistry.COMMENT_GENERATOR_ADD_REMARK_COMMENTS));\n+        \n+        String dateFormatString = properties.getProperty(PropertyRegistry.COMMENT_GENERATOR_DATE_FORMAT);\n+        if (StringUtility.stringHasValue(dateFormatString)) {\n+            dateFormat = new SimpleDateFormat(dateFormatString);\n+        }\n     }\n \n     /**\n@@ -167,6 +175,8 @@ public class DefaultCommentGenerator implements CommentGenerator {\n     protected String getDateString() {\n         if (suppressDate) {\n             return null;\n+        } else if (dateFormat != null) {\n+            return dateFormat.format(new Date());\n         } else {\n             return new Date().toString();\n         }\ndiff --git a/core/mybatis-generator-core/src/site/xhtml/configreference/commentGenerator.xhtml b/core/mybatis-generator-core/src/site/xhtml/configreference/commentGenerator.xhtml\nindex a5b98a1a..3902788d 100644\n--- a/core/mybatis-generator-core/src/site/xhtml/configreference/commentGenerator.xhtml\n+++ b/core/mybatis-generator-core/src/site/xhtml/configreference/commentGenerator.xhtml\n@@ -142,7 +142,18 @@ specified with the <a href=\"property.html\">&lt;property&gt;</a> child element:</\n       </table>\n       <p><b>Warning: </b> If suppressAllComments option is true, this option will be ignored.</p>\n     </td>\n-  </tr></table>\n+  </tr>\n+  <tr>\n+    <td valign=\"top\">dateFormat</td>\n+    <td>A date format string to use when writing the date into the generated comment.  This string\n+        will be used to construct a <code>java.text.SimpleDateFormat</code> object.  Any \n+        valid format string for that object can be specified here.  By default, the date string\n+        will be from the <code>toString()</code> method on <code>java.util.Date</code>.\n+      <p>Since 1.3.4</p>\n+      <p><b>Warning: </b> If the suppressAllComments option is true, this option will be ignored.</p>\n+      <p><b>Warning: </b> If the suppressDate option is true, this option will be ignored.</p>\n+    </td>\n+</table>\n \n <h2>Example</h2>\n <p>This element specifies that we do not want the timestamp added to any generated comment:</p>\ndiff --git a/core/mybatis-generator-core/src/test/resources/generatorConfigMyBatis3.xml b/core/mybatis-generator-core/src/test/resources/generatorConfigMyBatis3.xml\nindex 41c08fc5..cab56bab 100644\n--- a/core/mybatis-generator-core/src/test/resources/generatorConfigMyBatis3.xml\n+++ b/core/mybatis-generator-core/src/test/resources/generatorConfigMyBatis3.xml\n@@ -98,6 +98,10 @@\n   <context id=\"MyBatis3MixedMapper\" targetRuntime=\"MyBatis3\" defaultModelType=\"flat\">\n     <plugin type=\"org.mybatis.generator.plugins.EqualsHashCodePlugin\" />\n \n+    <commentGenerator>\n+      <property name=\"suppressDate\" value=\"true\"/>\n+    </commentGenerator>\n+\n     <jdbcConnection driverClass=\"org.hsqldb.jdbcDriver\"\n         connectionURL=\"jdbc:hsqldb:mem:aname\"\n         userId=\"sa\" />\n@@ -136,6 +140,11 @@\n   <context id=\"MyBatis3AnnotatedMapper\" targetRuntime=\"MyBatis3\" defaultModelType=\"flat\">\n     <plugin type=\"org.mybatis.generator.plugins.EqualsHashCodePlugin\" />\n \n+    <commentGenerator>\n+      <property name=\"addRemarkComments\" value=\"true\"/>\n+      <property name=\"dateFormat\" value=\"yyyy-MM-dd\"/>\n+    </commentGenerator>\n+\n     <jdbcConnection driverClass=\"org.hsqldb.jdbcDriver\"\n         connectionURL=\"jdbc:hsqldb:mem:aname\"\n         userId=\"sa\" />\ndiff --git a/core/mybatis-generator-systests-mybatis3/src/main/resources/generatorConfig.xml b/core/mybatis-generator-systests-mybatis3/src/main/resources/generatorConfig.xml\nindex 38e54667..516989b0 100644\n--- a/core/mybatis-generator-systests-mybatis3/src/main/resources/generatorConfig.xml\n+++ b/core/mybatis-generator-systests-mybatis3/src/main/resources/generatorConfig.xml\n@@ -80,6 +80,7 @@\n \n     <commentGenerator>\n       <property name=\"addRemarkComments\" value=\"true\"/>\n+      <property name=\"dateFormat\" value=\"yyyy-MM-dd\"/>\n     </commentGenerator>\n \n     <jdbcConnection driverClass=\"org.hsqldb.jdbcDriver\"",
    "Removed SelectGameScreenHost since it was dead code": "diff --git a/engine/src/main/java/org/terasology/rendering/nui/layers/mainMenu/SelectGameScreenHost.java b/engine/src/main/java/org/terasology/rendering/nui/layers/mainMenu/SelectGameScreenHost.java\ndeleted file mode 100644\nindex 38b55cc3c..000000000\n--- a/engine/src/main/java/org/terasology/rendering/nui/layers/mainMenu/SelectGameScreenHost.java\n+++ /dev/null\n@@ -1,115 +0,0 @@\n-/*\n- * Copyright 2016 MovingBlocks\n- *\n- * Licensed under the Apache License, Version 2.0 (the \"License\");\n- * you may not use this file except in compliance with the License.\n- * You may obtain a copy of the License at\n- *\n- *      http://www.apache.org/licenses/LICENSE-2.0\n- *\n- * Unless required by applicable law or agreed to in writing, software\n- * distributed under the License is distributed on an \"AS IS\" BASIS,\n- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n- * See the License for the specific language governing permissions and\n- * limitations under the License.\n- */\n-package org.terasology.rendering.nui.layers.mainMenu;\n-\n-import org.slf4j.Logger;\n-import org.slf4j.LoggerFactory;\n-import org.terasology.config.Config;\n-import org.terasology.engine.GameEngine;\n-import org.terasology.engine.modes.StateLoading;\n-import org.terasology.engine.paths.PathManager;\n-import org.terasology.game.GameManifest;\n-import org.terasology.network.NetworkMode;\n-import org.terasology.registry.CoreRegistry;\n-import org.terasology.registry.In;\n-import org.terasology.rendering.nui.CoreScreenLayer;\n-import org.terasology.rendering.nui.WidgetUtil;\n-import org.terasology.rendering.nui.layers.mainMenu.savedGames.GameInfo;\n-import org.terasology.rendering.nui.layers.mainMenu.savedGames.GameProvider;\n-import org.terasology.rendering.nui.widgets.UIList;\n-import org.terasology.utilities.FilesUtil;\n-\n-import java.nio.file.Path;\n-\n-/**\n- */\n-public class SelectGameScreenHost extends CoreScreenLayer {\n-\n-    private static final Logger logger = LoggerFactory.getLogger(SelectGameScreenHost.class);\n-\n-    @In\n-    private Config config;\n-\n-    private boolean loadingAsServer;\n-\n-    @Override\n-    public void initialise() {\n-        final UIList<GameInfo> gameList = find(\"gameList\", UIList.class);\n-\n-        refreshList(gameList);\n-        gameList.subscribe((widget, item) -> loadGame(item));\n-\n-        WidgetUtil.trySubscribe(this, \"create\", button -> {\n-            CreateGameScreen createGameScreen = getManager().pushScreen(\"engine:createGameScreen\", CreateGameScreen.class);\n-            createGameScreen.setLoadingAsServer(loadingAsServer);\n-        });\n-\n-        WidgetUtil.trySubscribe(this, \"load\", button -> {\n-            GameInfo gameInfo = gameList.getSelection();\n-            if (gameInfo != null) {\n-                loadGame(gameInfo);\n-            }\n-        });\n-\n-        WidgetUtil.trySubscribe(this, \"delete\", button -> {\n-            GameInfo gameInfo = gameList.getSelection();\n-            if (gameInfo != null) {\n-                Path world = PathManager.getInstance().getSavePath(gameInfo.getManifest().getTitle());\n-                try {\n-                    FilesUtil.recursiveDelete(world);\n-                    gameList.getList().remove(gameInfo);\n-                    gameList.setSelection(null);\n-                } catch (Exception e) {\n-                    logger.error(\"Failed to delete saved game\", e);\n-                    getManager().pushScreen(MessagePopup.ASSET_URI, MessagePopup.class).setMessage(\"Error Deleting Game\", e.getMessage());\n-                }\n-            }\n-        });\n-\n-        WidgetUtil.trySubscribe(this, \"close\", button -> getManager().popScreen());\n-    }\n-\n-    @Override\n-    public boolean isLowerLayerVisible() {\n-        return false;\n-    }\n-\n-    private void loadGame(GameInfo item) {\n-        try {\n-            GameManifest manifest = item.getManifest();\n-\n-            config.getWorldGeneration().setDefaultSeed(manifest.getSeed());\n-            config.getWorldGeneration().setWorldTitle(manifest.getTitle());\n-            CoreRegistry.get(GameEngine.class).changeState(new StateLoading(manifest, (loadingAsServer) ? NetworkMode.DEDICATED_SERVER : NetworkMode.NONE));\n-        } catch (Exception e) {\n-            logger.error(\"Failed to load saved game\", e);\n-            getManager().pushScreen(MessagePopup.ASSET_URI, MessagePopup.class).setMessage(\"Error Loading Game\", e.getMessage());\n-        }\n-    }\n-\n-    public boolean isLoadingAsServer() {\n-        return loadingAsServer;\n-    }\n-\n-    public void setLoadingAsServer(boolean loadingAsServer) {\n-        this.loadingAsServer = loadingAsServer;\n-    }\n-\n-    private void refreshList(UIList<GameInfo> gameList) {\n-        gameList.setList(GameProvider.getSavedGames());\n-    }\n-\n-}",
    "Resolved maven compilation warnings , issue <issue_id>": "diff --git a/pom.xml b/pom.xml\nindex 35f03b972..febb64d29 100755\n--- a/pom.xml\n+++ b/pom.xml\n@@ -393,6 +393,18 @@\n               </sources>\n             </configuration>\n           </execution>\n+          <execution>\n+            <id>add-test-source</id>\n+            <phase>generate-test-sources</phase>\n+            <goals>\n+              <goal>add-test-source</goal>\n+            </goals>\n+            <configuration>\n+              <sources>\n+                <source>src/test/resources</source>\n+              </sources>\n+            </configuration>\n+          </execution>\n         </executions>\n       </plugin>\n \n@@ -447,9 +459,12 @@\n       <plugin>\n         <groupId>org.apache.maven.plugins</groupId>\n         <artifactId>maven-surefire-plugin</artifactId>\n-        <version>2.9</version>\n+        <version>2.17</version>\n         <configuration>\n           <argLine>-Duser.language=en -Duser.country=US -XX:-UseSplitVerifier</argLine>\n+          <additionalClasspathElements>\n+            <additionalClasspathElement>src/test/resources-noncompilable</additionalClasspathElement>\n+          </additionalClasspathElements>\n         </configuration>\n       </plugin>\n \n@@ -522,35 +537,6 @@\n           <downloadJavadocs>true</downloadJavadocs>\n         </configuration>\n       </plugin>\n-      <plugin>\n-        <groupId>org.apache.maven.plugins</groupId>\n-        <artifactId>maven-surefire-plugin</artifactId>\n-        <version>2.17</version>\n-        <configuration>\n-          <additionalClasspathElements>\n-            <additionalClasspathElement>src/test/resources-noncompilable</additionalClasspathElement>\n-          </additionalClasspathElements>\n-        </configuration>\n-      </plugin>\n-      <plugin>\n-        <groupId>org.codehaus.mojo</groupId>\n-        <artifactId>build-helper-maven-plugin</artifactId>\n-        <version>1.9</version>\n-        <executions>\n-          <execution>\n-            <id>add-test-source</id>\n-            <phase>generate-test-sources</phase>\n-            <goals>\n-              <goal>add-test-source</goal>\n-     ",
    "Removed unused imports .": "diff --git a/rxjava-core/src/main/java/rx/Scheduler.java b/rxjava-core/src/main/java/rx/Scheduler.java\nindex dffe97fcd..22735209c 100644\n--- a/rxjava-core/src/main/java/rx/Scheduler.java\n+++ b/rxjava-core/src/main/java/rx/Scheduler.java\n@@ -19,7 +19,6 @@ import static org.mockito.Matchers.*;\n import static org.mockito.Mockito.*;\n \n import java.util.Date;\n-import java.util.concurrent.Executors;\n import java.util.concurrent.TimeUnit;\n import java.util.concurrent.atomic.AtomicBoolean;\n \n@@ -27,7 +26,6 @@ import org.junit.Test;\n import org.mockito.InOrder;\n import org.mockito.Mockito;\n \n-import rx.concurrency.Schedulers;\n import rx.concurrency.TestScheduler;\n import rx.subscriptions.Subscriptions;\n import rx.util.functions.Action0;",
    "added tests for Model .": "diff --git a/dependency-check-core/src/test/java/org/owasp/dependencycheck/xml/pom/ModelTest.java b/dependency-check-core/src/test/java/org/owasp/dependencycheck/xml/pom/ModelTest.java\nnew file mode 100644\nindex 000000000..d669aae1d\n--- /dev/null\n+++ b/dependency-check-core/src/test/java/org/owasp/dependencycheck/xml/pom/ModelTest.java\n@@ -0,0 +1,286 @@\n+/*\n+ * Copyright 2015 OWASP.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.owasp.dependencycheck.xml.pom;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+import java.util.Properties;\n+import org.junit.After;\n+import org.junit.AfterClass;\n+import org.junit.Before;\n+import org.junit.BeforeClass;\n+import org.junit.Test;\n+import static org.junit.Assert.*;\n+\n+/**\n+ *\n+ * @author jeremy\n+ */\n+public class ModelTest {\n+\n+    /**\n+     * Test of getName method, of class Model.\n+     */\n+    @Test\n+    public void testGetName() {\n+        Model instance = new Model();\n+        instance.setName(\"\");\n+        String expResult = \"\";\n+        String result = instance.getName();\n+        assertEquals(expResult, result);\n+    }\n+\n+    /**\n+     * Test of setName method, of class Model.\n+     */\n+    @Test\n+    public void testSetName() {\n+        String name = \"\";\n+        Model instance = new Model();\n+        instance.setName(name);\n+    }\n+\n+    /**\n+     * Test of getOrganization method, of class Model.\n+     */\n+    @Test\n+    public void testGetOrganization() {\n+        Model instance = new Model();\n+        instance.setOrganization(\"\");\n+        String expResult = \"\";\n+        String result = instance.getOrganization();\n+        assertEquals(expResult, result);\n+    }\n+\n+    /**\n+     * Test of setOrganization method, of class Model.\n+     */\n+    @Test\n+    public void testSetOrganization() {\n+        String organization = \"\";\n+        Model instance = new Model();\n+        instance.setOrganization(organization);\n+    }\n+\n+    /**\n+     * Test of getDescription method, of class Model.\n+     */\n+    @Test\n+    public void testGetDescription() {\n+        Model instance = new Model();\n+        instance.setDescription(\"\");\n+        String expResult = \"\";\n+        String result = instance.getDescription();\n+        assertEquals(expResult, result);\n+    }\n+\n+    /**\n+     * Test of setDescription method, of class Model.\n+     */\n+    @Test\n+    public void testSetDescription() {\n+        String description = \"\";\n+        Model instance = new Model();\n+        instance.setDescription(description);\n+    }\n+\n+    /**\n+     * Test of getGroupId method, of class Model.\n+     */\n+    @Test\n+    public void testGetGroupId() {\n+        Model instance = new Model();\n+        instance.setGroupId(\"\");\n+        String expResult = \"\";\n+        String result = instance.getGroupId();\n+        assertEquals(expResult, result);\n+    }\n+\n+    /**\n+     * Test of setGroupId method, of class Model.\n+     */\n+    @Test\n+    public void testSetGroupId() {\n+        String groupId = \"\";\n+        Model instance = new Model();\n+        instance.setGroupId(groupId);\n+    }\n+\n+    /**\n+     * Test of getArtifactId method, of class Model.\n+     */\n+    @Test\n+    public void testGetArtifactId() {\n+        Model instance = new Model();\n+        instance.setArtifactId(\"\");\n+        String expResult = \"\";\n+        String result = instance.getArtifactId();\n+        assertEquals(expResult, result);\n+    }\n+\n+    /**\n+     * Test of setArtifactId method, of class Model.\n+     */\n+    @Test\n+    public void testSetArtifactId() {\n+        String artifactId = \"\";\n+        Model instance = new Model();\n+        instance.setArtifactId(artifactId);\n+    }\n+\n+    /**\n+     * Test of getVersion method, of class Model.\n+     */\n+    @Test\n+    public void testGetVersion() {\n+        Model instance = new Model();\n+        instance.setVersion(\"\");\n+        String expResult = \"\";\n+        String result = instance.getVersion();\n+        assertEquals(expResult, result);\n+    }\n+\n+    /**\n+     * Test of setVersion method, of class Model.\n+     */\n+    @Test\n+    public void testSetVersion() {\n+        String version = \"\";\n+        Model instance = new Model();\n+        instance.setVersion(version);\n+    }\n+\n+    /**\n+     * Test of getParentGroupId method, of class Model.\n+     */\n+    @Test\n+    public void testGetParentGroupId() {\n+        Model instance = new Model();\n+        instance.setParentGroupId(\"\");\n+        String expResult = \"\";\n+        String result = instance.getParentGroupId();\n+        assertEquals(expResult, result);\n+    }\n+\n+    /**\n+     * Test of setParentGroupId method, of class Model.\n+     */\n+    @Test\n+    public void testSetParentGroupId() {\n+        String parentGroupId = \"\";\n+        Model instance = new Model();\n+        instance.setParentGroupId(parentGroupId);\n+    }\n+\n+    /**\n+     * Test of getParentArtifactId method, of class Model.\n+     */\n+    @Test\n+    public void testGetParentArtifactId() {\n+        Model instance = new Model();\n+        instance.setParentArtifactId(\"\");\n+        String expResult = \"\";\n+        String result = instance.getParentArtifactId();\n+        assertEquals(expResult, result);\n+    }\n+\n+    /**\n+     * Test of setParentArtifactId method, of class Model.\n+     */\n+    @Test\n+    public void testSetParentArtifactId() {\n+        String parentArtifactId = \"\";\n+        Model instance = new Model();\n+        instance.setParentArtifactId(parentArtifactId);\n+    }\n+\n+    /**\n+     * Test of getParentVersion method, of class Model.\n+     */\n+    @Test\n+    public void testGetParentVersion() {\n+        Model instance = new Model();\n+        instance.setParentVersion(\"\");\n+        String expResult = \"\";\n+        String result = instance.getParentVersion();\n+        assertEquals(expResult, result);\n+    }\n+\n+    /**\n+     * Test of setParentVersion method, of class Model.\n+     */\n+    @Test\n+    public void testSetParentVersion() {\n+        String parentVersion = \"\";\n+        Model instance = new Model();\n+        instance.setParentVersion(parentVersion);\n+    }\n+\n+    /**\n+     * Test of getLicenses method, of class Model.\n+     */\n+    @Test\n+    public void testGetLicenses() {\n+        Model instance = new Model();\n+        instance.addLicense(new License(\"name\", \"url\"));\n+        List<License> expResult = new ArrayList<License>();\n+        expResult.add(new License(\"name\", \"url\"));\n+        List<License> result = instance.getLicenses();\n+        assertEquals(expResult, result);\n+    }\n+\n+    /**\n+     * Test of addLicense method, of class Model.\n+     */\n+    @Test\n+    public void testAddLicense() {\n+        License license = new License(\"name\", \"url\");\n+        Model instance = new Model();\n+        instance.addLicense(license);\n+    }\n+\n+    /**\n+     * Test of processProperties method, of class Model.\n+     */\n+    @Test\n+    public void testProcessProperties() {\n+        Properties prop = new Properties();\n+        prop.setProperty(\"key\", \"value\");\n+        prop.setProperty(\"nested\", \"nested ${key}\");\n+        String text = \"This is a test of '${key}' '${nested}'\";\n+\n+        Model instance = new Model();\n+        instance.setName(text);\n+        instance.processProperties(prop);\n+        String expResults = \"This is a test of 'value' 'nested value'\";\n+        assertEquals(expResults, instance.getName());\n+    }\n+\n+    /**\n+     * Test of interpolateString method, of class Model.\n+     */\n+    @Test\n+    public void testInterpolateString() {\n+        Properties prop = new Properties();\n+        prop.setProperty(\"key\", \"value\");\n+        prop.setProperty(\"nested\", \"nested ${key}\");\n+        String text = \"This is a test of '${key}' '${nested}'\";\n+        String expResults = \"This is a test of 'value' 'nested value'\";\n+        String results = Model.interpolateString(text, prop);\n+        assertEquals(expResults, results);\n+    }\n+\n+}",
    "include android support header after llvm - libc + + as math . h method not found .": "diff --git a/src/main/java/com/google/devtools/build/lib/bazel/rules/android/ndkcrosstools/NdkPaths.java b/src/main/java/com/google/devtools/build/lib/bazel/rules/android/ndkcrosstools/NdkPaths.java\nindex c52d07bbd4..f2eb4aee81 100644\n--- a/src/main/java/com/google/devtools/build/lib/bazel/rules/android/ndkcrosstools/NdkPaths.java\n+++ b/src/main/java/com/google/devtools/build/lib/bazel/rules/android/ndkcrosstools/NdkPaths.java\n@@ -235,9 +235,7 @@ public class NdkPaths {\n         \"external/%repositoryName%/ndk/sources/\".replace(\"%repositoryName%\", repositoryName);\n \n     ImmutableList.Builder<String> includePaths = ImmutableList.builder();\n-\n-    includePaths.add(prefix + \"android/support/include\");\n-\n+    \n     if (majorRevision <= 12) {\n       includePaths.add(prefix + \"cxx-stl/llvm-libc++/libcxx/include\");\n       includePaths.add(prefix + \"cxx-stl/llvm-libc++abi/libcxxabi/include\");\n@@ -248,6 +246,8 @@ public class NdkPaths {\n       includePaths.add(prefix + \"cxx-stl/llvm-libc++abi/include\");\n     }\n \n+    includePaths.add(prefix + \"android/support/include\");\n+\n     return includePaths.build();\n   }\n ",
    "Relax validateMetrics timing requirements further .": "diff --git a/benchmark/common/src/androidTest/java/androidx/benchmark/BenchmarkStateTest.kt b/benchmark/common/src/androidTest/java/androidx/benchmark/BenchmarkStateTest.kt\nindex 15c39446197..46d7c0956ae 100644\n--- a/benchmark/common/src/androidTest/java/androidx/benchmark/BenchmarkStateTest.kt\n+++ b/benchmark/common/src/androidTest/java/androidx/benchmark/BenchmarkStateTest.kt\n@@ -68,7 +68,7 @@ class BenchmarkStateTest {\n             }\n \n             state.pauseTiming()\n-            runAndSpin(durationUs = 600) {\n+            runAndSpin(durationUs = 700) {\n                 allocate(80)\n             }\n             state.resumeTiming()\n@@ -77,8 +77,8 @@ class BenchmarkStateTest {\n         // come out are reasonable, not perfect - this isn't always run in stable perf environments\n         val medianTime = state.getReport().getStats(\"timeNs\").median\n         assertTrue(\n-            \"median time (ns) $medianTime should be approximately 300us\",\n-            medianTime in us2ns(280)..us2ns(450)\n+            \"median time (ns) $medianTime should",
    "Initialize BitArray storage as number of bits ( <issue_id> ) ( <issue_id> )": "diff --git a/server/src/main/java/org/elasticsearch/common/util/BitArray.java b/server/src/main/java/org/elasticsearch/common/util/BitArray.java\nindex c7a2789f2f1..e938862a47c 100644\n--- a/server/src/main/java/org/elasticsearch/common/util/BitArray.java\n+++ b/server/src/main/java/org/elasticsearch/common/util/BitArray.java\n@@ -34,11 +34,11 @@ public final class BitArray implements Releasable {\n \n     /**\n      * Create the {@linkplain BitArray}.\n-     * @param initialSize the initial size of underlying storage.\n+     * @param initialSize the initial size of underlying storage expressed in bits.\n      */\n     public BitArray(long initialSize, BigArrays bigArrays) {\n         this.bigArrays = bigArrays;\n-        this.bits = bigArrays.newLongArray(initialSize, true);\n+        this.bits = bigArrays.newLongArray(wordNum(initialSize) + 1, true);\n     }\n \n     /**",
    "Add links to documentation on users and roles": "diff --git a/app/views/helpers/DocsHelper.java b/app/views/helpers/DocsHelper.java\nindex 933ea2ad45..ca48b6658f 100644\n--- a/app/views/helpers/DocsHelper.java\n+++ b/app/views/helpers/DocsHelper.java\n@@ -21,7 +21,8 @@ public enum DocsHelper {\n     PAGE_SEARCH_QUERY_LANGUAGE(\"queries.html\"),\n     PAGE_STANDARD_DATE_CONVERTER(\"extractors.html#the-standard-date-converter\"),\n     PAGE_STREAM_PROCESSING_RUNTIME_LIMITS(\"streams.html#stream-processing-runtime-limits\"),\n-    PAGE_STREAMS(\"streams.html\");\n+    PAGE_STREAMS(\"streams.html\"),\n+    PAGE_USERS_ROLES(\"users_roles.html\");\n \n     private static final String DOCS_URL = \"http://docs.graylog.org/en/\";\n \ndiff --git a/app/views/system/roles/roles.scala.html b/app/views/system/roles/roles.scala.html\nindex 9d34cbf111..45be15cde7 100644\n--- a/app/views/system/roles/roles.scala.html\n+++ b/app/views/system/roles/roles.scala.html\n@@ -5,6 +5,10 @@\n         <div class=\"col-md-8\">\n             <h1>Roles</h1>\n             <p class=\"description\">Roles bundle permissions which can be assigned to multiple users at once</p>\n+\n+            @views.html.partials.support.list_small() {\n+                Read more about Graylog roles in the @views.html.partials.links.docs(views.helpers.DocsHelper.PAGE_USERS_ROLES, \"documentation\").\n+            }\n         </div>\n     </div>\n \ndiff --git a/app/views/system/users/index.scala.html b/app/views/system/users/index.scala.html\nindex 951fe81b51..eec1dd11f4 100644\n--- a/app/views/system/users/index.scala.html\n+++ b/app/views/system/users/index.scala.html\n@@ -11,8 +11,11 @@\n     <div class=\"row content content-head\">\n         <div class=\"col-md-8\">\n             <h1>User accounts</h1>\n-            <p class=\"description\">Create as many users as you want next to the default administrator user here. You can also configure LDAP and make changes to already existing users.\n-            </p>\n+            <p class=\"description\">Create as many users as you want next to the default administrator user here. You can also configure LDAP and make changes to already existing users.</p>\n+\n+            @views.html.partials.support.list_small() {\n+                Read more about user management in the @views.html.partials.links.docs(views.helpers.DocsHelper.PAGE_USERS_ROLES, \"documentation\").\n+            }\n         </div>\n \n         <div class=\"col-md-4\" style=\"text-align: right; margin-top: 10px;\">",
    "Automated merge with main - silver": "diff --git a/lib.profiler.ui/manifest.mf b/lib.profiler.ui/manifest.mf\nindex a736629d6..73e4e298c 100644\n--- a/lib.profiler.ui/manifest.mf\n+++ b/lib.profiler.ui/manifest.mf\n@@ -1,5 +1,5 @@\n Manifest-Version: 1.0\n OpenIDE-Module: org.netbeans.lib.profiler.ui/1\n OpenIDE-Module-Localizing-Bundle: org/netbeans/lib/profiler/ui/Bundle.properties\n-OpenIDE-Module-Specification-Version: 1.58\n+OpenIDE-Module-Specification-Version: 1.65\n \ndiff --git a/lib.profiler.ui/nbproject/project.xml b/lib.profiler.ui/nbproject/project.xml\nindex a9cc8510f..bb67b6d90 100644\n--- a/lib.profiler.ui/nbproject/project.xml\n+++ b/lib.profiler.ui/nbproject/project.xml\n@@ -55,7 +55,7 @@ made subject to such option by the copyright holder.\n                     <compile-dependency/>\n                     <run-dependency>\n                         <release-version>1</release-version>\n-                        <specification-version>1.51</specification-version>\n+                        <specification-version>1.62</specification-version>\n                     </run-dependency>\n                 </dependency>\n                 <dependency>\n@@ -130,6 +130,7 @@ made subject to such option by the copyright holder.\n                 <package>org.netbeans.lib.profiler.ui.locks</package>\n                 <package>org.netbeans.lib.profiler.ui.memory</package>\n                 <package>org.netbeans.lib.profiler.ui.monitor</package>\n+                <package>org.netbeans.lib.profiler.ui.results</package>\n                 <package>org.netbeans.lib.profiler.ui.swing</package>\n                 <package>org.netbeans.lib.profiler.ui.swing.renderer</package>\n                 <package>org.netbeans.lib.profiler.ui.threads</package>\ndiff --git a/lib.profiler.ui/src/org/netbeans/lib/profiler/ui/UIUtils.java b/lib.profiler.ui/src/org/netbeans/lib/profiler/ui/UIUtils.java\nindex b41a0d6b6..88cf50708 100644\n--- a/lib.profiler.ui/src/org/netbeans/lib/profiler/ui/UIUtils.java\n+++ b/lib.profiler.ui/src/org/netbeans/lib/profiler/ui/UIUtils.java\n@@ -46,6 +46,7 @@ package org.netbeans.lib.profiler.ui;\n import java.awt.*;\n import java.awt.event.ComponentAdapter;\n import java.awt.event.ComponentEvent;\n+import java.awt.event.KeyEvent;\n import java.awt.image.BufferedImage;\n import java.awt.image.PixelGrabber;\n import java.lang.reflect.InvocationTargetException;\n@@ -506,16 +507,6 @@ public final class UIUtils {\n         }\n     }\n \n-    public static BufferedImage createScreenshot(Component component) {\n-        if (component instanceof JScrollPane) {\n-            JScrollPane scrollPane = (JScrollPane) component;\n-\n-            return createComponentScreenshot(scrollPane.getViewport());\n-        } else {\n-            return createComponentScreenshot(component);\n-        }\n-    }\n-\n     public static void ensureMinimumSize(Component comp) {\n         comp = getParentWindow(comp);\n \n@@ -691,30 +682,42 @@ public final class UIUtils {\n             if (disabledLineColor == null) disabledLineColor = Color.GRAY;\n         }\n         return disabledLineColor;\n-    } \n-\n-    private static BufferedImage createComponentScreenshot(final Component component) {\n-        final BufferedImage[] result = new BufferedImage[1];\n-\n-        final Runnable screenshotPerformer = new Runnable() {\n-            public void run() {\n-                if (component instanceof JTable\n-                        || (component instanceof JViewport && ((JViewport) component).getView() instanceof JTable)) {\n-                    result[0] = createTableScreenshot(component);\n-                } else {\n-                    result[0] = createGeneralComponentScreenshot(component);\n-                }\n-            }\n-        };\n+    }\n+    \n+    \n+    private static String acceleratorDelimiter;\n+    public static String keyAcceleratorString(KeyStroke keyStroke) {\n+        String keyText = KeyEvent.getKeyText(keyStroke.getKeyCode());\n         \n-        try {\n-            if (SwingUtilities.isEventDispatchThread()) screenshotPerformer.run();\n-            else SwingUtilities.invokeAndWait(screenshotPerformer);\n-        } catch (Exception e) {\n-            return null;\n+        int modifiers = keyStroke.getModifiers();\n+        if (modifiers == 0) return keyText;\n+        \n+        if (acceleratorDelimiter == null) {\n+            acceleratorDelimiter = UIManager.getString(\"MenuItem.acceleratorDelimiter\"); // NOI18N\n+            if (acceleratorDelimiter == null) acceleratorDelimiter = \"+\"; // NOI18N // Note: NetBeans default, Swing uses '-' by default\n         }\n+        return KeyEvent.getKeyModifiersText(modifiers) + acceleratorDelimiter + keyText;\n+    }\n+    \n+    \n+    public static BufferedImage createScreenshot(Component component) {\n+        assert SwingUtilities.isEventDispatchThread();\n         \n-        return result[0];\n+        if (component instanceof JScrollPane) {\n+            JScrollPane scrollPane = (JScrollPane) component;\n+            return createComponentScreenshot(scrollPane.getViewport());\n+        } else {\n+            return createComponentScreenshot(component);\n+        }\n+    }\n+\n+    private static BufferedImage createComponentScreenshot(Component component) {\n+        if (component instanceof JTable || (component instanceof JViewport &&\n+                                           ((JViewport) component).getView() instanceof JTable)) {\n+            return createTableScreenshot(component);\n+        } else {\n+            return createGeneralComponentScreenshot(component);\n+        }\n     }\n \n     private static BufferedImage createGeneralComponentScreenshot(Component component) {\n@@ -782,40 +785,11 @@ public final class UIUtils {\n \n         BufferedImage tableScreenshot = new BufferedImage(sourceSize.width, tableHeaderSize.height + sourceSize.height,\n                                                           BufferedImage.TYPE_INT_RGB);\n-        final Graphics tableScreenshotGraphics = tableScreenshot.getGraphics();\n-\n-        // Component.printAll has to run in AWT Thread to print component contents correctly\n-        if (SwingUtilities.isEventDispatchThread()) {\n-            tableHeader.printAll(tableScreenshotGraphics);\n-        } else {\n-            try {\n-                SwingUtilities.invokeAndWait(new Runnable() {\n-                        public void run() {\n-                            tableHeader.printAll(tableScreenshotGraphics);\n-                        }\n-                    });\n-            } catch (Exception e) {\n-            }\n-        }\n-\n+        Graphics tableScreenshotGraphics = tableScreenshot.getGraphics();\n+        tableHeader.printAll(tableScreenshotGraphics);\n         tableScreenshotGraphics.translate(0, tableHeaderSize.height);\n-\n-        final Component printSrc = source;\n-\n-        // Component.printAll has to run in AWT Thread to print component contents correctly\n-        if (SwingUtilities.isEventDispatchThread()) {\n-            printSrc.printAll(tableScreenshotGraphics);\n-        } else {\n-            try {\n-                SwingUtilities.invokeAndWait(new Runnable() {\n-                        public void run() {\n-                            printSrc.printAll(tableScreenshotGraphics);\n-                        }\n-                    });\n-            } catch (Exception e) {\n-            }\n-        }\n-\n+        source.printAll(tableScreenshotGraphics);\n         return tableScreenshot;\n     }\n+    \n }\ndiff --git a/lib.profiler.ui/src/org/netbeans/lib/profiler/ui/components/CloseButton.java b/lib.profiler.ui/src/org/netbeans/lib/profiler/ui/components/CloseButton.java\nnew file mode 100644\nindex 000000000..3162669fb\n--- /dev/null\n+++ b/lib.profiler.ui/src/org/netbeans/lib/profiler/ui/components/CloseButton.java\n@@ -0,0 +1,78 @@\n+/*\n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS HEADER.\n+ *\n+ * Copyright 1997-2015 Oracle and/or its affiliates. All rights reserved.\n+ *\n+ * Oracle and Java are registered trademarks of Oracle and/or its affiliates.\n+ * Other names may be trademarks of their respective owners.\n+ *\n+ * The contents of this file are subject to the terms of either the GNU\n+ * General Public License Version 2 only (\"GPL\") or the Common\n+ * Development and Distribution License(\"CDDL\") (collectively, the\n+ * \"License\"). You may not use this file except in compliance with the\n+ * License. You can obtain a copy of the License at\n+ * http://www.netbeans.org/cddl-gplv2.html\n+ * or nbbuild/licenses/CDDL-GPL-2-CP. See the License for the\n+ * specific language governing permissions and limitations under the\n+ * License.  When distributing the software, include this License Header\n+ * Notice in each file and include the License file at\n+ * nbbuild/licenses/CDDL-GPL-2-CP.  Oracle designates this\n+ * particular file as subject to the \"Classpath\" exception as provided\n+ * by Oracle in the GPL Version 2 section of the License file that\n+ * accompanied this code. If applicable, add the following below the\n+ * License Header, with the fields enclosed by brackets [] replaced by\n+ * your own identifying information:\n+ * \"Portions Copyrighted [year] [name of copyright owner]\"\n+ *\n+ * Contributor(s):\n+ * The Original Software is NetBeans. The Initial Developer of the Original\n+ * Software is Sun Microsystems, Inc. Portions Copyright 1997-2006 Sun\n+ * Microsystems, Inc. All Rights Reserved.\n+ *\n+ * If you wish your version of this file to be governed by only the CDDL\n+ * or only the GPL Version 2, indicate your decision by adding\n+ * \"[Contributor] elects to include this software in this distribution\n+ * under the [CDDL or GPL Version 2] license.\" If you do not indicate a\n+ * single choice of license, a recipient has the option to distribute\n+ * your version of this file under either the CDDL, the GPL Version 2 or\n+ * to extend the choice of license to its licensees as provided above.\n+ * However, if you add GPL Version 2 code and therefore, elected the GPL\n+ * Version 2 license, then the option applies only if the new code is\n+ * made subject to such option by the copyright holder.\n+ */\n+package org.netbeans.lib.profiler.ui.components;\n+\n+import java.awt.event.ActionEvent;\n+import java.awt.event.ActionListener;\n+import javax.swing.JButton;\n+import org.openide.util.Lookup;\n+\n+/**\n+ *\n+ * @author Jiri Sedlacek\n+ */\n+public class CloseButton {\n+    \n+    public static JButton create(Runnable onClose) {\n+        Provider provider = Lookup.getDefault().lookup(Provider.class);\n+        return provider != null ? provider.create(onClose) : new Impl(onClose);\n+    }\n+    protected CloseButton() {}\n+    \n+    \n+    public static abstract class Provider {\n+        \n+        public abstract JButton create(Runnable onClose);\n+        \n+    }\n+    \n+    public static class Impl extends JButton {\n+        public Impl(final Runnable onClose) {\n+            super(\"Close\");\n+            if (onClose != null) addActionListener(new ActionListener() {\n+                public void actionPerformed(ActionEvent e) { onClose.run(); }\n+            });\n+        }\n+    }\n+    \n+}\ndiff --git a/lib.profiler.ui/src/org/netbeans/lib/profiler/ui/cpu/CPUTableView.java b/lib.profiler.ui/src/org/netbeans/lib/profiler/ui/cpu/CPUTableView.java\nindex 8a9986d53..f62758db9 100644\n--- a/lib.profiler.ui/src/org/netbeans/lib/profiler/ui/cpu/CPUTableView.java\n+++ b/lib.profiler.ui/src/org/netbeans/lib/profiler/ui/cpu/CPUTableView.java\n@@ -50,16 +50,16 @@ import java.util.Map;\n import java.util.Set;\n import javax.swing.AbstractAction;\n import javax.swing.JLabel;\n-import javax.swing.JPanel;\n import javax.swing.JPopupMenu;\n import javax.swing.SortOrder;\n import javax.swing.SwingUtilities;\n import javax.swing.table.AbstractTableModel;\n-import org.netbeans.lib.profiler.ProfilerClient;\n import org.netbeans.lib.profiler.client.ClientUtils;\n import org.netbeans.lib.profiler.results.cpu.FlatProfileContainer;\n+import org.netbeans.lib.profiler.ui.results.DataView;\n import org.netbeans.lib.profiler.ui.swing.ProfilerTable;\n import org.netbeans.lib.profiler.ui.swing.ProfilerTableContainer;\n+import org.netbeans.lib.profiler.ui.swing.ExportUtils;\n import org.netbeans.lib.profiler.ui.swing.renderer.CheckBoxRenderer;\n import org.netbeans.lib.profiler.ui.swing.renderer.HideableBarRenderer;\n import org.netbeans.lib.profiler.ui.swing.renderer.JavaNameRenderer;\n@@ -71,9 +71,7 @@ import org.netbeans.lib.profiler.ui.swing.renderer.NumberRenderer;\n  *\n  * @author Jiri Sedlacek\n  */\n-abstract class CPUTableView extends JPanel {\n-    \n-//    private final ProfilerClient client;\n+abstract class CPUTableView extends DataView {\n     \n     private CPUTableModel tableModel;\n     private ProfilerTable table;\n@@ -87,8 +85,7 @@ abstract class CPUTableView extends JPanel {\n     private boolean twoTimeStamps;\n     \n     \n-    public CPUTableView(ProfilerClient client, Set<ClientUtils.SourceCodeSelection> selection) {\n-//        this.client = client;\n+    public CPUTableView(Set<ClientUtils.SourceCodeSelection> selection) {\n         this.selection = selection;\n         \n         initUI();\n@@ -124,8 +121,8 @@ abstract class CPUTableView extends JPanel {\n                     tableModel.fireTableDataChanged();\n                 }\n                 if (structureChange) {\n-                    int col = table.convertColumnIndexToView(6);\n-                    String colN = tableModel.getColumnName(6);\n+                    int col = table.convertColumnIndexToView(selection == null ? 5 : 6);\n+                    String colN = tableModel.getColumnName(selection == null ? 5 : 6);\n                     table.getColumnModel().getColumn(col).setHeaderValue(colN);\n                     repaint();\n                 }\n@@ -147,13 +144,21 @@ abstract class CPUTableView extends JPanel {\n     }\n     \n     \n-    protected abstract void performDefaultAction(ClientUtils.SourceCodeSelection value);\n+    ExportUtils.ExportProvider[] getExportProviders() {\n+        return table.getRowCount() == 0 ? null : new ExportUtils.ExportProvider[] {\n+            new ExportUtils.CSVExportProvider(table),\n+            new ExportUtils.HTMLExportProvider(table, \"Methods - Hot Spots\"),\n+            new ExportUtils.XMLExportProvider(table, \"Methods - Hot Spots\"),\n+            new ExportUtils.PNGExportProvider(table.getParent())\n+        };\n+    }\n+    \n     \n-    protected abstract void populatePopup(JPopupMenu popup, ClientUtils.SourceCodeSelection value);\n+    protected abstract void populatePopup(JPopupMenu popup, Object value, ClientUtils.SourceCodeSelection userValue);\n     \n-    protected abstract void popupShowing();\n+    protected void popupShowing() {};\n     \n-    protected abstract void popupHidden();\n+    protected void popupHidden()  {};\n     \n     \n     private HideableBarRenderer[] renderers;\n@@ -162,11 +167,11 @@ abstract class CPUTableView extends JPanel {\n         tableModel = new CPUTableModel();\n         \n         table = new ProfilerTable(tableModel, true, true, null) {\n-            protected ClientUtils.SourceCodeSelection getValueForPopup(int row) {\n-                return valueForRow(row);\n+            public ClientUtils.SourceCodeSelection getUserValueForRow(int row) {\n+                return CPUTableView.this.getUserValueForRow(row);\n             }\n-            protected void populatePopup(JPopupMenu popup, Object value) {\n-                CPUTableView.this.populatePopup(popup, (ClientUtils.SourceCodeSelection)value);\n+            protected void populatePopup(JPopupMenu popup, Object value, Object userValue) {\n+                CPUTableView.this.populatePopup(popup, value, (ClientUtils.SourceCodeSelection)userValue);\n             }\n             protected void popupShowing() {\n                 CPUTableView.this.popupShowing();\n@@ -177,24 +182,20 @@ abstract class CPUTableView extends JPanel {\n         };\n         \n         table.providePopupMenu(true);\n-        table.setDefaultAction(new AbstractAction() {\n-            public void actionPerformed(ActionEvent e) {\n-                int row = table.getSelectedRow();\n-                ClientUtils.SourceCodeSelection value = valueForRow(row);\n-                if (value != null) performDefaultAction(value);\n-            }\n-        });\n+        installDefaultAction();\n         \n-        table.setMainColumn(1);\n-        table.setFitWidthColumn(1);\n+        int offset = selection == null ? -1 : 0;\n         \n-        table.setSortColumn(3);\n-        table.setDefaultSortOrder(1, SortOrder.ASCENDING);\n+        table.setMainColumn(1 + offset);\n+        table.setFitWidthColumn(1 + offset);\n         \n-        table.setColumnVisibility(0, false);\n-        table.setColumnVisibility(2, false);\n-        table.setColumnVisibility(4, false);\n-        table.setColumnVisibility(6, false);\n+        table.setSortColumn(3 + offset);\n+        table.setDefaultSortOrder(1 + offset, SortOrder.ASCENDING);\n+        \n+        if (selection != null) table.setColumnVisibility(0, false);\n+        table.setColumnVisibility(2 + offset, false);\n+        table.setColumnVisibility(4 + offset, false);\n+        table.setColumnVisibility(6 + offset, false);\n         \n         renderers = new HideableBarRenderer[5];\n         \n@@ -211,7 +212,7 @@ abstract class CPUTableView extends JPanel {\n         renderers[3].setMaxValue(refTime);\n         renderers[4].setMaxValue(refTime);\n         \n-        table.setColumnRenderer(0, new CheckBoxRenderer() {\n+        if (selection != null) table.setColumnRenderer(0, new CheckBoxRenderer() {\n             private boolean visible;\n             public void setValue(Object value, int row) {\n                 visible = isSelectable(idMap.get(data.getMethodIdAtRow(row)));\n@@ -226,25 +227,28 @@ abstract class CPUTableView extends JPanel {\n                 }\n             }\n         });\n-        table.setColumnRenderer(1, new JavaNameRenderer());\n-        table.setColumnRenderer(2, renderers[0]);\n-        table.setColumnRenderer(3, renderers[1]);\n-        table.setColumnRenderer(4, renderers[2]);\n-        table.setColumnRenderer(5, renderers[3]);\n-        table.setColumnRenderer(6, renderers[4]);\n+        table.setColumnRenderer(1 + offset, new JavaNameRenderer());\n+        table.setColumnRenderer(2 + offset, renderers[0]);\n+        table.setColumnRenderer(3 + offset, renderers[1]);\n+        table.setColumnRenderer(4 + offset, renderers[2]);\n+        table.setColumnRenderer(5 + offset, renderers[3]);\n+        table.setColumnRenderer(6 + offset, renderers[4]);\n         \n-        int w = new JLabel(table.getColumnName(0)).getPreferredSize().width;\n-        table.setDefaultColumnWidth(0, w + 15);\n-        table.setDefaultColumnWidth(2, renderers[0].getMaxNoBarWidth());\n-        table.setDefaultColumnWidth(3, renderers[1].getOptimalWidth());\n-        table.setDefaultColumnWidth(4, renderers[2].getMaxNoBarWidth());\n-        table.setDefaultColumnWidth(5, renderers[3].getMaxNoBarWidth());\n+        int w;\n+        if (selection != null) {\n+            w = new JLabel(table.getColumnName(0)).getPreferredSize().width;\n+            table.setDefaultColumnWidth(0, w + 15);\n+        }\n+        table.setDefaultColumnWidth(2 + offset, renderers[0].getMaxNoBarWidth());\n+        table.setDefaultColumnWidth(3 + offset, renderers[1].getOptimalWidth());\n+        table.setDefaultColumnWidth(4 + offset, renderers[2].getMaxNoBarWidth());\n+        table.setDefaultColumnWidth(5 + offset, renderers[3].getMaxNoBarWidth());\n         \n         sampled = !sampled;\n-        w = new JLabel(table.getColumnName(6)).getPreferredSize().width;\n+        w = new JLabel(table.getColumnName(6 + offset)).getPreferredSize().width;\n         sampled = !sampled;\n-        w = Math.max(w, new JLabel(table.getColumnName(6)).getPreferredSize().width);\n-        table.setDefaultColumnWidth(6, Math.max(renderers[4].getNoBarWidth(), w + 15));\n+        w = Math.max(w, new JLabel(table.getColumnName(6 + offset)).getPreferredSize().width);\n+        table.setDefaultColumnWidth(6 + offset, Math.max(renderers[4].getNoBarWidth(), w + 15));\n         \n         ProfilerTableContainer tableContainer = new ProfilerTableContainer(table, false, null);\n         \n@@ -252,8 +256,12 @@ abstract class CPUTableView extends JPanel {\n         add(tableContainer, BorderLayout.CENTER);\n     }\n     \n+    protected ProfilerTable getResultsComponent() {\n+        return table;\n+    }\n+    \n     \n-    private ClientUtils.SourceCodeSelection valueForRow(int row) {\n+    protected ClientUtils.SourceCodeSelection getUserValueForRow(int row) {\n         if (data == null || row == -1) return null;\n         if (row >= tableModel.getRowCount()) return null; // #239936\n         row = table.convertRowIndexToModel(row);\n@@ -282,6 +290,8 @@ abstract class CPUTableView extends JPanel {\n     private class CPUTableModel extends AbstractTableModel {\n         \n         public String getColumnName(int columnIndex) {\n+            if (selection == null) columnIndex++;\n+            \n             if (columnIndex == 1) {\n                 return",
    "Improve HTTP2 client failure handling": "diff --git a/core/src/main/java/io/undertow/client/http2/Http2ClientConnection.java b/core/src/main/java/io/undertow/client/http2/Http2ClientConnection.java\nindex 5a7f37af9..5c1ea0282 100644\n--- a/core/src/main/java/io/undertow/client/http2/Http2ClientConnection.java\n+++ b/core/src/main/java/io/undertow/client/http2/Http2ClientConnection.java\n@@ -23,10 +23,12 @@ import static io.undertow.util.Headers.TRANSFER_ENCODING;\n \n import java.io.IOException;\n import java.net.SocketAddress;\n+import java.nio.channels.ClosedChannelException;\n import java.util.Map;\n import java.util.concurrent.ConcurrentHashMap;\n \n import io.undertow.client.ClientStatistics;\n+import io.undertow.protocols.http2.Http2GoAwayStreamSourceChannel;\n import io.undertow.protocols.http2.Http2PushPromiseStreamSourceChannel;\n import io.undertow.util.HeaderValues;\n import io.undertow.util.Protocols;\n@@ -290,7 +292,14 @@ public class Http2ClientConnection implements ClientConnection {\n \n     @Override\n     public void close() throws IOException {\n-        http2Channel.sendGoAway(0);\n+        try {\n+            http2Channel.sendGoAway(0);\n+        } finally {\n+            for(Map.Entry<Integer, Http2ClientExchange> entry : currentExchanges.entrySet()) {\n+                entry.getValue().failed(new ClosedChannelException());\n+            }\n+            currentExchanges.clear();\n+        }\n     }\n \n     @Override\n@@ -415,6 +424,9 @@ public class Http2ClientConnection implements ClientConnection {\n                         }\n                     }\n                     Channels.drain(result, Long.MAX_VALUE);\n+\n+                } else if (result instanceof Http2GoAwayStreamSourceChannel) {\n+                    close();\n                 } else if(!channel.isOpen()) {\n                     throw UndertowMessages.MESSAGES.channelIsClosed();\n    ",
    "Rewrite LLVMFrameReadWriteFactory to new type": "diff --git a/projects/com.oracle.truffle.llvm.parser.factories/src/com/oracle/truffle/llvm/parser/factories/LLVMFrameReadWriteFactory.java b/projects/com.oracle.truffle.llvm.parser.factories/src/com/oracle/truffle/llvm/parser/factories/LLVMFrameReadWriteFactory.java\nindex 00648633c31..45ba270b0e8 100644\n--- a/projects/com.oracle.truffle.llvm.parser.factories/src/com/oracle/truffle/llvm/parser/factories/LLVMFrameReadWriteFactory.java\n+++ b/projects/com.oracle.truffle.llvm.parser.factories/src/com/oracle/truffle/llvm/parser/factories/LLVMFrameReadWriteFactory.java\n@@ -29,7 +29,6 @@\n  */\n package com.oracle.truffle.llvm.parser.factories;\n \n-import com.intel.llvm.ireditor.types.ResolvedType;\n import com.oracle.truffle.api.frame.FrameSlot;\n import com.oracle.truffle.api.frame.FrameSlotKind;\n import com.oracle.truffle.llvm.nodes.base.LLVMExpressionNode;\n@@ -76,6 +75,7 @@ import com.oracle.truffle.llvm.nodes.impl.vars.LLVMWriteNodeFactory.LLVMWriteI8N\n import com.oracle.truffle.llvm.nodes.impl.vars.LLVMWriteNodeFactory.LLVMWriteIVarBitNodeGen;\n import com.oracle.truffle.llvm.nodes.impl.vars.LLVMWriteVectorNodeGen;\n import com.oracle.truffle.llvm.parser.LLVMBaseType;\n+import com.oracle.truffle.llvm.parser.base.model.types.Type;\n import com.oracle.truffle.llvm.parser.base.util.LLVMTypeHelperImpl;\n import com.oracle.truffle.llvm.runtime.LLVMUnsupportedException;\n import com.oracle.truffle.llvm.runtime.LLVMUnsupportedException.UnsupportedReason;\n@@ -168,8 +168,8 @@ public final class LLVMFrameReadWriteFactory {\n         }\n     }\n \n-    public static FrameSlotKind getFrameSlotKind(ResolvedType type) {\n-        LLVMBaseType llvmType = LLVMTypeHelperImpl.getLLVMType(type).getType();\n+    public static FrameSlotKind getFrameSlotKind(Type type) {\n+        LLVMBaseType llvmType = type.getLLVMBaseType();\n         return LLVMFrameReadWriteFactory.getFrameSlotKind(llvmType);\n     }\n \ndiff --git a/projects/com.oracle.truffle.llvm.parser.factories/src/com/oracle/truffle/llvm/parser/factories/NodeFactoryFacadeImpl.java b/projects/com.oracle.truffle.llvm.parser.factories/src/com/oracle/truffle/llvm/parser/factories/NodeFactoryFacadeImpl.java\nindex 15d0a24930a..9673aa8cc24 100644\n--- a/projects/com.oracle.truffle.llvm.parser.factories/src/com/oracle/truffle/llvm/parser/factories/NodeFactoryFacadeImpl.java\n+++ b/projects/com.oracle.truffle.llvm.parser.factories/src/com/oracle/truffle/llvm/parser/factories/NodeFactoryFacadeImpl.java\n@@ -224,7 +224,7 @@ public class NodeFactoryFacadeImpl implements NodeFactoryFacade {\n \n     @Override\n     public FrameSlotKind getFrameSlotKind(ResolvedType type) {\n-        return LLVMFrameReadWriteFactory.getFrameSlotKind(type);\n+        return LLVMFrameReadWriteFactory.getFrameSlotKind(LLVMToBitcodeAdapter.resolveType(type));\n     }\n \n     @Override",
    "resolve partitions using normalizer and partitionExpression": "diff --git a/sql/src/main/java/io/crate/analyze/AbstractDataAnalysis.java b/sql/src/main/java/io/crate/analyze/AbstractDataAnalysis.java\nindex 1cfdae194f..1628732b5d 100644\n--- a/sql/src/main/java/io/crate/analyze/AbstractDataAnalysis.java\n+++ b/sql/src/main/java/io/crate/analyze/AbstractDataAnalysis.java\n@@ -57,11 +57,11 @@ public abstract class AbstractDataAnalysis extends Analysis {\n     };\n \n     protected final EvaluatingNormalizer normalizer;\n-    protected final PartitionVisitor partitionVisitor;\n     private boolean onlyScalarsAllowed;\n \n     protected final ReferenceInfos referenceInfos;\n-    private final Functions functions;\n+    protected final Functions functions;\n+    protected final ReferenceResolver referenceResolver;\n     protected SchemaInfo schema;\n     protected TableInfo table;\n     protected final List<String> ids = new ArrayList<>();\n@@ -86,8 +86,8 @@ public abstract class AbstractDataAnalysis extends Analysis {\n         super(parameterContext);\n         this.referenceInfos = referenceInfos;\n         this.functions = functions;\n+        this.referenceResolver = referenceResolver;\n         this.normalizer = new EvaluatingNormalizer(functions, RowGranularity.CLUSTER, referenceResolver);\n-        this.partitionVisitor = new PartitionVisitor(this.normalizer);\n     }\n \n     @Override\ndiff --git a/sql/src/main/java/io/crate/analyze/DataStatementAnalyzer.java b/sql/src/main/java/io/crate/analyze/DataStatementAnalyzer.java\nindex 804a56037f..77779664a9 100644\n--- a/sql/src/main/java/io/crate/analyze/DataStatementAnalyzer.java\n+++ b/sql/src/main/java/io/crate/analyze/DataStatementAnalyzer.java\n@@ -21,31 +21,33 @@\n \n package io.crate.analyze;\n \n-import com.google.common.base.*;\n+import com.google.common.base.Optional;\n+import com.google.common.base.Preconditions;\n import com.google.common.collect.*;\n+import io.crate.PartitionName;\n import io.crate.exceptions.UnsupportedFeatureException;\n-import io.crate.metadata.FunctionIdent;\n-import io.crate.metadata.FunctionInfo;\n-import io.crate.metadata.ReferenceIdent;\n+import io.crate.metadata.*;\n+import io.crate.metadata.table.TableInfo;\n import io.crate.operation.aggregation.impl.CollectSetAggregation;\n import io.crate.operation.operator.*;\n import io.crate.operation.operator.any.AnyLikeOperator;\n import io.crate.operation.operator.any.AnyNotLikeOperator;\n import io.crate.operation.operator.any.AnyOperator;\n import io.crate.operation.predicate.NotPredicate;\n+import io.crate.operation.reference.partitioned.PartitionExpression;\n import io.crate.operation.scalar.CastFunction;\n import io.crate.operation.scalar.SubscriptFunction;\n import io.crate.planner.DataTypeVisitor;\n+import io.crate.planner.RowGranularity;\n import io.crate.planner.symbol.*;\n-import io.crate.planner.symbol.Function;\n import io.crate.planner.symbol.Literal;\n import io.crate.sql.tree.*;\n import io.crate.types.*;\n import org.apache.lucene.util.BytesRef;\n import org.elasticsearch.ElasticsearchParseException;\n+import org.elasticsearch.common.collect.Tuple;\n import org.elasticsearch.index.query.MultiMatchQueryBuilder;\n \n-import javax.annotation.Nullable;\n import java.util.*;\n \n \n@@ -92,7 +94,7 @@ abstract class DataStatementAnalyzer<T extends AbstractDataAnalysis> extends Abs\n             FunctionInfo innerInfo = context.getFunctionInfo(innerIdent);\n             Function innerFunction = context.allocateFunction(innerInfo, arguments);\n \n-            // define the outer function which contains the inner function as arugment.\n+            // define the outer function which contains the inner function as argument.\n             String nodeName = \"collection_\" + node.getName().toString();\n             List<Symbol> outerArguments = Arrays.<Symbol>asList(innerFunction);\n             ImmutableList<DataType> outerArgumentTypes =\n@@ -161,7 +163,7 @@ abstract class DataStatementAnalyzer<T extends AbstractDataAnalysis> extends Abs\n \n         return context.allocateFunction(\n                 NotPredicate.INFO,\n-                ImmutableList.<Symbol>of(context.allocateFunction(isNullInfo, Arrays.asList(argument))));\n+                ImmutableList.<Symbol>of(context.allocateFunction(isNullInfo, ImmutableList.of(argument))));\n     }\n \n     @Override\n@@ -219,7 +221,17 @@ abstract class DataStatementAnalyzer<T extends AbstractDataAnalysis> extends Abs\n         insideNotPredicate = true;\n         Symbol argument = process(node.getValue(), context);\n         insideNotPredicate = false;\n-        if (argument.symbolType() == SymbolType.PARAMETER) {\n+        if (argument instanceof DataTypeSymbol) {\n+            DataType dataType = ((DataTypeSymbol) argument).valueType();\n+            if (!dataType.equals(DataTypes.BOOLEAN) && !dataType.equals(DataTypes.NULL)) {\n+                throw new IllegalArgumentException(String.format(\n+                    \"Invalid argument of type \\\"%s\\\" passed to %s predicate. Argument must resolve to boolean or null\",\n+                    dataType,\n+                    node\n+                ));\n+            }\n+        }\n+        if (argument instanceof Parameter) {\n             argument = Literal.fromParameter((Parameter) argument);\n         }\n         return new Function(NotPredicate.INFO, Arrays.asList(argument));\n@@ -267,8 +279,7 @@ abstract class DataStatementAnalyzer<T extends AbstractDataAnalysis> extends Abs\n             if (reference.info().ident().columnIdent().name().equalsIgnoreCase(_SCORE)) {\n                 throw new UnsupportedOperationException(\n                         String.format(Locale.ENGLISH,\n-                                \"System column '%s' cannot be used within a predicate\",\n-                                _SCORE, ComparisonExpression.Type.GREATER_THAN_OR_EQUAL.getValue()));\n+                                \"System column '%s' cannot be used within a predicate\", _SCORE));\n             }\n         }\n     }\n@@ -423,7 +434,7 @@ abstract class DataStatementAnalyzer<T extends AbstractDataAnalysis> extends Abs\n                 new FunctionIdent(io.crate.operation.predicate.IsNullPredicate.NAME,\n                         ImmutableList.of(DataTypeVisitor.fromSymbol((value))));\n         FunctionInfo functionInfo = context.getFunctionInfo(functionIdent);\n-        return context.allocateFunction(functionInfo, Arrays.asList(value));\n+        return context.allocateFunction(functionInfo, ImmutableList.of(value));\n     }\n \n     @Override\n@@ -461,22 +472,131 @@ abstract class DataStatementAnalyzer<T extends AbstractDataAnalysis> extends Abs\n                 }\n             }\n \n-            // TODO: THIS IS ONLY HERE FOR BACKWARDS COMPATIBILITY DURING WIP STATUS\n+            // TODO: this should be part of the getRouting on tableInfo\n             if (context.table().isPartitioned()) {\n-                PartitionVisitor.Context ctx = context.partitionVisitor.process(whereClause, context.table());\n-                whereClause = ctx.whereClause(); // might have changes\n-                whereClause.partitions(Lists.transform(ctx.partitions(), new com.google.common.base.Function<String, Literal>() {\n-                    @Nullable\n-                    @Override\n-                    public Literal apply(@Nullable String input) {\n-                        return Literal.newLiteral(input);\n-                    }\n-                }));\n+                whereClause = resolvePartitions(\n+                        context.referenceResolver,\n+                        context.functions, whereClause, context.table());\n             }\n         }\n         return whereClause;\n     }\n \n+    private PartitionReferenceResolver preparePartitionResolver(\n+            ReferenceResolver referenceResolver, List<ReferenceInfo> partitionColumns) {\n+        List<PartitionExpression> partitionExpressions = new ArrayList<>(partitionColumns.size());\n+        int idx = 0;\n+        for (ReferenceInfo partitionedByColumn : partitionColumns) {\n+            partitionExpressions.add(new PartitionExpression(partitionedByColumn, idx));\n+            idx++;\n+        }\n+        return new PartitionReferenceResolver(referenceResolver, partitionExpressions);\n+    }\n+\n+    private WhereClause resolvePartitions(ReferenceResolver referenceResolver,\n+                                          Functions functions,\n+                                          WhereClause whereClause,\n+                                          TableInfo table) {\n+        assert table.isPartitioned() : \"table must be partitioned in order to resolve partitions\";\n+        if (table.partitions().isEmpty()) {\n+            return WhereClause.NO_MATCH; // table is partitioned but has no data / no partitions\n+        }\n+        PartitionReferenceResolver partitionReferenceResolver = preparePartitionResolver(\n+                referenceResolver,\n+                table.partitionedByColumns());\n+        EvaluatingNormalizer normalizer =\n+                new EvaluatingNormalizer(functions, RowGranularity.PARTITION, partitionReferenceResolver);\n+\n+        Symbol normalized = null;\n+        Map<Symbol, List<Literal>> queryPartitionMap = new HashMap<>();\n+\n+        for (PartitionName partitionName : table.partitions()) {\n+            for (PartitionExpression partitionExpression : partitionReferenceResolver.expressions()) {\n+                partitionExpression.setNextRow(partitionName);\n+            }\n+            normalized = normalizer.normalize(whereClause.query());\n+            assert normalized != null : \"normalizing a query must not return null\";\n+\n+            if (normalized.equals(whereClause.query())) {\n+                return whereClause; // no partition columns inside the where clause\n+            }\n+\n+            boolean canMatch = WhereClause.canMatch(normalized);\n+            if (canMatch) {\n+                List<Literal> partitions = queryPartitionMap.get(normalized);\n+                if (partitions == null) {\n+                    partitions = new ArrayList<>();\n+                    queryPartitionMap.put(normalized, partitions);\n+                }\n+                partitions.add(Literal.newLiteral(partitionName.stringValue()));\n+            }\n+        }\n+\n+        if (queryPartitionMap.size() == 1) {\n+            Map.Entry<Symbol, List<Literal>> entry = queryPartitionMap.entrySet().iterator().next();\n+            whereClause = new WhereClause(entry.getKey());\n+            whereClause.partitions(entry.getValue());\n+        } else if (queryPartitionMap.size() > 0) {\n+            whereClause = tieBreakPartitionQueries(normalizer, queryPartitionMap);\n+        } else {\n+            whereClause = WhereClause.NO_MATCH;\n+        }\n+\n+        return whereClause;\n+    }\n+\n+    private WhereClause tieBreakPartitionQueries(EvaluatingNormalizer normalizer,\n+                                                 Map<Symbol, List<Literal>> queryPartitionMap) throws UnsupportedOperationException{\n+        /**\n+         * Got multiple normalized queries which all could match.\n+         * This might be the case if one partition resolved to null\n+         *\n+         * e.g.\n+         *\n+         *  p = 1 and x = 2\n+         *\n+         * might lead to\n+         *\n+         *  null and x = 2\n+         *  true and x = 2\n+         *\n+         * At this point it is unknown if they really match.\n+         * In order to figure out if they could potentially match all conditions involving references are now set to true\n+         *\n+         *  null and true   -> can't match\n+         *  true and true   -> can match, can use this query + partition\n+         *\n+         * If there is still more than 1 query that can match it's not possible to execute the query :(\n+         */\n+\n+        List<Tuple<Symbol, List<Literal>>> canMatch = new ArrayList<>();\n+        ReferenceToTrueVisitor referenceToTrueVisitor = new ReferenceToTrueVisitor();\n+        for (Map.Entry<Symbol, List<Literal>> entry : queryPartitionMap.entrySet()) {\n+            Symbol query = entry.getKey();\n+            List<Literal> partitions = entry.getValue();\n+\n+            Symbol symbol = referenceToTrueVisitor.process(query, null);\n+            Symbol normalized = normalizer.normalize(symbol);\n+\n+            assert normalized instanceof Literal && ((Literal) normalized).valueType().equals(DataTypes.BOOLEAN) :\n+                \"after normalization and replacing all reference occurrences with true there must only be a boolean left\";\n+\n+            Object value = ((Literal) normalized).value();\n+            if (value != null && (Boolean) value) {\n+                canMatch.add(new Tuple<>(query, partitions));\n+            }\n+        }\n+        if (canMatch.size() == 1) {\n+            Tuple<Symbol, List<Literal>> symbolListTuple = canMatch.get(0);\n+            WhereClause whereClause = new WhereClause(symbolListTuple.v1());\n+            whereClause.partitions(symbolListTuple.v2());\n+            return whereClause;\n+        }\n+        throw new UnsupportedOperationException(\n+            \"logical conjunction of the conditions in the WHERE clause which \" +\n+                \"involve partitioned columns led to a query that can't be executed.\");\n+    }\n+\n     protected void processPrimaryKeyLiterals(List primaryKeyLiterals, WhereClause whereClause, T context) {\n         List<List<BytesRef>> primaryKeyValuesList = new ArrayList<>(primaryKeyLiterals.size());\n         primaryKeyValuesList.add(new ArrayList<BytesRef>(context.table().primaryKey().size()));\n@@ -668,11 +788,11 @@ abstract class DataStatementAnalyzer<T extends AbstractDataAnalysis> extends Abs\n \n         FunctionInfo functionInfo = context.getFunctionInfo(io.crate.operation.predicate.MatchPredicate.IDENT);\n         return context.allocateFunction(functionInfo,\n-                Arrays.<Symbol>asList(\n-                        Literal.newLiteral(identBoostMap),\n-                        Literal.newLiteral(queryTerm),\n-                        Literal.newLiteral(matchType),\n-                        Literal.newLiteral(options)));\n+            Arrays.<Symbol>asList(\n+                Literal.newLiteral(identBoostMap),\n+                Literal.newLiteral(queryTerm),\n+                Literal.newLiteral(matchType),\n+                Literal.newLiteral(options)));\n     }\n \n \ndiff --git a/sql/src/main/java/io/crate/analyze/PartitionVisitor.java b/sql/src/main/java/io/crate/analyze/PartitionVisitor.java\ndeleted file mode 100644\nindex 31c5b6224c..0000000000\n--- a/sql/src/main/java/io/crate/analyze/PartitionVisitor.java\n+++ /dev/null\n@@ -1,152 +0,0 @@\n-/*\n- * Licensed to CRATE Technology GmbH (\"Crate\") under one or more contributor\n- * license agreements.  See the NOTICE file distributed with this work for\n- * additional information regarding copyright ownership.  Crate licenses\n- * this file to you under the Apache License, Version 2.0 (the \"License\");\n- * you may not use this file except in compliance with the License.  You may\n- * obtain a copy of the License at\n- *\n- *     http://www.apache.org/licenses/LICENSE-2.0\n- *\n- * Unless required by applicable law or agreed to in writing, software\n- * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n- * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.  See the\n- * License for the specific language governing permissions and limitations\n- * under the License.\n- *\n- * However, if you have executed another commercial license agreement\n- * with Crate these terms will supersede the license and you may use the\n- * software solely pursuant to the terms of the relevant commercial agreement.\n- */\n-\n-package io.crate.analyze;\n-\n-import com.google.common.base.Objects;\n-import com.google.common.collect.ImmutableList;\n-import com.google.common.collect.ImmutableMap;\n-import com.google.common.collect.Lists;\n-import io.crate.PartitionName;\n-import io.crate.exceptions.UnsupportedFeatureException;\n-import io.crate.metadata.ReferenceInfo;\n-import io.crate.metadata.table.TableInfo;\n-import io.crate.planner.symbol.*;\n-import org.apache.lucene.util.BytesRef;\n-\n-import javax.annotation.Nullable;\n-import java.util.LinkedList;\n-import java.util.List;\n-import java.util.Map;\n-\n-public class PartitionVisitor extends SymbolVisitor<PartitionVisitor.Context, Symbol> {\n-\n-    private final EvaluatingNormalizer normalizer;\n-\n-    public PartitionVisitor(EvaluatingNormalizer normalizer) {\n-        this.normalizer = normalizer;\n-    }\n-\n-    public Context process(WhereClause whereClause, TableInfo tableInfo) {\n-        Context ctx = new Context(tableInfo.partitionedByColumns(), whereClause);\n-        if (tableInfo.isPartitioned() && whereClause.hasQuery()) {\n-            List<String> partitions = new LinkedList<>();\n-            Symbol processed = process(whereClause.query(), ctx);\n-            Symbol normalized = null;\n-            Symbol lastQuery = null;\n-            for (PartitionName partitionName : tableInfo.partitions()) {\n-                List<BytesRef> values = partitionName.values();\n-                List<ReferenceInfo> partitionedByColumns = tableInfo.partitionedByColumns();\n-                for (int i = 0; i < partitionedByColumns.size(); i++) {\n-                    ReferenceInfo info = partitionedByColumns.get(i);\n-                    ReferencePlaceHolder partitionSymbol = ctx.partitionSymbol(info);\n-                    if (partitionSymbol != null) {\n-                        partitionSymbol.setValue(values.get(i));\n-                    }\n-                }\n-                normalized = this.normalizer.normalize(processed);\n-\n-                if (normalized != null && !new WhereClause(normalized).noMatch()) {\n-                    // we have a query\n-                    if (lastQuery != null && !lastQuery.equals(normalized)) {\n-                        // TODO: remove this check if we are able to run normal search queries without ESSearch\n-                        // Just now, we would have to execute 2 separate ESSearch tasks and merge results\n-                        // which is not supported right now and maybe never will be\n-                        throw new UnsupportedFeatureException(\"Using a partitioned column and a \" +\n-                                \"normal column inside an OR clause is not supported\");\n-                    } else {\n-                         partitions.add(partitionName.stringValue());\n-                    }\n-                    lastQuery = normalized;\n-                }\n-            }\n-            ctx.partitions = partitions;\n-            ctx.whereClause = new WhereClause(Objects.firstNonNull(lastQuery,\n-                    Objects.firstNonNull(normalized, Literal.NULL)));\n-\n-        } else if (whereClause.noMatch()) {\n-            ctx.partitions = ImmutableList.of();\n-        } else {\n-            ctx.partitions = Lists.transform(tableInfo.partitions(), new com.google.common.base.Function<PartitionName, String>() {\n-                @Nullable\n-                @Override\n-                public String apply(@Nullable PartitionName input) {\n-                    return input == null ? null : input.stringValue();\n-                }\n-            });\n-        }\n-        return ctx;\n-    }\n-\n-    public static class Context {\n-        private final Map<ReferenceInfo, ReferencePlaceHolder> partitionValues;\n-\n-        private List<String> partitions = ImmutableList.of();\n-\n-        private WhereClause whereClause;\n-\n-     ",
    "Implemented face culling for item models , improves performance slightly .": "diff --git a/src/main/java/net/minecraftforge/client/model/IPerspectiveAwareModel.java b/src/main/java/net/minecraftforge/client/model/IPerspectiveAwareModel.java\nindex 71309f768..16fd01d01 100644\n--- a/src/main/java/net/minecraftforge/client/model/IPerspectiveAwareModel.java\n+++ b/src/main/java/net/minecraftforge/client/model/IPerspectiveAwareModel.java\n@@ -72,7 +72,7 @@ public interface IPerspectiveAwareModel extends IFlexibleBakedModel\n         {\n             TRSRTransformation tr = transforms.get(cameraTransformType);\n             Matrix4f mat = null;\n-            if(tr != null && tr != TRSRTransformation.identity()) mat = TRSRTransformation.blockCornerToCenter(tr).getMatrix();\n+            if(tr != null && !tr.equals(TRSRTransformation.identity())) mat = TRSRTransformation.blockCornerToCenter(tr).getMatrix();\n             return Pair.of(model, mat);\n         }\n \ndiff --git a/src/main/java/net/minecraftforge/client/model/ItemLayerModel.java b/src/main/java/net/minecraftforge/client/model/ItemLayerModel.java\nindex 87100ee9e..119092eb6 100644\n--- a/src/main/java/net/minecraftforge/client/model/ItemLayerModel.java\n+++ b/src/main/java/net/minecraftforge/client/model/ItemLayerModel.java\n@@ -5,8 +5,11 @@ import java.util.BitSet;\n import java.util.Collection;\n import java.util.List;\n \n+import javax.vecmath.Matrix4f;\n import javax.vecmath.Vector4f;\n \n+import org.apache.commons.lang3.tuple.Pair;\n+\n import net.minecraft.client.renderer.block.model.BakedQuad;\n import net.minecraft.client.renderer.block.model.ItemCameraTransforms;\n import net.minecraft.client.renderer.block.model.ItemCameraTransforms.TransformType;\n@@ -93,14 +96,10 @@ public class ItemLayerModel implements IRetexturableModel\n         }\n         TextureAtlasSprite particle = bakedTextureGetter.apply(textures.isEmpty() ? new ResourceLocation(\"missingno\") : textures.get(0));\n         ImmutableMap<TransformType, TRSRTransformation> map = IPerspectiveAwareModel.MapWrapper.getTransforms(state);\n-        IFlexibleBakedModel ret = new BakedModel(builder.build(), particle, format);\n-        if(map.isEmpty())\n-        {\n-            return ret;\n-        }\n-        return new IPerspectiveAwareModel.MapWrapper(ret, map);\n+        return new BakedItemModel(builder.build(), particle, format, map, null);\n     }\n \n+    @Deprecated // remove 1.9\n     public static class BakedModel implements IFlexibleBakedModel\n     {\n         private final ImmutableList<BakedQuad> quads;\n@@ -124,6 +123,65 @@ public class ItemLayerModel implements IRetexturableModel\n         public VertexFormat getFormat() { return format; }\n     }\n \n+    private static class BakedItemModel implements IFlexibleBakedModel, IPerspectiveAwareModel\n+    {\n+        private final ImmutableList<BakedQuad> quads;\n+        private final TextureAtlasSprite particle;\n+        private final VertexFormat format;\n+        private final ImmutableMap<TransformType, TRSRTransformation> transforms;\n+        private final IFlexibleBakedModel otherModel;\n+        private final boolean isCulled;\n+\n+        public BakedItemModel(ImmutableList<BakedQuad> quads, TextureAtlasSprite particle, VertexFormat format, ImmutableMap<TransformType, TRSRTransformation> transforms, IFlexibleBakedModel otherModel)\n+        {\n+            this.quads = quads;\n+            this.particle = particle;\n+            this.format = format;\n+            this.transforms = transforms;\n+            if(otherModel != null)\n+            {\n+                this.otherModel = otherModel;\n+                this.isCulled = true;\n+            }\n+            else\n+            {\n+                ImmutableList.Builder<BakedQuad> builder = ImmutableList.builder();\n+                for(BakedQuad quad : quads)\n+                {\n+                    if(quad.getFace() == EnumFacing.SOUTH)\n+                    {\n+                        builder.add(quad);\n+                    }\n+                }\n+                this.otherModel = new BakedItemModel(builder.build(), particle, format, transforms, this);\n+                isCulled = false;\n+            }\n+        }\n+\n+        public boolean isAmbientOcclusion() { return true; }\n+        public boolean isGui3d() { return false; }\n+        public boolean isBuiltInRenderer() { return false; }\n+        public TextureAtlasSprite getParticleTexture() { return particle; }\n+        public ItemCameraTransforms getItemCameraTransforms() { return ItemCameraTransforms.DEFAULT; }\n+        public List<BakedQuad> getFaceQuads(EnumFacing side) { return ImmutableList.of(); }\n+        public List<BakedQuad> getGeneralQuads() { return quads; }\n+        public VertexFormat getFormat() { return format; }\n+\n+        public Pair<? extends IFlexibleBakedModel, Matrix4f> handlePerspective(TransformType type)\n+        {\n+            Pair<? extends IFlexibleBakedModel, Matrix4f> pair = IPerspectiveAwareModel.MapWrapper.handlePerspective(this, transforms, type);\n+            if(type == TransformType.GUI && !isCulled && pair.getRight() == null)\n+            {\n+                return Pair.of(otherModel, null);\n+       ",
    "Updates SmallTemplate to allow presentation of toggles , add sample to demo .": "diff --git a/samples/SupportSliceDemos/build.gradle b/samples/SupportSliceDemos/build.gradle\nindex 9b1435b3f88..f2699b3388e 100644\n--- a/samples/SupportSliceDemos/build.gradle\n+++ b/samples/SupportSliceDemos/build.gradle\n@@ -22,6 +22,7 @@ dependencies {\n     implementation libs.support.design, libs.support_exclude_config\n     implementation libs.support.app_compat, libs.support_exclude_config\n     implementation libs.support.cardview, libs.support_exclude_config\n+    implementation project(':lifecycle:extensions')\n }\n \n android {\ndiff --git a/samples/SupportSliceDemos/src/main/AndroidManifest.xml b/samples/SupportSliceDemos/src/main/AndroidManifest.xml\nindex 1fd990da030..232724c5e36 100644\n--- a/samples/SupportSliceDemos/src/main/AndroidManifest.xml\n+++ b/samples/SupportSliceDemos/src/main/AndroidManifest.xml\n@@ -20,8 +20,10 @@\n \n     <uses-sdk tools:overrideLibrary=\"androidx.app.slice.view, androidx.app.slice.builders, androidx.app.slice.core\" />\n \n+    <uses-permission android:name=\"android.permission.ACCESS_WIFI_STATE\"/>\n     <uses-permission android:name=\"android.permission.BIND_SLICE\" />\n \n+    <uses-permission android:name=\"android.permission.CHANGE_WIFI_STATE\"/>\n     <application\n         android:allowBackup=\"true\"\n         android:icon=\"@mipmap/ic_launcher\"\n@@ -43,6 +45,14 @@\n         <provider android:authorities=\"com.example.androidx.slice.demos\"\n                   android:name=\".SampleSliceProvider\"\n                   android:grantUriPermissions=\"true\" />\n+\n+        <receiver\n+            android:name=\".SliceBroadcastReceiver\"\n+            android:exported=\"true\" >\n+            <intent-filter>\n+                <action android:name=\"com.android.settings.slice.action.WIFI_CHANGED\"/>\n+            </intent-filter>\n+        </receiver>\n     </application>\n \n </manifest>\ndiff --git a/samples/SupportSliceDemos/src/main/java/com/example/androidx/slice/demos/SampleSliceProvider.java b/samples/SupportSliceDemos/src/main/java/com/example/androidx/slice/demos/SampleSliceProvider.java\nindex 0157cf74759..86665e9f352 100644\n--- a/samples/SupportSliceDemos/src/main/java/com/example/androidx/slice/demos/SampleSliceProvider.java\n+++ b/samples/SupportSliceDemos/src/main/java/com/example/androidx/slice/demos/SampleSliceProvider.java\n@@ -16,14 +16,20 @@\n \n package com.example.androidx.slice.demos;\n \n+import android.app.PendingIntent;\n import android.app.slice.Slice;\n import android.app.slice.SliceProvider;\n+import android.content.Context;\n+import android.content.Intent;\n import android.graphics.drawable.Icon;\n import android.net.Uri;\n+import android.net.wifi.WifiManager;\n+import android.provider.Settings;\n import android.support.annotation.RequiresApi;\n import android.text.format.DateUtils;\n \n import androidx.app.slice.builders.MessagingSliceBuilder;\n+import androidx.app.slice.builders.SliceHints;\n \n /**\n  * Examples of using slice template builders.\n@@ -32,6 +38,11 @@ import androidx.app.slice.builders.MessagingSliceBuilder;\n public class SampleSliceProvider extends SliceProvider {\n     public static final Uri MESSAGE =\n             Uri.parse(\"content://com.example.androidx.slice.demos/message\");\n+    public static final Uri WIFI =\n+            Uri.parse(\"content://com.example.androidx.slice.demos/wifi\");\n+\n+    public static final String ACTION_WIFI_CHANGED =\n+            \"com.android.settings.slice.action.WIFI_CHANGED\";\n \n     @Override\n     public boolean onCreate() {\n@@ -44,6 +55,8 @@ public class SampleSliceProvider extends SliceProvider {\n         switch (path) {\n             case \"/message\":\n                 return createMessagingSlice(sliceUri);\n+            case \"/wifi\":\n+                return createSettingsSlice(sliceUri);\n         }\n         throw new IllegalArgumentException(\"Unknown uri \" + sliceUri);\n     }\n@@ -69,4 +82,64 @@ public class SampleSliceProvider extends SliceProvider {\n                 .build();\n \n     }\n+\n+    private Slice createSettingsSlice(Uri sliceUri) {\n+        // TODO: Create a proper template builder for toggles\n+        // Get wifi state\n+        String[] toggleHints;\n+        WifiManager wifiManager = (WifiManager) getContext().getSystemService(Context.WIFI_SERVICE);\n+        int wifiState = wifiManager.getWifiState();\n+        boolean wifiEnabled = false;\n+        String state;\n+        switch (wifiState) {\n+            case WifiManager.WIFI_STATE_DISABLED:\n+            case WifiManager.WIFI_STATE_DISABLING:\n+                state = \"disconnected\";\n+                break;\n+            case WifiManager.WIFI_STATE_ENABLED:\n+            case WifiManager.WIFI_STATE_ENABLING:\n+                state = wifiManager.getConnectionInfo().getSSID();\n+                wifiEnabled = true;\n+                break;\n+            case WifiManager.WIFI_STATE_UNKNOWN:\n+            default:\n+                state = \"\"; // just don't show anything?\n+                break;\n+        }\n+        if (wifiEnabled) {\n+            toggleHints = new String[] {SliceHints.HINT_TOGGLE, Slice.HINT_SELECTED};\n+        } else {\n+            toggleHints = new String[] {SliceHints.HINT_TOGGLE};\n+        }\n+        // Construct the slice\n+        Slice.Builder b = new Slice.Builder(sliceUri);\n+        b.addSubSlice(new Slice.Builder(b)\n+                .addAction(getIntent(Settings.ACTION_WIFI_SETTINGS),\n+                        new Slice.Builder(b)\n+                                .addText(\"Wi-fi\")\n+                                .addText(state)\n+                                .addIcon(Icon.createWithResource(getContext(),\n+                                        R.drawable.ic_settings_wifi), SliceHints.HINT_HIDDEN)\n+                                .addHints(Slice.HINT_TITLE)\n+                                .build())\n+                .addAction(getBroadcastIntent(ACTION_WIFI_CHANGED),\n+                        new Slice.Builder(b)\n+                                .addHints(toggleHints)\n+                                .build())\n+                .build());\n+        return b.build();\n+    }\n+\n+    private PendingIntent getIntent(String action) {\n+        Intent intent = new Intent(action);\n+        PendingIntent pi = PendingIntent.getActivity(getContext(), 0, intent, 0);\n+        return pi;\n+    }\n+\n+    private PendingIntent getBroadcastIntent(String action) {\n+        Intent intent = new Intent(action);\n+        intent.setClass(getContext(), SliceBroadcastReceiver.class);\n+        return PendingIntent.getBroadcast(getContext(), 0, intent,\n+                PendingIntent.FLAG_CANCEL_CURRENT);\n+    }\n }\ndiff --git a/samples/SupportSliceDemos/src/main/java/com/example/androidx/slice/demos/SliceBroadcastReceiver.java b/samples/SupportSliceDemos/src/main/java/com/example/androidx/slice/demos/SliceBroadcastReceiver.java\nnew file mode 100644\nindex 00000000000..a8d5367a4d2\n--- /dev/null\n+++ b/samples/SupportSliceDemos/src/main/java/com/example/androidx/slice/demos/SliceBroadcastReceiver.java\n@@ -0,0 +1,49 @@\n+/*\n+ * Copyright 2017 The Android Open Source Project\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.example.androidx.slice.demos;\n+\n+import android.content.BroadcastReceiver;\n+import android.content.Context;\n+import android.content.Intent;\n+import android.net.wifi.WifiManager;\n+import android.os.Handler;\n+\n+import androidx.app.slice.builders.SliceHints;\n+\n+/**\n+ * Responds to actions performed on slices and notifies slices of updates in state changes.\n+ */\n+public class SliceBroadcastReceiver extends BroadcastReceiver {\n+\n+    @Override\n+    public void onReceive(Context context, Intent i) {\n+        String action = i.getAction();\n+        switch (action) {\n+            case SampleSliceProvider.ACTION_WIFI_CHANGED:\n+                WifiManager wm = (WifiManager) context.getSystemService(Context.WIFI_SERVICE);\n+                boolean newState = i.getBooleanExtra(SliceHints.EXTRA_TOGGLE_STATE,\n+                        wm.isWifiEnabled());\n+                wm.setWifiEnabled(newState);\n+                // Wait a bit for wifi to update (TODO: is there a better way to do this?)\n+                Handler h = new Handler();\n+                h.postDelayed(() -> {\n+                    context.getContentResolver().notifyChange(SampleSliceProvider.WIFI, null);\n+                }, 1000);\n+                break;\n+        }\n+    }\n+}\ndiff --git a/samples/SupportSliceDemos/src/main/res/drawable/ic_large.xml b/samples/SupportSliceDemos/src/main/res/drawable/ic_large.xml\nindex b8042a802a2..79ac59069f3 100644\n--- a/samples/SupportSliceDemos/src/main/res/drawable/ic_large.xml\n+++ b/samples/SupportSliceDemos/src/main/res/drawable/ic_large.xml\n@@ -1,18 +1,18 @@\n <!--\n-Copyright (C) 2014 The Android Open Source Project\n-\n-   Licensed under the Apache License, Version 2.0 (the \"License\");\n-    you may not use this file except in compliance with the License.\n-    You may obtain a copy of the License at\n-\n-         http://www.apache.org/licenses/LICENSE-2.0\n-\n-    Unless required by applicable law or agreed to in writing, software\n-    distributed under the License is distributed on an \"AS IS\" BASIS,\n-    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n-    See the License for the specific language governing permissions and\n-    limitations under the License.\n--->\n+  ~ Copyright 2017 The Android Open Source Project\n+  ~\n+  ~ Licensed under the Apache License, Version 2.0 (the \"License\");\n+  ~ you may not use this file except in compliance with the License.\n+  ~ You may obtain a copy of the License at\n+  ~\n+  ~      http://www.apache.org/licenses/LICENSE-2.0\n+  ~\n+  ~ Unless required by applicable law or agreed to in writing, software\n+  ~ distributed under the License is distributed on an \"AS IS\" BASIS,\n+  ~ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+  ~ See the License for the specific language governing permissions and\n+  ~ limitations under the License.\n+  -->\n <vector xmlns:android=\"http://schemas.android.com/apk/res/android\"\n         android:width=\"48.0dp\"\n         android:height=\"48.0dp\"\ndiff --git a/samples/SupportSliceDemos/src/main/res/drawable/ic_settings_wifi.xml b/samples/SupportSliceDemos/src/main/res/drawable/ic_settings_wifi.xml\nnew file mode 100644\nindex 00000000000..4fbfd60711c\n--- /dev/null\n+++ b/samples/SupportSliceDemos/src/main/res/drawable/ic_settings_wifi.xml\n@@ -0,0 +1,28 @@\n+<!--\n+  ~ Copyright 2017 The Android Open Source Project\n+  ~\n+  ~ Licensed under the Apache License, Version 2.0 (the \"License\");\n+  ~ you may not use this file except in compliance with the License.\n+  ~ You may obtain a copy of the License at\n+  ~\n+  ~      http://www.apache.org/licenses/LICENSE-2.0\n+  ~\n+  ~ Unless required by applicable law or agreed to in writing, software\n+  ~ distributed under the License is distributed on an \"AS IS\" BASIS,\n+  ~ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+  ~ See the License for the specific language governing permissions and\n+  ~ limitations under the License.\n+  -->\n+<vector xmlns:android=\"http://schemas.android.com/apk/res/android\"\n+        android:width=\"24dp\"\n+        android:height=\"24dp\"\n+        android:viewportWidth=\"24.0\"\n+        android:viewportHeight=\"24.0\">\n+    <path\n+        android:fillColor=\"#FF000000\"\n+        android:pathData=\"M12.01,21.49L23.64,7c-0.45,-0.34 -4.93,-4 -11.64,-4C5.28,3 0.81,6.66 0.36,7l11.63,14.49 0.01,0.01 0.01,-0.01z\"\n+        android:fillAlpha=\".3\"/>\n+    <path\n+        android:fillColor=\"#FF000000\"\n+        android:pathData=\"M3.53,10.95l8.46,10.54 0.01,0.01 0.01,-0.01 8.46,-10.54C20.04,10.62 16.81,8 12,8c-4.81,0 -8.04,2.62 -8.47,2.95z\"/>\n+</vector>\ndiff --git a/samples/SupportSliceDemos/src/main/res/drawable/ic_shortcut.xml b/samples/SupportSliceDemos/src/main/res/drawable/ic_shortcut.xml\nindex 4b5485d6bc6..bf9572a7c3d 100644\n--- a/samples/SupportSliceDemos/src/main/res/drawable/ic_shortcut.xml\n+++ b/samples/SupportSliceDemos/src/main/res/drawable/ic_shortcut.xml\n@@ -1,18 +1,18 @@\n <!--\n-Copyright (C) 2014 The Android Open Source Project\n-\n-   Licensed under the Apache License, Version 2.0 (the \"License\");\n-    you may not use this file except in compliance with the License.\n-    You may obtain a copy of the License at\n-\n-         http://www.apache.org/licenses/LICENSE-2.0\n-\n-    Unless required by applicable law or agreed to in writing, software\n-    distributed under the License is distributed on an \"AS IS\" BASIS,\n-    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n-    See the License for the specific language governing permissions and\n-    limitations under the License.\n--->\n+  ~ Copyright 2017 The Android Open Source Project\n+  ~\n+  ~ Licensed under the Apache License, Version 2.0 (the \"License\");\n+  ~ you may not use this file except in compliance with the License.\n+  ~ You may obtain a copy of the License at\n+  ~\n+  ~      http://www.apache.org/licenses/LICENSE-2.0\n+  ~\n+  ~ Unless required by applicable law or agreed to in writing, software\n+  ~ distributed under the License is distributed on an \"AS IS\" BASIS,\n+  ~ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+  ~ See the License for the specific language governing permissions and\n+  ~ limitations under the License.\n+  -->\n <vector xmlns:android=\"http://schemas.android.com/apk/res/android\"\n     android:height=\"48.0dp\"\n     android:viewportHeight=\"48.0\"\ndiff --git a/samples/SupportSliceDemos/src/main/res/drawable/ic_small.xml b/samples/SupportSliceDemos/src/main/res/drawable/ic_small.xml\nindex b35e1c1973a..8fd43dfa24e 100644\n--- a/samples/SupportSliceDemos/src/main/res/drawable/ic_small.xml\n+++ b/samples/SupportSliceDemos/src/main/res/drawable/ic_small.xml\n@@ -1,18 +1,18 @@\n <!--\n-Copyright (C) 2014 The Android Open Source Project\n-\n-   Licensed under the Apache License, Version 2.0 (the \"License\");\n-    you may not use this file except in compliance with the License.\n-    You may obtain a copy of the License at\n-\n-         http://www.apache.org/licenses/LICENSE-2.0\n-\n-    Unless required by applicable law or agreed to in writing, software\n-    distributed under the License is distributed on an \"AS IS\" BASIS,\n-    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n-    See the License for the specific language governing permissions and\n-    limitations under the License.\n--->\n+  ~ Copyright 2017 The Android Open Source Project\n+  ~\n+  ~ Licensed under the Apache License, Version 2.0 (the \"License\");\n+  ~ you may not use this file except in compliance with the License.\n+  ~ You may obtain a copy of the License at\n+  ~\n+  ~      http://www.apache.org/licenses/LICENSE-2.0\n+  ~\n+  ~ Unless required by applicable law or agreed to in writing, software\n+  ~ distributed under the License is distributed on an \"AS IS\" BASIS,\n+  ~ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+  ~ See the License for the specific language governing permissions and\n+  ~ limitations under the License.\n+  -->\n <vector xmlns:android=\"http://schemas.android.com/apk/res/android\"\n         android:width=\"48.0dp\"\n         android:height=\"48.0dp\"\ndiff --git a/slices/builders/build.gradle b/slices/builders/build.gradle\nindex 2acc235ba63..b68dc009d35 100644\n--- a/slices/builders/build.gradle\n+++ b/slices/builders/build.gradle\n@@ -19,7 +19,6 @@ plugins {\n }\n \n dependencies {\n-    implementation project(\":slices-core\")\n     implementation libs.support.annotations, libs.support_exclude_config\n }\n \ndiff --git a/slices/builders/src/main/java/androidx/app/slice/builders/SliceHints.java b/slices/builders/src/main/java/androidx/app/slice/builders/SliceHints.java\nnew file mode 100644\nindex 00000000000..5db1219305f\n--- /dev/null\n+++ b/slices/builders/src/main/java/androidx/app/slice/builders/SliceHints.java\n@@ -0,0 +1,50 @@\n+/*\n+ * Copyright 2017 The Android Open Source Project\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package androidx.app.slice.builders;\n+\n+import static android.support.annotation.RestrictTo.Scope.LIBRARY_GROUP;\n+\n+import android.app.slice.Slice;\n+import android.app.slice.widget.SliceView;\n+import android.support.annotation.RestrictTo;\n+\n+\n+/**\n+ * Temporary class to contain hint constants for slices to be used.\n+ * @hide\n+ */\n+@RestrictTo(LIBRARY_GROUP)\n+public class SliceHints {\n+    /**\n+     * Hint to indicate that this content has a toggle action associated with it. To indicate that\n+     * the toggle is on, use {@link Slice#HINT_SELECTED}. When the toggle state changes, the intent\n+     * associated with it will be sent along with an extra {@link #EXTRA_TOGGLE_STATE} which can be\n+     * retrieved to see the new state of the toggle.\n+     */\n+    public static final String HINT_TOGGLE = \"toggle\";\n+\n+    /**\n+     * Key to retrieve an extra added to an intent when a control is changed.\n+     */\n+    public static final String EXTRA_TOGGLE_STATE = \"android.app.slice.extra.TOGGLE_STATE\";\n+    /**\n+     * Hint to indicate that this content should not be shown in the {@link SliceView#MODE_SMALL}\n+     * and {@link SliceView#MODE_LARGE} modes of SliceView. This content may be used to populate\n+     * the {@link SliceView#MODE_SHORTCUT} format of the slice.\n+     */\n+    public static final String HINT_HIDDEN = \"hidden\";\n+}\ndiff --git a/slices/core/build.gradle b/slices/core/build.gradle\nindex b145dedcf67..fcf754a000b 100644\n--- a/slices/core/build.gradle\n+++ b/slices/core/build.gradle\n@@ -20,6 +20,7 @@ plugins {\n \n dependencies {\n     implementation libs.support.annotations, libs.support_exclude_config\n+    compile project(path: ':slices-builders')\n }\n \n android {\ndiff --git a/slices/core/src/main/java/androidx/app/slice/core/SliceQuery.java b/slices/core/src/main/java/androidx/app/slice/core/SliceQuery.java\nindex 570c249b7e2..e1430d05dd3 100644\n--- a/slices/core/src/main/java/androidx/app/slice/core/SliceQuery.java\n+++ b/slices/core/src/main/java/androidx/app/slice/core/SliceQuery.java\n@@ -30,6 +30,8 @@ import java.util.stream.Collectors;\n import java.util.stream.Stream;\n import java.util.stream.StreamSupport;\n \n+import androidx.app.slice.builders.SliceHints;\n+\n /**\n  * Utilities for finding content within a Slice.\n  * @hide\n@@ -37,6 +39,60 @@ import java.util.stream.StreamSupport;\n @RestrictTo(RestrictTo.Scope.LIBRARY_GROUP)\n public class SliceQuery {\n \n+    /**\n+     * @return Whether this item is appropriate to be considered a \"start\" item, i.e. go in the\n+     *         front slot of a small slice.\n+     */\n+    public static boolean isStartType(SliceItem item) {\n+        final int type = item.getType();\n+        return !item.hasHint(SliceHints.HINT_TOGGLE)\n+                && ((type == SliceItem.TYPE_ACTION && (find(item, SliceItem.TYPE_IMAGE) != null))\n+                || type == SliceItem.TYPE_IMAGE\n+                || type == SliceItem.TYPE_TIMESTAMP);\n+    }\n+\n+    /**\n+     * @return Finds the first slice that has non-slice children.\n+     */\n+    public static SliceItem findFirstSlice(SliceItem slice) {\n+        if (slice.getType() != SliceItem.TYPE_SLICE) {\n+            return slice;\n+        }\n+        List<SliceItem> items = slice.getSlice().getItems();\n+        for (int i = 0; i < items.size(); i++) {\n+            if (items.get(i).getType() == SliceItem.TYPE_SLICE) {\n+                SliceItem childSlice = items.get(i);\n+                return findFirstSlice(childSlice);\n+            } else {\n+                // Doesn't have slice children so return it\n+                return slice;\n+            }\n+        }\n+        // Slices all the way down, just return it\n+        return slice;\n+    }\n+\n+    /**\n+     * @return Whether this item is a simple action, i.e. an action that only has an icon.\n+     */\n+    public static boolean isSimpleAction(SliceItem item) {\n+        if (item.getType() == SliceItem.TYPE_ACTION) {\n+            List<SliceItem> items = item.getSlice().getItems();\n+            boolean hasImage = false;\n+            for (int i = 0; i < items.size(); i++) {\n+                SliceItem child = items.get(i);\n+                if (child.getType() == SliceItem.TYPE_IMAGE && !hasImage) {\n+                    hasImage = true;\n+                } else if (child.getType() == SliceItem.TYPE_COLOR) {\n+                    continue;\n+                } else {\n+                    return false;\n+                }\n+            }\n+        }\n+        return false;\n+    }\n+\n     /**\n      */\n     public static boolean hasAnyHints(SliceItem item, String... hints) {\ndiff --git a/slices/view/build.gradle b/slices/view/build.gradle\nindex 9ce7167cd94..1ddb04bfe4c 100644\n--- a/slices/view/build.gradle\n+++ b/slices/view/build.gradle\n@@ -20,6 +20,7 @@ plugins {\n \n dependencies {\n     implementation project(\":slices-core\")\n+    implementation project(\":slices-builders\")\n     implementation libs.support.recyclerview, libs.support_exclude_config\n     implementation project(':lifecycle:extensions')\n }\ndiff --git a/slices/view/src/main/java/androidx/app/slice/widget/SliceViewUtil.java b/slices/view/src/main/java/androidx/app/slice/widget/SliceViewUtil.java\nindex 3b18a9fd02d..62844c1bee0 100644\n--- a/slices/view/src/main/java/androidx/app/slice/widget/SliceViewUtil.java\n+++ b/slices/view/src/main/java/androidx/app/slice/widget/SliceViewUtil.java\n@@ -34,11 +34,14 @@ import android.support.annotation.AttrRes;\n import android.support.annotation.ColorInt;\n import android.support.annotation.NonNull;\n import android.support.annotation.RestrictTo;\n+import android.text.format.DateUtils;\n import android.view.Gravity;\n import android.view.ViewGroup;\n import android.widget.FrameLayout;\n import android.widget.ImageView;\n \n+import java.util.Calendar;\n+\n /**\n  * A bunch of utilities for slice UI.\n  *\n@@ -99,7 +102,7 @@ public class SliceViewUtil {\n                 Color.blue(inputColor));\n     }\n \n-    /**:%s\n+    /**\n      */\n     @ColorInt\n     public static int getColorAttr(@NonNull Context context, @AttrRes int attr) {\n@@ -186,4 +189,11 @@ public class SliceViewUtil {\n         canvas.drawBitmap(bitmap, rect, rect, paint);\n         return output;\n     }\n+\n+    /**\n+     */\n+    public static CharSequence getRelativeTimeString(long time) {\n+        return DateUtils.getRelativeTimeSpanString(time, Calendar.getInstance().getTimeInMillis(),\n+                DateUtils.MINUTE_IN_MILLIS, DateUtils.FORMAT_ABBREV_RELATIVE);\n+    }\n }\ndiff --git a/slices/view/src/main/java/androidx/app/slice/widget/SmallTemplateView.java b/slices/view/src/main/java/androidx/app/slice/widget/SmallTemplateView.java\nindex a8c31a9eed4..f430602d19e 100644\n--- a/slices/view/src/main/java/androidx/app/slice/widget/SmallTemplateView.java\n+++ b/slices/view/src/main/java/androidx/app/slice/widget/SmallTemplateView.java\n@@ -16,23 +16,25 @@\n \n package androidx.app.slice.widget;\n \n+import android.app.PendingIntent;\n import android.app.PendingIntent.CanceledException;\n import android.app.slice.Slice;\n import android.app.slice.SliceItem;\n import android.content.Context;\n+import android.content.Intent;\n import android.os.AsyncTask;\n import android.support.annotation.RestrictTo;\n+import android.util.Log;\n import android.view.View;\n import android.widget.ImageView;\n import android.widget.LinearLayout;\n+import android.widget.Switch;\n import android.widget.TextView;\n \n-import java.text.Format;\n-import java.text.SimpleDateFormat;\n import java.util.ArrayList;\n-import java.util.Date;\n import java.util.List;\n \n+import androidx.app.slice.builders.SliceHints;\n import androidx.app.slice.core.SliceQuery;\n import androidx.app.slice.view.R;\n \n@@ -43,27 +45,39 @@ import androidx.app.slice.view.R;\n  */\n @RestrictTo(RestrictTo.Scope.LIBRARY)\n public class SmallTemplateView extends SliceView.SliceModeView implements\n-        LargeSliceAdapter.SliceListView {\n+        LargeSliceAdapter.SliceListView, View.OnClickListener {\n \n     private static final String TAG = \"SmallTemplateView\";\n \n+    // The number of items that fit on the right hand side of a small slice\n+    private static final int MAX_END_ITEMS = 3;\n+\n+    private SliceItem mColorItem;\n+\n     private int mIconSize;\n     private int mPadding;\n \n     private LinearLayout mStartContainer;\n-    private TextView mTitleText;\n+    private LinearLayout mContent;\n+    private TextView mPrimaryText;\n     private TextView mSecondaryText;\n     private LinearLayout mEndContainer;\n \n+    private SliceItem mRowAction;\n+    private View mDivider;\n+    private Switch mToggle;\n+\n     public SmallTemplateView(Context context) {\n         super(context);\n-        inflate(context, R.layout.abc_slice_small_template, this);\n         mIconSize = getContext().getResources().getDimensionPixelSize(R.dimen.abc_slice_icon_size);\n         mPadding = getContext().getResources().getDimensionPixelSize(R.dimen.abc_slice_padding);\n+        inflate(context, R.layout.abc_slice_small_template, this);\n \n         mStartContainer = (LinearLayout) findViewById(android.R.id.icon_frame);\n-        mTitleText = (TextView) findViewById(android.R.id.title);\n+  ",
    "Improve nodetool getendpoints docs for pk param .": "diff --git a/CHANGES.txt b/CHANGES.txt\nindex 8872f622a4..0f6329a422 100644\n--- a/CHANGES.txt\n+++ b/CHANGES.txt\n@@ -1,4 +1,6 @@\n 2.1.5\n+ * Improve nodetool getendpoints documentation about the partition\n+   key parameter (CASSANDRA-6458)\n  * Don't check other keyspaces for schema changes when an user-defined\n    type is altered (CASSANDRA-9187)\n  * Allow takeColumnFamilySnapshot to take a list of tables (CASSANDRA-8348)\ndiff --git a/src/java/org/apache/cassandra/tools/NodeTool.java b/src/java/org/apache/cassandra/tools/NodeTool.java\nindex 20cf567f8e..2c913e06ae 100644\n--- a/src/java/org/apache/cassandra/tools/NodeTool.java\n+++ b/src/java/org/apache/cassandra/tools/NodeTool.java\n@@ -1593,7 +1593,7 @@ public class NodeTool\n     @Command(name = \"getendpoints\", description = \"Print the end points that owns the key\")\n     public static class GetEndpoints extends NodeToolCmd\n     {\n-        @Arguments(usage = \"<keyspace> <cfname> <key>\", description = \"The keyspace, the column family, and the key for which we need to find the endpoint\")\n+        @Arguments(usage = \"<keyspace> <cfname> <key>\", description = \"The keyspace, the column family, and the partition key for which we need to find the endpoint\")\n         private List<String> args = new ArrayList<>();\n \n         @Override",
    "Add a new bug report template": "diff --git a/.github/ISSUE_TEMPLATE/bug_report.md b/.github/ISSUE_TEMPLATE/bug_report.md\nnew file mode 100644\nindex 000000000..96b411d84\n--- /dev/null\n+++ b/.github/ISSUE_TEMPLATE/bug_report.md\n@@ -0,0 +1,27 @@\n+---\n+name: Bug report\n+about: Create a report to help us improve\n+title: ''\n+labels: Status:Discovery\n+assignees: ''\n+\n+---\n+\n+**Describe the bug**\n+A clear and concise description of what the bug is.\n+\n+**To Reproduce**\n+Steps to reproduce the behavior:\n+1. Using (extracted zip file, installed with installer, integrated with maven project)\n+2. Basic environment description - database platform and version used, properties files/POM files/config files, extensions used... Ensure private information is redacted.\n+3. Exact command used - from CLI, from maven, etc.\n+4. Actual problematic behavior - include log files if available. Ensure private information is redacted.\n+\n+**Expected behavior**\n+A clear and concise description of what you expected to happen.\n+\n+**Screenshots**\n+If applicable, add screenshots to help explain your problem.\n+\n+**Additional context**\n+Add any other context about the problem here.",
    "Remove unused registered protocol ( and corresponding SSLConnector )": "diff --git a/src/org/parosproxy/paros/network/HttpSender.java b/src/org/parosproxy/paros/network/HttpSender.java\nindex 67cda7f74..20e63ad97 100644\n--- a/src/org/parosproxy/paros/network/HttpSender.java\n+++ b/src/org/parosproxy/paros/network/HttpSender.java\n@@ -100,8 +100,6 @@ public class HttpSender {\n \tpublic static final int BEAN_SHELL_INITIATOR = 8;\r\n \tpublic static final int ACCESS_CONTROL_SCANNER_INITIATOR = 9;\r\n \r\n-\tpublic static final String ZAP_CFU_PROTOCOL_ID = \"zapcfu\";\r\n-\r\n \tprivate static Logger log = Logger.getLogger(HttpSender.class);\r\n \r\n \tprivate static ProtocolSocketFactory sslFactory = null;\r\n@@ -123,8 +121,6 @@ public class HttpSender {\n \t\t\tProtocol.registerProtocol(\"https\", new Protocol(\"https\",\r\n \t\t\t\t\t(ProtocolSocketFactory) new SSLConnector(true), 443));\r\n \t\t}\r\n-\t\tProtocol.registerProtocol(ZAP_CFU_PROTOCOL_ID, new Protocol(ZAP_CFU_PROTOCOL_ID/*\"https\"*/,\r\n-\t\t\t\t(ProtocolSocketFactory) new SSLConnector(false), 11443));\r\n \r\n \t\tAuthPolicy.registerAuthScheme(AuthPolicy.NTLM, ZapNTLMScheme.class);\r\n \t}\r",
    "Fixes the stack overflow exception caused by RC extensions .": "diff --git a/litho-core/src/main/java/com/facebook/litho/LayoutState.java b/litho-core/src/main/java/com/facebook/litho/LayoutState.java\nindex bd898de688..16f4259b46 100644\n--- a/litho-core/src/main/java/com/facebook/litho/LayoutState.java\n+++ b/litho-core/src/main/java/com/facebook/litho/LayoutState.java\n@@ -2365,7 +2365,9 @@ public class LayoutState\n             layoutOutput.getId(),\n             layoutOutput.getIndex(),\n             layoutOutput.getBounds(),\n-            parent == null ? -1 : parent.getRenderUnit().getId());\n+            parent != null\n+                ? layoutState.mIncrementalMountOutputs.get(parent.getRenderUnit().getId())\n+                : null);\n     layoutState.mIncrementalMountOutputs.put(layoutOutput.getId(), incrementalMountOutput);\n     layoutState.mMountableOutputTops.add(incrementalMountOutput);\n     layoutState.mMountableOutputBottoms.add(incrementalMountOutput);\ndiff --git a/litho-it/src/test/java/com/facebook/litho/IncrementalMountExtensionTest.java b/litho-it/src/test/java/com/facebook/litho/IncrementalMountExtensionTest.java\nindex 47ae050ff2..32c91c4b00 100644\n--- a/litho-it/src/test/java/com/facebook/litho/IncrementalMountExtensionTest.java\n+++ b/litho-it/src/test/java/com/facebook/litho/IncrementalMountExtensionTest.java\n@@ -36,7 +36,6 @@ import com.facebook.rendercore.incrementalmount.IncrementalMountOutput;\n import java.util.ArrayList;\n import java.util.Arrays;\n import java.util.Collection;\n-import java.util.HashMap;\n import java.util.LinkedHashMap;\n import java.util.List;\n import java.util.Map;\n@@ -199,7 +198,8 @@ public class IncrementalMountExtensionTest {\n \n         mountableOutputs.add(renderTreeNode);\n         final IncrementalMountOutput incrementalMountOutput =\n-            new IncrementalMountOutput(i, i, bounds, (long) i == 0 ? -1 : 0);\n+            new IncrementalMountOutput(\n+                i, i, bounds, i != 0 ? mIncrementalMountOutputs.get((long) (i - 1)) : null);\n         mIncrementalMountOutputs.put(incrementalMountOutput.getId(), incrementalMountOutput);\n         tops.add(incrementalMountOutput);\n         bottoms.add(incrementalMountOutput);\ndiff --git a/litho-it/src/test/java/com/facebook/litho/LayoutStateCalculateTopsAndBottomsTest.java b/litho-it/src/test/java/com/facebook/litho/LayoutStateCalculateTopsAndBottomsTest.java\nindex 9fb1297ec3..e6715a7e60 100644\n--- a/litho-it/src/test/java/com/facebook/litho/LayoutStateCalculateTopsAndBottomsTest.java\n+++ b/litho-it/src/test/java/com/facebook/litho/LayoutStateCalculateTopsAndBottomsTest.java\n@@ -435,8 +435,7 @@ public class LayoutStateCalculateTopsAndBottomsTest {\n \n   private static IncrementalMountOutput createIncrementMountOutput(\n       int top, int bottom, int index, long hostId) {\n-    return new IncrementalMountOutput(\n-        (index + 1) * 1L, index, new Rect(0, top, 10, bottom), hostId);\n+    return new IncrementalMountOutput((index + 1) * 1L, index, new Rect(0, top, 10, bottom), null);\n   }\n \n   private static IncrementalMountOutput createIncrementMountOutput(int top, int bottom, int index) {\ndiff --git a/litho-rendercore-incremental-mount/src/main/java/com/facebook/rendercore/incrementalmount/IncrementalMountExtension.java b/litho-rendercore-incremental-mount/src/main/java/com/facebook/rendercore/incrementalmount/IncrementalMountExtension.java\nindex 8cbdfa3505..cdd08ab16f 100644\n--- a/litho-rendercore-incremental-mount/src/main/java/com/facebook/rendercore/incrementalmount/IncrementalMountExtension.java\n+++ b/litho-rendercore-incremental-mount/src/main/java/com/facebook/rendercore/incrementalmount/IncrementalMountExtension.java\n@@ -23,7 +23,6 @@ import androidx.annotation.Nullable;\n import androidx.annotation.VisibleForTesting;\n import androidx.collection.ArraySet;\n import com.facebook.rendercore.Host;\n-import com.facebook.rendercore.MountState;\n import com.facebook.rendercore.RenderTreeNode;\n import com.facebook.rendercore.RenderUnit;\n import com.facebook.rendercore.extensions.ExtensionState;\n@@ -111,6 +110,9 @@ public class IncrementalMountExtension\n     final long id = renderTreeNode.getRenderUnit().getId();\n     final IncrementalMountExtensionState state = extensionState.getState();\n     final IncrementalMountOutput output = state.mInput.getIncrementalMountOutputForId(id);\n+    if (output == null) {\n+      throw new IllegalArgumentException(\"Output with id=\" + id + \" not found.\");\n+    }\n \n     maybeAcquireReference(extensionState, state.mPreviousLocalVisibleRect, output, false);\n   }\n@@ -207,19 +209,18 @@ public class IncrementalMountExtension\n       final IncrementalMountOutput output,\n       final boolean isMounting) {\n \n+    final IncrementalMountOutput host = output.getHostOutput();\n+\n     // If id is ROOT_HOST_ID then already at root host.\n-    if (output.getId() != MountState.ROOT_HOST_ID) {\n+    if (host != null) {\n \n       // Make sure the host is mounted before the child.\n-      final long hostId = output.getHostId();\n-      IncrementalMountExtensionInput input = extensionState.getState().mInput;\n+      final IncrementalMountExtensionState state = extensionState.getState();\n \n       // If not root host or if no reference was acquired, acquire it.\n-      if (!extensionState.ownsReference(hostId)) {\n+      if (!extensionState.ownsReference(host.getId())) {\n         acquireMountReferenceEnsureHostIsMounted(\n-            extensionState,\n-            input.getIncrementalMountOutputForId(hostId),\n-            isMounting || extensionState.getState().mAcquireReferencesDuringMount);\n+            extensionState, host, isMounting || state.mAcquireReferencesDuringMount);\n       }\n     }\n \ndiff --git a/litho-rendercore-incremental-mount/src/main/java/com/facebook/rendercore/incrementalmount/IncrementalMountOutput.java b/litho-rendercore-incremental-mount/src/main/java/com/facebook/rendercore/incrementalmount/IncrementalMountOutput.java\nindex a2bc20a02a..530266b946 100644\n--- a/litho-rendercore-incremental-mount/src/main/java/com/facebook/rendercore/incrementalmount/IncrementalMountOutput.java\n+++ b/litho-rendercore-incremental-mount/src/main/java/com/facebook/rendercore/incrementalmount/IncrementalMountOutput.java\n@@ -17,20 +17,24 @@\n package com.facebook.rendercore.incrementalmount;\n \n import android.graphics.Rect;\n+import androidx.annotation.Nullable;\n \n /** The output object for incremental mount extension */\n public class IncrementalMountOutput {\n-  public final int index;\n-  public final Rect bounds;\n+  private final int index;\n+  private final Rect bounds;\n   private final long id;\n-  private final long hostId;\n+  private final @Nullable IncrementalMountOutput host;\n \n   public IncrementalMountOutput(\n-      final long id, final int index, final Rect bounds, final long hostId) {\n+      final long id,\n+      final int index,\n+      final Rect bounds,\n+      final @Nullable IncrementalMountOutput host) {\n     this.id = id;\n     this.index = index;\n     this.bounds = bounds;\n-    this.hostId = hostId;\n+    this.host = host;\n   }\n \n   public int getIndex() {\n@@ -45,7 +49,7 @@ public class IncrementalMountOutput {\n     return id;\n   }\n \n-  public long getHostId() {\n-    return hostId;\n+  public @Nullable IncrementalMountOutput getHostOutput() {\n+    return host;\n   }\n }\ndiff --git a/litho-rendercore-incremental-mount/src/main/java/com/facebook/rendercore/incrementalmount/IncrementalMountRenderCoreExtension.java b/litho-rendercore-incremental-mount/src/main/java/com/facebook/rendercore/incrementalmount/IncrementalMountRenderCoreExtension.java\nindex 69b6eb16e9..ed27f0c6c2 100644\n--- a/litho-rendercore-incremental-mount/src/main/java/com/facebook/rendercore/incrementalmount/IncrementalMountRenderCoreExtension.java\n+++ b/litho-rendercore-incremental-mount/src/main/java/com/facebook/rendercore/incrementalmount/IncrementalMountRenderCoreExtension.java\n@@ -4,7 +4,6 @@ package com.facebook.rendercore.incrementalmount;\n \n import android.graphics.Rect;\n import androidx.annotation.Nullable;\n-import com.facebook.rendercore.MountState;\n import com.facebook.rendercore.Node;\n import com.facebook.rendercore.Node.LayoutResult;\n import com.facebook.rendercore.RenderTreeHost;\n@@ -180,29 +179,26 @@ public class IncrementalMountRenderCoreExtension\n         final int position,\n         final Results results) {\n \n-      final long id;\n       if (position == 0) {\n-        id = MountState.ROOT_HOST_ID;\n-      } else {\n-        final RenderUnit<?> unit = result.getRenderUnit();\n-        if (unit == null) {\n-          return;\n-        }\n-        id = unit.getId();\n+        return;\n       }\n \n-      final long hostId;\n-      if (parent != null) {\n-        if (parent.getRenderUnit() == null) {\n-          throw new IllegalArgumentException(\"Parent Node must have a RenderUnit.\");\n-        }\n-        hostId = parent.getRenderUnit().getId();\n-      } else {\n-        hostId = -1;\n+      final RenderUnit<?> unit = result.getRenderUnit();\n+      if (unit == null) {\n+        return;\n+      }\n+\n+      final long id = unit.getId();\n+\n+      final IncrementalMountOutput host;\n+      if (parent == null) {\n+        throw new IllegalArgumentException(\"Parent was null for position=\" + position);\n       }\n \n+      host = results.getIncrementalMountOutputForId(parent.getRenderUnit().getId());\n+\n       final Rect rect = new Rect(x, y, x + bounds.width(), y + bounds.height());\n-      results.addOutput(new IncrementalMountOutput(id, position, rect, hostId));\n+      results.addOutput(new IncrementalMountOutput(id, position, rect, host));\n       if (provider.hasRenderTreeHosts(result)) {\n         results.addRenderTreeHostId(id);\n       }\ndiff --git a/litho-rendercore/src/main/java/com/facebook/rendercore/extensions/LayoutResultVisitor.java b/litho-rendercore/src/main/java/com/facebook/rendercore/extensions/LayoutResultVisitor.java\nindex 46673cee8b..9d52b268aa 100644\n--- a/litho-rendercore/src/main/java/com/facebook/rendercore/extensions/LayoutResultVisitor.java\n+++ b/litho-rendercore/src/main/java/com/facebook/rendercore/extensions/LayoutResultVisitor.java\n@@ -35,7 +35,7 @@ public interface LayoutResultVisitor<State> {\n   /**\n    * This API is called for every LayoutResult during a layout pass.\n    *\n-   * @param parent\n+   * @param parent The parent {@link RenderTreeNode}.\n    * @param result The {@link LayoutResult} being visited.\n    * @param bounds The bounds of this {@link LayoutResult} relative to its parent.\n    * @param x The absolute x position.",
    "Improve certutil - - pass documentation about empty password ( <issue_id> ) .": "diff --git a/docs/reference/commands/certutil.asciidoc b/docs/reference/commands/certutil.asciidoc\nindex 06e9dc53bd9..6f4d3224d7a 100644\n--- a/docs/reference/commands/certutil.asciidoc\n+++ b/docs/reference/commands/certutil.asciidoc\n@@ -177,14 +177,17 @@ with the `ca` parameter.\n \n `--pass <password>`:: Specifies the password for the generated private keys.\n +\n-Keys stored in PKCS#12 format are always password protected.\n+Keys stored in PKCS#12 format are always password protected, however,\n+this password may be _blank_. If you want to specify a blank password\n+without a prompt, use `--pass \"\"` (with no `=`) on the command line.\n +\n Keys stored in PEM format are password protected only if the\n `--pass` parameter is specified. If you do not supply an argument for the\n `--pass` parameter, you are prompted for a password.\n-+\n-If you want to specify a _blank_ password (without prompting), use \n-`--pass \"\"` (with no `=`).\n+Encrypted PEM files do not support blank passwords (if you do not\n+wish to password-protect your PEM keys, then do not specify\n+`--pass`).\n+\n \n `--pem`:: Generates certificates and keys in PEM format instead of PKCS#12. This\n parameter cannot be used with the `csr` parameter.",
    "adding rule and compilation check to report empty decision table input entries ( <issue_id> ) .": "diff --git a/kie-dmn/kie-dmn-core/src/main/java/org/kie/dmn/core/compiler/DMNEvaluatorCompiler.java b/kie-dmn/kie-dmn-core/src/main/java/org/kie/dmn/core/compiler/DMNEvaluatorCompiler.java\nindex c9bc329841..27daa49d5c 100644\n--- a/kie-dmn/kie-dmn-core/src/main/java/org/kie/dmn/core/compiler/DMNEvaluatorCompiler.java\n+++ b/kie-dmn/kie-dmn-core/src/main/java/org/kie/dmn/core/compiler/DMNEvaluatorCompiler.java\n@@ -308,6 +308,18 @@ public class DMNEvaluatorCompiler {\n         for ( DecisionRule dr : dt.getRule() ) {\n             DTDecisionRule rule = new DTDecisionRule( index );\n             for( UnaryTests ut : dr.getInputEntry() ) {\n+                if( ut == null || ut.getText() == null || ut.getText().isEmpty() ) {\n+                    MsgUtil.reportMessage( logger,\n+                                           DMNMessage.Severity.ERROR,\n+                                           ut,\n+                                           model,\n+                                           null,\n+                                           null,\n+                                           Msg.DTABLE_EMPTY_ENTRY,\n+                                           dt.getRule().indexOf( dr ) + 1,\n+                                           dr.getInputEntry().indexOf( ut ) + 1,\n+                                           dt.getParentDRDElement().getIdentifierString() );\n+                }\n                 java.util.List<UnaryTest> tests = textToUnaryTestList( ctx,\n                                                                        ut.getText(),\n                                                                        model,\ndiff --git a/kie-dmn/kie-dmn-core/src/main/java/org/kie/dmn/core/util/Msg.java b/kie-dmn/kie-dmn-core/src/main/java/org/kie/dmn/core/util/Msg.java\nindex 14167c30c7..ed5a3491b6 100644\n--- a/kie-dmn/kie-dmn-core/src/main/java/org/kie/dmn/core/util/Msg.java\n+++ b/kie-dmn/kie-dmn-core/src/main/java/org/kie/dmn/core/util/Msg.java\n@@ -43,6 +43,7 @@ public class Msg {\n     public static final Message1 MISSING_OUTPUT_VALUES                               = new Message1( DMNMessageType.MISSING_OUTPUT_VALUES, \"Decision table with hit policy Priority on node '%s' requires output elements to specify the output values list\" );\n     public static final Message1 DTABLE_SINGLEOUT_NONAME                             = new Message1( DMNMessageType.ILLEGAL_USE_OF_NAME, \"Decision table with single output on node '%s' should not have output name\" );\n     public static final Message1 DTABLE_SINGLEOUT_NOTYPEREF                          = new Message1( DMNMessageType.ILLEGAL_USE_OF_TYPEREF, \"Decision table with single output on node '%s' should not have an output type reference\" );\n+    public static final Message3 DTABLE_EMPTY_ENTRY                                  = new Message3( DMNMessageType.MISSING_EXPRESSION, \"Missing test on decision table input entry (row %d, column %d) on node '%s'\" );\n     public static final Message1 ELEMREF_NOHASH                                      = new Message1( DMNMessageType.INVALID_HREF_SYNTAX, \"The 'href' reference on node '%s' requires the use of the anchor syntax\" );\n     public static final Message2 DUPLICATE_FORMAL_PARAM                              = new Message2( DMNMessageType.DUPLICATED_PARAM, \"The formal parameter '%s' on function definition on node '%s' is duplicated\" );\n     public static final Message3 UNKNOWN_PARAMETER                                   = new Message3( DMNMessageType.PARAMETER_MISMATCH, \"Unknown parameter '%s' invoking function '%s' on node '%s'\" );\ndiff --git a/kie-dmn/kie-dmn-core/src/test/java/org/kie/dmn/core/DMNRuntimeTest.java b/kie-dmn/kie-dmn-core/src/test/java/org/kie/dmn/core/DMNRuntimeTest.java\nindex d143d196c8..4e9482180d 100644\n--- a/kie-dmn/kie-dmn-core/src/test/java/org/kie/dmn/core/DMNRuntimeTest.java\n+++ b/kie-dmn/kie-dmn-core/src/test/java/org/kie/dmn/core/DMNRuntimeTest.java\n@@ -992,7 +992,7 @@ public class DMNRuntimeTest {\n                 \"Dessin 1\" );\n         assertThat( dmnModel, notNullValue() );\n         assertThat( formatMessages( dmnModel.getMessages() ), dmnModel.hasErrors(), is( true ) );\n-        assertThat( dmnModel.getMessages().size(), is( 3 ) );\n+        assertThat( formatMessages( dmnModel.getMessages() ), dmnModel.getMessages().size(), is( 3 ) );\n         assertThat( dmnModel.getMessages().get( 0 ).getSourceReference(), is( instanceOf( ItemDefinition.class ) ) );\n         assertThat( dmnModel.getMessages().get( 0 ).getMessageType(), is( DMNMessageType.ERR_COMPILING_FEEL ) );\n         assertThat( dmnModel.getMessages().get( 1 ).getSourceId(), is( \"_e794c655-4fdf-45d1-b7b7-d990df513f92\" ) );\ndiff --git a/kie-dmn/kie-dmn-core/src/test/resources/org/kie/dmn/core/Loan_Recommendation2.dmn b/kie-dmn/kie-dmn-core/src/test/resources/org/kie/dmn/core/Loan_Recommendation2.dmn\nindex 85a011f116..389035cd0d 100644\n--- a/kie-dmn/kie-dmn-core/src/test/resources/org/kie/dmn/core/Loan_Recommendation2.dmn\n+++ b/kie-dmn/kie-dmn-core/src/test/resources/org/kie/dmn/core/Loan_Recommendation2.dmn\n@@ -698,7 +698,7 @@\n       </semantic:rule>\n       <semantic:rule id=\"_317797a6-756e-4359-a7fc-dde584eda4b4\">\n         <semantic:inputEntry id=\"_0aede350-64ed-4df2-a046-de3692195101\">\n-          <semantic:text/>\n+          <semantic:text>-</semantic:text>\n         </semantic:inputEntry>\n         <semantic:inputEntry id=\"_a13f638e-ddb2-4c4a-abce-8d2191e76da7\">\n           <semantic:text>\"Employed\"</semantic:text>\n@@ -715,7 +715,7 @@\n       </semantic:rule>\n       <semantic:rule id=\"_4218cd3b-c337-4a00-8d1c-94d82671a83c\">\n         <semantic:inputEntry id=\"_bd9919b0-2182-4c96-a393-6d5be89b9865\">\n-          <semantic:text/>\n+          <semantic:text>-</semantic:text>\n         </semantic:inputEntry>\n         <semantic:inputEntry id=\"_f6305661-3f54-4f10-bf84-2b2520273244\">\n           <semantic:text>\"Employed\"</semantic:text>\n@@ -732,7 +732,7 @@\n       </semantic:rule>\n       <semantic:rule id=\"_b2bf5c43-fde1-41b4-b969-ce5bf6e9b519\">\n         <semantic:inputEntry id=\"_ab7a64ef-c111-477d-a448-4b917b26dd3c\">\n-          <semantic:text/>\n+          <semantic:text>-</semantic:text>\n         </semantic:inputEntry>\n         <semantic:inputEntry id=\"_89098272-9687-47a5-8eff-fc112b07eca3\">\n           <semantic:text>\"Employed\"</semantic:text>\n@@ -749,7 +749,7 @@\n       </semantic:rule>\n       <semantic:rule id=\"_f370914c-5569-488a-bdca-c03c70e4003d\">\n         <semantic:inputEntry id=\"_3f968f13-3397-49bb-ac22-8016808f4c80\">\n-          <semantic:text/>\n+          <semantic:text>-</semantic:text>\n         </semantic:inputEntry>\n         <semantic:inputEntry id=\"_3440f8ef-4ea4-47dc-b5ed-b3f8c7105ab0\">\n           <semantic:text>\"Self-employed\"</semantic:text>\n@@ -766,7 +766,7 @@\n       </semantic:rule>\n       <semantic:rule id=\"_deb10acb-ae90-453f-bac7-fff2a89ad123\">\n         <semantic:inputEntry id=\"_dcbd293d-2d76-41ef-986e-c077cc44c934\">\n-          <semantic:text/>\n+          <semantic:text>-</semantic:text>\n         </semantic:inputEntry>\n         <semantic:inputEntry id=\"_0950364a-b781-4ecd-882f-6ec091fb80db\">\n           <semantic:text>\"Self-employed\"</semantic:text>\n@@ -783,7 +783,7 @@\n       </semantic:rule>\n       <semantic:rule id=\"_2d798cd3-a77f-4a37-ae00-8d7a4ca8950d\">\n         <semantic:inputEntry id=\"_9c302a8c-896c-491f-864a-e9b64c6eb619\">\n-          <semantic:text/>\n+          <semantic:text>-</semantic:text>\n         </semantic:inputEntry>\n         <semantic:inputEntry id=\"_b5ebd290-6085-4f31-a777-4697fef47d8b\">\n           <semantic:text>\"Self-employed\"</semantic:text>\n@@ -800,7 +800,7 @@\n       </semantic:rule>\n       <semantic:rule id=\"_1bf448df-1f01-45fb-a900-d05b8f4b6541\">\n         <semantic:inputEntry id=\"_ab0bf38e-bd13-4e63-8433-fccf3178779b\">\n-          <semantic:text/>\n+          <semantic:text>-</semantic:text>\n         </semantic:inputEntry>\n         <semantic:inputEntry id=\"_3b670331-7f7b-4493-b6e0-71c49058e5fd\">\n           <semantic:text>\"Retired\"</semantic:text>\n@@ -817,7 +817,7 @@\n       </semantic:rule>\n       <semantic:rule id=\"_c87d02f4-f5bf-49f9-97aa-423a2380c015\">\n         <semantic:inputEntry id=\"_ee61805e-d530-4b8d-b5a2-3fb00fac3ddf\">\n-          <semantic:text/>\n+          <semantic:text>-</semantic:text>\n         </semantic:inputEntry>\n         <semantic:inputEntry id=\"_78bf3d95-0bbd-45f0-a199-4702bdcc1c4f\">\n           <semantic:text>\"Unemployed\"</semantic:text>\ndiff --git a/kie-dmn/kie-dmn-core/src/test/resources/org/kie/dmn/core/WrongConstraintsInItemDefinition.dmn b/kie-dmn/kie-dmn-core/src/test/resources/org/kie/dmn/core/WrongConstraintsInItemDefinition.dmn\nindex ae1f556ca1..e6384a6317 100644\n--- a/kie-dmn/kie-dmn-core/src/test/resources/org/kie/dmn/core/WrongConstraintsInItemDefinition.dmn\n+++ b/kie-dmn/kie-dmn-core/src/test/resources/org/kie/dmn/core/WrongConstraintsInItemDefinition.dmn\n@@ -24,10 +24,10 @@\n       <semantic:output id=\"_6c09b12a-73d5-4f8f-b583-b007d58881ad\"/>\r\n       <semantic:rule id=\"_0403ec9a-51e9-4b3c-883a-fe6584919036\">\r\n         <semantic:inputEntry id=\"_fca031ec-9a37-4795-b06b-8b4c9044c8eb\">\r\n-          <semantic:text/>\r\n+          <semantic:text>-</semantic:text>\r\n         </semantic:inputEntry>\r\n         <semantic:outputEntry id=\"_aef76a51-de39-488c-bf54-fdb3e193613b\">\r\n-          <semantic:text/>\r\n+          <semantic:text>-</semantic:text>\r\n         </semantic:outputEntry>\r\n       </semantic:rule>\r\n     </semantic:decisionTable>\r\ndiff --git a/kie-dmn/kie-dmn-validation/src/main/resources/dmn-validation-rules-dtable.drl b/kie-dmn/kie-dmn-validation/src/main/resources/dmn-validation-rules-dtable.drl\nindex a22a000749..50d4323f80 100644\n--- a/kie-dmn/kie-dmn-validation/src/main/resources/dmn-validation-rules-dtable.drl\n+++ b/kie-dmn/kie-dmn-validation/src/main/resources/dmn-validation-rules-dtable.drl\n@@ -62,4 +62,13 @@ when\n   $oc : OutputClause( parent instanceof DecisionTable, parent.output.size == 1, this.typeRef != null )\n then\n   reporter.report( DMNMessage.Severity.WARN,  $oc , Msg.DTABLE_SINGLEOUT_NOTYPEREF, $oc.getParentDRDElement().getIdentifierString() );\n+end\n+\n+rule DTABLE_EMPTY_ENTRY\n+when\n+  $ie : UnaryTests( text == null || text.isEmpty(), parent instanceof DecisionRule )\n+  $dr : DecisionRule( ) from $ie.parent\n+  $dt : DecisionTable( ) from $dr.parent\n+then\n+  reporter.report( DMNMessage.Severity.ERROR,  $ie , Msg.DTABLE_EMPTY_ENTRY, $dt.getRule().indexOf( $dr )+1, $dr.getInputEntry().indexOf($ie)+1, $dt.getParentDRDElement().getIdentifierString() );\n end\n\\ No newline at end of file\ndiff --git a/kie-dmn/kie-dmn-validation/src/test/java/org/kie/dmn/validation/ValidatorDecisionTableTest.java b/kie-dmn/kie-dmn-validation/src/test/java/org/kie/dmn/validation/ValidatorDecisionTableTest.java\nnew file mode 100644\nindex 0000000000..af1cbfa8d7\n--- /dev/null\n+++ b/kie-dmn/kie-dmn-validation/src/test/java/org/kie/dmn/validation/ValidatorDecisionTableTest.java\n@@ -0,0 +1,67 @@\n+/*\n+ * Copyright 2017 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *       http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.kie.dmn.validation;\n+\n+import org.junit.Test;\n+import org.kie.dmn.api.core.DMNMessage;\n+import org.kie.dmn.api.core.DMNMessageType;\n+import org.kie.dmn.model.v1_1.Context;\n+import org.kie.dmn.model.v1_1.ContextEntry;\n+\n+import java.util.List;\n+\n+import static org.hamcrest.CoreMatchers.is;\n+import static org.junit.Assert.assertThat;\n+import static org.junit.Assert.assertTrue;\n+import static org.kie.dmn.validation.DMNValidator.Validation.*;\n+\n+public class ValidatorDecisionTableTest\n+        extends AbstractValidatorTest {\n+\n+    @Test\n+    public void testDTABLE_EMPTY_ENTRY() {\n+        final List<DMNMessage> validate = validator.validate(\n+                getReader(\"DTABLE_EMPTY_ENTRY.dmn\"),\n+                VALIDATE_MODEL, VALIDATE_COMPILATION);\n+        assertThat(ValidatorUtil.formatMessages(validate), validate.size(), is(2));\n+        assertTrue(validate.stream().anyMatch(p -> p.getMessageType().equals(DMNMessageType.MISSING_EXPRESSION)));\n+    }\n+\n+    @Test\n+    public void testDTABLE_MULTIPLEOUT_NAME() {\n+        List<DMNMessage> validate = validator.validate( getReader( \"DTABLE_MULTIPLEOUTPUT_WRONG_OUTPUT.dmn\" ), VALIDATE_SCHEMA, VALIDATE_MODEL, VALIDATE_COMPILATION);\n+        assertThat( ValidatorUtil.formatMessages( validate ), validate.size(), is( 5 ) );\n+        assertTrue( validate.stream().anyMatch( p -> p.getMessageType().equals( DMNMessageType.MISSING_NAME ) ) );\n+        assertTrue( validate.stream().anyMatch( p -> p.getMessageType().equals( DMNMessageType.MISSING_TYPE_REF ) ) );\n+        assertTrue( validate.stream().anyMatch( p -> p.getMessageType().equals( DMNMessageType.INVALID_NAME ) ) );\n+    }\n+\n+    @Test\n+    public void testDTABLE_PRIORITY_MISSING_OUTVALS() {\n+        List<DMNMessage> validate = validator.validate( getReader( \"DTABLE_PRIORITY_MISSING_OUTVALS.dmn\" ), VALIDATE_SCHEMA, VALIDATE_MODEL, VALIDATE_COMPILATION);\n+        assertThat( ValidatorUtil.formatMessages( validate ), validate.size(), is( 1 ) );\n+        assertTrue( validate.stream().anyMatch( p -> p.getMessageType().equals( DMNMessageType.MISSING_OUTPUT_VALUES ) ) );\n+    }\n+\n+    @Test\n+    public void testDTABLE_SINGLEOUT_NONAME() {\n+        List<DMNMessage> validate = validator.validate( getReader( \"DTABLE_SINGLEOUTPUT_WRONG_OUTPUT.dmn\" ), VALIDATE_SCHEMA, VALIDATE_MODEL, VALIDATE_COMPILATION);\n+        assertThat( ValidatorUtil.formatMessages( validate ), validate.size(), is( 2 ) );\n+        assertTrue( validate.stream().anyMatch( p -> p.getMessageType().equals( DMNMessageType.ILLEGAL_USE_OF_NAME ) ) );\n+        assertTrue( validate.stream().anyMatch( p -> p.getMessageType().equals( DMNMessageType.ILLEGAL_USE_OF_TYPEREF ) ) );\n+    }\n+}\ndiff --git a/kie-dmn/kie-dmn-validation/src/test/java/org/kie/dmn/validation/ValidatorTest.java b/kie-dmn/kie-dmn-validation/src/test/java/org/kie/dmn/validation/ValidatorTest.java\nindex 7fa5c1a619..d21fba2cb9 100644\n--- a/kie-dmn/kie-dmn-validation/src/test/java/org/kie/dmn/validation/ValidatorTest.java\n+++ b/kie-dmn/kie-dmn-validation/src/test/java/org/kie/dmn/validation/ValidatorTest.java\n@@ -126,30 +126,6 @@ public class ValidatorTest extends AbstractValidatorTest {\n         assertTrue( validate.stream().anyMatch( p -> p.getMessageType().equals( DMNMessageType.DUPLICATE_NAME ) ) );\n     }\n     \n-    @Test\n-    public void testDTABLE_MULTIPLEOUT_NAME() {\n-        List<DMNMessage> validate = validator.validate( getReader( \"DTABLE_MULTIPLEOUTPUT_WRONG_OUTPUT.dmn\" ), VALIDATE_SCHEMA, VALIDATE_MODEL, VALIDATE_COMPILATION);\n-        assertThat( ValidatorUtil.formatMessages( validate ), validate.size(), is( 5 ) );\n-        assertTrue( validate.stream().anyMatch( p -> p.getMessageType().equals( DMNMessageType.MISSING_NAME ) ) );\n-        assertTrue( validate.stream().anyMatch( p -> p.getMessageType().equals( DMNMessageType.MISSING_TYPE_REF ) ) );\n-        assertTrue( validate.stream().anyMatch( p -> p.getMessageType().equals( DMNMessageType.INVALID_NAME ) ) );\n-    }\n-    \n-    @Test\n-    public void testDTABLE_PRIORITY_MISSING_OUTVALS() {\n-        List<DMNMessage> validate = validator.validate( getReader( \"DTABLE_PRIORITY_MISSING_OUTVALS.dmn\" ), VALIDATE_SCHEMA, VALIDATE_MODEL, VALIDATE_COMPILATION);\n-        assertThat( ValidatorUtil.formatMessages( validate ), validate.size(), is( 1 ) );\n-        assertTrue( validate.stream().anyMatch( p -> p.getMessageType().equals( DMNMessageType.MISSING_OUTPUT_VALUES ) ) );\n-    }\n-    \n-    @Test\n-    public void testDTABLE_SINGLEOUT_NONAME() {\n-        List<DMNMessage> validate = validator.validate( getReader( \"DTABLE_SINGLEOUTPUT_WRONG_OUTPUT.dmn\" ), VALIDATE_SCHEMA, VALIDATE_MODEL, VALIDATE_COMPILATION);\n-        assertThat( ValidatorUtil.formatMessages( validate ), validate.size(), is( 2 ) );\n-        assertTrue( validate.stream().anyMatch( p -> p.getMessageType().equals( DMNMessageType.ILLEGAL_USE_OF_NAME ) ) );\n-        assertTrue( validate.stream().anyMatch( p -> p.getMessageType().equals( DMNMessageType.ILLEGAL_USE_OF_TYPEREF ) ) );\n-    }\n-    \n     @Test\n     public void testFORMAL_PARAM_DUPLICATED() {\n         List<DMNMessage> validate = validator.validate( getReader( \"FORMAL_PARAM_DUPLICATED.dmn\" ), VALIDATE_SCHEMA, VALIDATE_MODEL, VALIDATE_COMPILATION);\ndiff --git a/kie-dmn/kie-dmn-validation/src/test/resources/org/kie/dmn/validation/DTABLE_EMPTY_ENTRY.dmn b/kie-dmn/kie-dmn-validation/src/test/resources/org/kie/dmn/validation/DTABLE_EMPTY_ENTRY.dmn\nnew file mode 100644\nindex 0000000000..74a29362da\n--- /dev/null\n+++ b/kie-dmn/kie-dmn-validation/src/test/resources/org/kie/dmn/validation/DTABLE_EMPTY_ENTRY.dmn\n@@ -0,0 +1,121 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<!--\n+  ~ Licensed under the Apache License, Version 2.0 (the \"License\");\n+  ~ you may not use this file except in compliance with the License.\n+  ~ You may obtain a copy of the License at\n+  ~\n+  ~       http://www.apache.org/licenses/LICENSE-2.0\n+  ~\n+  ~ Unless required by applicable law or agreed to in writing, software\n+  ~ distributed under the License is distributed on an \"AS IS\" BASIS,\n+  ~ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+  ~ See the License for the specific language governing permissions and\n+  ~ limitations under the License.\n+  -->\n+\n+<definitions id=\"DTABLE_PRIORITY_MISSING_OUTVALS\" name=\"DTABLE_PRIORITY_MISSING_OUTVALS\"\n+    namespace=\"https://github.com/kiegroup/kie-dmn\"\n+    xmlns=\"http://www.omg.org/spec/DMN/20151101/dmn.xsd\"\n+    xmlns:feel=\"http://www.omg.org/spec/FEEL/20140401\"\n+    xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n+    xsi:schemaLocation=\"http://www.omg.org/spec/DMN/20151101/dmn.xsd http://www.omg.org/spec/DMN/20151101/dmn.xsd \">\n+  <decision id=\"_0004-simpletable-U\" name=\"simpletable-U\">\n+    <variable name=\"simpletable-U\" typeRef=\"feel:string\"/>\n+    <informationRequirement>\n+      <requiredInput href=\"#_Age\"/>\n+    </informationRequirement>\n+    <informationRequirement>\n+      <requiredInput href=\"#_RiskCategory\"/>\n+    </informationRequirement>\n+    <informationRequirement>\n+      <requiredInput href=\"#_isAffordable\"/>\n+    </informationRequirement>\n+    <decisionTable hitPolicy=\"FIRST\" outputLabel=\"Approval Status\" preferredOrientation=\"Rule-as-Row\">\n+      <input id=\"_iAge\" label=\"Age\">\n+        <inputExpression typeRef=\"feel:number\">\n+          <text>Age</text>\n+        </inputExpression>\n+      </input>\n+      <input id=\"_iRiskCategory\" label=\"RiskCategory\">\n+        <inputExpression typeRef=\"feel:string\">\n+          <text>RiskCategory</text>\n+        </inputExpression>\n+        <inputValues>\n+          <text>\"High\", \"Low\", \"Medium\"</text>\n+        </inputValues>\n+      </input>\n+      <input id=\"_iIsAffordable\" label=\"isAffordable\">\n+        <inputExpression typeRef=\"feel:boolean\">\n+          <text>isAffordable</text>\n+        </inputExpression>\n+      </input>\n+      <output id=\"_oApprovalStatus\">\n+        <!-- TEST -->\n+      </output>\n+      <rule id=\"_7f03803d-2636-40ab-8346-7fd7f38ab695\">\n+        <inputEntry id=\"_7f03803d-2636-40ab-8346-7fd7f38ab695-0\">\n+          <text>&gt;=18</text>\n+        </inputEntry>\n+        <inputEntry id=\"_7f03803d-2636-40ab-8346-7fd7f38ab695-1\">\n+          <text/>\n+        </inputEntry>\n+        <inputEntry id=\"_7f03803d-2636-40ab-8346-7fd7f38ab695-2\">\n+          <text>true</text>\n+        </inputEntry>\n+        <outputEntry id=\"_7f03803d-2636-40ab-8346-7fd7f38ab695-3\">\n+          <text>\"Approved\"</text>\n+        </outputEntry>\n+      </rule>\n+      <rule id=\"_887acecd-40fc-42da-9443-eeba476f5516\">\n+        <inputEntry id=\"_887acecd-40fc-42da-9443-eeba476f5516-0\">\n+          <text>&lt;18</text>\n+        </inputEntry>\n+        <inputEntry id=\"_887acecd-40fc-42da-9443-eeba476f5516-1\">\n+          <text>\"Medium\",\"Low\"</text>\n+        </inputEntry>\n+        <inputEntry id=\"_887acecd-40fc-42da-9443-eeba476f5516-2\">\n+        </inputEntry>\n+        <outputEntry id=\"_887acecd-40fc-42da-9443-eeba476f5516-3\">\n+          <text>\"Declined\"</text>\n+        </outputEntry>\n+      </rule>\n+      <rule id=\"_18058414-a571-4375-991f-77b9ea7fc699\">\n+        <inputEntry id=\"_18058414-a571-4375-991f-77b9ea7fc699-0\">\n+          <text>-</text>\n+        </inputEntry>\n+        <inputEntry id=\"_18058414-a571-4375-991f-77b9ea7fc699-1\">\n+          <text>\"High\"</text>\n+        </inputEntry>\n+        <inputEntry id=\"_18058414-a571-4375-991f-77b9ea7fc699-2\">\n+          <text>true</text>\n+        </inputEntry>\n+        <outputEntry id=\"_18058414-a571-4375-991f-77b9ea7fc699-3\">\n+          <text>\"Declined\"</text>\n+        </outputEntry>\n+      </rule>\n+      <rule id=\"_ede3e62a-43f3-49d3-90a4-ffaf1f698f54\">\n+        <inputEntry id=\"_ede3e62a-43f3-49d3-90a4-ffaf1f698f54-0\">\n+          <text>-</text>\n+        </inputEntry>\n+        <inputEntry id=\"_ede3e62a-43f3-49d3-90a4-ffaf1f698f54-1\">\n+          <text>-</text>\n+        </inputEntry>\n+        <inputEntry id=\"_ede3e62a-43f3-49d3-90a4-ffaf1f698f54-2\">\n+          <text>false</text>\n+        </inputEntry>\n+        <outputEntry id=\"_ede3e62a-43f3-49d3-90a4-ffaf1f698f54-3\">\n+          <text>\"Declined\"</text>\n+        </outputEntry>\n+      </rule>\n+    </decisionTable>\n+  </decision>\n+  <inputData id=\"_Age\" name=\"Age\">\n+    <variable name=\"Age\" typeRef=\"feel:number\"/>\n+  </inputData>\n+  <inputData id=\"_RiskCategory\" name=\"RiskCategory\">\n+    <variable name=\"RiskCategory\" typeRef=\"feel:string\"/>\n+  </inputData>\n+  <inputData id=\"_isAffordable\" name=\"isAffordable\">\n+    <variable name=\"isAffordable\" typeRef=\"feel:boolean\"/>\n+  </inputData>\n+</definitions>\n\\ No newline at end of file",
    "Enable failure detector in tests .": "diff --git a/presto-hive/src/test/java/com/facebook/presto/hive/TestHivePushdownFilterQueries.java b/presto-hive/src/test/java/com/facebook/presto/hive/TestHivePushdownFilterQueries.java\nindex 0e2848d060..fd062c7401 100644\n--- a/presto-hive/src/test/java/com/facebook/presto/hive/TestHivePushdownFilterQueries.java\n+++ b/presto-hive/src/test/java/com/facebook/presto/hive/TestHivePushdownFilterQueries.java\n@@ -103,6 +103,9 @@ public class TestHivePushdownFilterQueries\n     {\n         DistributedQueryRunner queryRunner = HiveQueryRunner.createQueryRunner(getTables(),\n                 ImmutableMap.of(\"experimental.pushdown-subfields-enabled\", \"true\"),\n+                // TODO: enable failure detector.  Currently this test has a ton of major GC activity on travis,\n+                //  and the failure detector may make the test run longer\n+                ImmutableMap.of(\"failure-detector.enabled\", \"false\"),\n                 \"sql-standard\",\n                 ImmutableMap.of(\"hive.pushdown-filter-enabled\", \"true\"),\n                 Optional.empty());\n@@ -173,8 +176,8 @@ public class TestHivePushdownFilterQueries\n \n         assertQuery(legacyUnnest, \"SELECT orderkey, date.day FROM lineitem_ex CROSS JOIN UNNEST(dates) t(date)\",\n                 \"SELECT orderkey, day(shipdate) FROM lineitem WHERE orderkey % 31 <> 0 UNION ALL \" +\n-                \"SELECT orderkey, day(commitdate) FROM lineitem WHERE orderkey % 31 <> 0 UNION ALL \" +\n-                \"SELECT orderkey, day(receiptdate) FROM lineitem WHERE orderkey % 31 <> 0\");\n+                        \"SELECT orderkey, day(commitdate) FROM lineitem WHERE orderkey % 31 <> 0 UNION ALL \" +\n+                        \"SELECT orderkey, day(receiptdate) FROM lineitem WHERE orderkey % 31 <> 0\");\n     }\n \n     @Test\ndiff --git a/presto-hive/src/test/java/com/facebook/presto/hive/TestHiveRecoverableGroupedExecution.java b/presto-hive/src/test/java/com/facebook/presto/hive/TestHiveRecoverableGroupedExecution.java\nindex 5d6e6ee703..adf0878cfb 100644\n--- a/presto-hive/src/test/java/com/facebook/presto/hive/TestHiveRecoverableGroupedExecution.java\n+++ b/presto-hive/src/test/java/com/facebook/presto/hive/TestHiveRecoverableGroupedExecution.java\n@@ -94,8 +94,9 @@ public class TestHiveRecoverableGroupedExecution\n                         // this effectively disables the retries\n                         \"query.remote-task.max-error-duration\", \"1s\",\n                         // allow 2 out of 4 tasks to fail\n-                        \"max-failed-task-percentage\", \"0.6\"),\n-\n+                        \"max-failed-task-percentage\", \"0.6\",\n+                        // turn off the failure detector since with the shortened timeouts, it becomes too prone to failure\n+                        \"failure-detector.enabled\", \"false\"),\n                 Optional.empty());\n         executor = listeningDecorator(newCachedThreadPool());\n     }\ndiff --git a/presto-jmx/src/test/java/com/facebook/presto/connector/jmx/JmxQueryRunner.java b/presto-jmx/src/test/java/com/facebook/presto/connector/jmx/JmxQueryRunner.java\nindex 7c5d9f6009..8038a05849 100644\n--- a/presto-jmx/src/test/java/com/facebook/presto/connector/jmx/JmxQueryRunner.java\n+++ b/presto-jmx/src/test/java/com/facebook/presto/connector/jmx/JmxQueryRunner.java\n@@ -15,6 +15,7 @@ package com.facebook.presto.connector.jmx;\n \n import com.facebook.presto.Session;\n import com.facebook.presto.tests.DistributedQueryRunner;\n+import com.google.common.collect.ImmutableMap;\n \n import static com.facebook.airlift.testing.Closeables.closeAllSuppress;\n import static com.facebook.presto.connector.jmx.JmxMetadata.JMX_SCHEMA_NAME;\n@@ -30,7 +31,11 @@ public final class JmxQueryRunner\n     {\n         DistributedQueryRunner queryRunner = null;\n         try {\n-            queryRunner = new DistributedQueryRunner(createSession(), 3);\n+            queryRunner = DistributedQueryRunner.builder(createSession())\n+                    .setNodeCount(3)\n+                    // disable failure-detector to prevent flaky tests since the jmx tests rely on the number of nodes being consistent\n+                    .setCoordinatorProperties(ImmutableMap.of(\"failure-detector.enabled\", \"false\"))\n+                    .build();\n \n             queryRunner.installPlugin(new JmxPlugin());\n             queryRunner.createCatalog(\"jmx\", \"jmx\");\ndiff --git a/presto-main/src/main/java/com/facebook/presto/server/testing/TestingPrestoServer.java b/presto-main/src/main/java/com/facebook/presto/server/testing/TestingPrestoServer.java\nindex 3e14a39670..39dd062a69 100644\n--- a/presto-main/src/main/java/com/facebook/presto/server/testing/TestingPrestoServer.java\n+++ b/presto-main/src/main/java/com/facebook/presto/server/testing/TestingPrestoServer.java\n@@ -232,11 +232,6 @@ public class TestingPrestoServer\n                 .put(\"task.max-worker-threads\", \"4\")\n                 .put(\"exchange.client-threads\", \"4\");\n \n-        if (coordinator) {\n-            // TODO: enable failure detector\n-            serverProperties.put(\"failure-detector.enabled\", \"false\");\n-        }\n-\n         ImmutableList.Builder<Module> modules = ImmutableList.<Module>builder()\n                 .add(new TestingNodeModule(Optional.ofNullable(environment)))\n                 .add(new TestingHttpServerModule(parseInt(coordinator ? coordinatorPort : \"0\")))\ndiff --git a/presto-raptor/src/test/java/com/facebook/presto/raptor/RaptorQueryRunner.java b/presto-raptor/src/test/java/com/facebook/presto/raptor/RaptorQueryRunner.java\nindex ba30e4790c..024a7625ff 100644\n--- a/presto-raptor/src/test/java/com/facebook/presto/raptor/RaptorQueryRunner.java\n+++ b/presto-raptor/src/test/java/com/facebook/presto/raptor/RaptorQueryRunner.java\n@@ -57,7 +57,12 @@ public final class RaptorQueryRunner\n             Map<String, String> extraRaptorProperties)\n             throws Exception\n     {\n-        DistributedQueryRunner queryRunner = new DistributedQueryRunner(createSession(\"tpch\"), 2, extraProperties);\n+        DistributedQueryRunner queryRunner = DistributedQueryRunner.builder(createSession(\"tpch\"))\n+                .setNodeCount(2)\n+                // TODO: enable failure-detector for raptor. Currently enabling the failure detector causes failures.\n+                .setCoordinatorProperties(ImmutableMap.of(\"failure-detector.enabled\", \"false\"))\n+                .setExtraProperties(extraProperties)\n+                .build();\n \n         queryRunner.installPlugin(new TpchPlugin());\n         queryRunner.createCatalog(\"tpch\", \"tpch\");\ndiff --git a/presto-tests/src/test/java/com/facebook/presto/tests/TestMinWorkerRequirement.java b/presto-tests/src/test/java/com/facebook/presto/tests/TestMinWorkerRequirement.java\nindex 2997f561b3..cb98d48f56 100644\n--- a/presto-tests/src/test/java/com/facebook/presto/tests/TestMinWorkerRequirement.java\n+++ b/presto-tests/src/test/java/com/facebook/presto/tests/TestMinWorkerRequirement.java\n@@ -21,6 +21,7 @@ import static org.testng.Assert.assertEquals;\n import static org.testng.Assert.fail;\n \n // run single threaded to avoid creating multiple query runners at once\n+// failure detector is disabled in these tests to prevent flakiness since the tests assert a specific number of workers are present\n @Test(singleThreaded = true)\n public class TestMinWorkerRequirement\n {\n@@ -29,7 +30,10 @@ public class TestMinWorkerRequirement\n             throws Exception\n     {\n         try (DistributedQueryRunner queryRunner = TpchQueryRunnerBuilder.builder()\n-                .setSingleCoordinatorProperty(\"query-manager.initialization-required-workers\", \"5\")\n+                .setCoordinatorProperties(ImmutableMap.<String, String>builder()\n+                        .put(\"query-manager.initialization-required-workers\", \"5\")\n+                        .put(\"failure-detector.enabled\", \"false\")\n+                        .build())\n                 .setNodeCount(4)\n                 .build()) {\n             queryRunner.execute(\"SELECT 1\");\n@@ -43,7 +47,10 @@ public class TestMinWorkerRequirement\n     {\n         try (DistributedQueryRunner queryRunner = TpchQueryRunnerBuilder.builder()\n                 .setSingleExtraProperty(\"node-scheduler.include-coordinator\", \"false\")\n-                .setSingleCoordinatorProperty(\"query-manager.initialization-required-workers\", \"4\")\n+                .setCoordinatorProperties(ImmutableMap.<String, String>builder()\n+                        .put(\"query-manager.initialization-required-workers\", \"4\")\n+                        .put(\"failure-detector.enabled\", \"false\")\n+                        .build())\n                 .setNodeCount(4)\n                 .build()) {\n             queryRunner.execute(\"SELECT 1\");\n@@ -56,7 +63,10 @@ public class TestMinWorkerRequirement\n             throws Exception\n     {\n         try (DistributedQueryRunner queryRunner = TpchQueryRunnerBuilder.builder()\n-                .setSingleCoordinatorProperty(\"query-manager.initialization-required-workers\", \"4\")\n+                .setCoordinatorProperties(ImmutableMap.<String, String>builder()\n+                        .put(\"query-manager.initialization-required-workers\", \"4\")\n+                        .put(\"failure-detector.enabled\", \"false\")\n+                        .build())\n                 .setNodeCount(4)\n                 .build()) {\n             queryRunner.execute(\"SELECT 1\");\n@@ -77,6 +87,7 @@ public class TestMinWorkerRequirement\n                 .setCoordinatorProperties(ImmutableMap.<String, String>builder()\n                         .put(\"query-manager.initialization-required-workers\", \"5\")\n                         .put(\"query-manager.initialization-timeout\", \"1ns\")\n+                        .put(\"failure-detector.enabled\", \"false\")\n                         .build())\n                 .setNodeCount(4)\n                 .build()) {\n@@ -93,6 +104,7 @@ public class TestMinWorkerRequirement\n                 .setCoordinatorProperties(ImmutableMap.<String, String>builder()\n                         .put(\"query-manager.required-workers\", \"5\")\n                  ",
    "put guide snippets in reactor . guide package + explain debug filtering": "diff --git a/src/docs/asciidoc/debugging.adoc b/src/docs/asciidoc/debugging.adoc\nindex a071ee326..5915a8bb0 100644\n--- a/src/docs/asciidoc/debugging.adoc\n+++ b/src/docs/asciidoc/debugging.adoc\n@@ -36,7 +36,7 @@ java.lang.IndexOutOfBoundsException: Source emitted more than one item\n \tat reactor.core.publisher.Mono.subscribe(Mono.java:2629)\n \tat reactor.core.publisher.Mono.subscribe(Mono.java:2604)\n \tat reactor.core.publisher.Mono.subscribe(Mono.java:2582)\n-\tat reactor.core.publisher.scenarios.GuideTests.debuggingCommonStacktrace(GuideTests.java:722)\n+\tat reactor.guide.GuideTests.debuggingCommonStacktrace(GuideTests.java:722)\n ----\n \n There is a lot going on there! We get an `IndexOutOfBoundsException` which tell\n@@ -120,8 +120,20 @@ We are dealing with a form of instrumentation here, and creating a\n stacktrace is costly. That is why this debugging feature should only be\n activated in a controlled manner, as a last resort.\n There are ways of limiting the impact of that feature by restricting the hook to\n-the type of operator that is causing an issue. For instance in our case we could\n-only instrument `single`:\n+the type of operator that is causing an issue.\n+\n+The filter to use is best determined by looking at the class in the stack trace,\n+after removing any `Parallel`, `Flux` and `Mono` prefixes and the `Fuseable`\n+suffix. For instance in our case:\n+\n+----\n+at reactor.core.publisher.MonoSingle$SingleSubscriber.onNext(MonoSingle.java:120)\n+----\n+\n+We have `MonoSingle.java:120`, so `MonoSingle` operator implementation and\n+`single` as the filtering keyword.\n+\n+So we could only instrument uses of the incriminating operator by doing:\n \n [source,java]\n ----\n@@ -129,7 +141,8 @@ Hooks.onOperator(providedHook -> providedHook.ifName(\"single\") <1>\n                                              .operatorStackTrace());\n ----\n <1> Only activate for operator classes named \"single\", ignoring case and the\n-\"Flux\" or \"Mono\" prefixes, as well as \"Fuseable\" suffix (as seen in stacktrace)\n+\"Parallel\", \"Flux\" or \"Mono\" prefixes, as well as \"Fuseable\" suffix (as seen in\n+stacktrace)\n ****\n \n In the next section, we'll see how it differs and how to interpret that new\n@@ -151,12 +164,12 @@ java.lang.IndexOutOfBoundsException: Source emitted more than one item\n \tat reactor.core.publisher.Mono.subscribe(Mono.java:2629)\n \tat reactor.core.publisher.Mono.subscribe(Mono.java:2604)\n \tat reactor.core.publisher.Mono.subscribe(Mono.java:2582)\n-\tat reactor.core.publisher.scenarios.GuideTests.debuggingActivated(GuideTests.java:727)\n+\tat reactor.guide.GuideTests.debuggingActivated(GuideTests.java:727)\n \tSuppressed: reactor.core.publisher.FluxOnAssembly$OnAssemblyException: <3>\n Assembly trace from producer [reactor.core.publisher.MonoSingle] : <4>\n \treactor.core.publisher.Flux.single(Flux.java:5335)\n-\treactor.core.publisher.scenarios.GuideTests.scatterAndGather(GuideTests.java:689)\n-\treactor.core.publisher.scenarios.GuideTests.populateDebug(GuideTests.java:702)\n+\treactor.guide.GuideTests.scatterAndGather(GuideTests.java:689)\n+\treactor.guide.GuideTests.populateDebug(GuideTests.java:702)\n \torg.junit.rules.TestWatcher$1.evaluate(TestWatcher.java:55)\n \torg.junit.rules.RunRules.evaluate(RunRules.java:20)\n Observed operator chain, starting from the origin : <5>\ndiff --git a/src/test/java/reactor/misc/FakeRepository.java b/src/test/java/reactor/guide/FakeRepository.java\nsimilarity index 97%\nrename from src/test/java/reactor/misc/FakeRepository.java\nrename to src/test/java/reactor/guide/FakeRepository.java\nindex 9d52e26ae..76cb0bd9d 100644\n--- a/src/test/java/reactor/misc/FakeRepository.java\n+++ b/src/test/java/reactor/guide/FakeRepository.java\n@@ -14,7 +14,7 @@\n  * limitations under the License.\n  */\n \n-package reactor.misc;\n+package reactor.guide;\n \n import reactor.core.publisher.Flux;\n \ndiff --git a/src/test/java/reactor/misc/FakeUtils1.java b/src/test/java/reactor/guide/FakeUtils1.java\nsimilarity index 97%\nrename from src/test/java/reactor/misc/FakeUtils1.java\nrename to src/test/java/reactor/guide/FakeUtils1.java\nindex ba812acae..d7b03c3bf 100644\n--- a/src/test/java/reactor/misc/FakeUtils1.java\n+++ b/src/test/java/reactor/guide/FakeUtils1.java\n@@ -14,7 +14,7 @@\n  * limitations under the License.\n  */\n \n-package reactor.misc;\n+package reactor.guide;\n \n import java.util.function.Function;\n \ndiff --git a/src/test/java/reactor/misc/FakeUtils2.java b/src/test/java/reactor/guide/FakeUtils2.java\nsimilarity index 97%\nrename from src/test/java/reactor/misc/FakeUtils2.java\nrename to src/test/java/reactor/guide/FakeUtils2.java\nindex 2130ecbc3..5c9048d50 100644\n--- a/src/test/java/reactor/misc/FakeUtils2.java\n+++ b/src/test/java/reactor/guide/FakeUtils2.java\n@@ -14,7 +14,7 @@\n  * limitations under the License.\n  */\n \n-package reactor.misc;\n+package reactor.guide;\n \n import java.util.function.Function;\n \ndiff --git a/src/test/java/reactor/misc/GuideDebuggingExtraTests.java b/src/test/java/reactor/guide/GuideDebuggingExtraTests.java\nsimilarity index 94%\nrename from src/test/java/reactor/misc/GuideDebuggingExtraTests.java\nrename to src/test/java/reactor/guide/GuideDebuggingExtraTests.java\nindex fc8c6cdbb..10b5cdda7 100644\n--- a/src/test/java/reactor/misc/GuideDebuggingExtraTests.java\n+++ b/src/test/java/reactor/guide/GuideDebuggingExtraTests.java\n@@ -14,9 +14,8 @@\n  * limitations under the License.\n  */\n \n-package reactor.misc;\n+package reactor.guide;\n \n-import java.io.PrintStream;\n import java.io.PrintWriter;\n import java.io.StringWriter;\n \n@@ -51,9 +50,9 @@ public class GuideDebuggingExtraTests {\n \t\t\t\t\t\t\t+ \"\\t|_\\tFlux.map(FakeRepository.java:27)\\n\"\n \t\t\t\t\t\t\t+ \"\\t|_\\tFlux.map(FakeRepository.java:28)\\n\"\n \t\t\t\t\t\t\t+ \"\\t|_\\tFlux.filter(FakeUtils1.java:29)\\n\"\n-\t\t\t\t\t\t\t+ \"\\t|_\\tFlux.transform(GuideDebuggingExtraTests.java:41)\\n\"\n+\t\t\t\t\t\t\t+ \"\\t|_\\tFlux.transform(GuideDebuggingExtraTests.java:40)\\n\"\n \t\t\t\t\t\t\t+ \"\\t|_\\tFlux.elapsed(FakeUtils2.java:30)\\n\"\n-\t\t\t\t\t\t\t+ \"\\t|_\\tFlux.transform(GuideDebuggingExtraTests.java:42)\\n\\n\");\n+\t\t\t\t\t\t\t+ \"\\t|_\\tFlux.transform(GuideDebuggingExtraTests.java:41)\\n\\n\");\n \n \t\t\tSystem.out.println(debugStack);\n \t\t}\ndiff --git a/src/test/java/reactor/core/publisher/scenarios/GuideTests.java b/src/test/java/reactor/guide/GuideTests.java\nsimilarity index 99%\nrename from src/test/java/reactor/core/publisher/scenarios/GuideTests.java\nrename to src/test/java/reactor/guide/GuideTests.java\nindex 266f4584e..b3194e15e 100644\n--- a/src/test/java/reactor/core/publisher/scenarios/GuideTests.java\n+++ b/src/test/java/reactor/guide/GuideTests.java\n@@ -1,11 +1,11 @@\n /*\n- * Copyright (c) 2011-2016 Pivotal Software Inc, All Rights Reserved.\n+ * Copyright (c) 2011-2017 Pivotal Software Inc, All Rights Reserved.\n  *\n  * Licensed under the Apache License, Version 2.0 (the \"License\");\n  * you may not use this file except in compliance with the License.\n  * You may obtain a copy of the License at\n  *\n- *       http://www.apache.org/licenses/LICENSE-2.0\n+ *        http://www.apache.org/licenses/LICENSE-2.0\n  *\n  * Unless required by applicable law or agreed to in writing, software\n  * distributed under the License is distributed on an \"AS IS\" BASIS,\n@@ -14,7 +14,7 @@\n  * limitations under the License.\n  */\n \n-package reactor.core.publisher.scenarios;\n+package reactor.guide;\n \n import java.io.IOException;\n import java.time.Duration;\n@@ -727,7 +727,7 @@ public class GuideTests {\n \t\t\t\tassertThat(withSuppressed.getSuppressed()).hasSize(1);\n \t\t\t\tassertThat(withSuppressed.getSuppressed()[0])\n \t\t\t\t\t\t.hasMessageStartingWith(\"\\nAssembly trace from producer [reactor.core.publisher.MonoSingle] :\")\n-\t\t\t\t\t\t.hasMessageEndingWith(\"Flux.single(TestWatcher.java:55)\\n\");\n+\t\t\t\t\t\t.hasMessageEndingWith(\"Flux.single(GuideTests.java:685)\\n\");\n \t\t\t});\n \t\t}\n \t}",
    "Add the ComponentView to the interceptor context \\' s private data": "diff --git a/webservices/server-integration/src/main/java/org/jboss/as/webservices/invocation/InvocationHandlerEJB3.java b/webservices/server-integration/src/main/java/org/jboss/as/webservices/invocation/InvocationHandlerEJB3.java\nindex 5bfb7745e8..66309a6bde 100644\n--- a/webservices/server-integration/src/main/java/org/jboss/as/webservices/invocation/InvocationHandlerEJB3.java\n+++ b/webservices/server-integration/src/main/java/org/jboss/as/webservices/invocation/InvocationHandlerEJB3.java\n@@ -125,7 +125,8 @@ final class InvocationHandlerEJB3 extends AbstractInvocationHandler {\n          context.setParameters(wsInvocation.getArgs());\n          context.setTarget(reference.getInstance());\n          context.putPrivateData(Component.class, componentView.getComponent());\n-         // invoke method\n+         context.putPrivateData(ComponentView.class, componentView);\n+          // invoke method\n          final Object retObj = componentView.invoke(context);\n          // set return value\n          wsInvocation.setReturnValue(retObj);",
    "Remove instable seed node": "diff --git a/network/src/main/java/io/bitsquare/p2p/seed/SeedNodesRepository.java b/network/src/main/java/io/bitsquare/p2p/seed/SeedNodesRepository.java\nindex 4bc4f30857..a8b712dafe 100644\n--- a/network/src/main/java/io/bitsquare/p2p/seed/SeedNodesRepository.java\n+++ b/network/src/main/java/io/bitsquare/p2p/seed/SeedNodesRepository.java\n@@ -35,7 +35,7 @@ public class SeedNodesRepository {\n             new NodeAddress(\"uadzuib66jupaept.onion:8000\"),\n             new NodeAddress(\"hbma455xxbqhcuqh.onion:8000\"),\n             new NodeAddress(\"wgthuiqn3aoiovbm.onion:8000\"),\n-            new NodeAddress(\"2zxtnprnx5wqr7a3.onion:8000\"),\n+            //new NodeAddress(\"2zxtnprnx5wqr7a3.onion:8000\"),\n \n             // testnet\n             new NodeAddress(\"znmy44wcstn2rkva.onion:8001\"),",
    "Consider completion of separate parts of Change": "diff --git a/controller-server/src/main/java/com/yahoo/vespa/hosted/controller/Application.java b/controller-server/src/main/java/com/yahoo/vespa/hosted/controller/Application.java\nindex 33137202ea4..295b1adbca9 100644\n--- a/controller-server/src/main/java/com/yahoo/vespa/hosted/controller/Application.java\n+++ b/controller-server/src/main/java/com/yahoo/vespa/hosted/controller/Application.java\n@@ -130,7 +130,11 @@ public class Application {\n      * Returns the change that should used for this application at the given instant, typically now.\n      */\n     public Change changeAt(Instant now) {\n-        return change.effectiveAt(deploymentSpec, now); }\n+        Change change = change();\n+        if ( ! deploymentSpec.canUpgradeAt(now)) change = change.withoutPlatform();\n+        if ( ! deploymentSpec.canChangeRevisionAt(now)) change = change.withoutApplication();\n+        return change;\n+    }\n \n     /**\n      * Returns whether this has an outstanding change (in the source repository), which\ndiff --git a/controller-server/src/main/java/com/yahoo/vespa/hosted/controller/application/Change.java b/controller-server/src/main/java/com/yahoo/vespa/hosted/controller/application/Change.java\nindex 5294ac9b774..c8482af1c2e 100644\n--- a/controller-server/src/main/java/com/yahoo/vespa/hosted/controller/application/Change.java\n+++ b/controller-server/src/main/java/com/yahoo/vespa/hosted/controller/application/Change.java\n@@ -39,10 +39,12 @@ public final class Change {\n         this.application = application;\n     }\n \n-    /** Returns this change with currently blocked parts removed. */\n-    public Change effectiveAt(DeploymentSpec deploymentSpec, Instant instant) {\n-        return new Change(platform.filter(__ -> deploymentSpec.canUpgradeAt(instant)),\n-                          application.filter(__ -> deploymentSpec.canChangeRevisionAt(instant)));\n+    public Change withoutPlatform() {\n+        return new Change(Optional.empty(), application);\n+    }\n+\n+    public Change withoutApplication() {\n+        return new Change(platform, Optional.empty());\n     }\n \n     /** Returns whether a change should currently be deployed */\ndiff --git a/controller-server/src/main/java/com/yahoo/vespa/hosted/controller/deployment/DeploymentTrigger.java b/controller-server/src/main/java/com/yahoo/vespa/hosted/controller/deployment/DeploymentTrigger.java\nindex 601ee18758e..9404985f1fb 100644\n--- a/controller-server/src/main/java/com/yahoo/vespa/hosted/controller/deployment/DeploymentTrigger.java\n+++ b/controller-server/src/main/java/com/yahoo/vespa/hosted/controller/deployment/DeploymentTrigger.java\n@@ -208,8 +208,8 @@ public class DeploymentTrigger {\n     public void cancelChange(ApplicationId applicationId, boolean keepApplicationChange) {\n         applications().lockOrThrow(applicationId, application -> {\n             applications().store(application.withChange(application.change().application()\n+                                                                   .filter(__ -> keepApplicationChange)\n                                                                    .map(Change::of)\n-                                                                   .filter(change -> keepApplicationChange)\n                                                                    .orElse(Change.empty())));\n         });\n     }\n@@ -290,10 +290,9 @@ public class DeploymentTrigger {\n     private List<Job> computeReadyJobs(ApplicationId id) {\n         List<Job> jobs = new ArrayList<>();\n         applications().get(id).ifPresent(application -> {\n-            List<Step> steps = application.deploymentSpec().steps().isEmpty()\n-                    ? singletonList(new DeploymentSpec.DeclaredZone(test))\n-                    : application.deploymentSpec().steps();\n-            List<Step> productionSteps = steps.stream().filter(step -> step.deploysTo(prod) || step.zones().isEmpty()).collect(toList());\n+            List<Step> productionSteps = application.deploymentSpec().steps().stream()\n+                                                    .filter(step -> step.deploysTo(prod) || step.zones().isEmpty())\n+                                                    .collect(toList());\n \n             Change change = application.change();\n             @SuppressWarnings(\"cast\") // Bad compiler!\n@@ -339,14 +338,43 @@ public class DeploymentTrigger {\n                 testJobs = testJobsFor(application, targetFor(application, application.change(), empty()), \"Testing last changes outside prod\", clock.instant());\n             jobs.addAll(testJobs);\n \n-            // TODO jvenstad: Replace with completion of individual parts of Change.\n-            if (steps.stream().flatMap(step -> step.zones().stream()).map(order::toJob)\n-                     .allMatch(job -> completedAt(application.change(), application, job).isPresent()))\n-                applications().lockIfPresent(id, lockedApplication -> applications().store(lockedApplication.withChange(Change.empty())));\n+            removeCompletedChange(application);\n         });\n         return jobs;\n     }\n \n+    private void removeCompletedChange(Application application) {\n+        List<JobType> jobs = (application.deploymentSpec().steps().isEmpty()\n+                ? singletonList(new DeploymentSpec.DeclaredZone(test))\n+                : application.deploymentSpec().steps()).stream()\n+                                                       .flatMap(step -> step.zones().stream())\n+                                                       .map(order::toJob)\n+                                                       .collect(toList());\n+\n+        // The strange ||-conditions below are necessary because a job may be complete for the change as a whole, but not for each part of it >_<\n+        boolean platformComplete = application.change().platform().map(Change::of)\n+                                              .map(change -> jobs.stream().allMatch(job ->    completedAt(change, application, job).isPresent()\n+                                                    ",
    "Added tag jdk8u71 - b09 for changeset e19f39e6fbaa": "diff --git a/jaxws/.hgtags b/jaxws/.hgtags\nindex 76b3d39062..633a355105 100644\n--- a/jaxws/.hgtags\n+++ b/jaxws/.hgtags\n@@ -502,3 +502,4 @@ f86ce5ee62ba5d0c91040fa53f0de5b19b20f155 jdk8u71-b01\n b567f800daaadd47bbf49f69f683b515baeb4d9b jdk8u71-b06\n 58f12bf42e5d726b01429a5bbfe26955c6620051 jdk8u71-b07\n 7099cbc92fa4f4555e9ad8e19773851d701968b2 jdk8u71-b08\n+a46eae10609ff4c9199fec9bff277f892da00495 jdk8u71-b09",
    "Consolidate knowledge about which @ Immutable is checked by ImmutableChecker .": "diff --git a/core/src/main/java/com/google/errorprone/bugpatterns/threadsafety/ImmutableChecker.java b/core/src/main/java/com/google/errorprone/bugpatterns/threadsafety/ImmutableChecker.java\nindex f3841f8ec6..38c66676ac 100644\n--- a/core/src/main/java/com/google/errorprone/bugpatterns/threadsafety/ImmutableChecker.java\n+++ b/core/src/main/java/com/google/errorprone/bugpatterns/threadsafety/ImmutableChecker.java\n@@ -76,16 +76,27 @@ public class ImmutableChecker extends BugChecker\n         MemberReferenceTreeMatcher {\n \n   private final WellKnownMutability wellKnownMutability;\n+  private final ImmutableSet<String> immutableAnnotations;\n \n   @Deprecated // Used reflectively, but you should pass in ErrorProneFlags to get custom mutability\n   public ImmutableChecker() {\n     this(ErrorProneFlags.empty());\n   }\n \n+  ImmutableChecker(ImmutableSet<String> immutableAnnotations) {\n+    this(ErrorProneFlags.empty(), immutableAnnotations);\n+  }\n+\n   public ImmutableChecker(ErrorProneFlags flags) {\n+    this(flags, ImmutableSet.of(Immutable.class.getName()));\n+  }\n+\n+  private ImmutableChecker(ErrorProneFlags flags, ImmutableSet<String> immutableAnnotations) {\n     this.wellKnownMutability = WellKnownMutability.fromFlags(flags);\n+    this.immutableAnnotations = immutableAnnotations;\n   }\n \n+\n   // check instantiations of `@ImmutableTypeParameter`s in method references\n   @Override\n   public Description matchMemberReference(MemberReferenceTree tree, VisitorState state) {\n@@ -106,7 +117,7 @@ public class ImmutableChecker extends BugChecker\n     checkInvocation(\n         tree, ((JCNewClass) tree).constructorType, state, ((JCNewClass) tree).constructor);\n     // check instantiations of `@ImmutableTypeParameter`s in class constructor invocations\n-    ImmutableAnalysis analysis = new ImmutableAnalysis(this, state, wellKnownMutability);\n+    ImmutableAnalysis analysis = createImmutableAnalysis(state);\n     Violation info =\n         analysis.checkInstantiation(\n             ASTHelpers.getSymbol(tree.getIdentifier()).getTypeParameters(),\n@@ -117,9 +128,13 @@ public class ImmutableChecker extends BugChecker\n     return NO_MATCH;\n   }\n \n+  private ImmutableAnalysis createImmutableAnalysis(VisitorState state) {\n+    return new ImmutableAnalysis(this, state, wellKnownMutability, immutableAnnotations);\n+  }\n+\n   private Description checkInvocation(\n       Tree tree, Type methodType, VisitorState state, Symbol symbol) {\n-    ImmutableAnalysis analysis = new ImmutableAnalysis(this, state, wellKnownMutability);\n+    ImmutableAnalysis analysis = createImmutableAnalysis(state);\n     Violation info = analysis.checkInvocation(methodType, symbol);\n     if (info.isPresent()) {\n       state.reportMatch(buildDescription(tree).setMessage(info.message()).build());\n@@ -133,7 +148,7 @@ public class ImmutableChecker extends BugChecker\n     if (sym == null) {\n       return NO_MATCH;\n     }\n-    ImmutableAnalysis analysis = new ImmutableAnalysis(this, state, wellKnownMutability);\n+    ImmutableAnalysis analysis = createImmutableAnalysis(state);\n     if (!analysis.hasThreadSafeTypeParameterAnnotation((TypeVariableSymbol) sym)) {\n       return NO_MATCH;\n     }\n@@ -154,7 +169,7 @@ public class ImmutableChecker extends BugChecker\n \n   @Override\n   public Description matchClass(ClassTree tree, VisitorState state) {\n-    ImmutableAnalysis analysis = new ImmutableAnalysis(this, state, wellKnownMutability);\n+    ImmutableAnalysis analysis = createImmutableAnalysis(state);\n     if (tree.getSimpleName().length() == 0) {\n       // anonymous classes have empty names\n       // TODO(cushon): once Java 8 happens, require @Immutable on anonymous classes\n@@ -320,14 +335,16 @@ public class ImmutableChecker extends BugChecker\n    * Returns the type of the first superclass or superinterface in the hierarchy annotated with\n    * {@code @Immutable}, or {@code null} if no such super type exists.\n    */\n-  private static Type immutableSupertype(Symbol sym, VisitorState state) {\n+  private Type immutableSupertype(Symbol sym, VisitorState state) {\n     for (Type superType : state.getTypes().closure(sym.type)) {\n       if (superType.equals(sym.type)) {\n         continue;\n       }\n       // Don't use getImmutableAnnotation here: subtypes of trusted types are\n       // also trusted, only check for explicitly annotated supertypes.\n-      if (ASTHelpers.hasAnnotation(superType.tsym, Immutable.class, state)) {\n+      if (immutableAnnotations\n+          .stream()\n+          .anyMatch(annotation -> ASTHelpers.hasAnnotation(superType.tsym, annotation, state))) {\n         return superType;\n       }\n       // We currently trust that @interface annotations are immutable, but don't enforce that",
    "Expand max android version in ` InputMethodManagerLeaks ` to android 25 ( N_MR1 )": "diff --git a/app/src/main/java/com/simplecity/amp_library/utils/InputMethodManagerLeaks.java b/app/src/main/java/com/simplecity/amp_library/utils/InputMethodManagerLeaks.java\nindex 4d34bb4e..5710ed32 100644\n--- a/app/src/main/java/com/simplecity/amp_library/utils/InputMethodManagerLeaks.java\n+++ b/app/src/main/java/com/simplecity/amp_library/utils/InputMethodManagerLeaks.java\n@@ -5,6 +5,7 @@ import android.app.Activity;\n import android.app.Application;\n import android.content.Context;\n import android.content.ContextWrapper;\n+import android.os.Build;\n import android.os.Bundle;\n import android.os.Looper;\n import android.os.MessageQueue;\n@@ -146,7 +147,7 @@ public class InputMethodManagerLeaks {\n     public static void fixFocusedViewLeak(Application application) {\n \n         // Still not fixed until android 23\n-        if (SDK_INT < KITKAT || SDK_INT > 23) {\n+        if (SDK_INT < KITKAT || SDK_INT > Build.VERSION_CODES.N_MR1) {\n             return;\n         }\n ",
    "update unsafetruncate - > unsafesystem .": "diff --git a/CHANGES.txt b/CHANGES.txt\nindex 4886aa42c7..253c649627 100644\n--- a/CHANGES.txt\n+++ b/CHANGES.txt\n@@ -1,5 +1,5 @@\n 1.2.7\n- * add cassandra.unsafetruncate property (CASSANDRA-5704)\n+ * add cassandra.unsafesystem property (CASSANDRA-5704)\n  * (Hadoop) quote identifiers in CqlPagingRecordReader (CASSANDRA-5763)\n  * Add replace_node functionality for vnodes (CASSANDRA-5337)\n  * Add timeout events to query traces (CASSANDRA-5520)\ndiff --git a/src/java/org/apache/cassandra/db/DefsTable.java b/src/java/org/apache/cassandra/db/DefsTable.java\nindex b96205d9d7..ea15cd0df2 100644\n--- a/src/java/org/apache/cassandra/db/DefsTable.java\n+++ b/src/java/org/apache/cassandra/db/DefsTable.java\n@@ -44,7 +44,6 @@ import org.apache.cassandra.exceptions.ConfigurationException;\n import org.apache.cassandra.service.StorageService;\n import org.apache.cassandra.service.MigrationManager;\n import org.apache.cassandra.utils.ByteBufferUtil;\n-import org.apache.cassandra.utils.FBUtilities;\n \n /**\n  * SCHEMA_{KEYSPACES, COLUMNFAMILIES, COLUMNS}_CF are used to store Keyspace/ColumnFamily attributes to make schema\n@@ -620,14 +619,9 @@ public class DefsTable\n \n     private static void flushSchemaCFs()\n     {\n-        flushSchemaCF(SystemTable.SCHEMA_KEYSPACES_CF);\n-        flushSchemaCF(SystemTable.SCHEMA_COLUMNFAMILIES_CF);\n-        flushSchemaCF(SystemTable.SCHEMA_COLUMNS_CF);\n-    }\n-\n-    private static void flushSchemaCF(String cfName)\n-    {\n-        FBUtilities.waitOnFuture(SystemTable.schemaCFS(cfName).forceFlush());\n+        SystemTable.forceBlockingFlush(SystemTable.SCHEMA_KEYSPACES_CF);\n+        SystemTable.forceBlockingFlush(SystemTable.SCHEMA_COLUMNFAMILIES_CF);\n+        SystemTable.forceBlockingFlush(SystemTable.SCHEMA_COLUMNS_CF);\n     }\n \n     private static ByteBuffer toUTF8Bytes(UUID version)\ndiff --git a/src/java/org/apache/cassandra/db/SystemTable.java b/src/java/org/apache/cassandra/db/SystemTable.java\nindex 1d9fd729cb..4c74df55d8 100644\n--- a/src/java/org/apache/cassandra/db/SystemTable.java\n+++ b/src/java/org/apache/cassandra/db/SystemTable.java\n@@ -185,8 +185,7 @@ public class SystemTable\n     {\n         String req = \"UPDATE system.%s SET truncated_at = truncated_at + %s WHERE key = '%s'\";\n         processInternal(String.format(req, LOCAL_CF, truncationAsMapEntry(cfs, truncatedAt, position), LOCAL_KEY));\n-        if (!Boolean.getBoolean(\"cassandra.unsafetruncate\"))\n-            forceBlockingFlush(LOCAL_CF);\n+        forceBlockingFlush(LOCAL_CF);\n     }\n \n     /**\n@@ -347,20 +346,10 @@ public class SystemTable\n         return tokens;\n     }\n \n-    private static void forceBlockingFlush(String cfname)\n+    public static void forceBlockingFlush(String cfname)\n     {\n-        try\n-        {\n-            Table.open(Table.SYSTEM_KS).getColumnFamilyStore(cfname).forceBlockingFlush();\n-        }\n-        catch (ExecutionException e)\n-        {\n-            throw new RuntimeException(e);\n-        }\n-        catch (InterruptedException e)\n-        {\n-            throw new AssertionError(e);\n-        }\n+        if (!Boolean.getBoolean(\"cassandra.unsafesystem\"))\n+            FBUtilities.waitOnFuture(Table.open(Table.SYSTEM_KS).getColumnFamilyStore(cfname).forceFlush());\n     }\n \n     /**",
    "Add custom shuffle serialization for Presto on Spark": "diff --git a/presto-spark-base/src/main/java/com/facebook/presto/spark/PrestoSparkQueryExecutionFactory.java b/presto-spark-base/src/main/java/com/facebook/presto/spark/PrestoSparkQueryExecutionFactory.java\nindex ca666cfe2d..6b5ecb83cc 100644\n--- a/presto-spark-base/src/main/java/com/facebook/presto/spark/PrestoSparkQueryExecutionFactory.java\n+++ b/presto-spark-base/src/main/java/com/facebook/presto/spark/PrestoSparkQueryExecutionFactory.java\n@@ -38,13 +38,16 @@ import com.facebook.presto.server.QuerySessionSupplier;\n import com.facebook.presto.server.SessionContext;\n import com.facebook.presto.spark.classloader_interface.IPrestoSparkQueryExecution;\n import com.facebook.presto.spark.classloader_interface.IPrestoSparkQueryExecutionFactory;\n+import com.facebook.presto.spark.classloader_interface.IPrestoSparkTaskExecutor;\n import com.facebook.presto.spark.classloader_interface.MutablePartitionId;\n import com.facebook.presto.spark.classloader_interface.PrestoSparkConfInitializer;\n+import com.facebook.presto.spark.classloader_interface.PrestoSparkMaterializedRow;\n import com.facebook.presto.spark.classloader_interface.PrestoSparkMutableRow;\n import com.facebook.presto.spark.classloader_interface.PrestoSparkSerializedPage;\n import com.facebook.presto.spark.classloader_interface.PrestoSparkSession;\n import com.facebook.presto.spark.classloader_interface.PrestoSparkTaskExecutorFactoryProvider;\n import com.facebook.presto.spark.classloader_interface.PrestoSparkTaskInputs;\n+import com.facebook.presto.spark.classloader_interface.PrestoSparkToMaterializedRowFunction;\n import com.facebook.presto.spark.classloader_interface.SerializedPrestoSparkTaskDescriptor;\n import com.facebook.presto.spark.classloader_interface.SerializedTaskStats;\n import com.facebook.presto.spark.classloader_interface.SparkProcessType;\n@@ -71,7 +74,6 @@ import com.google.common.collect.ImmutableList;\n import com.google.common.collect.ImmutableMap;\n import com.google.common.collect.ImmutableSet;\n import com.google.common.util.concurrent.UncheckedExecutionException;\n-import io.airlift.slice.BasicSliceInput;\n import io.airlift.slice.SliceInput;\n import io.airlift.slice.Slices;\n import org.apache.spark.SparkContext;\n@@ -98,7 +100,7 @@ import java.util.concurrent.Future;\n import static com.facebook.airlift.concurrent.MoreFutures.getFutureValue;\n import static com.facebook.presto.execution.scheduler.StreamingPlanSection.extractStreamingSections;\n import static com.facebook.presto.execution.scheduler.TableWriteInfo.createTableWriteInfo;\n-import static com.facebook.presto.spark.util.PrestoSparkUtils.transformRowsToPages;\n+import static com.facebook.presto.spark.util.PrestoSparkUtils.transformMaterializedRowsToPages;\n import static com.facebook.presto.spi.StandardErrorCode.NOT_SUPPORTED;\n import static com.facebook.presto.spi.connector.ConnectorCapabilities.SUPPORTS_PAGE_SINK_COMMIT;\n import static com.facebook.presto.sql.planner.SystemPartitioningHandle.COORDINATOR_DISTRIBUTION;\n@@ -361,7 +363,7 @@ public class PrestoSparkQueryExecutionFactory\n         @Override\n         public List<List<Object>> execute()\n         {\n-            List<Tuple2<MutablePartitionId, PrestoSparkMutableRow>> rddResults;\n+            List<Tuple2<MutablePartitionId, PrestoSparkMaterializedRow>> rddResults;\n             try {\n                 rddResults = doExecute(plan);\n                 commit(session, transactionManager);\n@@ -404,9 +406,9 @@ public class PrestoSparkQueryExecutionFactory\n             ConnectorSession connectorSession = session.toConnectorSession();\n             List<Type> types = plan.getFragment().getTypes();\n             ImmutableList.Builder<List<Object>> result = ImmutableList.builder();\n-            for (Tuple2<MutablePartitionId, PrestoSparkMutableRow> tuple : rddResults) {\n-                PrestoSparkMutableRow row = tuple._2;\n-                SliceInput sliceInput = new BasicSliceInput(Slices.wrappedBuffer(row.getBytes(), 0, row.getLength()));\n+            for (Tuple2<MutablePartitionId, PrestoSparkMaterializedRow> tuple : rddResults) {\n+                PrestoSparkMaterializedRow row = tuple._2;\n+                SliceInput sliceInput = Slices.wrappedBuffer(row.getData()).getInput();\n                 List<Object> columns = new ArrayList<>();\n                 for (Type type : types) {\n                     BlockBuilder blockBuilder = type.createBlockBuilder(null, 1);\n@@ -428,7 +430,7 @@ public class PrestoSparkQueryExecutionFactory\n             return updateType;\n         }\n \n-        private List<Tuple2<MutablePartitionId, PrestoSparkMutableRow>> doExecute(SubPlan root)\n+        private List<Tuple2<MutablePartitionId, PrestoSparkMaterializedRow>> doExecute(SubPlan root)\n                 throws SparkException\n         {\n             PlanFragment rootFragment = root.getFragment();\n@@ -444,23 +446,30 @@ public class PrestoSparkQueryExecutionFactory\n                 Map<PlanFragmentId, RddAndMore> inputRdds = root.getChildren().stream()\n                         .collect(toImmutableMap(child -> child.getFragment().getId(), this::createRdd));\n \n-                Map<String, Future<List<Tuple2<MutablePartitionId, PrestoSparkMutableRow>>>> inputFutures = inputRdds.entrySet().stream()\n+                Map<String, Future<List<Tuple2<MutablePartitionId, PrestoSparkMaterializedRow>>>> inputFutures = inputRdds.entrySet().stream()\n                         .collect(toImmutableMap(\n                                 entry -> entry.getKey().toString(),\n-                                entry -> entry.getValue().getRdd().collectAsync()));\n+                                entry -> entry.getValue().getRdd()\n+                                        .mapValues(new PrestoSparkToMaterializedRowFunction())\n+                                        .collectAsync()));\n \n                 waitFor(inputFutures.values());\n \n                 Map<String, Iterator<Tuple2<MutablePartitionId, PrestoSparkMutableRow>>> inputs = inputFutures.entrySet().stream()\n-                        .collect(toImmutableMap(Map.Entry::getKey, entry -> getUnchecked(entry.getValue()).iterator()));\n+                        .collect(toImmutableMap(\n+                                Map.Entry::getKey,\n+                                entry -> transform(\n+                                        getUnchecked(entry.getValue()).iterator(),\n+                                        tuple -> new Tuple2<>(tuple._1, tuple._2.toPrestoSparkMutableRow()))));\n \n-                return ImmutableList.copyOf(executorFactoryProvider.get(SparkProcessType.DRIVER).create(\n+                IPrestoSparkTaskExecutor prestoSparkTaskExecutor = executorFactoryProvider.get(SparkProcessType.DRIVER).create(\n                         0,\n                         0,\n                         serializedTaskDescriptor,\n                         emptyIterator(),\n                         new PrestoSparkTaskInputs(inputs, ImmutableMap.of()),\n-                        taskStatsCollector));\n+                        taskStatsCollector);\n+                return ImmutableList.copyOf(transform(prestoSparkTaskExecutor, tuple -> new Tuple2<>(tuple._1, tuple._2.toMaterializedRow())));\n             }\n \n             RddAndMore rootRdd = createRdd(root);\n@@ -477,11 +486,11 @@ public class PrestoSparkQueryExecutionFactory\n                 PlanFragment childFragment = child.getFragment();\n                 RddAndMore childRdd = createRdd(child);\n                 if (childFragment.getPartitioningScheme().getPartitioning().getHandle().equals(FIXED_BROADCAST_DISTRIBUTION)) {\n-                    List<Tuple2<MutablePartitionId, PrestoSparkMutableRow>> broadcastRows = childRdd.collectAndDestroyDependencies();\n+                    List<Tuple2<MutablePartitionId, PrestoSparkMaterializedRow>> broadcastRows = childRdd.collectAndDestroyDependencies();\n                     // TODO: Transform rows to pages on executors (using `RDD#map` function)\n                     // TODO: Transforming it on coordinator results in 2x memory utilization as both,\n                     // TODO: rows and pages have to be kept in memory all at the same time\n-                    Iterator<Page> pagesIterator = transformRowsToPages(transform(broadcastRows.iterator(), Tuple2::_2), childFragment.getTypes());\n+                    Iterator<Page> pagesIterator = transformMaterializedRowsToPages(transform(broadcastRows.iterator(), Tuple2::_2), childFragment.getTypes());\n                     Iterator<PrestoSparkSerializedPage> serializedPagesIterator = transform(transform(pagesIterator, pagesSerde::serialize), PrestoSparkUtils::toPrestoSparkSerializedPage);\n                     List<PrestoSparkSerializedPage> serializedPages = new ArrayList<>();\n                     serializedPagesIterator.forEachRemaining(serializedPages::add);\n@@ -566,11 +575,13 @@ public class PrestoSparkQueryExecutionFactory\n             this.broadcastDependencies = ImmutableList.copyOf(requireNonNull(broadcastDependencies, \"broadcastDependencies is null\"));\n         }\n \n-        public List<Tuple2<MutablePartitionId, PrestoSparkMutableRow>> collectAndDestroyDependencies()\n+        public List<Tuple2<MutablePartitionId, PrestoSparkMaterializedRow>> collectAndDestroyDependencies()\n         {\n             checkState(!collected, \"already collected\");\n             collected = true;\n-            List<Tuple2<MutablePartitionId, PrestoSparkMutableRow>> result = rdd.collect();\n+            List<Tuple2<MutablePartitionId, PrestoSparkMaterializedRow>> result = rdd\n+                    .mapValues(new PrestoSparkToMaterializedRowFunction())\n+                    .collect();\n             broadcastDependencies.forEach(Broadcast::destroy);\n             return result;\n         }\ndiff --git a/presto-spark-base/src/main/java/com/facebook/presto/spark/execution/PrestoSparkOutputOperator.java b/presto-spark-base/src/main/java/com/facebook/presto/spark/execution/PrestoSparkOutputOperator.java\nindex f2ba9e0147..7fe3e1923d 100644\n--- a/presto-spark-base/src/main/java/com/facebook/presto/spark/execution/PrestoSparkOutputOperator.java\n+++ b/presto-spark-base/src/main/java/com/facebook/presto/spark/execution/PrestoSparkOutputOperator.java\n@@ -35,6 +35,7 @@ import com.google.common.util.concurrent.ListenableFuture;\n import io.airlift.slice.DynamicSliceOutput;\n import io.airlift.slice.SliceOutput;\n \n+import java.nio.ByteBuffer;\n import java.util.List;\n import java.util.Optional;\n import java.util.OptionalInt;\n@@ -259,13 +260,19 @@ public class PrestoSparkOutputOperator\n             byte[] rowBytes = output.size() == 0 ? new byte[0] : output.getUnderlyingSlice().byteArray();\n             if (shouldReplicate) {\n                 for (int i = 0; i < partitionFunction.getPartitionCount(); i++) {\n-                    appendRow(new PrestoSparkMutableRow(i, output.size(), rowBytes));\n+                    PrestoSparkMutableRow row = new PrestoSparkMutableRow();\n+                    row.setPartition(i);\n+                    row.setBuffer(ByteBuffer.wrap(rowBytes, 0, output.size()));\n+                    appendRow(row);\n                 }\n                 hasAnyRowBeenReplicated = true;\n             }\n             else {\n                 int partition = getPartition(partitionFunctionArguments, position);\n-                appendRow(new PrestoSparkMutableRow(partition, output.size(), rowBytes));\n+                PrestoSparkMutableRow row = new PrestoSparkMutableRow();\n+                row.setPartition(partition);\n+                row.setBuffer(ByteBuffer.wrap(rowBytes, 0, output.size()));\n+                appendRow(row);\n             }\n         }\n         updateMemoryContext();\ndiff --git a/presto-spark-base/src/main/java/com/facebook/presto/spark/execution/PrestoSparkRemoteSourceFactory.java b/presto-spark-base/src/main/java/com/facebook/presto/spark/execution/PrestoSparkRemoteSourceFactory.java\nindex f03368b39b..88cff350e9 100644\n--- a/presto-spark-base/src/main/java/com/facebook/presto/spark/execution/PrestoSparkRemoteSourceFactory.java\n+++ b/presto-spark-base/src/main/java/com/facebook/presto/spark/execution/PrestoSparkRemoteSourceFactory.java\n@@ -30,7 +30,7 @@ import java.util.List;\n import java.util.Map;\n \n import static com.facebook.presto.spark.util.PrestoSparkUtils.toSerializedPage;\n-import static com.facebook.presto.spark.util.PrestoSparkUtils.transformRowsToPages;\n+import static com.facebook.presto.spark.util.PrestoSparkUtils.transformMutableRowsToPages;\n import static com.google.common.base.Preconditions.checkArgument;\n import static com.google.common.collect.Iterators.transform;\n import static java.util.Objects.requireNonNull;\n@@ -70,7 +70,7 @@ public class PrestoSparkRemoteSourceFactory\n         return new SparkRemoteSourceOperatorFactory(\n                 operatorId,\n                 planNodeId,\n-                transformRowsToPages(shuffleInput, types));\n+                transformMutableRowsToPages(shuffleInput, types));\n     }\n \n     @Override\ndiff --git a/presto-spark-base/src/main/java/com/facebook/presto/spark/planner/PrestoSparkRddFactory.java b/presto-spark-base/src/main/java/com/facebook/presto/spark/planner/PrestoSparkRddFactory.java\nindex fadd85c270..62feca68f3 100644\n--- a/presto-spark-base/src/main/java/com/facebook/presto/spark/planner/PrestoSparkRddFactory.java\n+++ b/presto-spark-base/src/main/java/com/facebook/presto/spark/planner/PrestoSparkRddFactory.java\n@@ -25,6 +25,7 @@ import com.facebook.presto.spark.classloader_interface.MutablePartitionId;\n import com.facebook.presto.spark.classloader_interface.PrestoSparkMutableRow;\n import com.facebook.presto.spark.classloader_interface.PrestoSparkPartitioner;\n import com.facebook.presto.spark.classloader_interface.PrestoSparkSerializedPage;\n+import com.facebook.presto.spark.classloader_interface.PrestoSparkShuffleSerializer;\n import com.facebook.presto.spark.classloader_interface.PrestoSparkTaskExecutorFactoryProvider;\n import com.facebook.presto.spark.classloader_interface.PrestoSparkTaskProcessor;\n import com.facebook.presto.spark.classloader_interface.PrestoSparkTaskRdd;\n@@ -55,6 +56,7 @@ import org.apache.spark.api.java.JavaPairRDD;\n import org.apache.spark.api.java.JavaSparkContext;\n import org.apache.spark.broadcast.Broadcast;\n import org.apache.spark.rdd.RDD;\n+import org.apache.spark.rdd.ShuffledRDD;\n import org.apache.spark.util.CollectionAccumulator;\n import scala.Tuple2;\n import scala.reflect.ClassTag;\n@@ -175,7 +177,7 @@ public class PrestoSparkRddFactory\n             }\n \n             Map<PlanFragmentId, JavaPairRDD<MutablePartitionId, PrestoSparkMutableRow>> partitionedInputs = rddInputs.entrySet().stream()\n-                    .collect(toImmutableMap(Entry::getKey, entry -> entry.getValue().partitionBy(createPartitioner(session, partitioning))));\n+                    .collect(toImmutableMap(Entry::getKey, entry -> partitionBy(entry.getValue(), createPartitioner(session, partitioning))));\n \n             return createRdd(\n                     sparkContext,\n@@ -206,6 +208,17 @@ public class PrestoSparkRddFactory\n         return fragment;\n     }\n \n+    private static JavaPairRDD<MutablePartitionId, PrestoSparkMutableRow> partitionBy(JavaPairRDD<MutablePartitionId, PrestoSparkMutableRow> rdd, Partitioner partitioner)\n+    {\n+        JavaPairRDD<MutablePartitionId, PrestoSparkMutableRow> javaPairRdd = rdd.partitionBy(partitioner);\n+        ShuffledRDD<MutablePartitionId, PrestoSparkMutableRow, PrestoSparkMutableRow> shuffledRdd = (ShuffledRDD<MutablePartitionId, PrestoSparkMutableRow, PrestoSparkMutableRow>) javaPairRdd.rdd();\n+        shuffledRdd.setSerializer(new PrestoSparkShuffleSerializer());\n+        return JavaPairRDD.fromRDD(\n+                shuffledRdd,\n+                classTag(MutablePartitionId.class),\n+                classTag(PrestoSparkMutableRow.class));\n+    }\n+\n     private Partitioner createPartitioner(Session session, PartitioningHandle partitioning)\n     {\n         if (partitioning.equals(SINGLE_DISTRIBUTION)) {\ndiff --git a/presto-spark-base/src/main/java/com/facebook/presto/spark/util/PrestoSparkUtils.java b/presto-spark-base/src/main/java/com/facebook/presto/spark/util/PrestoSparkUtils.java\nindex c7a2b85f2f..979c35dd88 100644\n--- a/presto-spark-base/src/main/java/com/facebook/presto/spark/util/PrestoSparkUtils.java\n+++ b/presto-spark-base/src/main/java/com/facebook/presto/spark/util/PrestoSparkUtils.java\n@@ -17,11 +17,11 @@ import com.facebook.presto.common.Page;\n import com.facebook.presto.common.PageBuilder;\n import com.facebook.presto.common.block.BlockBuilder;\n import com.facebook.presto.common.type.Type;\n+import com.facebook.presto.spark.classloader_interface.PrestoSparkMaterializedRow;\n import com.facebook.presto.spark.classloader_interface.PrestoSparkMutableRow;\n import com.facebook.presto.spark.classloader_interface.PrestoSparkSerializedPage;\n import com.facebook.presto.spi.page.SerializedPage;\n import com.google.common.collect.AbstractIterator;\n-import io.airlift.slice.BasicSliceInput;\n import io.airlift.slice.Slice;\n import io.airlift.slice.SliceInput;\n import io.airlift.slice.Slices;\n@@ -32,13 +32,42 @@ import java.util.List;\n import static com.facebook.presto.common.block.BlockUtil.compactArray;\n import static com.google.common.base.Preconditions.checkArgument;\n import static com.google.common.base.Verify.verify;\n-import static io.airlift.slice.Slices.wrappedBuffer;\n \n public class PrestoSparkUtils\n {\n     private PrestoSparkUtils() {}\n \n-    public static Iterator<Page> transformRowsToPages(Iterator<PrestoSparkMutableRow> rows, List<Type> types)\n+    public static Iterator<Page> transformMaterializedRowsToPages(Iterator<PrestoSparkMaterializedRow> rows, List<Type> types)\n+    {\n+        return new AbstractIterator<Page>()\n+        {\n+            @Override\n+            protected Page computeNext()\n+            {\n+                if (!rows.hasNext()) {\n+                    return endOfData();\n+                }\n+                PageBuilder pageBuilder = new PageBuilder(types);\n+                while (rows.hasNext() && !pageBuilder.isFull()) {\n+                    PrestoSparkMaterializedRow row = rows.next();\n+                    SliceInput sliceInput = Slices.wrappedBuffer(row.getData()).getInput();\n+                    pageBuilder.declarePosition();\n+                    for (int channel = 0; channel < types.size(); channel++) {\n+                        BlockBuilder blockBuilder = pageBuilder.getBlockBuilder(channel);\n+                        blockBuilder.readPositionFrom(sliceInput);\n+                    }\n+                    sliceInput.close();\n+                }\n+                verify(!pageBuilder.isEmpty());\n+                return pageBuilder.build();\n+            }\n+        };\n+    }\n+\n+    /**\n+     * TODO: Transitional method. Will be removed in the next commit.\n+     */\n+    public static Iterator<Page> transformMutableRowsToPages(Iterator<PrestoSparkMutableRow> rows, List<Type> types)\n     {\n         return new AbstractIterator<Page>()\n         {\n@@ -51,7 +80,7 @@ public class PrestoSparkUtils\n                 PageBuilder pageBuilder = new PageBuilder(types);\n                 while (rows.hasNext() && !pageBuilder.isFull()) {\n                     PrestoSparkMutableRow row = rows.next();\n-                    SliceInput sliceInput = new BasicSliceInput(wrappedBuffer(row.getBytes(), 0, row.getLength()));\n+                    SliceInput sliceInput = Slices.wrappedBuffer(row.getBuffer()).getInput();\n                     pageBuilder.declarePosition();\n                     for (int channel = 0; channel < types.size(); channel++) {\n                         BlockBuilder blockBuilder = pageBuilder.getBlockBuilder(channel);\ndiff --git a/presto-spark-base/src/test/java/com/facebook/presto/spark/TestPrestoSparkQueryRunner.java b/presto-spark-base/src/test/java/com/facebook/presto/spark/TestPrestoSparkQueryRunner.java\nindex d17d8d7ae5..46ec8ef72b 100644\n--- a/presto-spark-base/src/test/java/com/facebook/presto/spark/TestPrestoSparkQueryRunner.java\n+++ b/presto-spark-base/src/test/java/com/facebook/presto/spark/TestPrestoSparkQueryRunner.java\n@@ -13,9 +13,12 @@\n  */\n package com.facebook.presto.spark;\n \n+import com.facebook.presto.testing.MaterializedResult;\n import com.facebook.presto.tests.AbstractTestQueryFramework;\n import org.testng.annotations.Test;\n \n+import static com.facebook.presto.testing.assertions.Assert.assertEquals;\n+\n public class TestPrestoSparkQueryRunner\n         extends AbstractTestQueryFramework\n {\n@@ -304,6 +307,15 @@ public class TestPrestoSparkQueryRunner\n                 \"SELECT 0\");\n     }\n \n+    @Test\n+    public void testLimit()\n+    {\n+        MaterializedResult actual = computeActual(\"SELECT * FROM orders LIMIT 10\");\n+        assertEquals(actual.getRowCount(), 10);\n+        actual = computeActual(\"SELECT 'a' FROM orders LIMIT 10\");\n+        assertEquals(actual.getRowCount(), 10);\n+    }\n+\n     private void assertBucketedQuery(String sql)\n     {\n         assertQuery(sql, sql.replaceAll(\"_bucketed\", \"\"));\ndiff --git a/presto-spark-classloader-interface/src/main/java/com/facebook/presto/spark/classloader_interface/PrestoSparkConfInitializer.java b/presto-spark-classloader-interface/src/main/java/com/facebook/presto/spark/classloader_interface/PrestoSparkConfInitializer.java\nindex fd17acaadc..cbe67dece0 100644\n--- a/presto-spark-classloader-interface/src/main/java/com/facebook/presto/spark/classloader_interface/PrestoSparkConfInitializer.java\n+++ b/presto-spark-classloader-interface/src/main/java/com/facebook/presto/spark/classloader_interface/PrestoSparkConfInitializer.java\n@@ -36,6 +36,7 @@ public class PrestoSparkConfInitializer\n         sparkConf.registerKryoClasses(new Class[] {\n                 MutablePartitionId.class,\n                 PrestoSparkMutableRow.class,\n+                PrestoSparkMaterializedRow.class,\n                 PrestoSparkSerializedPage.class,\n                 SerializedPrestoSparkTaskDescriptor.class,\n                 SerializedTaskStats.class\ndiff --git a/presto-spark-classloader-interface/src/main/java/com/facebook/presto/spark/classloader_interface/PrestoSparkMaterializedRow.java b/presto-spark-classloader-interface/src/main/java/com/facebook/presto/spark/classloader_interface/PrestoSparkMaterializedRow.java\nnew file mode 100644\nindex 0000000000..9a36add08c\n--- /dev/null\n+++ b/presto-spark-classloader-interface/src/main/java/com/facebook/presto/spark/classloader_interface/PrestoSparkMaterializedRow.java\n@@ -0,0 +1,42 @@\n+/*\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package com.facebook.presto.spark.classloader_interface;\n+\n+import java.io.Serializable;\n+import java.nio.ByteBuffer;\n+\n+import static java.util.Objects.requireNonNull;\n+\n+public class PrestoSparkMaterializedRow\n+        implements Serializable\n+{\n+    private final byte[] data;\n+\n+    public PrestoSparkMaterializedRow(byte[] data)\n+    {\n+        this.data = requireNonNull(data, \"data is null\");\n+    }\n+\n+    public byte[] getData()\n+    {\n+        return data;\n+    }\n+\n+    public PrestoSparkMutableRow toPrestoSparkMutableRow()\n+    {\n+        PrestoSparkMutableRow prestoSparkMutableRow = new PrestoSparkMutableRow();\n+        prestoSparkMutableRow.setBuffer(ByteBuffer.wrap(data));\n+        return prestoSparkMutableRow;\n+    }\n+}\ndiff --git a/presto-spark-classloader-interface/src/main/java/com/facebook/presto/spark/classloader_interface/PrestoSparkMutableRow.java b/presto-spark-classloader-interface/src/main/java/com/facebook/presto/spark/classloader_interface/PrestoSparkMutableRow.java\nindex 832c955cdb..debd5bcf0d 100644\n--- a/presto-spark-classloader-interface/src/main/java/com/facebook/presto/spark/classloader_interface/PrestoSparkMutableRow.java\n+++ b/presto-spark-classloader-interface/src/main/java/com/facebook/presto/spark/classloader_interface/PrestoSparkMutableRow.java\n@@ -13,48 +13,85 @@\n  */\n package com.facebook.presto.spark.classloader_interface;\n \n-import java.io.Serializable;\n+import com.esotericsoftware.kryo.Kryo;\n+import com.esotericsoftware.kryo.KryoSerializable;\n+import com.esotericsoftware.kryo.io.Input;\n+import com.esotericsoftware.kryo.io.Output;\n \n-import static java.util.Objects.requireNonNull;\n+import java.io.Externalizable;\n+import java.io.ObjectInput;\n+import java.io.ObjectOutput;\n+import java.nio.ByteBuffer;\n \n public class PrestoSparkMutableRow\n-        implements Serializable\n+        implements Externalizable, KryoSerializable\n {\n-    private static final int INSTANCE_SIZE = Long.BYTES * 2 /* headers */\n-            + Integer.BYTES /* partition */\n-            + Integer.BYTES /* length */\n-            + Long.BYTES /* bytes pointer */\n-            + Long.BYTES * 2 /* bytes headers */\n-            + Integer.BYTES /* bytes length */;\n+    private int partition;\n+    private ByteBuffer buffer;\n \n-    private final int partition;\n-    private final int length;\n-    private final byte[] bytes;\n+    public int getPartition()\n+    {\n+        return partition;\n+    }\n \n-    public PrestoSparkMutableRow(int partition, int length, byte[] bytes)\n+    public void setPartition(int partition)\n     {\n         this.partition = partition;\n-        this.length = length;\n-        this.bytes = requireNonNull(bytes, \"bytes is null\");\n     }\n \n-    public int getPartition()\n+    public ByteBuffer getBuffer()\n     {\n-        return partition;\n+        return buffer;\n+    }\n+\n+    public void setBuffer(ByteBuffer buffer)\n+    {\n+        this.buffer = buffer;\n+    }\n+\n+    /**\n+     * TODO: Transitional method. Will be removed in the next commit.\n+     */\n+    public int getRetainedSize()\n+    {\n+        return Integer.SIZE + buffer.remaining();\n+    }\n+\n+    public PrestoSparkMaterializedRow toMaterializedRow()\n+    {\n+        byte[] copy = new byte[buffer.remaining()];\n+        System.arraycopy(buffer.array(), buffer.arrayOffset() + buffer.position(), copy, 0, buffer.remaining());\n+        return new PrestoSparkMaterializedRow(copy);\n+    }\n+\n+    @Override\n+    public void write(Kryo kryo, Output output)\n+    {\n+        throw serializationNotSupportedException();\n+    }\n+\n+    @Override\n+    public void read(Kryo kryo, Input input)\n+    {\n+        throw serializationNotSupportedException();\n",
    "Removed superfluous tracking of credentialsExpired state in TransactionStateMachine": "diff --git a/community/bolt/src/main/java/org/neo4j/bolt/v1/runtime/TransactionStateMachine.java b/community/bolt/src/main/java/org/neo4j/bolt/v1/runtime/TransactionStateMachine.java\nindex 228c0c9deae..4b0f2e6e757 100644\n--- a/community/bolt/src/main/java/org/neo4j/bolt/v1/runtime/TransactionStateMachine.java\n+++ b/community/bolt/src/main/java/org/neo4j/bolt/v1/runtime/TransactionStateMachine.java\n@@ -279,20 +279,7 @@ public class TransactionStateMachine implements StatementProcessor\n     private static Result executeQuery( MutableTransactionState ctx, SPI spi, String statement,\n                                         Map<String, Object> params ) throws QueryExecutionKernelException\n     {\n-        try\n-        {\n-            return spi.executeQuery( ctx.querySource, ctx.authSubject, statement, params );\n-        }\n-        catch ( AuthorizationViolationException e )\n-        {\n-            // TODO: Make lower level of the stack aware of expired credentials so that it can throw the correct\n-            // exception instead of translating it here.\n-            /*if ( ctx.credentialsExpired )\n-            {\n-   ",
    "add check mark to menu item Switch Off": "diff --git a/languagetool-gui-commons/src/main/java/org/languagetool/gui/Configuration.java b/languagetool-gui-commons/src/main/java/org/languagetool/gui/Configuration.java\nindex d4b83f08b7..66abba3d15 100644\n--- a/languagetool-gui-commons/src/main/java/org/languagetool/gui/Configuration.java\n+++ b/languagetool-gui-commons/src/main/java/org/languagetool/gui/Configuration.java\n@@ -72,6 +72,7 @@ public class Configuration {\n   private static final String ERROR_COLORS_KEY = \"errorColors\";\n   private static final String UNDERLINE_COLORS_KEY = \"underlineColors\";\n   private static final String CONFIGURABLE_RULE_VALUES_KEY = \"configurableRuleValues\";\n+  private static final String LT_SWITCHED_OFF_KEY = \"ltSwitchedOff\";\n \n   private static final String DELIMITER = \",\";\n   // find all comma followed by zero or more white space characters that are preceded by \":\" AND a valid 6-digit hex code\n@@ -113,6 +114,7 @@ public class Configuration {\n   private boolean doResetCheck = false;\n   private String externalRuleDirectory;\n   private String lookAndFeelName;\n+  private boolean switchOff = false;\n \n   /**\n    * Uses the configuration file from the default location.\n@@ -614,6 +616,25 @@ public class Configuration {\n     configurableRuleValues.put(ruleID, value);\n   }\n \n+  /**\n+   * @since 4.4\n+   * if true: LT is switched Off, else: LT is switched On\n+   */\n+  public boolean isSwitchedOff() {\n+    return switchOff;\n+  }\n+\n+  /**\n+   * @throws IOException \n+   * @since 4.4\n+   * Set LT is switched Off or On\n+   * save configuration\n+   */\n+  public void setSwitchedOff(boolean switchOff, Language lang) throws IOException {\n+    this.switchOff = switchOff;\n+    saveConfiguration(lang);\n+  }\n+\n   private void loadConfiguration(Language lang) throws IOException {\n \n     String qualifier = getQualifier(lang);\n@@ -687,6 +708,11 @@ public class Configuration {\n         doResetCheck = Boolean.parseBoolean(resetCheckString);\n       }\n \n+      String switchOffString = (String) props.get(LT_SWITCHED_OFF_KEY);\n+      if (switchOffString != null) {\n+        switchOff = Boolean.parseBoolean(switchOffString);\n+      }\n+\n       String rulesValuesString = (String) props.get(CONFIGURABLE_RULE_VALUES_KEY);\n       parseConfigurableRuleValues(rulesValuesString);\n \n@@ -808,6 +834,9 @@ public class Configuration {\n     props.setProperty(SERVER_PORT_KEY, Integer.toString(serverPort));\n     props.setProperty(PARA_CHECK_KEY, Integer.toString(numParasToCheck));\n     props.setProperty(RESET_CHECK_KEY, Boolean.toString(doResetCheck));\n+    if(switchOff) {\n+      props.setProperty(LT_SWITCHED_OFF_KEY, Boolean.toString(switchOff));\n+    }\n     if (fontName != null) {\n       props.setProperty(FONT_NAME_KEY, fontName);\n     }\ndiff --git a/languagetool-office-extension/pom.xml b/languagetool-office-extension/pom.xml\nindex e3739de6c1..79ec0f6f12 100644\n--- a/languagetool-office-extension/pom.xml\n+++ b/languagetool-office-extension/pom.xml\n@@ -127,25 +127,25 @@\n         <dependency>\n             <groupId>org.openoffice</groupId>\n             <artifactId>ridl</artifactId>\n-            <version>3.2.1</version>\n+            <version>4.1.2</version>\n             <scope>provided</scope>\n         </dependency>\n         <dependency>\n             <groupId>org.openoffice</groupId>\n             <artifactId>jurt</artifactId>\n-            <version>3.2.1</version>\n+            <version>4.1.2</version>\n             <scope>provided</scope>\n         </dependency>\n         <dependency>\n             <groupId>org.openoffice</groupId>\n             <artifactId>juh</artifactId>\n-            <version>3.2.1</version>\n+            <version>4.1.2</version>\n             <scope>provided</scope>\n         </dependency>\n         <dependency>\n             <groupId>org.openoffice</groupId>\n             <artifactId>unoil</artifactId>\n-            <version>3.2.1</version>\n+            <version>4.1.2</version>\n             <scope>provided</scope>\n         </dependency>\n \n@@ -157,4 +157,4 @@\n         </dependency>\n     </dependencies>\n \n-</project>\n\\ No newline at end of file\n+</project>\ndiff --git a/languagetool-office-extension/src/main/java/org/languagetool/openoffice/Main.java b/languagetool-office-extension/src/main/java/org/languagetool/openoffice/Main.java\nindex 1d1c1ff8f9..398ac621e9 100644\n--- a/languagetool-office-extension/src/main/java/org/languagetool/openoffice/Main.java\n+++ b/languagetool-office-extension/src/main/java/org/languagetool/openoffice/Main.java\n@@ -71,7 +71,6 @@ public class Main extends WeakBase implements XJobExecutor,\n \n   private static final ResourceBundle MESSAGES = JLanguageTool.getMessageBundle();\n \n-  \n   // LibreOffice (since 4.2.0) special tag for locale with variant \n   // e.g. language =\"qlt\" country=\"ES\" variant=\"ca-ES-valencia\":\n   private static final String LIBREOFFICE_SPECIAL_LANGUAGE_TAG = \"qlt\";\n@@ -83,7 +82,6 @@ public class Main extends WeakBase implements XJobExecutor,\n   private Set<String> disabledRules = null;\n   private Set<String> disabledRulesUI;\n   private String lastPara = null;\n-  private boolean switchOff = false;\n \n   private XComponentContext xContext;\n   \n@@ -149,9 +147,6 @@ public class Main extends WeakBase implements XJobExecutor,\n     paRes.aText = paraText;\n     paRes.aProperties = propertyValues;\n     try {\n-      if(switchOff) {\n-        return paRes;\n-      }\n       int[] footnotePositions = getPropertyValues(\"FootnotePositions\", propertyValues);  // since LO 4.3\n       paRes = documents.getCheckResults(paraText, locale, paRes, footnotePositions);\n       if (disabledRules == null) {\n@@ -365,8 +360,9 @@ public class Main extends WeakBase implements XJobExecutor,\n         AboutDialogThread aboutThread = new AboutDialogThread(MESSAGES);\n         aboutThread.start();\n       } else if (\"switchOff\".equals(sEvent)) {\n-        switchOff = !switchOff;\n-        resetCheck();\n+        if(documents.toggleSwitchedOff()) {\n+          resetCheck();\n+        }\n       } else {\n         MessageHandler.printToLogFile(\"Sorry, don't know what to do, sEvent = \" + sEvent);\n       }\n@@ -491,5 +487,4 @@ public class Main extends WeakBase implements XJobExecutor,\n     goneContext.removeEventListener(this); \n   }\n \n-\n }\ndiff --git a/languagetool-office-extension/src/main/java/org/languagetool/openoffice/MultiDocumentsHandler.java b/languagetool-office-extension/src/main/java/org/languagetool/openoffice/MultiDocumentsHandler.java\nindex 0585f5320b..451958cc13 100644\n--- a/languagetool-office-extension/src/main/java/org/languagetool/openoffice/MultiDocumentsHandler.java\n+++ b/languagetool-office-extension/src/main/java/org/languagetool/openoffice/MultiDocumentsHandler.java\n@@ -19,6 +19,7 @@\n package org.languagetool.openoffice;\n \n import java.io.File;\n+import java.io.IOException;\n import java.util.ArrayList;\n import java.util.List;\n import java.util.ResourceBundle;\n@@ -36,6 +37,8 @@ import org.languagetool.rules.CategoryId;\n import org.languagetool.rules.Rule;\n import org.languagetool.tools.Tools;\n \n+import com.sun.star.awt.XMenuBar;\n+import com.sun.star.awt.XPopupMenu;\n import com.sun.star.beans.XPropertySet;\n import com.sun.star.frame.XModel;\n import com.sun.star.lang.Locale;\n@@ -57,16 +60,22 @@ public class MultiDocumentsHandler {\n   // LibreOffice (since 4.2.0) special tag for locale with variant \n   // e.g. language =\"qlt\" country=\"ES\" variant=\"ca-ES-valencia\":\n   private static final String LIBREOFFICE_SPECIAL_LANGUAGE_TAG = \"qlt\";\n-\n+  \n+  // If anything on the position of LT menu is changed the following has to be changed\n+  private static final String TOOLS_COMMAND = \".uno:ToolsMenu\";             //  Command to open tools menu\n+  private static final String WORD_COUNT_COMMAND = \".uno:WordCountDialog\";  //  Command to open words count menu (LT menu is installed before)\n+                                                    //  Command to Switch Off/On LT\n+  private static final String LT_SWITCH_OFF_COMMAND = \"service:org.languagetool.openoffice.Main?switchOff\";   \n+  \n   private static final boolean debugMode = false;   //  should be false except for testing\n   \n   private JLanguageTool langTool = null;\n-  private Language docLanguage;\n+  private Language docLanguage = null;\n   private ResourceBundle MESSAGES;\n   private XEventListener xEventListener;\n   private final File configDir;\n   private final String configFile;\n-  private Configuration config;\n+  private Configuration config = null;\n   private LinguisticServices linguServices = null;\n   \n   private XComponentContext xContext;       //  The context of the document\n@@ -77,6 +86,8 @@ public class MultiDocumentsHandler {\n   private boolean recheck = true;\n   private int docNum;                       //  number of the current document\n \n+  private boolean switchOff = false;        //  is LT switched off\n+\n   private boolean testMode = false;\n \n \n@@ -101,16 +112,16 @@ public class MultiDocumentsHandler {\n       initLanguageTool();\n       initCheck();\n     }\n-\n     if (proofIsRunning) {\n       isParallelThread = true;          //  parallel Thread (right-click or dialog-box while background iteration is running)\n     } else {\n       proofIsRunning = true;  // main thread is running\n     }\n-    \n     docNum = getNumDoc(paRes.aDocumentIdentifier);\n+    if(switchOff) {\n+      return paRes;\n+    }\n     paRes = documents.get(docNum).getCheckResults(paraText, locale, paRes, footnotePositions, isParallelThread, langTool);\n-    \n     if(isParallelThread) {\n       isParallelThread = false;\n     } else {\n@@ -327,6 +338,7 @@ public class MultiDocumentsHandler {\n       }\n     }\n     documents.add(new SingleDocument(xContext, config, docID, xComponent));\n+    setMenuTextForSwitchOff(xContext);\n     if (debugMode) {\n       MessageHandler.printToLogFile(\"Document \" + docNum + \" created; docID = \" + docID);\n     }\n@@ -371,6 +383,7 @@ public class MultiDocumentsHandler {\n         linguServices = new LinguisticServices(xContext);\n       }\n       config = new Configuration(configDir, configFile, docLanguage, linguServices);\n+      switchOff = config.isSwitchedOff();\n       // not using MultiThreadedJLanguageTool here fixes \"osl::Thread::Create failed\", see https://bugs.documentfoundation.org/show_bug.cgi?id=90740:\n       langTool = new JLanguageTool(docLanguage, config.getMotherTongue(), null, \n           new UserConfig(config.getConfigurableValues(), linguServices));\n@@ -427,5 +440,101 @@ public class MultiDocumentsHandler {\n     }\n     recheck = false;\n   }\n+  \n+/**\n+ * Set or remove a check mark to the LT menu item Switch Off \n+ * return true if text should be rechecked\n+ */\n+  public boolean setMenuTextForSwitchOff(XComponentContext xContext) {\n+    boolean ret = true;\n+    XMenuBar menubar = OfficeTools.getMenuBar(xContext);\n+    if (menubar == null) {\n+      MessageHandler.printToLogFile(\"Menubar is null\");\n+      return false;\n+    }\n+    XPopupMenu toolsMenu = null;\n+    XPopupMenu ltMenu = null;\n+    short toolsId = 525;\n+    short ltId = 1501;\n+    try {\n+      for (short i = 0; i < menubar.getItemCount(); i++) {\n+        toolsId = menubar.getItemId(i);\n+        String command = menubar.getCommand(toolsId);\n+        if(TOOLS_COMMAND.equals(command)) {\n+          toolsMenu = menubar.getPopupMenu(toolsId);\n+          break;\n+        }\n+      }\n+      if (toolsMenu == null) {\n+        MessageHandler.printToLogFile(\"Tools Menu is null\");\n+        return false;\n+      }\n+      for (short i = 0; i < toolsMenu.getItemCount(); i++) {\n+        String command = toolsMenu.getCommand(toolsMenu.getItemId(i));\n+        if(WORD_COUNT_COMMAND.equals(command)) {\n+          ltId = toolsMenu.getItemId((short) (i - 1));\n+          ltMenu = toolsMenu.getPopupMenu(ltId);\n+          break;\n+        }\n+      }\n+      if (ltMenu == null) {\n+        MessageHandler.printToLogFile(\"LT Menu is null\");\n+        return false;\n+      }\n+      short switchOffId = 0;\n+      for (short i = 0; i < ltMenu.getItemCount(); i++) {\n+        String command = ltMenu.getCommand(ltMenu.getItemId(i));\n+        if(LT_SWITCH_OFF_COMMAND.equals(command)) {\n+          switchOffId = ltMenu.getItemId(i);\n+          break;\n+        }\n+      }\n+      if (switchOffId == 0) {\n+        MessageHandler.printToLogFile(\"switchOffId not found\");\n+        return false;\n+      }\n+      \n+      boolean isSwitchOff = ltMenu.isItemChecked(switchOffId);\n+      if((switchOff && isSwitchOff) || (!switchOff && !isSwitchOff)) {\n+        switchOff = !switchOff;\n+        ret = false;\n+      }\n+      \n+      if(switchOff) {\n+        ltMenu.checkItem(switchOffId, true);\n+      } else {\n+        ltMenu.checkItem(switchOffId, false);\n+      }\n+    } catch (Throwable t) {\n+      MessageHandler.printException(t);\n+      ret = false;\n+    }\n+    toolsMenu.setPopupMenu(ltId, ltMenu);\n+    menubar.setPopupMenu(toolsId, toolsMenu);\n+    return ret;\n+  }\n+  \n+  public boolean isSwitchedOff() {\n+    return switchOff;\n+  }\n+\n+/**\n+ *  Toggle Switch Off / On of LT\n+ *  return true if toggle was done \n+ */\n+  public boolean toggleSwitchedOff() throws IOException {\n+    if(docLanguage == null) {\n+      docLanguage = getLanguage();\n+    }\n+    if (config == null) {\n+      config = new Configuration(configDir, configFile, docLanguage, linguServices);\n+    }\n+    switchOff = !switchOff;\n+    boolean ret = setMenuTextForSwitchOff(xContext);\n+    langTool = null;\n+    config.setSwitchedOff(switchOff, docLanguage);\n+    return ret;\n+  }\n+\n \n }\ndiff --git a/languagetool-office-extension/src/main/java/org/languagetool/openoffice/OfficeTools.java b/languagetool-office-extension/src/main/java/org/languagetool/openoffice/OfficeTools.java\nindex 08fcf855eb..b6a0fab2e4 100644\n--- a/languagetool-office-extension/src/main/java/org/languagetool/openoffice/OfficeTools.java\n+++ b/languagetool-office-extension/src/main/java/org/languagetool/openoffice/OfficeTools.java\n@@ -20,9 +20,14 @@ package org.languagetool.openoffice;\n \n import org.jetbrains.annotations.Nullable;\n \n+import com.sun.star.awt.XMenuBar;\n+import com.sun.star.beans.XPropertySet;\n import com.sun.star.frame.XDesktop;\n+import com.sun.star.frame.XFrame;\n+import com.sun.star.frame.XLayoutManager;\n import com.sun.star.lang.XComponent;\n import com.sun.star.lang.XMultiComponentFactory;\n+import com.sun.star.ui.XUIElement;\n import com.sun.star.uno.UnoRuntime;\n import com.sun.star.uno.XComponentContext;\n \n@@ -33,6 +38,8 @@ import com.sun.star.uno.XComponentContext;\n  */\n public class OfficeTools {\n   \n+  private static final String MENU_BAR = \"private:resource/menubar/menubar\";\n+\n   /**\n    * Returns the current XDesktop\n    * Returns null if it fails\n@@ -77,6 +84,33 @@ public class OfficeTools {\n     }\n   }\n     \n+  public static XMenuBar getMenuBar(XComponentContext xContext) {\n+    try {\n+      XDesktop desktop = OfficeTools.getCurrentDesktop(xContext);\n+      if (desktop == null) {\n+        return null;\n+      }\n+      XFrame frame = desktop.getCurrentFrame();\n+      if (frame == null) {\n+        return null;\n+      }\n+      XPropertySet propSet = UnoRuntime.queryInterface(XPropertySet.class, frame);\n+      if (propSet == null) {\n+        return null;\n+      }\n+      XLayoutManager layoutManager = UnoRuntime.queryInterface(XLayoutManager.class,  propSet.getPropertyValue(\"LayoutManager\"));\n+      if (layoutManager == null) {\n+        return null;\n+      }\n+      XUIElement oMenuBar = layoutManager.getElement(MENU_BAR); \n+      XPropertySet props = UnoRuntime.queryInterface(XPropertySet.class, oMenuBar); \n+      return UnoRuntime.queryInterface(XMenuBar.class,  props.getPropertyValue(\"XMenuBar\"));\n+    } catch (Throwable t) {\n+      MessageHandler.printException(t);\n+    }\n+    return null;\n+  }\n+  \n \n \n }\ndiff --git a/languagetool-office-extension/src/main/resources/Addons.xcu b/languagetool-office-extension/src/main/resources/Addons.xcu\nindex 0986e088f8..207ca49ad8 100644\n--- a/languagetool-office-extension/src/main/resources/Addons.xcu\n+++ b/languagetool-office-extension/src/main/resources/Addons.xcu\n@@ -119,8 +119,8 @@\n                   </prop>\n                   <prop oor:name=\"Title\" oor:type=\"xs:string\">\n                     <value/>\n-                    <value xml:lang=\"en-US\">Switch On/Off</value>\n-                    <value xml:lang=\"de\">Ein-/Ausschalten</value>\n+                    <value xml:lang=\"en-US\">Switch Off</value>\n+                    <value xml:lang=\"de\">Ausschalten</value>\n                   </prop>\n                   <prop oor:name=\"Target\" oor:type=\"xs:string\">\n                     <value>_self</value>",
    "Add check for exceptions while polling data": "diff --git a/axon-server-connector/src/main/java/org/axonframework/axonserver/connector/event/axon/EventBuffer.java b/axon-server-connector/src/main/java/org/axonframework/axonserver/connector/event/axon/EventBuffer.java\nindex 0d954af93..2c13f296c 100644\n--- a/axon-server-connector/src/main/java/org/axonframework/axonserver/connector/event/axon/EventBuffer.java\n+++ b/axon-server-connector/src/main/java/org/axonframework/axonserver/connector/event/axon/EventBuffer.java\n@@ -125,6 +125,8 @@ private void waitForData(long deadline) throws InterruptedException {\n             peekData = events.poll(Math.min(deadline - now, pollingTimeMillis), TimeUnit.MILLISECONDS);\n             if (peekData != null) {\n                 consumeListener.accept(1);\n+            } else {\n+                checkExceptionState();\n             }\n         }\n     }",
    "Handle core removing SearchRequestParsers .": "diff --git a/elasticsearch/src/main/java/org/elasticsearch/xpack/XPackPlugin.java b/elasticsearch/src/main/java/org/elasticsearch/xpack/XPackPlugin.java\nindex 8ebb0158c50..dca131d78bc 100644\n--- a/elasticsearch/src/main/java/org/elasticsearch/xpack/XPackPlugin.java\n+++ b/elasticsearch/src/main/java/org/elasticsearch/xpack/XPackPlugin.java\n@@ -40,7 +40,6 @@ import org.elasticsearch.plugins.ScriptPlugin;\n import org.elasticsearch.rest.RestHandler;\n import org.elasticsearch.script.ScriptContext;\n import org.elasticsearch.script.ScriptService;\n-import org.elasticsearch.search.SearchRequestParsers;\n import org.elasticsearch.threadpool.ExecutorBuilder;\n import org.elasticsearch.threadpool.ThreadPool;\n import org.elasticsearch.transport.Transport;\n@@ -96,7 +95,6 @@ import java.security.AccessController;\n import java.security.PrivilegedAction;\n import java.time.Clock;\n import java.util.ArrayList;\n-import java.util.Arrays;\n import java.util.Collection;\n import java.util.Collections;\n import java.util.HashMap;\n@@ -221,7 +219,7 @@ public class XPackPlugin extends Plugin implements ScriptPlugin, ActionPlugin, I\n     @Override\n     public Collection<Object> createComponents(Client client, ClusterService clusterService, ThreadPool threadPool,\n                                                ResourceWatcherService resourceWatcherService, ScriptService scriptService,\n-                                               SearchRequestParsers searchRequestParsers, NamedXContentRegistry xContentRegistry) {\n+                                               NamedXContentRegistry xContentRegistry) {\n         List<Object> components = new ArrayList<>();\n         components.add(sslService);\n \n@@ -255,7 +253,7 @@ public class XPackPlugin extends Plugin implements ScriptPlugin, ActionPlugin, I\n                 httpTemplateParser, scriptService, httpAuthRegistry);\n         components.addAll(notificationComponents);\n \n-        components.addAll(watcher.createComponents(getClock(), scriptService, internalClient, searchRequestParsers, licenseState,\n+        components.addAll(watcher.createComponents(getClock(), scriptService, internalClient, licenseState,\n                 httpClient, httpTemplateParser, threadPool, clusterService, security.getCryptoService(), xContentRegistry, components));\n \n \ndiff --git a/elasticsearch/src/main/java/org/elasticsearch/xpack/watcher/Watcher.java b/elasticsearch/src/main/java/org/elasticsearch/xpack/watcher/Watcher.java\nindex 3723578f481..c6975b5ca02 100644\n--- a/elasticsearch/src/main/java/org/elasticsearch/xpack/watcher/Watcher.java\n+++ b/elasticsearch/src/main/java/org/elasticsearch/xpack/watcher/Watcher.java\n@@ -32,7 +32,6 @@ import org.elasticsearch.plugins.ScriptPlugin;\n import org.elasticsearch.rest.RestHandler;\n import org.elasticsearch.script.ScriptContext;\n import org.elasticsearch.script.ScriptService;\n-import org.elasticsearch.search.SearchRequestParsers;\n import org.elasticsearch.threadpool.ExecutorBuilder;\n import org.elasticsearch.threadpool.FixedExecutorBuilder;\n import org.elasticsearch.threadpool.ThreadPool;\n@@ -219,7 +218,7 @@ public class Watcher implements ActionPlugin, ScriptPlugin {\n     }\n \n     public Collection<Object> createComponents(Clock clock, ScriptService scriptService, InternalClient internalClient,\n-                                               SearchRequestParsers searchRequestParsers, XPackLicenseState licenseState,\n+                                               XPackLicenseState licenseState,\n                                                HttpClient httpClient, HttpRequestTemplate.Parser httpTemplateParser,\n                                                ThreadPool threadPool, ClusterService clusterService, CryptoService cryptoService,\n                                                NamedXContentRegistry xContentRegistry, Collection<Object> components) {\n@@ -237,8 +236,7 @@ public class Watcher implements ActionPlugin, ScriptPlugin {\n         final ConditionRegistry conditionRegistry = new ConditionRegistry(Collections.unmodifiableMap(parsers), clock);\n         final Map<String, TransformFactory> transformFactories = new HashMap<>();\n         transformFactories.put(ScriptTransform.TYPE, new ScriptTransformFactory(settings, scriptService));\n-        transformFactories.put(SearchTransform.TYPE, new SearchTransformFactory(settings, internalClient, searchRequestParsers,\n-                xContentRegistry, scriptService));\n+        transformFactories.put(SearchTransform.TYPE, new SearchTransformFactory(settings, internalClient, xContentRegistry, scriptService));\n         final TransformRegistry transformRegistry = new TransformRegistry(settings, Collections.unmodifiableMap(transformFactories));\n \n         final Map<String, ActionFactory> actionFactoryMap = new HashMap<>();\n@@ -261,7 +259,7 @@ public class Watcher implements ActionPlugin, ScriptPlugin {\n \n         final Map<String, InputFactory> inputFactories = new HashMap<>();\n         inputFactories.put(SearchInput.TYPE,\n-                new SearchInputFactory(settings, internalClient, searchRequestParsers, xContentRegistry, scriptService));\n+                new SearchInputFactory(settings, internalClient, xContentRegistry, scriptService));\n         inputFactories.put(SimpleInput.TYPE, new SimpleInputFactory(settings));\n         inputFactories.put(HttpInput.TYPE, new HttpInputFactory(settings, httpClient, templateEngine, httpTemplateParser));\n         inputFactories.put(NoneInput.TYPE, new NoneInputFactory(settings));\n@@ -294,7 +292,7 @@ public class Watcher implements ActionPlugin, ScriptPlugin {\n         final TriggeredWatchStore triggeredWatchStore = new TriggeredWatchStore(settings, watcherClientProxy, triggeredWatchParser);\n \n         final WatcherSearchTemplateService watcherSearchTemplateService =\n-                new WatcherSearchTemplateService(settings, scriptService, searchRequestParsers, xContentRegistry);\n+                new WatcherSearchTemplateService(settings, scriptService, xContentRegistry);\n         final WatchExecutor watchExecutor = getWatchExecutor(threadPool);\n         final Watch.Parser watchParser = new Watch.Parser(settings, triggerService, registry, inputRegistry, cryptoService, clock);\n \ndiff --git a/elasticsearch/src/main/java/org/elasticsearch/xpack/watcher/input/search/SearchInputFactory.java b/elasticsearch/src/main/java/org/elasticsearch/xpack/watcher/input/search/SearchInputFactory.java\nindex a2941e6a9a8..4a11bd9b027 100644\n--- a/elasticsearch/src/main/java/org/elasticsearch/xpack/watcher/input/search/SearchInputFactory.java\n+++ b/elasticsearch/src/main/java/org/elasticsearch/xpack/watcher/input/search/SearchInputFactory.java\n@@ -11,7 +11,6 @@ import org.elasticsearch.common.unit.TimeValue;\n import org.elasticsearch.common.xcontent.NamedXContentRegistry;\n import org.elasticsearch.common.xcontent.XContentParser;\n import org.elasticsearch.script.ScriptService;\n-import org.elasticsearch.search.SearchRequestParsers;\n import org.elasticsearch.xpack.security.InternalClient;\n import org.elasticsearch.xpack.watcher.input.InputFactory;\n import org.elasticsearch.xpack.watcher.input.simple.ExecutableSimpleInput;\n@@ -25,17 +24,17 @@ public class SearchInputFactory extends InputFactory<SearchInput, SearchInput.Re\n     private final TimeValue defaultTimeout;\n     private final WatcherSearchTemplateService searchTemplateService;\n \n-    public SearchInputFactory(Settings settings, InternalClient client, SearchRequestParsers searchRequestParsers,\n-            NamedXContentRegistry xContentRegistry, ScriptService scriptService) {\n-        this(settings, new WatcherClientProxy(settings, client), searchRequestParsers, xContentRegistry, scriptService);\n+    public SearchInputFactory(Settings settings, InternalClient client, NamedXContentRegistry xContentRegistry,\n+            ScriptService scriptService) {\n+        this(settings, new WatcherClientProxy(settings, client), xContentRegistry, scriptService);\n     }\n \n-    public SearchInputFactory(Settings settings, WatcherClientProxy client, SearchRequestParsers searchRequestParsers,\n-            NamedXContentRegistry xContentRegistry, ScriptService scriptService) {\n+    public SearchInputFactory(Settings settings, WatcherClientProxy client, NamedXContentRegistry xContentRegistry,\n+            ScriptService scriptService) {\n         super(Loggers.getLogger(ExecutableSimpleInput.class, settings));\n         this.client = client;\n         this.defaultTimeout = settings.getAsTime(\"xpack.watcher.input.search.default_timeout\", null);\n-        this.searchTemplateService = new WatcherSearchTemplateService(settings, scriptService, searchRequestParsers, xContentRegistry);\n+        this.searchTemplateService = new WatcherSearchTemplateService(settings, scriptService, xContentRegistry);\n     }\n \n     @Override\ndiff --git a/elasticsearch/src/main/java/org/elasticsearch/xpack/watcher/support/search/WatcherSearchTemplateService.java b/elasticsearch/src/main/java/org/elasticsearch/xpack/watcher/support/search/WatcherSearchTemplateService.java\nindex b4adbc71bcf..acecfac4d05 100644\n--- a/elasticsearch/src/main/java/org/elasticsearch/xpack/watcher/support/search/WatcherSearchTemplateService.java\n+++ b/elasticsearch/src/main/java/org/elasticsearch/xpack/watcher/support/search/WatcherSearchTemplateService.java\n@@ -17,7 +17,6 @@ import org.elasticsearch.index.query.QueryParseContext;\n import org.elasticsearch.script.CompiledScript;\n import org.elasticsearch.script.Script;\n import org.elasticsearch.script.ScriptService;\n-import org.elasticsearch.search.SearchRequestParsers;\n import org.elasticsearch.search.builder.SearchSourceBuilder;\n import org.elasticsearch.xpack.watcher.Watcher;\n import org.elasticsearch.xpack.watcher.execution.WatchExecutionContext;\n@@ -35,14 +34,11 @@ public class WatcherSearchTemplateService extends AbstractComponent {\n \n     private final ScriptService scriptService;\n     private final ParseFieldMatcher parseFieldMatcher;\n-    private final SearchRequestParsers searchRequestParsers;\n     private final NamedXContentRegistry xContentRegistry;\n \n-    public WatcherSearchTemplateService(Settings settings, ScriptService scriptService, SearchRequestParsers searchRequestParsers,\n-            NamedXContentRegistry xContentRegistry) {\n+    public WatcherSearchTemplateService(Settings settings, ScriptService scriptService, NamedXContentRegistry xContentRegistry) {\n         super(settings);\n         this.scriptService = scriptService;\n-        this.searchRequestParsers = searchRequestParsers;\n         this.parseFieldMatcher = new ParseFieldMatcher(settings);\n         this.xContentRegistry = xContentRegistry;\n     }\ndiff --git a/elasticsearch/src/main/java/org/elasticsearch/xpack/watcher/transform/search/SearchTransformFactory.java b/elasticsearch/src/main/java/org/elasticsearch/xpack/watcher/transform/search/SearchTransformFactory.java\nindex e4ef8ffc035..8e4c9da90a9 100644\n--- a/elasticsearch/src/main/java/org/elasticsearch/xpack/watcher/transform/search/SearchTransformFactory.java\n+++ b/elasticsearch/src/main/java/org/elasticsearch/xpack/watcher/transform/search/SearchTransformFactory.java\n@@ -11,7 +11,6 @@ import org.elasticsearch.common.unit.TimeValue;\n import org.elasticsearch.common.xcontent.NamedXContentRegistry;\n import org.elasticsearch.common.xcontent.XContentParser;\n import org.elasticsearch.script.ScriptService;\n-import org.elasticsearch.search.SearchRequestParsers;\n import org.elasticsearch.xpack.security.InternalClient;\n import org.elasticsearch.xpack.watcher.support.init.proxy.WatcherClientProxy;\n import org.elasticsearch.xpack.watcher.support.search.WatcherSearchTemplateService;\n@@ -24,17 +23,17 @@ public class SearchTransformFactory extends TransformFactory<SearchTransform, Se\n     private final TimeValue defaultTimeout;\n     private final WatcherSearchTemplateService searchTemplateService;\n \n-    public SearchTransformFactory(Settings settings, InternalClient client, SearchRequestParsers searchRequestParsers,\n-            NamedXContentRegistry xContentRegistry, ScriptService scriptService) {\n-        this(settings, new WatcherClientProxy(settings, client), searchRequestParsers, xContentRegistry, scriptService);\n+    public SearchTransformFactory(Settings settings, InternalClient client, NamedXContentRegistry xContentRegistry,\n+            ScriptService scriptService) {\n+        this(settings, new WatcherClientProxy(settings, client), xContentRegistry, scriptService);\n     }\n \n-    public SearchTransformFactory(Settings settings, WatcherClientProxy client, SearchRequestParsers searchRequestParsers,\n-            NamedXContentRegistry xContentRegistry, ScriptService scriptService) {\n+    public SearchTransformFactory(Settings settings, WatcherClientProxy client, NamedXContentRegistry xContentRegistry,\n+            ScriptService scriptService) {\n         super(Loggers.getLogger(ExecutableSearchTransform.class, settings));\n         this.client = client;\n         this.defaultTimeout = settings.getAsTime(\"xpack.watcher.transform.search.default_timeout\", null);\n-        this.searchTemplateService = new WatcherSearchTemplateService(settings, scriptService, searchRequestParsers, xContentRegistry);\n+        this.searchTemplateService = new WatcherSearchTemplateService(settings, scriptService, xContentRegistry);\n     }\n \n     @Override\ndiff --git a/elasticsearch/src/test/java/org/elasticsearch/xpack/watcher/test/integration/SearchInputTests.java b/elasticsearch/src/test/java/org/elasticsearch/xpack/watcher/test/integration/SearchInputTests.java\nindex 81f7d3ffdbd..af1a9ba5b6e 100644\n--- a/elasticsearch/src/test/java/org/elasticsearch/xpack/watcher/test/integration/SearchInputTests.java\n+++ b/elasticsearch/src/test/java/org/elasticsearch/xpack/watcher/test/integration/SearchInputTests.java\n@@ -17,7 +17,6 @@ import org.elasticsearch.plugins.ScriptPlugin;\n import org.elasticsearch.script.MockMustacheScriptEngine;\n import org.elasticsearch.script.ScriptContext;\n import org.elasticsearch.script.ScriptService;\n-import org.elasticsearch.search.SearchRequestParsers;\n import org.elasticsearch.search.builder.SearchSourceBuilder;\n import org.elasticsearch.test.ESIntegTestCase;\n import org.elasticsearch.test.ESIntegTestCase.ClusterScope;\n@@ -144,9 +143,8 @@ public class SearchInputTests extends ESIntegTestCase {\n         XContentParser parser = createParser(builder);\n         parser.nextToken();\n \n-        SearchRequestParsers searchParsers = new SearchRequestParsers();\n         SearchInputFactory factory = new SearchInputFactory(Settings.EMPTY, WatcherClientProxy.of(client()),\n-                                                            searchParsers, xContentRegistry(), scriptService());\n+                                                            xContentRegistry(), scriptService());\n \n         SearchInput searchInput = factory.parseInput(\"_id\", parser);\n         assertEquals(SearchInput.TYPE, searchInput.type());\n@@ -157,7 +155,6 @@ public class SearchInputTests extends ESIntegTestCase {\n         String master = internalCluster().getMasterName();\n         return new WatcherSearchTemplateService(internalCluster().clusterService(master).getSettings(),\n                 internalCluster().getInstance(ScriptService.class, master),\n-                internalCluster().getInstance(SearchRequestParsers.class, master),\n                 internalCluster().getInstance(NamedXContentRegistry.class, master)\n         );\n     }\ndiff --git a/elasticsearch/src/test/java/org/elasticsearch/xpack/watcher/test/integration/SearchTransformTests.java b/elasticsearch/src/test/java/org/elasticsearch/xpack/watcher/test/integration/SearchTransformTests.java\nindex 378fd43555a..ada4eb09c1e 100644\n--- a/elasticsearch/src/test/java/org/elasticsearch/xpack/watcher/test/integration/SearchTransformTests.java\n+++ b/elasticsearch/src/test/java/org/elasticsearch/xpack/watcher/test/integration/SearchTransformTests.java\n@@ -21,7 +21,6 @@ import org.elasticsearch.script.Script;\n import org.elasticsearch.script.ScriptContext;\n import org.elasticsearch.script.ScriptService;\n import org.elasticsearch.script.ScriptType;\n-import org.elasticsearch.search.SearchRequestParsers;\n import org.elasticsearch.search.builder.SearchSourceBuilder;\n import org.elasticsearch.test.ESIntegTestCase;\n import org.elasticsearch.test.ESIntegTestCase.ClusterScope;\n@@ -212,9 +211,8 @@ public class SearchTransformTests extends ESIntegTestCase {\n         XContentParser parser = createParser(builder);\n         parser.nextToken();\n \n-        SearchRequestParsers searchRequestParsers = internalCluster().getInstance(SearchRequestParsers.class);\n         SearchTransformFactory transformFactory = new SearchTransformFactory(Settings.EMPTY, WatcherClientProxy.of(client()),\n-                                                                             searchRequestParsers, xContentRegistry(), scriptService());\n+                                                                             xContentRegistry(), scriptService());\n         ExecutableSearchTransform executable = transformFactory.parseExecutable(\"_id\", parser);\n \n         assertThat(executable, notNullValue());\n@@ -284,7 +282,6 @@ public class SearchTransformTests extends ESIntegTestCase {\n         String master = internalCluster().getMasterName();\n         return new WatcherSearchTemplateService(internalCluster().clusterService(master).getSettings(),\n                 internalCluster().getInstance(ScriptService.class, master),\n-                internalCluster().getInstance(SearchRequestParsers.class, master),\n                 xContentRegistry()\n         );\n     }\ndiff --git a/elasticsearch/src/test/java/org/elasticsearch/xpack/watcher/watch/WatchTests.java b/elasticsearch/src/test/java/org/elasticsearch/xpack/watcher/watch/WatchTests.java\nindex 415f85123e2..537f420b96a 100644\n--- a/elasticsearch/src/test/java/org/elasticsearch/xpack/watcher/watch/WatchTests.java\n+++ b/elasticsearch/src/test/java/org/elasticsearch/xpack/watcher/watch/WatchTests.java\n@@ -23,7 +23,6 @@ import org.elasticsearch.index.query.ScriptQueryBuilder;\n import org.elasticsearch.license.XPackLicenseState;\n import org.elasticsearch.script.Script;\n import org.elasticsearch.script.ScriptService;\n-import org.elasticsearch.search.SearchRequestParsers;\n import org.elasticsearch.test.ESTestCase;\n import org.elasticsearch.xpack.common.http.HttpClient;\n import org.elasticsearch.xpack.common.http.HttpMethod;\n@@ -288,9 +287,7 @@ public class WatchTests extends ESTestCase {\n         ActionRegistry actionRegistry = registry(Collections.emptyList(), conditionRegistry, transformRegistry);\n         Watch.Parser watchParser = new Watch.Parser(settings, triggerService, actionRegistry, inputRegistry, null, Clock.systemUTC());\n \n-        SearchRequestParsers searchParsers = new SearchRequestParsers();\n-        WatcherSearchTemplateService searchTemplateService = new WatcherSearchTemplateService(settings, scriptService, searchParsers,\n-                xContentRegistry());\n+        WatcherSearchTemplateService searchTemplateService = new WatcherSearchTemplateService(settings, scriptService, xContentRegistry());\n \n         XContentBuilder builder = XContentFactory.jsonBuilder();\n         builder.startObject();\n@@ -409,8 +406,7 @@ public class WatchTests extends ESTestCase {\n         Map<String, InputFactory> parsers = new HashMap<>();\n         switch (inputType) {\n             case SearchInput.TYPE:\n-                SearchRequestParsers searchParsers = new SearchRequestParsers();\n-                parsers.put(SearchInput.TYPE, new SearchInputFactory(settings, client, searchParsers, xContentRegistry(), scriptService));\n+                parsers.put(SearchInput.TYPE, new SearchInputFactory(settings, client, xContentRegistry(), scriptService));\n                 return new InputRegistry(Settings.EMPTY, parsers);\n             default:\n                 parsers.put(SimpleInput.TYPE, new SimpleInputFactory(settings));\n@@ -457,10 +453,9 @@ public class WatchTests extends ESTestCase {\n     }\n \n     private TransformRegistry transformRegistry() {\n-        SearchRequestParsers searchParsers = new SearchRequestParsers();\n         Map<String, TransformFactory> factories = new HashMap<>();\n         factories.put(ScriptTransform.TYPE, new ScriptTransformFactory(settings, scriptService));\n-        factories.put(SearchTransform.TYPE, new SearchTransformFactory(settings, client, searchParsers, xContentRegistry(), scriptService));\n+        factories.put(SearchTransform.TYPE, new SearchTransformFactory(settings, client, xContentRegistry(), scriptService));\n         return new TransformRegistry(Settings.EMPTY, unmodifiableMap(factories));\n     }\n ",
    "include library project": "diff --git a/build.gradle b/build.gradle\nindex d2eefcc4a..a2136ad29 100644\n--- a/build.gradle\n+++ b/build.gradle\n@@ -22,6 +22,7 @@ dependencies {\n     compile 'com.nineoldandroids:library:2.4.0'\n     compile 'com.github.junrar:junrar:0.7'\n     compile 'org.apache.commons:commons-compress:1.8.1'\n+    compile project(\":library1\")\n     compile fileTree(include: '*.jar', dir: 'libs')\n }\n ",
    "add extension function for DownloadListener4WithSpeed": "diff --git a/okdownload-kotlin-enhance/src/main/kotlin/com.liulishuo.okdownload.kotlin/listener/DownloadListener4WithSpeedExtension.kt b/okdownload-kotlin-enhance/src/main/kotlin/com.liulishuo.okdownload.kotlin/listener/DownloadListener4WithSpeedExtension.kt\nnew file mode 100644\nindex 0000000..1cf7cd7\n--- /dev/null\n+++ b/okdownload-kotlin-enhance/src/main/kotlin/com.liulishuo.okdownload.kotlin/listener/DownloadListener4WithSpeedExtension.kt\n@@ -0,0 +1,146 @@\n+/*\n+ * Copyright (c) 2018 LingoChamp Inc.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.liulishuo.okdownload.kotlin.listener\n+\n+import com.liulishuo.okdownload.DownloadTask\n+import com.liulishuo.okdownload.SpeedCalculator\n+import com.liulishuo.okdownload.core.breakpoint.BlockInfo\n+import com.liulishuo.okdownload.core.breakpoint.BreakpointInfo\n+import com.liulishuo.okdownload.core.cause.EndCause\n+import com.liulishuo.okdownload.core.listener.DownloadListener4WithSpeed\n+import com.liulishuo.okdownload.core.listener.assist.Listener4SpeedAssistExtend\n+\n+/**\n+ * Correspond to [com.liulishuo.okdownload.core.listener.DownloadListener4WithSpeed.taskStart]\n+ */\n+typealias onInfoReadyWithSpeed = (\n+    task: DownloadTask,\n+    info: BreakpointInfo,\n+    fromBreakpoint: Boolean,\n+    model: Listener4SpeedAssistExtend.Listener4SpeedModel\n+) -> Unit\n+\n+/**\n+ * Correspond to [com.liulishuo.okdownload.core.listener.DownloadListener4WithSpeed.progressBlock]\n+ */\n+typealias onProgressBlockWithSpeed = (\n+    task: DownloadTask,\n+    blockIndex: Int,\n+    currentBlockOffset: Long,\n+    blockSpeed: SpeedCalculator\n+) -> Unit\n+\n+/**\n+ * Correspond to [com.liulishuo.okdownload.core.listener.DownloadListener4WithSpeed.progress]\n+ */\n+typealias onProgressWithSpeed = (\n+    task: DownloadTask,\n+    currentOffset: Long,\n+    taskSpeed: SpeedCalculator\n+) -> Unit\n+\n+/**\n+ * Correspond to [com.liulishuo.okdownload.core.listener.DownloadListener4WithSpeed.blockEnd]\n+ */\n+typealias onBlockEndWithSpeed = (\n+    task: DownloadTask,\n+    blockIndex: Int,\n+    info: BlockInfo,\n+    blockSpeed: SpeedCalculator\n+) -> Unit\n+\n+/**\n+ * Correspond to [com.liulishuo.okdownload.core.listener.DownloadListener4WithSpeed.taskEnd]\n+ */\n+typealias onTaskEndWithSpeed = (\n+    task: DownloadTask,\n+    cause: EndCause,\n+    realCause: Exception?,\n+    taskSpeed: SpeedCalculator\n+) -> Unit\n+\n+fun createListener4WithSpeed(\n+    onTaskStart: onTaskStart? = null,\n+    onConnectStart: onConnectStart? = null,\n+    onConnectEnd: onConnectEnd? = null,\n+    onInfoReadyWithSpeed: onInfoReadyWithSpeed? = null,\n+    onProgressBlockWithSpeed: onProgressBlockWithSpeed? = null,\n+    onProgressWithSpeed: onProgressWithSpeed? = null,\n+    onBlockEndWithSpeed: onBlockEndWithSpeed? = null,\n+    onTaskEndWithSpeed: onTaskEndWithSpeed\n+): DownloadListener4WithSpeed = object : DownloadListener4WithSpeed() {\n+    override fun taskStart(task: DownloadTask) {\n+        onTaskStart?.invoke(task)\n+    }\n+\n+    override fun infoReady(\n+        task: DownloadTask,\n+        info: BreakpointInfo,\n+        fromBreakpoint: Boolean,\n+        model: Listener4SpeedAssistExtend.Listener4SpeedModel\n+    ) {\n+        onInfoReadyWithSpeed?.invoke(task, info, fromBreakpoint, model)\n+    }\n+\n+    override fun progressBlock(\n+        task: DownloadTask,\n+        blockIndex: Int,\n+        currentBlockOffset: Long,\n+        blockSpeed: SpeedCalculator\n+    ) {\n+        onProgressBlockWithSpeed?.invoke(task, blockIndex, currentBlockOffset, blockSpeed)\n+    }\n+\n+    override fun progress(task: DownloadTask, currentOffset: Long, taskSpeed: SpeedCalculator) {\n+        onProgressWithSpeed?.invoke(task, currentOffset, taskSpeed)\n+    }\n+\n+    override fun blockEnd(\n+        task: DownloadTask,\n+        blockIndex: Int,\n+        info: BlockInfo,\n+        blockSpeed: SpeedCalculator\n+    ) {\n+        onBlockEndWithSpeed?.invoke(task, blockIndex, info, blockSpeed)\n+    }\n+\n+    override fun taskEnd(\n+        task: DownloadTask,\n+        cause: EndCause,\n+        realCause: java.lang.Exception?,\n+        taskSpeed: SpeedCalculator\n+    ) {\n+        onTaskEndWithSpeed(task, cause, realCause, taskSpeed)\n+    }\n+\n+    override fun connectStart(\n+        task: DownloadTask,\n+        blockIndex: Int,\n+        requestHeaderFields: MutableMap<String, MutableList<String>>\n+    ) {\n+        onConnectStart?.invoke(task, blockIndex, requestHeaderFields)\n+    }\n+\n+    override fun connectEnd(\n+        task: DownloadTask,\n+        blockIndex: Int,\n+        responseCode: Int,\n+        responseHeaderFields: MutableMap<String, MutableList<String>>\n+    ) {\n+        onConnectEnd?.invoke(task, blockIndex, responseCode, responseHeaderFields)\n+    }\n+}\n\\ No newline at end of file\ndiff --git a/okdownload-kotlin-enhance/src/test/java/com/liulishuo/okdownload/kotlin/DownloadListener4WithSpeedExtensionTest.kt b/okdownload-kotlin-enhance/src/test/java/com/liulishuo/okdownload/kotlin/DownloadListener4WithSpeedExtensionTest.kt\nnew file mode 100644\nindex 0000000..4d3ffd4\n--- /dev/null\n+++ b/okdownload-kotlin-enhance/src/test/java/com/liulishuo/okdownload/kotlin/DownloadListener4WithSpeedExtensionTest.kt\n@@ -0,0 +1,166 @@\n+/*\n+ * Copyright (c) 2018 LingoChamp Inc.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.liulishuo.okdownload.kotlin\n+\n+import com.liulishuo.okdownload.DownloadTask\n+import com.liulishuo.okdownload.SpeedCalculator\n+import com.liulishuo.okdownload.core.breakpoint.BlockInfo\n+import com.liulishuo.okdownload.core.breakpoint.BreakpointInfo\n+import com.liulishuo.okdownload.core.cause.EndCause\n+import com.liulishuo.okdownload.core.listener.assist.Listener4SpeedAssistExtend\n+import com.liulishuo.okdownload.kotlin.listener.createListener4WithSpeed\n+import com.liulishuo.okdownload.kotlin.listener.onBlockEndWithSpeed\n+import com.liulishuo.okdownload.kotlin.listener.onConnectEnd\n+import com.liulishuo.okdownload.kotlin.listener.onConnectStart\n+import com.liulishuo.okdownload.kotlin.listener.onInfoReadyWithSpeed\n+import com.liulishuo.okdownload.kotlin.listener.onProgressBlockWithSpeed\n+import com.liulishuo.okdownload.kotlin.listener.onProgressWithSpeed\n+import com.liulishuo.okdownload.kotlin.listener.onTaskEndWithSpeed\n+import com.liulishuo.okdownload.kotlin.listener.onTaskStart\n+import io.mockk.MockKAnnotations\n+import io.mockk.confirmVerified\n+import io.mockk.every\n+import io.mockk.impl.annotations.MockK\n+import io.mockk.verify\n+import org.junit.Before\n+import org.junit.Test\n+import java.lang.Exception\n+\n+class DownloadListener4WithSpeedExtensionTest {\n+\n+    @MockK\n+    lateinit var onTaskStart: onTaskStart\n+    @MockK\n+    lateinit var onConnectStart: onConnectStart\n+    @MockK\n+    lateinit var onConnectEnd: onConnectEnd\n+    @MockK\n+    lateinit var onInfoReadyWithSpeed: onInfoReadyWithSpeed\n+    @MockK\n+    lateinit var onProgressBlockWithSpeed: onProgressBlockWithSpeed\n+    @MockK\n+    lateinit var onProgressWithSpeed: onProgressWithSpeed\n+    @MockK\n+    lateinit var onBlockEndWithSpeed: onBlockEndWithSpeed\n+    @MockK\n+    lateinit var onTaskEndWithSpeed: onTaskEndWithSpeed\n+    @MockK\n+    lateinit var mockTask: DownloadTask\n+    @MockK\n+    lateinit var mockHeaderFields: Map<String, List<String>>\n+    @MockK\n+    lateinit var mockBreakInfo: BreakpointInfo\n+    @MockK\n+    lateinit var mockListener4Model: Listener4SpeedAssistExtend.Listener4SpeedModel\n+    @MockK\n+    lateinit var mockSpeedCalculator: SpeedCalculator\n+    @MockK\n+    lateinit var mockBlockInfo: BlockInfo\n+    @MockK\n+    lateinit var mockCause: EndCause\n+    @MockK\n+    lateinit var mockRealCause: Exception\n+\n+    @Before\n+    fun setup() = MockKAnnotations.init(this, relaxed = true)\n+\n+    @Test\n+    fun `create DownloadListener4WithSpeed with only task end callback`() {\n+        val listener4WithSpeed = createListener4WithSpeed { task, cause, realCause, taskSpeed ->\n+            onTaskEndWithSpeed(task, cause, realCause, taskSpeed)\n+        }\n+        val blockIndex = 1\n+        val responseCode = 200\n+        val fromBreakpoint = true\n+        val currentOffset = 100L\n+\n+        listener4WithSpeed.taskStart(mockTask)\n+        listener4WithSpeed.connectStart(mockTask, blockIndex, mockHeaderFields)\n+        listener4WithSpeed.connectEnd(mockTask, blockIndex, responseCode, mockHeaderFields)\n+        listener4WithSpeed.infoReady(mockTask, mockBreakInfo, fromBreakpoint, mockListener4Model)\n+        listener4WithSpeed.progressBlock(mockTask, blockIndex, currentOffset, mockSpeedCalculator)\n+        listener4WithSpeed.progress(mockTask, currentOffset, mockSpeedCalculator)\n+        listener4WithSpeed.blockEnd(mockTask, blockIndex, mockBlockInfo, mockSpeedCalculator)\n+        listener4WithSpeed.taskEnd(mockTask, mockCause, mockRealCause, mockSpeedCalculator)\n+\n+        verify { onTaskEndWithSpeed(mockTask, mockCause, mockRealCause, mockSpeedCalculator) }\n+        confirmVerified(onTaskEndWithSpeed)\n+    }\n+\n+    fun `create DownloadListener4WithSpeed with all callbacks`() {\n+        val listener4WithSpeed = createListener4WithSpeed(\n+            onTaskStart,\n+            onConnectStart,\n+            onConnectEnd,\n+            onInfoReadyWithSpeed,\n+            onProgressBlockWithSpeed,\n+            onProgressWithSpeed,\n+            onBlockEndWithSpeed,\n+            onTaskEndWithSpeed\n+        )\n+        val blockIndex = 1\n+        val responseCode = 200\n+        val fromBreakpoint = true\n+        val currentOffset = 100L\n+\n+        every { onTaskStart.invoke(mockTask) } returns Unit\n+        every { onConnectStart.invoke(mockTask, blockIndex, mockHeaderFields) } returns Unit\n+        every {\n+            onConnectEnd.invoke(mockTask, blockIndex, responseCode, mockHeaderFields)\n+        } returns Unit\n+        every {\n+            onInfoReadyWithSpeed.invoke(mockTask, mockBreakInfo, fromBreakpoint, mockListener4Model)\n+        } returns Unit\n+        every {\n+            onProgressWithSpeed.invoke(mockTask, currentOffset, mockSpeedCalculator)\n+        } returns Unit\n+        every {\n+            onBlockEndWithSpeed.invoke(mockTask, blockIndex, mockBlockInfo, mockSpeedCalculator)\n+        } returns Unit\n+\n+        listener4WithSpeed.taskStart(mockTask)\n+        listener4WithSpeed.connectStart(mockTask, blockIndex, mockHeaderFields)\n+        listener4WithSpeed.connectEnd(mockTask, blockIndex, responseCode, mockHeaderFields)\n+        listener4WithSpeed.infoReady(mockTask, mockBreakInfo, fromBreakpoint, mockListener4Model)\n+        listener4WithSpeed.progressBlock(mockTask, blockIndex, currentOffset, mockSpeedCalculator)\n+        listener4WithSpeed.progress(mockTask, currentOffset, mockSpeedCalculator)\n+        listener4WithSpeed.blockEnd(mockTask, blockIndex, mockBlockInfo, mockSpeedCalculator)\n+        listener4WithSpeed.taskEnd(mockTask, mockCause, mockRealCause, mockSpeedCalculator)\n+\n+        verify { onTaskStart.invoke(mockTask) }\n+        verify { onConnectStart.invoke(mockTask, blockIndex, mockHeaderFields) }\n+        verify { onConnectEnd.invoke(mockTask, blockIndex, responseCode, mockHeaderFields) }\n+        verify {\n+            onInfoReadyWithSpeed.invoke(mockTask, mockBreakInfo, fromBreakpoint, mockListener4Model)\n+        }\n+        verify { onProgressWithSpeed.invoke(mockTask, currentOffset, mockSpeedCalculator) }\n+        verify {\n+            onBlockEndWithSpeed.invoke(mockTask, blockIndex, mockBlockInfo, mockSpeedCalculator)\n+        }\n+        verify {\n+            onTaskEndWithSpeed.invoke(mockTask, mockCause, mockRealCause, mockSpeedCalculator)\n+        }\n+\n+        confirmVerified(onTaskStart)\n+        confirmVerified(onConnectStart)\n+        confirmVerified(onConnectEnd)\n+        confirmVerified(onInfoReadyWithSpeed)\n+        confirmVerified(onProgressWithSpeed)\n+        confirmVerified(onBlockEndWithSpeed)\n+        confirmVerified(onTaskEndWithSpeed)\n+    }\n+}\n\\ No newline at end of file\ndiff --git a/sample/src/main/java/com/liulishuo/okdownload/sample/ListenerSample.kt b/sample/src/main/java/com/liulishuo/okdownload/sample/ListenerSample.kt\nindex b29bbe8..8887c04 100644\n--- a/sample/src/main/java/com/liulishuo/okdownload/sample/ListenerSample.kt\n+++ b/sample/src/main/java/com/liulishuo/okdownload/sample/ListenerSample.kt\n@@ -18,23 +18,17 @@ package com.liulishuo.okdownload.sample\n \n import android.util.Log\n import com.liulishuo.okdownload.DownloadListener\n-import com.liulishuo.okdownload.DownloadTask\n-import com.liulishuo.okdownload.SpeedCalculator\n-import com.liulishuo.okdownload.core.breakpoint.BlockInfo\n-import com.liulishuo.okdownload.core.breakpoint.BreakpointInfo\n-import com.liulishuo.okdownload.core.cause.EndCause\n import com.liulishuo.okdownload.core.listener.DownloadListener1\n import com.liulishuo.okdownload.core.listener.DownloadListener2\n import com.liulishuo.okdownload.core.listener.DownloadListener3\n import com.liulishuo.okdownload.core.listener.DownloadListener4\n import com.liulishuo.okdownload.core.listener.DownloadListener4WithSpeed\n-import com.liulishuo.okdownload.core.listener.assist.Listener4Assist\n-import com.liulishuo.okdownload.core.listener.assist.Listener4SpeedAssistExtend\n import com.liulishuo.okdownload.kotlin.listener.createListener\n import com.liulishuo.okdownload.kotlin.listener.createListener1\n import com.liulishuo.okdownload.kotlin.listener.createListener2\n import com.liulishuo.okdownload.kotlin.listener.createListener3\n import com.liulishuo.okdownload.kotlin.listener.createListener4\n+import com.liulishuo.okdownload.kotlin.listener.createListener4WithSpeed\n \n class ListenerSample {\n \n@@ -61,50 +55,8 @@ class ListenerSample {\n \n     fun listener4(): DownloadListener4 = createListener4 { _, _, _, _ -> log(\"taskEnd\") }\n \n-    fun listener4WithSpeed(): DownloadListener4WithSpeed {\n-        return object : DownloadListener4WithSpeed() {\n-            override fun taskStart(task: DownloadTask) {\n-                log(\"taskStart\")\n-            }\n-\n-            override fun infoReady(task: DownloadTask, info: BreakpointInfo,\n-                                   fromBreakpoint: Boolean,\n-                                   model: Listener4SpeedAssistExtend.Listener4SpeedModel) {\n-                log(\"infoReady\")\n-            }\n-\n-            override fun connectStart(task: DownloadTask, blockIndex: Int,\n-                                      requestHeader: Map<String, List<String>>) {\n-                log(\"connectStart\")\n-            }\n-\n-            override fun connectEnd(task: DownloadTask, blockIndex: Int, responseCode: Int,\n-                                    responseHeader: Map<String, List<String>>) {\n-                log(\"connectEnd\")\n-            }\n-\n-            override fun progressBlock(task: DownloadTask, blockIndex: Int,\n-                                       currentBlockOffset: Long,\n-                                       blockSpeed: SpeedCalculator) {\n-                log(\"progressBlock\")\n-            }\n-\n-            override fun progress(task: DownloadTask, currentOffset: Long,\n-                                  taskSpeed: SpeedCalculator) {\n-                log(\"progress\")\n-            }\n-\n-            override fun blockEnd(task: DownloadTask, blockIndex: Int, info: BlockInfo,\n-                                  blockSpeed: SpeedCalculator) {\n-                log(\"blockEnd\")\n-            }\n-\n-            override fun taskEnd(task: DownloadTask, cause: EndCause,\n-                                 realCause: Exception?,\n-                                 taskSpeed: SpeedCalculator) {\n-                log(\"taskEnd\")\n-            }\n-        }\n+    fun listener4WithSpeed(): DownloadListener4WithSpeed = createListener4WithSpeed { _, _, _, _ ->\n+        log(\"taskEnd\")\n     }\n \n     companion object {",
    "represent TimeoutExceptions during transaction processing as TransactionTimedOutException": "diff --git a/hazelcast/src/main/java/com/hazelcast/transaction/TransactionTimedOutException.java b/hazelcast/src/main/java/com/hazelcast/transaction/TransactionTimedOutException.java\nnew file mode 100644\nindex 0000000000..3307dbbed8\n--- /dev/null\n+++ b/hazelcast/src/main/java/com/hazelcast/transaction/TransactionTimedOutException.java\n@@ -0,0 +1,39 @@\n+/*\n+ * Copyright (c) 2008-2014, Hazelcast, Inc. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.hazelcast.transaction;\n+\n+/**\n+ * Thrown when a transaction has timed out.\n+ */\n+public class TransactionTimedOutException extends TransactionException {\n+\n+    public TransactionTimedOutException() {\n+    }\n+\n+    public TransactionTimedOutException(String message) {\n+        super(message);\n+    }\n+\n+    public TransactionTimedOutException(String message, Throwable cause) {\n+        super(message, cause);\n+    }\n+\n+    public TransactionTimedOutException(Throwable cause) {\n+        super(cause);\n+    }\n+\n+}\ndiff --git a/hazelcast/src/main/java/com/hazelcast/util/FutureUtil.java b/hazelcast/src/main/java/com/hazelcast/util/FutureUtil.java\nindex a55234dfad..c667e962b0 100644\n--- a/hazelcast/src/main/java/com/hazelcast/util/FutureUtil.java\n+++ b/hazelcast/src/main/java/com/hazelcast/util/FutureUtil.java\n@@ -22,6 +22,7 @@ import com.hazelcast.logging.ILogger;\n import com.hazelcast.logging.Logger;\n import com.hazelcast.spi.InternalCompletableFuture;\n import com.hazelcast.spi.annotation.PrivateApi;\n+import com.hazelcast.transaction.TransactionTimedOutException;\n \n import java.util.ArrayList;\n import java.util.Collection;\n@@ -90,6 +91,20 @@ public final class FutureUtil {\n         }\n     };\n \n+\n+    /**\n+     * Handler for transaction specific rethrown of exceptions.\n+     */\n+    public static final ExceptionHandler RETHROW_TRANSACTION_EXCEPTION = new ExceptionHandler() {\n+        @Override\n+        public void handleException(Throwable throwable) {\n+            if (throwable instanceof TimeoutException) {\n+                throw new TransactionTimedOutException(throwable);\n+            }\n+            throw ExceptionUtil.rethrow(throwable);\n+        }\n+    };\n+\n     private static final ILogger LOGGER = Logger.getLogger(FutureUtil.class);\n \n     private FutureUtil() {\n@@ -99,9 +114,9 @@ public final class FutureUtil {\n      * This ExceptionHandler rethrows {@link java.util.concurrent.ExecutionException}s and logs\n      * {@link com.hazelcast.core.MemberLeftException}s to the log.\n      *\n-     * @param logger the ILogger instance to be used for logging\n+     * @param logger  the ILogger instance to be used for logging\n      * @param message the log message to appear in the logs before the stacktrace\n-     * @param level the log level to be used for logging\n+     * @param level   the log level to be used for logging\n      */\n     @PrivateApi\n     public static ExceptionHandler logAllExceptions(final ILogger logger, final String message, final Level level) {\n@@ -121,7 +136,7 @@ public final class FutureUtil {\n      * {@link com.hazelcast.core.MemberLeftException}s to the log.\n      *\n      * @param message the log message to appear in the logs before the stacktrace\n-     * @param level the log level to be used for logging\n+     * @param level   the log level to be used for logging\n      */\n     @PrivateApi\n     public static ExceptionHandler logAllExceptions(final String message, final Level level) {\n@@ -141,7 +156,7 @@ public final class FutureUtil {\n      * {@link com.hazelcast.core.MemberLeftException}s to the log.\n      *\n      * @param logger the ILogger instance to be used for logging\n-     * @param level the log level to be used for logging\n+     * @param level  the log level to be used for logging\n      */\n     @PrivateApi\n     public static ExceptionHandler logAllExceptions(final ILogger logger, final Level level) {\ndiff --git a/hazelcast/src/test/java/com/hazelcast/util/FutureUtilTest.java b/hazelcast/src/test/java/com/hazelcast/util/FutureUtilTest.java\nindex e39d7b60f0..f40a615aa4 100644\n--- a/hazelcast/src/test/java/com/hazelcast/util/FutureUtilTest.java\n+++ b/hazelcast/src/test/java/com/hazelcast/util/FutureUtilTest.java\n@@ -19,6 +19,7 @@ package com.hazelcast.util;\n import com.hazelcast.test.HazelcastParallelClassRunner;\n import com.hazelcast.test.HazelcastTestSupport;\n import com.hazelcast.test.annotation.QuickTest;\n+import com.hazelcast.transaction.TransactionTimedOutException;\n import org.junit.Test;\n import org.junit.experimental.categories.Category;\n import org.junit.runner.RunWith;\n@@ -168,6 +169,15 @@ public class FutureUtilTest extends HazelcastTestSupport {\n         assertTrue(throwable.getCause() instanceof SpecialRuntimeException);\n     }\n \n+\n+    @Test(expected = TransactionTimedOutException.class)\n+    public void testTransactionTimedOutExceptionHandler() throws Exception {\n+        final ExceptionHandler exceptionHandler = FutureUtil.RETHROW_TRANSACTION_EXCEPTION;\n+        final Throwable throwable = new TimeoutException();\n+\n+        exceptionHandler.handleException(throwable);\n+    }\n+\n     private static final class ExceptionCollector implements ExceptionHandler {\n \n         private final List<Throwable> throwables = new ArrayList<Throwable>();",
    "Fixed a bug in the index command for the lucene - index component . . git - svn - id : https : / / svn . neo4j . org / laboratory / components / lucene - index / src @ 5273 0b971d98 - bb2f - 0410 - 8247 - b05b2b5feb2a": "diff --git a/advanced/main/java/org/neo4j/index/impl/IndexProviderShellApp.java b/advanced/main/java/org/neo4j/index/impl/IndexProviderShellApp.java\nindex d4c4fd10818..0330f53e333 100644\n--- a/advanced/main/java/org/neo4j/index/impl/IndexProviderShellApp.java\n+++ b/advanced/main/java/org/neo4j/index/impl/IndexProviderShellApp.java\n@@ -116,11 +116,11 @@ public class IndexProviderShellApp extends GraphDatabaseApp\n             Iterable<Node> result;\n             if ( query )\n             {\n-                result = query( indexes, parser, session, out );\n+                result = query( indexes, parser );\n             }\n             else\n             {\n-                result = get( indexes, parser, session, out );\n+                result = get( indexes, parser );\n             }\n             for ( Node node : result )\n             {\n@@ -130,11 +130,11 @@ public class IndexProviderShellApp extends GraphDatabaseApp\n         }\n         else if ( index )\n         {\n-            index( indexes, parser, session, out );\n+            index( indexes, parser, session );\n         }\n         else if ( remove )\n         {\n-            remove( indexes, parser, session, out );\n+            remove( indexes, parser, session );\n         }\n         return null;\n     }\n@@ -152,8 +152,7 @@ public class IndexProviderShellApp extends GraphDatabaseApp\n         return count;\n     }\n \n-    private Iterable<Node> get( IndexProvider indexes, AppCommandParser parser, Session session,\n-            Output out )\n+    private Iterable<Node> get( IndexProvider indexes, AppCommandParser parser )\n     {\n         String index = parser.arguments().get( 0 );\n         String key = parser.arguments().get( 1 );\n@@ -161,21 +160,20 @@ public class IndexProviderShellApp extends GraphDatabaseApp\n         return indexes.nodeIndex( index, emptyConfig() ).get( key, value );\n     }\n \n-    private Iterable<Node> query( IndexProvider indexes, AppCommandParser parser, Session session,\n-            Output out )\n+    private Iterable<Node> query( IndexProvider indexes, AppCommandParser parser )\n     {\n         String index = parser.arguments().get( 0 );\n         String query = parser.arguments().get( 1 );\n         return indexes.nodeIndex( index, emptyConfig() ).query( query );\n     }\n \n-    private void index( IndexProvider indexes, AppCommandParser parser, Session session, Output out )\n+    private void index( IndexProvider indexes,",
    "Decouple MessageListAdapter from MessageListFragment . selected": "diff --git a/app/ui/src/main/java/com/fsck/k9/fragment/MessageListAdapter.kt b/app/ui/src/main/java/com/fsck/k9/fragment/MessageListAdapter.kt\nindex 0543e1148..2508364bb 100644\n--- a/app/ui/src/main/java/com/fsck/k9/fragment/MessageListAdapter.kt\n+++ b/app/ui/src/main/java/com/fsck/k9/fragment/MessageListAdapter.kt\n@@ -122,6 +122,8 @@ class MessageListAdapter internal constructor(\n \n     var uniqueIdColumn: Int = 0\n \n+    var selected: Set<Long> = emptySet()\n+\n \n     private fun recipientSigil(toMe: Boolean, ccMe: Boolean): String {\n         return if (toMe) {\n@@ -220,7 +222,7 @@ class MessageListAdapter internal constructor(\n         val maybeBoldTypeface = if (read) Typeface.NORMAL else Typeface.BOLD\n \n         val uniqueId = cursor.getLong(uniqueIdColumn)\n-        val selected = fragment.selected.contains(uniqueId)\n+        val selected = selected.contains(uniqueId)\n \n         holder.chip.setBackgroundColor(account.chipColor)\n         if (checkboxes) {\ndiff --git a/app/ui/src/main/java/com/fsck/k9/fragment/MessageListFragment.java b/app/ui/src/main/java/com/fsck/k9/fragment/MessageListFragment.java\nindex d4f19651b..d0b59c62f 100644\n--- a/app/ui/src/main/java/com/fsck/k9/fragment/MessageListFragment.java\n+++ b/app/ui/src/main/java/com/fsck/k9/fragment/MessageListFragment.java\n@@ -196,7 +196,7 @@ public class MessageListFragment extends Fragment implements OnItemClickListener\n     private boolean sortDateAscending = false;\n \n     private int selectedCount = 0;\n-    Set<Long> selected = new HashSet<>();\n+    private Set<Long> selected = new HashSet<>();\n     private ActionMode actionMode;\n     private Boolean hasConnectivity;\n     /**\n@@ -2595,6 +2595,8 @@ public class MessageListFragment extends Fragment implements OnItemClickListener\n         }\n \n         cleanupSelected(cursor);\n+        adapter.setSelected(selected);\n+\n         updateContextMenu(cursor);\n \n         adapter.swapCursor(cursor);",
    "Enabled crashlytics crash reporting": "diff --git a/actor-apps/app-ios/ActorApp.xcodeproj/project.pbxproj b/actor-apps/app-ios/ActorApp.xcodeproj/project.pbxproj\nindex 5599b6a20..c66130b82 100644\n--- a/actor-apps/app-ios/ActorApp.xcodeproj/project.pbxproj\n+++ b/actor-apps/app-ios/ActorApp.xcodeproj/project.pbxproj\n@@ -368,11 +368,11 @@\n \t\t1ACEA023B930E6F261DAC0A6BDB410C1 /* Supporting Files */ = {\n \t\t\tisa = PBXGroup;\n \t\t\tchildren = (\n-\t\t\t\t94EE37C03BC0B4DD1E82AE89A542A35B /* ActorApp-Bridging-Header.h */,\n \t\t\t\tDE8D1D9859D2C4D4C7EC7AD74BB65F0E /* Info.plist */,\n+\t\t\t\t94EE37C03BC0B4DD1E82AE89A542A35B /* ActorApp-Bridging-Header.h */,\n+\t\t\t\t148837AEB986AFDE519BEBD3686AB073 /* main.m */,\n \t\t\t\tF76A77E9428111C798E69B43EA06A281 /* ActorApp.entitlements */,\n \t\t\t\t897AD66A77219F6888322861BDA2CD14 /* app.json */,\n-\t\t\t\t148837AEB986AFDE519BEBD3686AB073 /* main.m */,\n \t\t\t);\n \t\t\tname = \"Supporting Files\";\n \t\t\tsourceTree = \"<group>\";\n@@ -824,6 +824,7 @@\n \t\t\t\t4533F91FE5E247335BA76B35E6FC28C1 /* Frameworks */,\n \t\t\t\tB094A1F03E91E4354C789DE8702D2FB4 /* Resources */,\n \t\t\t\t8A6D3D9BB256B05E9E66DD2FD43B13B0 /* Copy Pods Resources */,\n+\t\t\t\t06FC5E741BAB2DCC0071F153 /* ShellScript */,\n \t\t\t);\n \t\t\tbuildRules = (\n \t\t\t);\n@@ -919,6 +920,19 @@\n /* End PBXResourcesBuildPhase section */\n \n /* Begin PBXShellScriptBuildPhase section */\n+\t\t06FC5E741BAB2DCC0071F153 /* ShellScript */ = {\n+\t\t\tisa = PBXShellScriptBuildPhase;\n+\t\t\tbuildActionMask = 2147483647;\n+\t\t\tfiles = (\n+\t\t\t);\n+\t\t\tinputPaths = (\n+\t\t\t);\n+\t\t\toutputPaths = (\n+\t\t\t);\n+\t\t\trunOnlyForDeploymentPostprocessing = 0;\n+\t\t\tshellPath = /bin/sh;\n+\t\t\tshellScript = \"# Initialization of Crashlytics\\n\\n# Getting build secret\\nBUILD_SECRET=$FABRIC_BUILD_SECRET\\n\\n# Getting api key from Info.plist\\nAPI_KEY=$(/usr/libexec/PlistBuddy \\\"${PRODUCT_SETTINGS_PATH}\\\" -c \\\"Print :Fabric:APIKey\\\")\\n\\nif [ -n \\\"$BUILD_SECRET\\\" ]; then\\n    if [[ $? -ne 0 ]]; then\\n        echo \\\"Crashlytics not installed, skipping\\\"\\n    else\\n        if [ -n \\\"$API_KEY\\\" ]; then\\n            echo \\\"Uploading symbols to crashlytics\\\" \\\"$API_KEY\\\" \\\"$BUILD_SECRET\\\"\\n            \\\"${PODS_ROOT}/Fabric/Fabric.framework/run\\\" \\\"$API_KEY\\\" \\\"$BUILD_SECRET\\\"\\n        else\\n            echo \\\"Crashlytics not installed, skipping\\\"\\n        fi\\n    fi\\nelse\\n    echo \\\"Crashlytics build secret not set, skipping\\\"\\nfi\";\n+\t\t};\n \t\t8A6D3D9BB256B05E9E66DD2FD43B13B0 /* Copy Pods Resources */ = {\n \t\t\tisa = PBXShellScriptBuildPhase;\n \t\t\tbuildActionMask = 2147483647;\n@@ -1126,6 +1140,7 @@\n \t\t\t\tDEBUG_INFORMATION_FORMAT = \"dwarf-with-dsym\";\n \t\t\t\tEMBEDDED_CONTENT_CONTAINS_SWIFT = YES;\n \t\t\t\tENABLE_BITCODE = YES;\n+\t\t\t\tFABRIC_BUILD_SECRET = \"\";\n \t\t\t\tGCC_OPTIMIZATION_LEVEL = fast;\n \t\t\t\tINFOPLIST_FILE = \"ActorApp/Supporting Files/Info.plist\";\n \t\t\t\tIPHONEOS_DEPLOYMENT_TARGET = 7.1;\n@@ -1236,6 +1251,7 @@\n \t\t\t\t\"CODE_SIGN_IDENTITY[sdk=iphoneos*]\" = \"iPhone Developer\";\n \t\t\t\tEMBEDDED_CONTENT_CONTAINS_SWIFT = YES;\n \t\t\t\tENABLE_BITCODE = YES;\n+\t\t\t\tFABRIC_BUILD_SECRET = \"\";\n \t\t\t\tGCC_OPTIMIZATION_LEVEL = fast;\n \t\t\t\tINFOPLIST_FILE = \"ActorApp/Supporting Files/Info.plist\";\n \t\t\t\tIPHONEOS_DEPLOYMENT_TARGET = 7.1;\ndiff --git a/actor-apps/app-ios/ActorApp/AppDelegate.swift b/actor-apps/app-ios/ActorApp/AppDelegate.swift\nindex 898f23f78..ab472537b 100644\n--- a/actor-apps/app-ios/ActorApp/AppDelegate.swift\n+++ b/actor-apps/app-ios/ActorApp/AppDelegate.swift\n@@ -4,6 +4,9 @@\n \n import Foundation\n \n+import Fabric\n+import Crashlytics\n+\n @objc class AppDelegate : UIResponder,  UIApplicationDelegate {\n     \n     var window : UIWindow?\n@@ -20,11 +23,10 @@ import Foundation\n         createActor()\n         \n         // Apply crash logging\n-        // WARRING: Disabled because Mint doesn't support bitcode\n-        // if AppConfig.mint != nil {\n-        //    Mint.sharedInstance().disableNetworkMonitoring()\n-        //    Mint.sharedInstance().initAndStartSession(AppConfig.mint!)\n-        // }\n+        \n+        // Even when Fabric/Crashlytics not configured\n+        // this method doesn't crash\n+        Fabric.with([Crashlytics.self()])\n         \n         // Register hockey app\n         if AppConfig.hockeyapp != nil {\ndiff --git a/actor-apps/app-ios/ActorApp/Supporting Files/ActorApp-Bridging-Header.h b/actor-apps/app-ios/ActorApp/Supporting Files/ActorApp-Bridging-Header.h\nindex 0f47e77ec..415632fdd 100644\n--- a/actor-apps/app-ios/ActorApp/Supporting Files/ActorApp-Bridging-Header.h\t\n+++ b/actor-apps/app-ios/ActorApp/Supporting Files/ActorApp-Bridging-Header.h\t\n@@ -32,8 +32,6 @@\n #import <UIActionSheet+Blocks/UIActionSheet+Blocks.h>\n #import <UIAlertController+Blocks/UIAlertController+Blocks.h>\n \n-// WARRING: Disabled because Mint doesn't support bitcode\n-// #import <SplunkMint/SplunkMint.h>\n #import <HockeySDK/HockeySDK.h>\n #import <AddressBook/AddressBook.h>\n // #import <Mixpanel/Mixpanel.h>\ndiff --git a/actor-apps/app-ios/ActorApp/Supporting Files/Info.plist b/actor-apps/app-ios/ActorApp/Supporting Files/Info.plist\nindex 037595410..8e91dfffc 100644\n--- a/actor-apps/app-ios/ActorApp/Supporting Files/Info.plist\t\n+++ b/actor-apps/app-ios/ActorApp/Supporting Files/Info.plist\t\n@@ -37,8 +37,35 @@\n \t</array>\n \t<key>CFBundleVersion</key>\n \t<string>421</string>\n+\t<key>Fabric</key>\n+\t<dict>\n+\t\t<key>APIKey</key>\n+\t\t<string>ce660b7ca79e52417a0cf34681913cb71520098f</string>\n+\t\t<key>Kits</key>\n+\t\t<array>\n+\t\t\t<dict>\n+\t\t\t\t<key>KitInfo</key>\n+\t\t\t\t<dict/>\n+\t\t\t\t<key>KitName</key>\n+\t\t\t\t<string>Crashlytics</string>\n+\t\t\t</dict>\n+\t\t</array>\n+\t</dict>\n \t<key>LSRequiresIPhoneOS</key>\n \t<true/>\n+\t<key>NSAppTransportSecurity</key>\n+\t<dict>\n+\t\t<key>NSExceptionDomains</key>\n+\t\t<dict>\n+\t\t\t<key>s3.amazonaws.com</key>\n+\t\t\t<dict>\n+\t\t\t\t<key>NSExceptionRequiresForwardSecrecy</key>\n+\t\t\t\t<false/>\n+\t\t\t\t<key>NSIncludesSubdomains</key>\n+\t\t\t\t<true/>\n+\t\t\t</dict>\n+\t\t</dict>\n+\t</dict>\n \t<key>UIAppFonts</key>\n \t<array>\n \t\t<string>Roboto-Regular.ttf</string>\n@@ -81,18 +108,5 @@\n \t</array>\n \t<key>UIViewControllerBasedStatusBarAppearance</key>\n \t<false/>\n-\t<key>NSAppTransportSecurity</key>\n-\t<dict>\n-\t\t<key>NSExceptionDomains</key>\n-\t\t<dict>\n-\t\t\t<key>s3.amazonaws.com</key>\n-\t\t\t<dict>\n-\t\t\t\t<key>NSExceptionRequiresForwardSecrecy</key>\n-\t\t\t\t<false/>\n-\t\t\t\t<key>NSIncludesSubdomains</key>\n-\t\t\t\t<true/>\n-\t\t\t</dict>\n-\t\t</dict>\n-\t</dict>\n </dict>\n </plist>\ndiff --git a/actor-apps/app-ios/Podfile b/actor-apps/app-ios/Podfile\nindex d24137b0e..31d563a41 100644\n--- a/actor-apps/app-ios/Podfile\n+++ b/actor-apps/app-ios/Podfile\n@@ -35,5 +35,6 @@ target 'ActorApp' do\n \n     # Tracking\n     pod 'HockeySDK', '~> 3.8-RC'\n-    # pod 'SplunkMint'\n+    pod 'Fabric'\n+    pod 'Crashlytics'\n end",
    "Add predicates for matching files and directories": "diff --git a/servlet/src/main/java/io/undertow/servlet/predicate/DirectoryPredicate.java b/servlet/src/main/java/io/undertow/servlet/predicate/DirectoryPredicate.java\nnew file mode 100644\nindex 000000000..d7e9579d1\n--- /dev/null\n+++ b/servlet/src/main/java/io/undertow/servlet/predicate/DirectoryPredicate.java\n@@ -0,0 +1,106 @@\n+/*\n+ * JBoss, Home of Professional Open Source.\n+ * Copyright 2014 Red Hat, Inc., and individual contributors\n+ * as indicated by the @author tags.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *  Unless required by applicable law or agreed to in writing, software\n+ *  distributed under the License is distributed on an \"AS IS\" BASIS,\n+ *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ *  See the License for the specific language governing permissions and\n+ *  limitations under the License.\n+ */\n+\n+package io.undertow.servlet.predicate;\n+\n+import io.undertow.attribute.ExchangeAttribute;\n+import io.undertow.attribute.ExchangeAttributes;\n+import io.undertow.predicate.Predicate;\n+import io.undertow.predicate.PredicateBuilder;\n+import io.undertow.server.HttpServerExchange;\n+import io.undertow.server.handlers.resource.Resource;\n+import io.undertow.server.handlers.resource.ResourceManager;\n+import io.undertow.servlet.handlers.ServletRequestContext;\n+\n+import java.io.IOException;\n+import java.util.Collections;\n+import java.util.HashMap;\n+import java.util.Map;\n+import java.util.Set;\n+\n+/**\n+ * Predicate that returns true if the given location corresponds to a directory.\n+ *\n+ * @author Stuart Douglas\n+ */\n+public class DirectoryPredicate implements Predicate {\n+\n+    private final ExchangeAttribute location;\n+\n+    public DirectoryPredicate(final ExchangeAttribute location) {\n+        this.location = location;\n+    }\n+\n+    @Override\n+    public boolean resolve(final HttpServerExchange value) {\n+        String location = this.location.readAttribute(value);\n+        ServletRequestContext src = value.getAttachment(ServletRequestContext.ATTACHMENT_KEY);\n+        if(src == null) {\n+            return false;\n+        }\n+        ResourceManager manager = src.getDeployment().getDeploymentInfo().getResourceManager();\n+        if(manager == null) {\n+            return false;\n+        }\n+        try {\n+            Resource resource = manager.getResource(location);\n+            if(resource == null) {\n+                return false;\n+            }\n+            return resource.isDirectory();\n+        } catch (IOException e) {\n+            throw new RuntimeException(e);\n+        }\n+    }\n+\n+\n+    public static class Builder implements PredicateBuilder {\n+\n+        @Override\n+        public String name() {\n+            return \"directory\";\n+        }\n+\n+        @Override\n+        public Map<String, Class<?>> parameters() {\n+            final Map<String, Class<?>> params = new HashMap<>();\n+            params.put(\"value\", ExchangeAttribute.class);\n+            return params;\n+        }\n+\n+        @Override\n+        public Set<String> requiredParameters() {\n+            return Collections.emptySet();\n+        }\n+\n+        @Override\n+        public String defaultParameter() {\n+            return \"value\";\n+        }\n+\n+        @Override\n+        public Predicate build(final Map<String, Object> config) {\n+            ExchangeAttribute value = (ExchangeAttribute) config.get(\"value\");\n+            if(value == null) {\n+                value = ExchangeAttributes.relativePath();\n+            }\n+            return new DirectoryPredicate(value);\n+        }\n+    }\n+\n+}\ndiff --git a/servlet/src/main/java/io/undertow/servlet/predicate/FilePredicate.java b/servlet/src/main/java/io/undertow/servlet/predicate/FilePredicate.java\nnew file mode 100644\nindex 000000000..3f6d40e03\n--- /dev/null\n+++ b/servlet/src/main/java/io/undertow/servlet/predicate/FilePredicate.java\n@@ -0,0 +1,106 @@\n+/*\n+ * JBoss, Home of Professional Open Source.\n+ * Copyright 2014 Red Hat, Inc., and individual contributors\n+ * as indicated by the @author tags.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *  Unless required by applicable law or agreed to in writing, software\n+ *  distributed under the License is distributed on an \"AS IS\" BASIS,\n+ *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ *  See the License for the specific language governing permissions and\n+ *  limitations under the License.\n+ */\n+\n+package io.undertow.servlet.predicate;\n+\n+import io.undertow.attribute.ExchangeAttribute;\n+import io.undertow.attribute.ExchangeAttributes;\n+import io.undertow.predicate.Predicate;\n+import io.undertow.predicate.PredicateBuilder;\n+import io.undertow.server.HttpServerExchange;\n+import io.undertow.server.handlers.resource.Resource;\n+import io.undertow.server.handlers.resource.ResourceManager;\n+import io.undertow.servlet.handlers.ServletRequestContext;\n+\n+import java.io.IOException;\n+import java.util.Collections;\n+import java.util.HashMap;\n+import java.util.Map;\n+import java.util.Set;\n+\n+/**\n+ * Predicate that returns true if the given location corresponds to a regular file.\n+ *\n+ * @author Stuart Douglas\n+ */\n+public class FilePredicate implements Predicate {\n+\n+    private final ExchangeAttribute location;\n+\n+    public FilePredicate(final ExchangeAttribute location) {\n+        this.location = location;\n+    }\n+\n+    @Override\n+    public boolean resolve(final HttpServerExchange value) {\n+        String location = this.location.readAttribute(value);\n+        ServletRequestContext src = value.getAttachment(ServletRequestContext.ATTACHMENT_KEY);\n+        if(src == null) {\n+            return false;\n+        }\n+        ResourceManager manager = src.getDeployment().getDeploymentInfo().getResourceManager();\n+        if(manager == null) {\n+            return false;\n+        }\n+        try {\n+            Resource resource = manager.getResource(location);\n+            if(resource == null) {\n+                return false;\n+            }\n+            return !resource.isDirectory();\n+        } catch (IOException e) {\n+            throw new RuntimeException(e);\n+        }\n+    }\n+\n+\n+    public static class Builder implements PredicateBuilder {\n+\n+        @Override\n+        public String name() {\n+            return \"file\";\n+        }\n+\n+        @Override\n+        public Map<String, Class<?>> parameters() {\n+            final Map<String, Class<?>> params = new HashMap<>();\n+            params.put(\"value\", ExchangeAttribute.class);\n+            return params;\n+        }\n+\n+        @Override\n+        public Set<String> requiredParameters() {\n+            return Collections.emptySet();\n+        }\n+\n+        @Override\n+        public String defaultParameter() {\n+            return \"value\";\n+        }\n+\n+        @Override\n+        public Predicate build(final Map<String, Object> config) {\n+            ExchangeAttribute value = (ExchangeAttribute) config.get(\"value\");\n+            if(value == null) {\n+                value = ExchangeAttributes.relativePath();\n+            }\n+            return new FilePredicate(value);\n+        }\n+    }\n+\n+}\ndiff --git a/servlet/src/main/resources/META-INF/services/io.undertow.predicate.PredicateBuilder b/servlet/src/main/resources/META-INF/services/io.undertow.predicate.PredicateBuilder\nindex 219774de7..a7e987925 100644\n--- a/servlet/src/main/resources/META-INF/services/io.undertow.predicate.PredicateBuilder\n+++ b/servlet/src/main/resources/META-INF/services/io.undertow.predicate.PredicateBuilder\n@@ -1 +1,3 @@\n-io.undertow.servlet.predicate.DispatcherTypePredicate$Builder\n\\ No newline at end of file\n+io.undertow.servlet.predicate.DispatcherTypePredicate$Builder\n+io.undertow.servlet.predicate.DirectoryPredicate$Builder\n+io.undertow.servlet.predicate.FilePredicate$Builder\n\\ No newline at end of file",
    "added things to avoid .": "diff --git a/src/api/java/baritone/api/Settings.java b/src/api/java/baritone/api/Settings.java\nindex cd7bdabe..0037ba00 100644\n--- a/src/api/java/baritone/api/Settings.java\n+++ b/src/api/java/baritone/api/Settings.java\n@@ -172,7 +172,9 @@ public final class Settings {\n             Blocks.FURNACE,\n             Blocks.LIT_FURNACE,\n             Blocks.CHEST,\n-            Blocks.TRAPPED_CHEST\n+            Blocks.TRAPPED_CHEST,\n+       ",
    "Add compaction , fix Issue <issue_id>": "diff --git a/src/main/java/org/mapdb/DB.java b/src/main/java/org/mapdb/DB.java\nindex cfcff8d0..03408ed1 100644\n--- a/src/main/java/org/mapdb/DB.java\n+++ b/src/main/java/org/mapdb/DB.java\n@@ -350,10 +350,14 @@ public class DB {\n     }\n \n     /**\n-     * not yet implemented\n+     * Perform storage maintenance.\n+     * Typically compact underlying storage and reclaim unused space.\n+     * <p/>\n+     * NOTE: MapDB does not have smart defragmentation algorithms. So compaction usually recreates entire\n+     * store from scratch. This may require additional disk space.\n      */\n     synchronized public void compact(){\n-\n+        engine.compact();\n     }\n \n \ndiff --git a/src/main/java/org/mapdb/Engine.java b/src/main/java/org/mapdb/Engine.java\nindex bc3f8576..2de6dd0f 100644\n--- a/src/main/java/org/mapdb/Engine.java\n+++ b/src/main/java/org/mapdb/Engine.java\n@@ -182,4 +182,6 @@ public interface Engine {\n      * @return true if engine is read-only\n      */\n     boolean isReadOnly();\n+\n+    void compact();\n }\ndiff --git a/src/main/java/org/mapdb/EngineWrapper.java b/src/main/java/org/mapdb/EngineWrapper.java\nindex c879344b..ea3fd452 100644\n--- a/src/main/java/org/mapdb/EngineWrapper.java\n+++ b/src/main/java/org/mapdb/EngineWrapper.java\n@@ -29,7 +29,7 @@ import java.util.concurrent.ConcurrentLinkedQueue;\n  *\n  * @author Jan Kotek\n  */\n-public class EngineWrapper implements Engine{\n+public abstract class EngineWrapper implements Engine{\n \n     protected Engine engine;\n \n@@ -100,6 +100,11 @@ public class EngineWrapper implements Engine{\n         return engine.isReadOnly();\n     }\n \n+    @Override\n+    public void compact() {\n+        engine.compact();\n+    }\n+\n     /**\n      * Wraps an <code>Engine</code> and throws\n      * <code>UnsupportedOperationException(\"Read-only\")</code>\ndiff --git a/src/main/java/org/mapdb/Storage.java b/src/main/java/org/mapdb/Storage.java\nindex ace93581..4e2044a1 100644\n--- a/src/main/java/org/mapdb/Storage.java\n+++ b/src/main/java/org/mapdb/Storage.java\n@@ -17,8 +17,10 @@\n package org.mapdb;\n \n \n+import java.io.File;\n import java.io.IOError;\n import java.io.IOException;\n+import java.nio.ByteBuffer;\n import java.util.ArrayList;\n import java.util.concurrent.locks.ReentrantReadWriteLock;\n \n@@ -67,7 +69,7 @@ public abstract class Storage implements Engine {\n     public static final String DATA_FILE_EXT = \".p\";\n \n \n-    protected final ReentrantReadWriteLock lock = new ReentrantReadWriteLock();;\n+    protected final ReentrantReadWriteLock lock = new ReentrantReadWriteLock();\n \n     protected final boolean appendOnly;\n     protected final boolean deleteFilesOnExit;\n@@ -312,4 +314,70 @@ public abstract class Storage implements Engine {\n         }\n \n     }\n+\n+    @Override\n+    public void compact(){\n+        if(readOnly) throw new IllegalAccessError();\n+        if(index.getFile()==null) throw new UnsupportedOperationException(\"compact not supported for memory storage yet\");\n+        try{\n+            //create secondary files for compaction\n+            //TODO RAF\n+            //TODO memory based stores\n+            final File indexFile = index.getFile();\n+            final File physFile = phys.getFile();\n+            final File indexFile2 = new File(indexFile+\".compact\");\n+            final File physFile2 = new File(physFile+\".compact\");\n+            final boolean isRaf = index instanceof Volume.RandomAccessFile;\n+            Volume.Factory fab = Volume.fileFactory(false, isRaf, indexFile2);\n+            StorageDirect store2 = new StorageDirect(fab);\n+\n+            //transfer stack of free recids\n+            for(long recid =longStackTake(RECID_FREE_INDEX_SLOTS);\n+                recid!=0; recid=longStackTake(RECID_FREE_INDEX_SLOTS)){\n+                store2.longStackPut(recid, RECID_FREE_INDEX_SLOTS);\n+            }\n+\n+            //iterate over recids and transfer physical records\n+            final long indexSize = index.getLong(RECID_CURRENT_INDEX_FILE_SIZE*8)/8;\n+            store2.lock.writeLock().lock();\n+            for(long recid = INDEX_OFFSET_START; recid<indexSize;recid++){\n+                //read data from first store\n+                long physOffset = index.getLong(recid*8);\n+                long physSize = physOffset >>> 48;\n+                //TODO linked records larger then 64KB\n+                physOffset = physOffset & PHYS_OFFSET_MASK;\n+                DataInput2 in = phys.getDataInput(physOffset, (int)physSize);\n+\n+                //get free place in second store, and write data there\n+                long physOffset2 = store2.freePhysRecTake((int)physSize) & PHYS_OFFSET_MASK;\n+\n+                store2.phys.ensureAvailable((physOffset2 & PHYS_OFFSET_MASK)+physSize);\n+                synchronized (in.buf){\n+                    //copy directly from buffer\n+                    in.buf.position(in.pos);\n+                    store2.phys.putData(physOffset2, in.buf, (int)physSize);\n+                }\n+                //write index value into second storage\n+                store2.index.ensureAvailable(recid*8+8);\n+                store2.index.putLong(recid*8, (physSize<<48)|physOffset2);\n+            }\n+            store2.lock.writeLock().unlock();\n+            store2.close();\n+\n+            index.close();\n+            phys.close();\n+\n+            indexFile2.renameTo(indexFile);\n+            //TODO process may fail in middle of rename, analyze sequence and add recovery\n+            physFile2.renameTo(physFile);\n+\n+            Volume.Factory fac2 = Volume.fileFactory(false, isRaf, indexFile);\n+            index = fac2.createIndexVolume();\n+            phys = fac2.createPhysVolume();\n+\n+        }catch(IOException e){\n+            throw new IOError(e);\n+        }\n+    }\n+\n }\ndiff --git a/src/main/java/org/mapdb/StorageJournaled.java b/src/main/java/org/mapdb/StorageJournaled.java\nindex a371cab7..9738b18d 100644\n--- a/src/main/java/org/mapdb/StorageJournaled.java\n+++ b/src/main/java/org/mapdb/StorageJournaled.java\n@@ -514,6 +514,18 @@ public class StorageJournaled extends Storage implements Engine {\n \n     }\n \n+    @Override\n+    public void compact() {\n+        lock.writeLock().lock();\n+        try{\n+            if(transLog!=null && !transLog.isEmpty())\n+                throw new IllegalAccessError(\"Journal not empty; commit first, than compact\");\n+            super.compact();\n+        }finally {\n+            lock.writeLock().unlock();\n+        }\n+    }\n+\n \n     private long[] getLongStackPage(final long physOffset, boolean read){\n         long[] buf = longStackPages.get(physOffset);\ndiff --git a/src/main/java/org/mapdb/Volume.java b/src/main/java/org/mapdb/Volume.java\nindex c762a2b2..832d9c6b 100644\n--- a/src/main/java/org/mapdb/Volume.java\n+++ b/src/main/java/org/mapdb/Volume.java\n@@ -83,6 +83,8 @@ public abstract class Volume {\n         putByte(offset, (byte)(b & 0xff));\n     }\n \n+    /** returns underlying file if it exists */\n+    abstract public File getFile();\n \n \n     /**\n@@ -383,6 +385,11 @@ public abstract class Volume {\n             file.delete();\n         }\n \n+        @Override\n+        public File getFile() {\n+            return file;\n+        }\n+\n         @Override\n         protected java.nio.ByteBuffer makeNewBuffer(long offset) {\n             try {\n@@ -448,6 +455,11 @@ public abstract class Volume {\n         @Override public void sync() {}\n \n         @Override public void deleteFile() {}\n+\n+        @Override\n+        public File getFile() {\n+            return null;\n+        }\n     }\n \n \n@@ -611,6 +623,11 @@ public abstract class Volume {\n         public boolean isSliced(){\n             return false;\n         }\n+\n+        @Override\n+        public File getFile() {\n+            return file;\n+        }\n     }\n \n \ndiff --git a/src/test/java/org/mapdb/DebugVolume.java b/src/test/java/org/mapdb/DebugVolume.java\nindex 8354a385..6f672ebe 100644\n--- a/src/test/java/org/mapdb/DebugVolume.java\n+++ b/src/test/java/org/mapdb/DebugVolume.java\n@@ -1,5 +1,6 @@\n package org.mapdb;\n \n+import java.io.File;\n import java.io.IOError;\n import java.io.IOException;\n import java.io.PrintStream;\n@@ -110,4 +111,9 @@ public class DebugVolume extends Volume{\n         out.println(\"isSliced\");\n         return vol.isSliced();\n     }\n+\n+    @Override\n+    public File getFile() {\n+        return vol.getFile();\n+    }\n }\ndiff --git a/src/test/java/org/mapdb/LoggerVolume.java b/src/test/java/org/mapdb/LoggerVolume.java\nindex 289f5e37..a8a850af 100644\n--- a/src/test/java/org/mapdb/LoggerVolume.java\n+++ b/src/test/java/org/mapdb/LoggerVolume.java\n@@ -1,6 +1,7 @@\n package org.mapdb;\n \n import java.io.ByteArrayOutputStream;\n+import java.io.File;\n import java.io.PrintStream;\n \n \n@@ -160,4 +161,9 @@ public class LoggerVolume extends Volume{\n     public boolean isSliced() {\n         return logged.isSliced();\n     }\n+\n+    @Override\n+    public File getFile() {\n+        return logged.getFile();\n+    }\n }\ndiff --git a/src/test/java/org/mapdb/StorageDirectRAFTest.java b/src/test/java/org/mapdb/StorageDirectRAFTest.java\nnew file mode 100644\nindex 00000000..531f2346\n--- /dev/null\n+++ b/src/test/java/org/mapdb/StorageDirectRAFTest.java\n@@ -0,0 +1,8 @@\n+package org.mapdb;\n+\n+public class StorageDirectRAFTest extends StorageDirectTest{\n+\n+    {\n+        fac = Volume.fileFactory(false,true, index);\n+    }\n+}\ndiff --git a/src/test/java/org/mapdb/StorageDirectTest.java b/src/test/java/org/mapdb/StorageDirectTest.java\nindex 4afadcef..eb5f21bd 100644\n--- a/src/test/java/org/mapdb/StorageDirectTest.java\n+++ b/src/test/java/org/mapdb/StorageDirectTest.java\n@@ -343,5 +343,24 @@ public class StorageDirectTest extends StorageTestCase {\n \n     }\n \n+    @Test public void compact(){\n+        Map<Long,Long> recids = new HashMap<Long, Long>();\n+        for(Long l=0L;l<1000;l++){\n+            recids.put(l,\n+                    engine.put(l, Serializer.LONG_SERIALIZER));\n+        }\n+\n+        engine.commit();\n+        engine.compact();\n+\n+        for(Map.Entry<Long,Long> e:recids.entrySet()){\n+            Long recid= e.getValue();\n+            Long value = e.getKey();\n+            assertEquals(value, engine.get(recid, Serializer.LONG_SERIALIZER));\n+        }\n+\n+\n+    }\n+\n \n }\ndiff --git a/src/test/java/org/mapdb/TestFile.java b/src/test/java/org/mapdb/TestFile.java\nindex 23a42479..f0892c5e 100644\n--- a/src/test/java/org/mapdb/TestFile.java\n+++ b/src/test/java/org/mapdb/TestFile.java\n@@ -14,7 +14,7 @@ abstract public class TestFile {\n     protected final File data = new File(index.getPath()+ Storage.DATA_FILE_EXT);\n     protected final File log = new File(index.getPath()+ StorageJournaled.TRANS_LOG_FILE_EXT);\n \n-    protected final Volume.Factory fac = Volume.fileFactory(false, false, index, data, log);\n+    protected Volume.Factory fac = Volume.fileFactory(false, false, index, data, log);\n \n \n     @After public void after() throws IOException {",
    "Fix a few flaky test , add more timeout waiting for replication to finish": "diff --git a/src/test/java/com/zendesk/maxwell/MaxwellTestSupport.java b/src/test/java/com/zendesk/maxwell/MaxwellTestSupport.java\nindex dc1a7a30..9c86055a 100644\n--- a/src/test/java/com/zendesk/maxwell/MaxwellTestSupport.java\n+++ b/src/test/java/com/zendesk/maxwell/MaxwellTestSupport.java\n@@ -189,7 +189,7 @@ public class MaxwellTestSupport {\n \t\tBinlogPosition finalPosition = capture(mysql.getConnection());\n \t\tLOGGER.debug(\"running replicator up to \" + finalPosition);\n \n-\t\tLong pollTime = 1000L;\n+\t\tLong pollTime = 2000L;\n \t\tBinlogPosition lastPositionRead = null;\n \n \t\tfor ( ;; ) {\ndiff --git a/src/test/java/com/zendesk/maxwell/recovery/RecoveryTest.java b/src/test/java/com/zendesk/maxwell/recovery/RecoveryTest.java\nindex 0c719cd8..fd39a89b 100644\n--- a/src/test/java/com/zendesk/maxwell/recovery/RecoveryTest.java\n+++ b/src/test/java/com/zendesk/maxwell/recovery/RecoveryTest.java\n@@ -111,7 +111,7 @@ public class RecoveryTest extends TestWithNameLogging {\n \n \t\tif ( slavePosition.getFile().equals(recoveredPosition.getFile()) )\t{\n \t\t\tlong positionDiff = recoveredPosition.getOffset() - slavePosition.getOffset();\n-\t\t\tassertThat(Math.abs(positionDiff), lessThan(1000L));\n+\t\t\tassertThat(Math.abs(positionDiff), lessThan(1500L));\n \t\t} else {\n \t\t\t// TODO: something something.\n \t\t}\n@@ -268,6 +268,12 @@ public class RecoveryTest extends TestWithNameLogging {\n \t\tString[] input = generateMasterData();\n \t\t// Have maxwell connect to master first\n \t\tList<RowMap> rows = MaxwellTestSupport.getRowsWithReplicator(masterServer, null, input, null);\n+\t\ttry {\n+\t\t\t// sleep a bit for slave to catch up\n+\t\t\tThread.sleep(1000);\n+\t\t} catch (InterruptedException ex) {\n+\t\t\tLOGGER.info(\"Got ex: \" + ex);\n+\t\t}\n \n \t\tBinlogPosition slavePosition1 = MaxwellTestSupport.capture(slaveServer.getConnection());\n \t\tLOGGER.info(\"slave master position at time of cut: \" + slavePosition1 + \" rows: \" + rows.size());",
    "prepare release druid - 0 . 5 . 57": "diff --git a/client/pom.xml b/client/pom.xml\nindex 7519f24cbb..5749946f0c 100644\n--- a/client/pom.xml\n+++ b/client/pom.xml\n@@ -28,7 +28,7 @@\n     <parent>\n         <groupId>com.metamx</groupId>\n         <artifactId>druid</artifactId>\n-        <version>0.5.57-SNAPSHOT</version>\n+        <version>0.5.57</version>\n     </parent>\n \n     <dependencies>\ndiff --git a/common/pom.xml b/common/pom.xml\nindex 7387bbcf82..02f625eacf 100644\n--- a/common/pom.xml\n+++ b/common/pom.xml\n@@ -28,7 +28,7 @@\n     <parent>\n         <groupId>com.metamx</groupId>\n         <artifactId>druid</artifactId>\n-        <version>0.5.57-SNAPSHOT</version>\n+        <version>0.5.57</version>\n     </parent>\n \n     <dependencies>\ndiff --git a/examples/pom.xml b/examples/pom.xml\nindex 5d8957f919..063050b168 100644\n--- a/examples/pom.xml\n+++ b/examples/pom.xml\n@@ -9,7 +9,7 @@\n     <parent>\n         <groupId>com.metamx</groupId>\n         <artifactId>druid</artifactId>\n-        <version>0.5.57-SNAPSHOT</version>\n+        <version>0.5.57</version>\n     </parent>\n \n     <dependencies>\ndiff --git a/indexing-common/pom.xml b/indexing-common/pom.xml\nindex 7d6202f2a5..2f56d6a803 100644\n--- a/indexing-common/pom.xml\n+++ b/indexing-common/pom.xml\n@@ -28,7 +28,7 @@\n     <parent>\n         <groupId>com.metamx</groupId>\n         <artifactId>druid</artifactId>\n-        <version>0.5.57-SNAPSHOT</version>\n+        <version>0.5.57</version>\n     </parent>\n \n     <dependencies>\ndiff --git a/indexing-hadoop/pom.xml b/indexing-hadoop/pom.xml\nindex 94210a00cf..f7a24561e0 100644\n--- a/indexing-hadoop/pom.xml\n+++ b/indexing-hadoop/pom.xml\n@@ -28,7 +28,7 @@\n     <parent>\n         <groupId>com.metamx</groupId>\n         <artifactId>druid</artifactId>\n-        <version>0.5.57-SNAPSHOT</version>\n+        <version>0.5.57</version>\n     </parent>\n \n     <dependencies>\ndiff --git a/indexing-service/pom.xml b/indexing-service/pom.xml\nindex b302ee4c94..0260468c55 100644\n--- a/indexing-service/pom.xml\n+++ b/indexing-service/pom.xml\n@@ -28,7 +28,7 @@\n     <parent>\n         <groupId>com.metamx</groupId>\n         <artifactId>druid</artifactId>\n-        <version>0.5.57-SNAPSHOT</version>\n+        <version>0.5.57</version>\n     </parent>\n \n     <dependencies>\ndiff --git a/pom.xml b/pom.xml\nindex f43fd3a0f2..807d8c7269 100644\n--- a/pom.xml\n+++ b/pom.xml\n@@ -23,7 +23,7 @@\n     <groupId>com.metamx</groupId>\n     <artifactId>druid</artifactId>\n     <packaging>pom</packaging>\n-    <version>0.5.57-SNAPSHOT</version>\n+    <version>0.5.57</version>\n     <name>druid</name>\n     <description>druid</description>\n     <scm>\ndiff --git a/realtime/pom.xml b/realtime/pom.xml\nindex ba81e5cb64..9ce25f19db 100644\n--- a/realtime/pom.xml\n+++ b/realtime/pom.xml\n@@ -28,7 +28,7 @@\n     <parent>\n         <groupId>com.metamx</groupId>\n         <artifactId>druid</artifactId>\n-        <version>0.5.57-SNAPSHOT</version>\n+        <version>0.5.57</version>\n     </parent>\n \n     <dependencies>\ndiff --git a/server/pom.xml b/server/pom.xml\nindex 186186e79e..5045c42502 100644\n--- a/server/pom.xml\n+++ b/server/pom.xml\n@@ -28,7 +28,7 @@\n     <parent>\n         <groupId>com.metamx</groupId>\n         <artifactId>druid</artifactId>\n-        <version>0.5.57-SNAPSHOT</version>\n+        <version>0.5.57</version>\n     </parent>\n \n     <dependencies>\ndiff --git a/services/pom.xml b/services/pom.xml\nindex fe97dbaa07..54c39ff2fe 100644\n--- a/services/pom.xml\n+++ b/services/pom.xml\n@@ -24,11 +24,11 @@\n     <artifactId>druid-services</artifactId>\n     <name>druid-services</name>\n     <description>druid-services</description>\n-    <version>0.5.57-SNAPSHOT</version>\n+    <version>0.5.57</version>\n     <parent>\n         <groupId>com.metamx</groupId>\n         <artifactId>druid</artifactId>\n-        <version>0.5.57-SNAPSHOT</version>\n+        <version>0.5.57</version>\n     </parent>\n \n     <dependencies>",
    "Added missing guards . . Keeping track of callers is only needed with the new strategy .": "diff --git a/compiler/src/org.graalvm.compiler.truffle.runtime/src/org/graalvm/compiler/truffle/runtime/OptimizedDirectCallNode.java b/compiler/src/org.graalvm.compiler.truffle.runtime/src/org/graalvm/compiler/truffle/runtime/OptimizedDirectCallNode.java\nindex 9ec65299b70..95fa3733dd9 100644\n--- a/compiler/src/org.graalvm.compiler.truffle.runtime/src/org/graalvm/compiler/truffle/runtime/OptimizedDirectCallNode.java\n+++ b/compiler/src/org.graalvm.compiler.truffle.runtime/src/org/graalvm/compiler/truffle/runtime/OptimizedDirectCallNode.java\n@@ -33,6 +33,9 @@ import com.oracle.truffle.api.nodes.Node;\n import com.oracle.truffle.api.nodes.NodeInfo;\n import com.oracle.truffle.api.nodes.RootNode;\n import com.oracle.truffle.api.profiles.ValueProfile;\n+import org.graalvm.compiler.truffle.common.TruffleCompilerOptions;\n+\n+import static org.graalvm.compiler.truffle.common.TruffleCompilerOptions.TruffleUsePollutionBasedSplittingStrategy;\n \n /**\n  * A call node with a constant {@link CallTarget} that can be optimized by Graal.\n@@ -164,10 +167,14 @@ public final class OptimizedDirectCallNode extends DirectCallNode {\n \n             if (callCount >= 1) {\n                 currentTarget.decrementKnownCallSites();\n-                currentTarget.removeKnownCallSite(this);\n+                if (TruffleCompilerOptions.getValue(TruffleUsePollutionBasedSplittingStrategy)) {\n+                    currentTarget.removeKnownCallSite(this);\n+                }\n             }\n             splitTarget.incrementKnownCallSites();\n-            splitTarget.addKnownCallNode(this);\n+            if (TruffleCompilerOptions.getValue(TruffleUsePollutionBasedSplittingStrategy)) {\n+                splitTarget.addKnownCallNode(this);\n+            }\n \n             if (getParent() != null) {\n                 // dummy replace to report the split, irrelevant if this node is not adopted",
    "Skip DeadEvent objects in ClusterEventService": "diff --git a/graylog2-server/src/main/java/org/graylog2/events/ClusterEventService.java b/graylog2-server/src/main/java/org/graylog2/events/ClusterEventService.java\nindex 3e6d7f5f1c..0cbad6b6a7 100644\n--- a/graylog2-server/src/main/java/org/graylog2/events/ClusterEventService.java\n+++ b/graylog2-server/src/main/java/org/graylog2/events/ClusterEventService.java\n@@ -19,6 +19,7 @@ package org.graylog2.events;\n import com.fasterxml.jackson.core.type.TypeReference;\n import com.fasterxml.jackson.databind.ObjectMapper;\n import com.google.common.annotations.VisibleForTesting;\n+import com.google.common.eventbus.DeadEvent;\n import com.google.common.eventbus.EventBus;\n import com.google.common.eventbus.Subscribe;\n import com.google.common.util.concurrent.AbstractExecutionThreadService;\n@@ -181,6 +182,11 @@ public class ClusterEventService extends AbstractExecutionThreadService {\n \n     @Subscribe\n     public void publishClusterEvent(Object event) {\n+        if(event instanceof DeadEvent) {\n+            LOG.debug(\"Skipping DeadEvent on cluster event bus\");\n+            return;\n+        }\n+\n         final String className = event.getClass().getCanonicalName();\n         final ClusterEvent clusterEvent = ClusterEvent.create(nodeId.toString(), className, event);\n         final String id = dbCollection.save(clusterEvent).getSavedId();\ndiff --git a/graylog2-server/src/test/java/org/graylog2/events/ClusterEventServiceTest.java b/graylog2-server/src/test/java/org/graylog2/events/ClusterEventServiceTest.java\nindex cd1b0abbca..3fd22b6a86 100644\n--- a/graylog2-server/src/test/java/org/graylog2/events/ClusterEventServiceTest.java\n+++ b/graylog2-server/src/test/java/org/graylog2/events/ClusterEventServiceTest.java\n@@ -24,6 +24,7 @@ import com.fasterxml.jackson.databind.module.SimpleModule;\n import com.fasterxml.jackson.datatype.guava.GuavaModule;\n import com.fasterxml.jackson.datatype.joda.JodaModule;\n import com.google.common.collect.ImmutableMap;\n+import com.google.common.eventbus.DeadEvent;\n import com.google.common.eventbus.EventBus;\n import com.google.common.util.concurrent.Service;\n import com.google.common.util.concurrent.ServiceManager;\n@@ -220,6 +221,20 @@ public class ClusterEventServiceTest {\n         assertThat(payload).containsEntry(\"payload\", \"test\");\n     }\n \n+    @Test\n+    @UsingDataSet(loadStrategy = LoadStrategyEnum.DELETE_ALL)\n+    public void publishClusterEventSkipsDeadEvent() throws Exception {\n+        DBCollection collection = mongoConnection.getDatabase().getCollection(ClusterEventService.COLLECTION_NAME);\n+        DeadEvent event = new DeadEvent(clusterEventBus, new SimpleEvent(\"test\"));\n+\n+        assertThat(collection.count()).isEqualTo(0L);\n+\n+        clusterEventService.publishClusterEvent(event);\n+\n+        verify(clusterEventBus, never()).post(any());\n+        assertThat(collection.count()).isEqualTo(0L);\n+    }\n+\n     @Test\n     public void prepareCollectionCreatesIndexesOnExistingCollection() throws Exception {\n         DBCollection original = mongoConnection.getDatabase().createCollection(ClusterEventService.COLLECTION_NAME, null);",
    "add a potential fix for wrong error positions ( commented out )": "diff --git a/languagetool-wikipedia/src/main/java/org/languagetool/dev/wikipedia/TextConverter.java b/languagetool-wikipedia/src/main/java/org/languagetool/dev/wikipedia/TextConverter.java\nindex d34270a005..8d0af2747e 100644\n--- a/languagetool-wikipedia/src/main/java/org/languagetool/dev/wikipedia/TextConverter.java\n+++ b/languagetool-wikipedia/src/main/java/org/languagetool/dev/wikipedia/TextConverter.java\n@@ -226,6 +226,11 @@ public class TextConverter extends Visitor {\n         throw new RuntimeException(\"Error getting content of external link \" + link, e);\n       }\n     }\n+    \n+    // TODO: sometimes this seems to fix the error position, but we'd need to find out under which circumstances:\n+    //String url = link.getTarget().getProtocol() + \":\" + link.getTarget().getPath();\n+    //int correction = url.length();\n+    //addMapping(link, correction);\n     addMapping(link);\n     write(out.toString());\n   }\n@@ -365,10 +370,15 @@ public class TextConverter extends Visitor {\n   }\n \n   private void addMapping(Locatable loc) {\n+    addMapping(loc, 0);\n+  }\n+\n+  private void addMapping(Locatable loc, int columnCorrection) {\n     String contentSoFar = sb.toString() + line;\n     int textPos = contentSoFar.length() + needNewlines + 1;\n     if (loc.hasLocation()) {\n-      mapping.put(textPos, loc.getLocation());\n+      Location location = loc.getLocation();\n+      mapping.put(textPos, new Location(location.file, location.line, location.column + columnCorrection));\n       //System.out.println(\"PUT \" + textPos + \" -> \" + loc.getLocation());\n     }\n   }",
    "Parse test target for jitaas flag .": "diff --git a/buildenv/jenkins/common/pipeline-functions b/buildenv/jenkins/common/pipeline-functions\nindex ff9fe8c1e..ce2264a90 100644\n--- a/buildenv/jenkins/common/pipeline-functions\n+++ b/buildenv/jenkins/common/pipeline-functions\n@@ -155,7 +155,7 @@ def build(BUILD_JOB_NAME, OPENJDK_REPO, OPENJDK_BRANCH, OPENJDK_SHA, OPENJ9_REPO\n     }\n }\n \n-def build_with_one_upstream(JOB_NAME, UPSTREAM_JOB_NAME, UPSTREAM_JOB_NUMBER, VARIABLE_FILE, VENDOR_REPO, VENDOR_BRANCH, VENDOR_CREDENTIALS_ID, NODE, OPENJ9_REPO, OPENJ9_BRANCH, OPENJ9_SHA, VENDOR_TEST_REPOS, VENDOR_TEST_BRANCHES, VENDOR_TEST_SHAS, VENDOR_TEST_DIRS, USER_CREDENTIALS_ID, BUILD_LIST) {\n+def build_with_one_upstream(JOB_NAME, UPSTREAM_JOB_NAME, UPSTREAM_JOB_NUMBER, VARIABLE_FILE, VENDOR_REPO, VENDOR_BRANCH, VENDOR_CREDENTIALS_ID, NODE, OPENJ9_REPO, OPENJ9_BRANCH, OPENJ9_SHA, VENDOR_TEST_REPOS, VENDOR_TEST_BRANCHES, VENDOR_TEST_SHAS, VENDOR_TEST_DIRS, USER_CREDENTIALS_ID, BUILD_LIST, TEST_FLAG) {\n     stage (\"${JOB_NAME}\") {\n         return build_with_slack(JOB_NAME,\n             [string(name: 'UPSTREAM_JOB_NAME', value: UPSTREAM_JOB_NAME),\n@@ -173,12 +173,13 @@ def build_with_one_upstream(JOB_NAME, UPSTREAM_JOB_NAME, UPSTREAM_JOB_NUMBER, VA\n             string(name: 'VENDOR_TEST_SHAS', value: VENDOR_TEST_SHAS),\n             string(name: 'VENDOR_TEST_DIRS', value: VENDOR_TEST_DIRS),\n             string(name: 'USER_CREDENTIALS_ID', value: USER_CREDENTIALS_ID),\n-            string(name: 'BUILD_LIST', value: BUILD_LIST)])\n+            string(name: 'BUILD_LIST', value: BUILD_LIST),\n+            string(name: 'TEST_FLAG', value: TEST_FLAG)])\n \n     }\n }\n \n-def build_with_artifactory(JOB_NAME, VARIABLE_FILE, VENDOR_REPO, VENDOR_BRANCH, VENDOR_CREDENTIALS_ID, NODE, OPENJ9_REPO, OPENJ9_BRANCH, OPENJ9_SHA, VENDOR_TEST_REPOS, VENDOR_TEST_BRANCHES, VENDOR_TEST_SHAS, VENDOR_TEST_DIRS, USER_CREDENTIALS_ID, BUILD_LIST, CUSTOMIZED_SDK_URL, ARTIFACTORY_CREDS) {\n+def build_with_artifactory(JOB_NAME, VARIABLE_FILE, VENDOR_REPO, VENDOR_BRANCH, VENDOR_CREDENTIALS_ID, NODE, OPENJ9_REPO, OPENJ9_BRANCH, OPENJ9_SHA, VENDOR_TEST_REPOS, VENDOR_TEST_BRANCHES, VENDOR_TEST_SHAS, VENDOR_TEST_DIRS, USER_CREDENTIALS_ID, BUILD_LIST, CUSTOMIZED_SDK_URL, ARTIFACTORY_CREDS, TEST_FLAG) {\n     stage (\"${JOB_NAME}\") {\n         return build_with_slack(JOB_NAME,\n             [string(name: 'VARIABLE_FILE', value: VARIABLE_FILE),\n@@ -196,7 +197,8 @@ def build_with_artifactory(JOB_NAME, VARIABLE_FILE, VENDOR_REPO, VENDOR_BRANCH,\n             string(name: 'USER_CREDENTIALS_ID', value: USER_CREDENTIALS_ID),\n             string(name: 'BUILD_LIST', value: BUILD_LIST),\n             string(name: 'CUSTOMIZED_SDK_URL', value: CUSTOMIZED_SDK_URL),\n-            string(name: 'CUSTOMIZED_SDK_URL_CREDENTIAL_ID', value: ARTIFACTORY_CREDS)])\n+            string(name: 'CUSTOMIZED_SDK_URL_CREDENTIAL_ID', value: ARTIFACTORY_CREDS),\n+            string(name: 'TEST_FLAG', value: TEST_FLAG)])\n     }\n }\n \n@@ -278,12 +280,17 @@ def workflow(SDK_VERSION, SPEC, SHAS, OPENJDK_REPO, OPENJDK_BRANCH, OPENJ9_REPO,\n             echo \"Using ARTIFACTORY_CREDS:'${ARTIFACTORY_CREDS}'\"\n         }\n         for (name in TARGET_NAMES) {\n+            def TEST_FLAG\n+            if (name.contains('+jitaas')) {\n+                name -= '+jitaas'\n+                TEST_FLAG = 'JITAAS'\n+            }\n             def TEST_JOB_NAME = \"Test-${name}-JDK${SDK_VERSION}-${SPEC}\"\n             testjobs[\"${TEST_JOB_NAME}\"] = {\n                 if (ARTIFACTORY_CREDS) {\n-                    jobs[\"${TEST_JOB_NAME}\"] = build_with_artifactory(TEST_JOB_NAME, params.VARIABLE_FILE, params.VENDOR_REPO, params.VENDOR_BRANCH, params.VENDOR_CREDENTIALS_ID, params.TEST_NODE, OPENJ9_REPO, OPENJ9_BRANCH, SHAS['OPENJ9'], VENDOR_TEST_REPOS, VENDOR_TEST_BRANCHES, VENDOR_TEST_SHAS, VENDOR_TEST_DIRS, USER_CREDENTIALS_ID, BUILD_LIST, CUSTOMIZED_SDK_URL, ARTIFACTORY_CREDS)\n+                    jobs[\"${TEST_JOB_NAME}\"] = build_with_artifactory(TEST_JOB_NAME, params.VARIABLE_FILE, params.VENDOR_REPO, params.VENDOR_BRANCH, params.VENDOR_CREDENTIALS_ID, params.TEST_NODE, OPENJ9_REPO, OPENJ9_BRANCH, SHAS['OPENJ9'], VENDOR_TEST_REPOS, VENDOR_TEST_BRANCHES, VENDOR_TEST_SHAS, VENDOR_TEST_DIRS, USER_CREDENTIALS_ID, BUILD_LIST, CUSTOMIZED_SDK_URL, ARTIFACTORY_CREDS, TEST_FLAG)\n                 } else {\n-                    jobs[\"${TEST_JOB_NAME}\"] = build_with_one_upstream(TEST_JOB_NAME, BUILD_JOB_NAME, jobs[\"build\"].getNumber(), params.VARIABLE_FILE, params.VENDOR_REPO, params.VENDOR_BRANCH, params.VENDOR_CREDENTIALS_ID, params.TEST_NODE, OPENJ9_REPO, OPENJ9_BRANCH, SHAS['OPENJ9'], VENDOR_TEST_REPOS, VENDOR_TEST_BRANCHES, VENDOR_TEST_SHAS, VENDOR_TEST_DIRS, USER_CREDENTIALS_ID, BUILD_LIST)\n+                    jobs[\"${TEST_JOB_NAME}\"] = build_with_one_upstream(TEST_JOB_NAME, BUILD_JOB_NAME, jobs[\"build\"].getNumber(), params.VARIABLE_FILE, params.VENDOR_REPO, params.VENDOR_BRANCH, params.VENDOR_CREDENTIALS_ID, params.TEST_NODE, OPENJ9_REPO, OPENJ9_BRANCH, SHAS['OPENJ9'], VENDOR_TEST_REPOS, VENDOR_TEST_BRANCHES, VENDOR_TEST_SHAS, VENDOR_TEST_DIRS, USER_CREDENTIALS_ID, BUILD_LIST, TEST_FLAG)\n                 }\n                 echo \"JOB: ${TEST_JOB_NAME} PASSED in: ${jobs[TEST_JOB_NAME].getDurationString()}\"\n             }",
    "implemented response time measurement / assert , which closes <issue_id>": "diff --git a/README.md b/README.md\nindex 6eaf699e9..6c11ec87e 100755\n--- a/README.md\n+++ b/README.md\n@@ -48,8 +48,8 @@ And you don't need to create Java objects (or POJO-s) for any of the payloads th\n **Secondary HTTP Keywords** | [`param`](#param) | [`header`](#header) | [`cookie`](#cookie)\n  | [`form field`](#form-field) | [`multipart field`](#multipart-field) | [`multipart entity`](#multipart-entity)\n **Set, Match, Assert** | [`set`](#set) | [`match`](#match) | [`contains`](#match-contains) | [Ignore / Vallidate](#ignore-or-validate)\n-**Special Variables** | [`headers`](#headers) | [`response`](#response) | [`cookies`](#cookies)\n- | [`responseHeaders`](#responseheaders) | [`responseStatus`](#responsestatus) | [`read`](#read)\n+**Special Variables** | [`headers`](#headers) | [`response`](#response) | [`cookies`](#cookies) | [`read`](#read)\n+ | [`responseHeaders`](#responseheaders) | [`responseStatus`](#responsestatus) | [`responseTime`](#responsetime)\n  **Reusable Functions** | [`call`](#call) | [`karate` object](#the-karate-object)\n  **Tips and Tricks** | [Embedded Expressions](#embedded-expressions) | [GraphQL RegEx Example](#graphql--regex-replacement-example) | [Multi-line Comments](#multi-line-comments) | [Cucumber Tags](#cucumber-tags)\n  | [Data Driven Tests](#advanced-bdd) | [Auth and Headers](#sign-in-example)\n@@ -1092,6 +1092,15 @@ the HTTP response code in an expression or save it for later, you can get it as\n ```cucumber\n * def uploadStatusCode = responseStatus\n ```\n+### `responseTime`\n+The response time (in milliseconds) for every HTTP request would be available in a variable called\n+`responseTime`. You can use this to assert that the response was returned within the expected time\n+like so:\n+```cucumber\n+When method post\n+Then status 201\n+And assert responseTime < 1000\n+```\n ### `read`\n This is a great example of how you can extend Karate by defining your own functions. Behind the scenes\n the `read(filename)` function is actually implemented in JavaScript.\ndiff --git a/karate-core/src/main/java/com/intuit/karate/ScriptValueMap.java b/karate-core/src/main/java/com/intuit/karate/ScriptValueMap.java\nindex 3457e5b0b..8208407c8 100755\n--- a/karate-core/src/main/java/com/intuit/karate/ScriptValueMap.java\n+++ b/karate-core/src/main/java/com/intuit/karate/ScriptValueMap.java\n@@ -14,6 +14,7 @@ public class ScriptValueMap extends HashMap<String, ScriptValue> {\n     public static final String VAR_HEADERS = \"headers\";\n     public static final String VAR_RESPONSE_HEADERS = \"responseHeaders\";\n     public static final String VAR_RESPONSE_STATUS = \"responseStatus\";\n+    public static final String VAR_RESPONSE_TIME = \"responseTime\";\n \n     public ScriptValue put(String key, Object value) {\n         ScriptValue sv = new ScriptValue(value);\ndiff --git a/karate-core/src/main/java/com/intuit/karate/StepDefs.java b/karate-core/src/main/java/com/intuit/karate/StepDefs.java\nindex 26924a498..1f3abea32 100755\n--- a/karate-core/src/main/java/com/intuit/karate/StepDefs.java\n+++ b/karate-core/src/main/java/com/intuit/karate/StepDefs.java\n@@ -46,6 +46,7 @@ public class StepDefs {\n     private WebTarget target;\n     private Response response;\n     private String accept;\n+    private long startTime;\n \n     private final ScriptContext context;\n \n@@ -183,6 +184,17 @@ public class StepDefs {\n     public void accept(String expression) {\n         this.accept = expression;\n     }    \n+    \n+    private void startTimer() {\n+        startTime = System.currentTimeMillis();\n+    }\n+    \n+    private void stopTimer() {\n+        long endTime = System.currentTimeMillis();\n+        long responseTime = endTime - startTime;\n+        logger.debug(\"response time in milliseconds: {}\", responseTime);\n+        context.vars.put(ScriptValueMap.VAR_RESPONSE_TIME, responseTime);\n+    }\n \n     @When(\"^method (\\\\w+)\")\n     public void method(String method) {\n@@ -190,7 +202,9 @@ public class StepDefs {\n         if (\"POST\".equals(method) || \"PUT\".equals(method) || \"PATCH\".equals(method)) {\n             MultivaluedMap<String, Object> formFields = context.vars.get(VAR_FORM_FIELDS, MultivaluedMap.class);\n             if (formFields != null) {\n+                startTimer();\n                 response = prepare().method(method, Entity.entity(formFields, MediaType.APPLICATION_FORM_URLENCODED_TYPE));\n+                stopTimer();\n             } else {\n                 ScriptValue sv = context.vars.get(VAR_REQUEST);\n                 Entity entity;\n@@ -211,10 +225,14 @@ public class StepDefs {\n                     default:\n                         entity = Entity.text(sv.getAsString());\n                 }\n+                startTimer();\n                 response = prepare().method(method, entity);\n+                stopTimer();\n             }\n         } else {\n+            startTimer();\n             response = prepare().method(method);\n+            stopTimer();\n         }\n         unprepare();\n     }\n@@ -259,7 +277,9 @@ public class StepDefs {\n         logger.trace(\"soap action: '{}'\", action);\n         Document doc = context.vars.get(VAR_REQUEST, Document.class);\n         String xml = XmlUtils.toString(doc);\n+        startTimer();\n         response = target.request().header(\"SOAPAction\", action).method(\"POST\", Entity.entity(xml, MediaType.TEXT_XML));\n+        stopTimer();\n         String raw = response.readEntity(String.class);\n         if (StringUtils.isNotBlank(raw)) {\n             context.vars.put(ScriptValueMap.VAR_RESPONSE, XmlUtils.toXmlDoc(raw));\n@@ -328,8 +348,10 @@ public class StepDefs {\n             if (type != null) { // override with user specified\n                 mediaType = MediaType.valueOf(type);\n             }\n-        }        \n+        }\n+        startTimer();       \n         response = prepare().method(method, Entity.entity(mp, mediaType));\n+        stopTimer();\n         unprepare();\n     }\n \ndiff --git a/karate-core/src/test/java/com/intuit/karate/wiremock/hello-world.feature b/karate-core/src/test/java/com/intuit/karate/wiremock/hello-world.feature\nindex 238bce25b..56c59ac63 100755\n--- a/karate-core/src/test/java/com/intuit/karate/wiremock/hello-world.feature\n+++ b/karate-core/src/test/java/com/intuit/karate/wiremock/hello-world.feature\n@@ -7,6 +7,7 @@ And request { name: 'Billie' }\n When method post\n Then status 201\n And match response == { id: '#ignore', name: 'Billie' }\n+# And assert responseTime < 1000\n \n Given path response.id\n When method get",
    "Reduce timeout to 90 sec .": "diff --git a/core/src/main/java/bisq/core/trade/protocol/TradeProtocol.java b/core/src/main/java/bisq/core/trade/protocol/TradeProtocol.java\nindex 3f4dbd049a..8666b4ede4 100644\n--- a/core/src/main/java/bisq/core/trade/protocol/TradeProtocol.java\n+++ b/core/src/main/java/bisq/core/trade/protocol/TradeProtocol.java\n@@ -49,7 +49,7 @@ import static bisq.core.util.Validator.nonEmptyStringOf;\n \n @Slf4j\n public abstract class TradeProtocol {\n-    private static final long TIMEOUT = 120;\n+    private static final long TIMEOUT = 90;\n \n     protected final ProcessModel processModel;\n     private final DecryptedDirectMessageListener decryptedDirectMessageListener;",
    "Remove unnecessary queries of target environment .": "diff --git a/runtime/compiler/runtime/Trampoline.cpp b/runtime/compiler/runtime/Trampoline.cpp\nindex bcda365b8..9c4a416e2 100644\n--- a/runtime/compiler/runtime/Trampoline.cpp\n+++ b/runtime/compiler/runtime/Trampoline.cpp\n@@ -1392,74 +1392,38 @@ void s390zLinux64CodeCacheParameters(int32_t *trampolineSize, void **callBacks,\n void setupCodeCacheParameters(int32_t *trampolineSize, OMR::CodeCacheCodeGenCallbacks *callBacks, int32_t * numHelpers, int32_t *CCPreLoadedCodeSize)\n    {\n #if defined(TR_TARGET_POWER)\n-   if (TR::Compiler->target.cpu.isPower())\n-      {\n       ppcCodeCacheParameters(trampolineSize, (void **)callBacks, numHelpers, CCPreLoadedCodeSize);\n-      return;\n-      }\n #endif\n \n #if defined(TR_TARGET_X86) && defined(TR_TARGET_32BIT)\n-   if (TR::Compiler->target.cpu.isI386())\n-      {\n       ia32CodeCacheParameters(trampolineSize, callBacks, numHelpers, CCPreLoadedCodeSize);\n-      return;\n-      }\n #endif\n \n #if defined(TR_TARGET_X86) && defined(TR_TARGET_64BIT)\n-   if (TR::Compiler->target.cpu.isAMD64())\n-      {\n       amd64CodeCacheParameters(trampolineSize, callBacks, numHelpers, CCPreLoadedCodeSize);\n-      return;\n-      }\n #endif\n \n #if defined(TR_TARGET_ARM)\n-   if (TR::Compiler->target.cpu.isARM())\n-      {\n       armCodeCacheParameters(trampolineSize, (void **)callBacks, numHelpers, CCPreLoadedCodeSize);\n-      return;\n-      }\n #endif\n \n #if defined(TR_TARGET_ARM64)\n-   if (TR::Compiler->target.cpu.isARM64())\n-      {\n       arm64CodeCacheParameters(trampolineSize, (void **)callBacks, numHelpers, CCPreLoadedCodeSize);\n-      return;\n-      }\n #endif\n \n #if defined(TR_TARGET_S390) && !defined(TR_TARGET_64BIT) && defined(J9ZOS390)\n-   // zOS 31 code cache support.\n-   if (TR::Compiler->target.cpu.isZ())\n-      {\n       s390zOS31CodeCacheParameters(trampolineSize, (void **)callBacks, numHelpers, CCPreLoadedCodeSize);\n-      }\n #endif\n \n #if defined(TR_TARGET_S390) && defined(TR_TARGET_64BIT) && defined(J9ZOS390)\n-   // zOS 64 code cache support.\n-   if (TR::Compiler->target.cpu.isZ())\n-      {\n       s390zOS64CodeCacheParameters(trampolineSize, (void **)callBacks, numHelpers, CCPreLoadedCodeSize);\n-      }\n #endif\n \n #if defined(TR_TARGET_S390) && !defined(TR_TARGET_64BIT) && !defined(J9ZOS390)\n-   // zLinux 31 code cache support.\n-   if (TR::Compiler->target.cpu.isZ())\n-      {\n       s390zLinux31CodeCacheParameters(trampolineSize, (void **)callBacks, numHelpers, CCPreLoadedCodeSize);\n-      }\n #endif\n \n #if defined(TR_TARGET_S390) && defined(TR_TARGET_64BIT) && !defined(J9ZOS390)\n-   // zLinux 64 code cache support.\n-   if (TR::Compiler->target.cpu.isZ())\n-      {\n       s390zLinux64CodeCacheParameters(trampolineSize, (void **)callBacks, numHelpers, CCPreLoadedCodeSize);\n-      }\n #endif\n    }",
    "improved the message ( <issue_id> ) .": "diff --git a/core/src/main/java/hudson/tasks/MailSender.java b/core/src/main/java/hudson/tasks/MailSender.java\nindex f42daae5d5..ee238a79d8 100644\n--- a/core/src/main/java/hudson/tasks/MailSender.java\n+++ b/core/src/main/java/hudson/tasks/MailSender.java\n@@ -128,7 +128,17 @@ public class MailSender<P extends AbstractProject<P, B>, B extends AbstractBuild\n     private MimeMessage createUnstableMail(B build, BuildListener listener) throws MessagingException {\n         MimeMessage msg = createEmptyMail(build, listener);\n \n-        msg.setSubject(getSubject(build, \"Hudson build became unstable: \"),\"UTF-8\");\n+        String subject = \"Hudson build is unstable: \";\n+\n+        B prev = build.getPreviousBuild();\n+        if(prev!=null) {\n+            if(prev.getResult()==Result.SUCCESS)\n+                subject = \"Hudson build became unstable: \";\n+            if(prev.getResult()==Result.UNSTABLE)\n+                subject = \"Hudson build is still unstable: \";\n+        }\n+\n+        msg.setSubject(getSubject(build, subject),\"UTF-8\");\n         StringBuffer buf = new StringBuffer();\n         appendBuildUrl(build, buf);\n         msg.setText(buf.toString());",
    "Fixed bug reported by Andi Egloff in the ML on ODocument . iterator ( ) : didn \\' t load / check fields .": "diff --git a/core/src/main/java/com/orientechnologies/orient/core/record/impl/ODocument.java b/core/src/main/java/com/orientechnologies/orient/core/record/impl/ODocument.java\nindex 7c0ad79dd3..fb2c9c3fe2 100644\n--- a/core/src/main/java/com/orientechnologies/orient/core/record/impl/ODocument.java\n+++ b/core/src/main/java/com/orientechnologies/orient/core/record/impl/ODocument.java\n@@ -781,6 +781,9 @@ public class ODocument extends ORecordVirtualAbstract<Object> implements Iterabl\n \t * Returns the iterator against the field entries as name and value.\r\n \t */\r\n \tpublic Iterator<Entry<String, Object>> iterator() {\r\n+\t\tcheckForLoading();\r\n+\t\tcheckForFields();\r\n+\r\n \t\tif (_fieldValues == null)\r\n \t\t\treturn OEmptyIterator.INSTANCE;\r\n \r",
    "Add batch test coverage and SpotBugs to SonarQube analysis report": "diff --git a/build.gradle.kts b/build.gradle.kts\nindex 3cc47fc042..4c7e3426d0 100644\n--- a/build.gradle.kts\n+++ b/build.gradle.kts\n@@ -26,6 +26,7 @@ import com.github.vlsi.gradle.git.dsl.gitignore\n import com.github.vlsi.gradle.release.RepositoryType\n import org.ajoberstar.grgit.Grgit\n import org.gradle.api.tasks.testing.logging.TestExceptionFormat\n+import org.sonarqube.gradle.SonarQubeProperties\n \n plugins {\n     java\n@@ -182,16 +183,64 @@ sonarqube {\n     }\n }\n \n+fun SonarQubeProperties.add(name: String, value: String) {\n+    properties.getOrPut(name) { mutableSetOf<String>() }\n+        .also {\n+            @Suppress(\"UNCHECKED_CAST\")\n+            (it as MutableCollection<String>).add(value)\n+        }\n+}\n+\n+if (jacocoEnabled) {\n+    val sonarqubeTask = tasks.sonarqube\n+\n+    val overallReport = jacocoReport.get().reports.xml.destination.toString()\n+\n+    subprojects {\n+        if (File(projectDir, \"src/main\").exists()) {\n+            apply(plugin = \"org.sonarqube\")\n+            sonarqube {\n+                properties {\n+                    property(\"sonar.coverage.jacoco.xmlReportPaths\", overallReport)\n+                }\n+            }\n+        }\n+    }\n+\n+    sonarqubeTask {\n+        dependsOn(jacocoReport)\n+        doFirst {\n+            println(\"doFirst: ${properties}\")\n+        }\n+    }\n+    sonarqubeTask {\n+        allprojects {\n+            dependsOn(tasks.withType<JacocoReport>())\n+        }\n+    }\n+}\n+\n if (enableSpotBugs) {\n     // By default sonarqube does not depend on spotbugs\n     val sonarqubeTask = tasks.sonarqube\n \n     allprojects {\n+        val spotBugTasks = tasks.withType<SpotBugsTask>().matching {\n+            // We don't send spotbugs for test classes\n+            !it.name.endsWith(\"Test\")\n+        }\n+        if (File(projectDir, \"src/main\").exists()) {\n+            apply(plugin = \"org.sonarqube\")\n+            sonarqube {\n+                properties {\n+                    spotBugTasks.configureEach {\n+                        add(\"sonar.java.spotbugs.reportPaths\", reports.xml.destination.toString())\n+                    }\n+                }\n+            }\n+        }\n         sonarqubeTask {\n-            dependsOn(tasks.withType<SpotBugsTask>().matching {\n-                // We don't send spotbugs for test",
    "reverted modification at the generic shape": "diff --git a/src/main/java/de/neemann/digital/draw/shapes/GenericShape.java b/src/main/java/de/neemann/digital/draw/shapes/GenericShape.java\nindex a8bde5b6e..8a5f55623 100644\n--- a/src/main/java/de/neemann/digital/draw/shapes/GenericShape.java\n+++ b/src/main/java/de/neemann/digital/draw/shapes/GenericShape.java\n@@ -206,15 +206,9 @@ public class GenericShape implements Shape {\n \n         if (symmetric && inputs.size() > 0 && ((inputs.size() & 1) == 0)) yBottom += SIZE;\n \n-        int top = topBottomBorder;\n-        if (outputs.size() > 1) {\n-            top += 3;\n-            yBottom += 3;\n-        }\n-\n         Polygon polygon = new Polygon(true)\n-                .add(1, -top)\n-                .add(SIZE * width - 1, -top)\n+                .add(1, -topBottomBorder)\n+                .add(SIZE * width - 1, -topBottomBorder)\n                 .add(SIZE * width - 1, yBottom)\n                 .add(1, yBottom);\n \n@@ -231,7 +225,7 @@ public class GenericShape implements Shape {\n         }\n \n         if (label != null) {\n-            Vector pos = new Vector(SIZE2 * width, -top - 8);\n+            Vector pos = new Vector(SIZE2 * width, -topBottomBorder - 8);\n             graphic.drawText(pos, pos.add(1, 0), label, Orientation.CENTERBOTTOM, Style.NORMAL);\n         }\n \n@@ -256,7 +250,7 @@ public class GenericShape implements Shape {\n         }\n         if (name.length() > 0) {\n             if (name.length() <= 3 && !showPinLabels) {\n-                Vector pos = new Vector(SIZE2 * width, -top + 4);\n+                Vector pos = new Vector(SIZE2 * width, -topBottomBorder + 4);\n                 graphic.drawText(pos, pos.add(1, 0), name, Orientation.CENTERTOP, Style.NORMAL);\n             } else {\n                 Vector pos = new Vector(SIZE2 * width, yBottom + 4);\ndiff --git a/src/main/java/de/neemann/digital/draw/shapes/ShapeFactory.java b/src/main/java/de/neemann/digital/draw/shapes/ShapeFactory.java\nindex be12a28fb..448f3d1f2 100644\n--- a/src/main/java/de/neemann/digital/draw/shapes/ShapeFactory.java\n+++ b/src/main/java/de/neemann/digital/draw/shapes/ShapeFactory.java\n@@ -19,6 +19,7 @@ import de.neemann.digital.core.switching.*;\n import de.neemann.digital.core.wiring.*;\n import de.neemann.digital.draw.elements.PinException;\n import de.neemann.digital.draw.elements.Tunnel;\n+import de.neemann.digital.draw.graphics.Style;\n import de.neemann.digital.draw.library.ElementLibrary;\n import de.neemann.digital.draw.library.ElementTypeDescriptionCustom;\n import de.neemann.digital.draw.library.JarComponentManager;\n@@ -34,6 +35,9 @@ import de.neemann.digital.testing.TestCaseElement;\n \n import java.util.HashMap;\n \n+import static de.neemann.digital.draw.shapes.GenericShape.SIZE;\n+import static de.neemann.digital.draw.shapes.GenericShape.SIZE2;\n+\n /**\n  * Used to create a shape matching a given name\n  */\n@@ -79,7 +83,7 @@ public final class ShapeFactory {\n                     (attributes, inputs, outputs) -> {\n                         final boolean ws = attributes.get(Keys.WIDE_SHAPE);\n                         return new GenericShape(ws ? \"1\" : \"\", inputs, outputs)\n-                                .setTopBottomBorder(ws ? GenericShape.SIZE : GenericShape.SIZE2)\n+                                .setTopBottomBorder(ws ? SIZE : SIZE2)\n                                 .invert(true)\n                                 .setWide(ws);\n                     });\n@@ -224,6 +228,7 @@ public final",
    "Bump version for Beta11 .": "diff --git a/buildSrc/src/main/kotlin/androidx/build/LibraryVersions.kt b/buildSrc/src/main/kotlin/androidx/build/LibraryVersions.kt\nindex 0206de82858..44dd9163b2f 100644\n--- a/buildSrc/src/main/kotlin/androidx/build/LibraryVersions.kt\n+++ b/buildSrc/src/main/kotlin/androidx/build/LibraryVersions.kt\n@@ -35,11 +35,11 @@ object LibraryVersions {\n     val BIOMETRIC = Version(\"1.1.0-beta01\")\n     val BROWSER = Version(\"1.3.0-alpha06\")\n     val BUILDSRC_TESTS = Version(\"1.0.0-alpha01\")\n-    val CAMERA = Version(\"1.0.0-beta10\")\n-    val CAMERA_EXTENSIONS = Version(\"1.0.0-alpha17\")\n+    val CAMERA = Version(\"1.0.0-beta11\")\n+    val CAMERA_EXTENSIONS = Version(\"1.0.0-alpha18\")\n     val CAMERA_PIPE = Version(\"1.0.0-alpha01\")\n     val CAMERA_VIDEO = Version(\"1.0.0-alpha01\")\n-    val CAMERA_VIEW = Version(\"1.0.0-alpha17\")\n+    val CAMERA_VIEW = Version(\"1.0.0-alpha18\")\n     val CARDVIEW = Version(\"1.1.0-alpha01\")\n     val COLLECTION = Version(\"1.2.0-alpha01\")\n     val CONTENTPAGER = Version(\"1.1.0-alpha01\")\ndiff --git a/camera/camera-camera2/api/1.0.0-beta11.txt b/camera/camera-camera2/api/1.0.0-beta11.txt\nnew file mode 100644\nindex 00000000000..c4e06986fd2\n--- /dev/null\n+++ b/camera/camera-camera2/api/1.0.0-beta11.txt\n@@ -0,0 +1,9 @@\n+// Signature format: 3.0\n+package androidx.camera.camera2 {\n+\n+  public final class Camera2Config {\n+    method public static androidx.camera.core.CameraXConfig defaultConfig();\n+  }\n+\n+}\n+\ndiff --git a/camera/camera-camera2/api/public_plus_experimental_1.0.0-beta11.txt b/camera/camera-camera2/api/public_plus_experimental_1.0.0-beta11.txt\nnew file mode 100644\nindex 00000000000..d706ed683d9\n--- /dev/null\n+++ b/camera/camera-camera2/api/public_plus_experimental_1.0.0-beta11.txt\n@@ -0,0 +1,41 @@\n+// Signature format: 3.0\n+package androidx.camera.camera2 {\n+\n+  public final class Camera2Config {\n+    method public static androidx.camera.core.CameraXConfig defaultConfig();\n+  }\n+\n+}\n+\n+package androidx.camera.camera2.interop {\n+\n+  @androidx.camera.camera2.interop.ExperimentalCamera2Interop public final class Camera2CameraFilter {\n+    method public static androidx.camera.core.CameraFilter createCameraFilter(androidx.camera.camera2.interop.Camera2CameraFilter.Camera2Filter);\n+  }\n+\n+  public static interface Camera2CameraFilter.Camera2Filter {\n+    method public java.util.LinkedHashMap<java.lang.String!,android.hardware.camera2.CameraCharacteristics!> filter(java.util.LinkedHashMap<java.lang.String!,android.hardware.camera2.CameraCharacteristics!>);\n+  }\n+\n+  @androidx.camera.camera2.interop.ExperimentalCamera2Interop public final class Camera2CameraInfo {\n+    method public static androidx.camera.camera2.interop.Camera2CameraInfo fromCameraInfo(androidx.camera.core.CameraInfo);\n+    method public <T> T? getCameraCharacteristic(android.hardware.camera2.CameraCharacteristics.Key<T!>);\n+    method public String getCameraId();\n+  }\n+\n+  @androidx.camera.camera2.interop.ExperimentalCamera2Interop public final class Camera2Interop {\n+  }\n+\n+  public static final class Camera2Interop.Extender<T> {\n+    ctor public Camera2Interop.Extender(androidx.camera.core.ExtendableBuilder<T!>);\n+    method public <ValueT> androidx.camera.camera2.interop.Camera2Interop.Extender<T!> setCaptureRequestOption(android.hardware.camera2.CaptureRequest.Key<ValueT!>, ValueT);\n+    method public androidx.camera.camera2.interop.Camera2Interop.Extender<T!> setDeviceStateCallback(android.hardware.camera2.CameraDevice.StateCallback);\n+    method public androidx.camera.camera2.interop.Camera2Interop.Extender<T!> setSessionCaptureCallback(android.hardware.camera2.CameraCaptureSession.CaptureCallback);\n+    method public androidx.camera.camera2.interop.Camera2Interop.Extender<T!> setSessionStateCallback(android.hardware.camera2.CameraCaptureSession.StateCallback);\n+  }\n+\n+  @experimental.Experimental @java.lang.annotation.Retention(java.lang.annotation.RetentionPolicy.CLASS) public @interface ExperimentalCamera2Interop {\n+  }\n+\n+}\n+\ndiff --git a/camera/camera-camera2/api/res-1.0.0-beta11.txt b/camera/camera-camera2/api/res-1.0.0-beta11.txt\nnew file mode 100644\nindex 00000000000..e69de29bb2d\ndiff --git a/camera/camera-camera2/api/restricted_1.0.0-beta11.txt b/camera/camera-camera2/api/restricted_1.0.0-beta11.txt\nnew file mode 100644\nindex 00000000000..c4e06986fd2\n--- /dev/null\n+++ b/camera/camera-camera2/api/restricted_1.0.0-beta11.txt\n@@ -0,0 +1,9 @@\n+// Signature format: 3.0\n+package androidx.camera.camera2 {\n+\n+  public final class Camera2Config {\n+    method public static androidx.camera.core.CameraXConfig defaultConfig();\n+  }\n+\n+}\n+\ndiff --git a/camera/camera-core/api/1.0.0-beta11.txt b/camera/camera-core/api/1.0.0-beta11.txt\nnew file mode 100644\nindex 00000000000..0a36e63f351\n--- /dev/null\n+++ b/camera/camera-core/api/1.0.0-beta11.txt\n@@ -0,0 +1,306 @@\n+// Signature format: 3.0\n+package androidx.camera.core {\n+\n+  public class AspectRatio {\n+    field public static final int RATIO_16_9 = 1; // 0x1\n+    field public static final int RATIO_4_3 = 0; // 0x0\n+  }\n+\n+  public interface Camera {\n+    method public androidx.camera.core.CameraControl getCameraControl();\n+    method public androidx.camera.core.CameraInfo getCameraInfo();\n+  }\n+\n+  public interface CameraControl {\n+    method public com.google.common.util.concurrent.ListenableFuture<java.lang.Void!> cancelFocusAndMetering();\n+    method public com.google.common.util.concurrent.ListenableFuture<java.lang.Void!> enableTorch(boolean);\n+    method public com.google.common.util.concurrent.ListenableFuture<java.lang.Void!> setLinearZoom(@FloatRange(from=0.0f, to=1.0f) float);\n+    method public com.google.common.util.concurrent.ListenableFuture<java.lang.Void!> setZoomRatio(float);\n+    method public com.google.common.util.concurrent.ListenableFuture<androidx.camera.core.FocusMeteringResult!> startFocusAndMetering(androidx.camera.core.FocusMeteringAction);\n+  }\n+\n+  public static final class CameraControl.OperationCanceledException extends java.lang.Exception {\n+  }\n+\n+  public interface CameraInfo {\n+    method public int getSensorRotationDegrees();\n+    method public int getSensorRotationDegrees(int);\n+    method public androidx.lifecycle.LiveData<java.lang.Integer!> getTorchState();\n+    method public androidx.lifecycle.LiveData<androidx.camera.core.ZoomState!> getZoomState();\n+    method public boolean hasFlashUnit();\n+  }\n+\n+  public final class CameraInfoUnavailableException extends java.lang.Exception {\n+  }\n+\n+  public final class CameraSelector {\n+    field public static final androidx.camera.core.CameraSelector DEFAULT_BACK_CAMERA;\n+    field public static final androidx.camera.core.CameraSelector DEFAULT_FRONT_CAMERA;\n+    field public static final int LENS_FACING_BACK = 1; // 0x1\n+    field public static final int LENS_FACING_FRONT = 0; // 0x0\n+  }\n+\n+  public static final class CameraSelector.Builder {\n+    ctor public CameraSelector.Builder();\n+    method public androidx.camera.core.CameraSelector build();\n+    method public androidx.camera.core.CameraSelector.Builder requireLensFacing(int);\n+  }\n+\n+  public class CameraUnavailableException extends java.lang.Exception {\n+    ctor public CameraUnavailableException(int);\n+    ctor public CameraUnavailableException(int, String?);\n+    ctor public CameraUnavailableException(int, String?, Throwable?);\n+    ctor public CameraUnavailableException(int, Throwable?);\n+    method public int getReason();\n+    field public static final int CAMERA_DISABLED = 1; // 0x1\n+    field public static final int CAMERA_DISCONNECTED = 2; // 0x2\n+    field public static final int CAMERA_ERROR = 3; // 0x3\n+    field public static final int CAMERA_IN_USE = 4; // 0x4\n+    field public static final int CAMERA_MAX_IN_USE = 5; // 0x5\n+    field public static final int CAMERA_UNAVAILABLE_DO_NOT_DISTURB = 6; // 0x6\n+    field public static final int CAMERA_UNKNOWN_ERROR = 0; // 0x0\n+  }\n+\n+  public final class CameraXConfig {\n+  }\n+\n+  public static final class CameraXConfig.Builder {\n+    method public androidx.camera.core.CameraXConfig build();\n+    method public static androidx.camera.core.CameraXConfig.Builder fromConfig(androidx.camera.core.CameraXConfig);\n+    method public androidx.camera.core.CameraXConfig.Builder setCameraExecutor(java.util.concurrent.Executor);\n+  }\n+\n+  public static interface CameraXConfig.Provider {\n+    method public androidx.camera.core.CameraXConfig getCameraXConfig();\n+  }\n+\n+  public final class DisplayOrientedMeteringPointFactory extends androidx.camera.core.MeteringPointFactory {\n+    ctor public DisplayOrientedMeteringPointFactory(android.view.Display, androidx.camera.core.CameraInfo, float, float);\n+  }\n+\n+  public interface ExtendableBuilder<T> {\n+    method public T build();\n+  }\n+\n+  public final class FocusMeteringAction {\n+    method public long getAutoCancelDurationInMillis();\n+    method public java.util.List<androidx.camera.core.MeteringPoint!> getMeteringPointsAe();\n+    method public java.util.List<androidx.camera.core.MeteringPoint!> getMeteringPointsAf();\n+    method public java.util.List<androidx.camera.core.MeteringPoint!> getMeteringPointsAwb();\n+    method public boolean isAutoCancelEnabled();\n+    field public static final int FLAG_AE = 2; // 0x2\n+    field public static final int FLAG_AF = 1; // 0x1\n+    field public static final int FLAG_AWB = 4; // 0x4\n+  }\n+\n+  public static class FocusMeteringAction.Builder {\n+    ctor public FocusMeteringAction.Builder(androidx.camera.core.MeteringPoint);\n+    ctor public FocusMeteringAction.Builder(androidx.camera.core.MeteringPoint, int);\n+    method public androidx.camera.core.FocusMeteringAction.Builder addPoint(androidx.camera.core.MeteringPoint);\n+    method public androidx.camera.core.FocusMeteringAction.Builder addPoint(androidx.camera.core.MeteringPoint, int);\n+    method public androidx.camera.core.FocusMeteringAction build();\n+    method public androidx.camera.core.FocusMeteringAction.Builder disableAutoCancel();\n+    method public androidx.camera.core.FocusMeteringAction.Builder setAutoCancelDuration(@IntRange(from=1) long, java.util.concurrent.TimeUnit);\n+  }\n+\n+  public final class FocusMeteringResult {\n+    method public boolean isFocusSuccessful();\n+  }\n+\n+  public final class ImageAnalysis extends androidx.camera.core.UseCase {\n+    method public void clearAnalyzer();\n+    method public int getBackpressureStrategy();\n+    method public int getImageQueueDepth();\n+    method public int getTargetRotation();\n+    method public void setAnalyzer(java.util.concurrent.Executor, androidx.camera.core.ImageAnalysis.Analyzer);\n+    method public void setTargetRotation(int);\n+    field public static final int STRATEGY_BLOCK_PRODUCER = 1; // 0x1\n+    field public static final int STRATEGY_KEEP_ONLY_LATEST = 0; // 0x0\n+  }\n+\n+  public static interface ImageAnalysis.Analyzer {\n+    method public void analyze(androidx.camera.core.ImageProxy);\n+  }\n+\n+  public static final class ImageAnalysis.Builder implements androidx.camera.core.ExtendableBuilder<androidx.camera.core.ImageAnalysis> {\n+    ctor public ImageAnalysis.Builder();\n+    method public androidx.camera.core.ImageAnalysis build();\n+    method public androidx.camera.core.ImageAnalysis.Builder setBackgroundExecutor(java.util.concurrent.Executor);\n+    method public androidx.camera.core.ImageAnalysis.Builder setBackpressureStrategy(int);\n+    method public androidx.camera.core.ImageAnalysis.Builder setImageQueueDepth(int);\n+    method public androidx.camera.core.ImageAnalysis.Builder setTargetAspectRatio(int);\n+    method public androidx.camera.core.ImageAnalysis.Builder setTargetName(String);\n+    method public androidx.camera.core.ImageAnalysis.Builder setTargetResolution(android.util.Size);\n+    method public androidx.camera.core.ImageAnalysis.Builder setTargetRotation(int);\n+  }\n+\n+  public final class ImageCapture extends androidx.camera.core.UseCase {\n+    method public int getCaptureMode();\n+    method public int getFlashMode();\n+    method public int getTargetRotation();\n+    method public void setCropAspectRatio(android.util.Rational);\n+    method public void setFlashMode(int);\n+    method public void setTargetRotation(int);\n+    method public void takePicture(java.util.concurrent.Executor, androidx.camera.core.ImageCapture.OnImageCapturedCallback);\n+    method public void takePicture(androidx.camera.core.ImageCapture.OutputFileOptions, java.util.concurrent.Executor, androidx.camera.core.ImageCapture.OnImageSavedCallback);\n+    field public static final int CAPTURE_MODE_MAXIMIZE_QUALITY = 0; // 0x0\n+    field public static final int CAPTURE_MODE_MINIMIZE_LATENCY = 1; // 0x1\n+    field public static final int ERROR_CAMERA_CLOSED = 3; // 0x3\n+    field public static final int ERROR_CAPTURE_FAILED = 2; // 0x2\n+    field public static final int ERROR_FILE_IO = 1; // 0x1\n+    field public static final int ERROR_INVALID_CAMERA = 4; // 0x4\n+    field public static final int ERROR_UNKNOWN = 0; // 0x0\n+    field public static final int FLASH_MODE_AUTO = 0; // 0x0\n+    field public static final int FLASH_MODE_OFF = 2; // 0x2\n+    field public static final int FLASH_MODE_ON = 1; // 0x1\n+  }\n+\n+  public static final class ImageCapture.Builder implements androidx.camera.core.ExtendableBuilder<androidx.camera.core.ImageCapture> {\n+    ctor public ImageCapture.Builder();\n+    method public androidx.camera.core.ImageCapture build();\n+    method public androidx.camera.core.ImageCapture.Builder setCaptureMode(int);\n+    method public androidx.camera.core.ImageCapture.Builder setFlashMode(int);\n+    method public androidx.camera.core.ImageCapture.Builder setIoExecutor(java.util.concurrent.Executor);\n+    method public androidx.camera.core.ImageCapture.Builder setTargetAspectRatio(int);\n+    method public androidx.camera.core.ImageCapture.Builder setTargetName(String);\n+    method public androidx.camera.core.ImageCapture.Builder setTargetResolution(android.util.Size);\n+    method public androidx.camera.core.ImageCapture.Builder setTargetRotation(int);\n+  }\n+\n+  public static final class ImageCapture.Metadata {\n+    ctor public ImageCapture.Metadata();\n+    method public android.location.Location? getLocation();\n+    method public boolean isReversedHorizontal();\n+    method public boolean isReversedVertical();\n+    method public void setLocation(android.location.Location?);\n+    method public void setReversedHorizontal(boolean);\n+    method public void setReversedVertical(boolean);\n+  }\n+\n+  public abstract static class ImageCapture.OnImageCapturedCallback {\n+    ctor public ImageCapture.OnImageCapturedCallback();\n+    method public void onCaptureSuccess(androidx.camera.core.ImageProxy);\n+    method public void onError(androidx.camera.core.ImageCaptureException);\n+  }\n+\n+  public static interface ImageCapture.OnImageSavedCallback {\n+    method public void onError(androidx.camera.core.ImageCaptureException);\n+    method public void onImageSaved(androidx.camera.core.ImageCapture.OutputFileResults);\n+  }\n+\n+  public static final class ImageCapture.OutputFileOptions {\n+  }\n+\n+  public static final class ImageCapture.OutputFileOptions.Builder {\n+    ctor public ImageCapture.OutputFileOptions.Builder(java.io.File);\n+    ctor public ImageCapture.OutputFileOptions.Builder(android.content.ContentResolver, android.net.Uri, android.content.ContentValues);\n+    ctor public ImageCapture.OutputFileOptions.Builder(java.io.OutputStream);\n+    method public androidx.camera.core.ImageCapture.OutputFileOptions build();\n+    method public androidx.camera.core.ImageCapture.OutputFileOptions.Builder setMetadata(androidx.camera.core.ImageCapture.Metadata);\n+  }\n+\n+  public static class ImageCapture.OutputFileResults {\n+    method public android.net.Uri? getSavedUri();\n+  }\n+\n+  public class ImageCaptureException extends java.lang.Exception {\n+    ctor public ImageCaptureException(int, String, Throwable?);\n+    method public int getImageCaptureError();\n+  }\n+\n+  public interface ImageInfo {\n+    method public int getRotationDegrees();\n+    method public long getTimestamp();\n+  }\n+\n+  public interface ImageProxy extends java.lang.AutoCloseable {\n+    method public void close();\n+    method public android.graphics.Rect getCropRect();\n+    method public int getFormat();\n+    method public int getHeight();\n+    method public androidx.camera.core.ImageInfo getImageInfo();\n+    method public androidx.camera.core.ImageProxy.PlaneProxy![] getPlanes();\n+    method public int getWidth();\n+    method public void setCropRect(android.graphics.Rect?);\n+  }\n+\n+  public static interface ImageProxy.PlaneProxy {\n+    method public java.nio.ByteBuffer getBuffer();\n+    method public int getPixelStride();\n+    method public int getRowStride();\n+  }\n+\n+  public class InitializationException extends java.lang.Exception {\n+    ctor public InitializationException(String?);\n+    ctor public InitializationException(String?, Throwable?);\n+    ctor public InitializationException(Throwable?);\n+  }\n+\n+  public class MeteringPoint {\n+    method public float getSize();\n+  }\n+\n+  public abstract class MeteringPointFactory {\n+    method public final androidx.camera.core.MeteringPoint createPoint(float, float);\n+    method public final androidx.camera.core.MeteringPoint createPoint(float, float, float);\n+    method public static float getDefaultPointSize();\n+  }\n+\n+  public final class Preview extends androidx.camera.core.UseCase {\n+    method public int getTargetRotation();\n+    method @UiThread public void setSurfaceProvider(java.util.concurrent.Executor, androidx.camera.core.Preview.SurfaceProvider?);\n+    method @UiThread public void setSurfaceProvider(androidx.camera.core.Preview.SurfaceProvider?);\n+  }\n+\n+  public static final class Preview.Builder implements androidx.camera.core.ExtendableBuilder<androidx.camera.core.Preview> {\n+    ctor public Preview.Builder();\n+    method public androidx.camera.core.Preview build();\n+    method public androidx.camera.core.Preview.Builder setTargetAspectRatio(int);\n+    method public androidx.camera.core.Preview.Builder setTargetName(String);\n+    method public androidx.camera.core.Preview.Builder setTargetResolution(android.util.Size);\n+    method public androidx.camera.core.Preview.Builder setTargetRotation(int);\n+  }\n+\n+  public static interface Preview.SurfaceProvider {\n+    method public void onSurfaceRequested(androidx.camera.core.SurfaceRequest);\n+  }\n+\n+  public class SurfaceOrientedMeteringPointFactory extends androidx.camera.core.MeteringPointFactory {\n+    ctor public SurfaceOrientedMeteringPointFactory(float, float);\n+    ctor public SurfaceOrientedMeteringPointFactory(float, float, androidx.camera.core.UseCase);\n+  }\n+\n+  public final class SurfaceRequest {\n+    method public void addRequestCancellationListener(java.util.concurrent.Executor, Runnable);\n+    method public android.util.Size getResolution();\n+    method public void provideSurface(android.view.Surface, java.util.concurrent.Executor, androidx.core.util.Consumer<androidx.camera.core.SurfaceRequest.Result!>);\n+    method public boolean willNotProvideSurface();\n+  }\n+\n+  @com.google.auto.value.AutoValue public abstract static class SurfaceRequest.Result {\n+    method public abstract int getResultCode();\n+    method public abstract android.view.Surface getSurface();\n+    field public static final int RESULT_INVALID_SURFACE = 2; // 0x2\n+    field public static final int RESULT_REQUEST_CANCELLED = 1; // 0x1\n+    field public static final int RESULT_SURFACE_ALREADY_PROVIDED = 3; // 0x3\n+    field public static final int RESULT_SURFACE_USED_SUCCESSFULLY = 0; // 0x0\n+    field public static final int RESULT_WILL_NOT_PROVIDE_SURFACE = 4; // 0x4\n+  }\n+\n+  public class TorchState {\n+    field public static final int OFF = 0; // 0x0\n+    field public static final int ON = 1; // 0x1\n+  }\n+\n+  public abstract class UseCase {\n+  }\n+\n+  public interface ZoomState {\n+    method public float getLinearZoom();\n+    method public float getMaxZoomRatio();\n+    method public float getMinZoomRatio();\n+    method public float getZoomRatio();\n+  }\n+\n+}\n+\ndiff --git a/camera/camera-core/api/public_plus_experimental_1.0.0-beta11.txt b/camera/camera-core/api/public_plus_experimental_1.0.0-beta11.txt\nnew file mode 100644\nindex 00000000000..7da2353ea62\n--- /dev/null\n+++ b/camera/camera-core/api/public_plus_experimental_1.0.0-beta11.txt\n@@ -0,0 +1,376 @@\n+// Signature format: 3.0\n+package androidx.camera.core {\n+\n+  public class AspectRatio {\n+    field public static final int RATIO_16_9 = 1; // 0x1\n+    field public static final int RATIO_4_3 = 0; // 0x0\n+  }\n+\n+  public interface Camera {\n+    method public androidx.camera.core.CameraControl getCameraControl();\n+    method public androidx.camera.core.CameraInfo getCameraInfo();\n+  }\n+\n+  public interface CameraControl {\n+    method public com.google.common.util.concurrent.ListenableFuture<java.lang.Void!> cancelFocusAndMetering();\n+    method public com.google.common.util.concurrent.ListenableFuture<java.lang.Void!> enableTorch(boolean);\n+    method @androidx.camera.core.ExperimentalExposureCompensation public com.google.common.util.concurrent.ListenableFuture<java.lang.Integer!> setExposureCompensationIndex(int);\n+    method public com.google.common.util.concurrent.ListenableFuture<java.lang.Void!> setLinearZoom(@FloatRange(from=0.0f, to=1.0f) float);\n+    method public com.google.common.util.concurrent.ListenableFuture<java.lang.Void!> setZoomRatio(float);\n+    method public com.google.common.util.concurrent.ListenableFuture<androidx.camera.core.FocusMeteringResult!> startFocusAndMetering(androidx.camera.core.FocusMeteringAction);\n+  }\n+\n+  public static final class CameraControl.OperationCanceledException extends java.lang.Exception {\n+  }\n+\n+  @androidx.camera.core.ExperimentalCameraFilter public interface CameraFilter {\n+    method public java.util.LinkedHashSet<androidx.camera.core.Camera!> filter(java.util.LinkedHashSet<androidx.camera.core.Camera!>);\n+  }\n+\n+  public interface CameraInfo {\n+    method @androidx.camera.core.ExperimentalExposureCompensation public androidx.camera.core.ExposureState getExposureState();\n+    method public int getSensorRotationDegrees();\n+    method public int getSensorRotationDegrees(int);\n+    method public androidx.lifecycle.LiveData<java.lang.Integer!> getTorchState();\n+    method public androidx.lifecycle.LiveData<androidx.camera.core.ZoomState!> getZoomState();\n+    method public boolean hasFlashUnit();\n+  }\n+\n+  public final class CameraInfoUnavailableException extends java.lang.Exception {\n+  }\n+\n+  public final class CameraSelector {\n+    field public static final androidx.camera.core.CameraSelector DEFAULT_BACK_CAMERA;\n+    field public static final androidx.camera.core.CameraSelector DEFAULT_FRONT_CAMERA;\n+    field public static final int LENS_FACING_BACK = 1; // 0x1\n+    field public static final int LENS_FACING_FRONT = 0; // 0x0\n+  }\n+\n+  public static final class CameraSelector.Builder {\n+    ctor public CameraSelector.Builder();\n+    method @androidx.camera.core.ExperimentalCameraFilter public androidx.camera.core.CameraSelector.Builder addCameraFilter(androidx.camera.core.CameraFilter);\n+    method public androidx.camera.core.CameraSelector build();\n+    method public androidx.camera.core.CameraSelector.Builder requireLensFacing(int);\n+  }\n+\n+  public class CameraUnavailableException extends java.lang.Exception {\n+    ctor public CameraUnavailableException(int);\n+    ctor public CameraUnavailableException(int, String?);\n+    ctor public CameraUnavailableException(int, String?, Throwable?);\n+    ctor public CameraUnavailableException(int, Throwable?);\n+    method public int getReason();\n+    field public static final int CAMERA_DISABLED = 1; // 0x1\n+    field public static final int CAMERA_DISCONNECTED = 2; // 0x2\n+    field public static final int CAMERA_ERROR = 3; // 0x3\n+    field public static final int CAMERA_IN_USE = 4; // 0x4\n+    field public static final int CAMERA_MAX_IN_USE = 5; // 0x5\n+    field public static final int CAMERA_UNAVAILABLE_DO_NOT_DISTURB = 6; // 0x6\n+    field public static final int CAMERA_UNKNOWN_ERROR = 0; // 0x0\n+  }\n+\n+  public final class CameraXConfig {\n+  }\n+\n+  public static final class CameraXConfig.Builder {\n+    method public androidx.camera.core.CameraXConfig build();\n+    method public static androidx.camera.core.CameraXConfig.Builder fromConfig(androidx.camera.core.CameraXConfig);\n+    method public androidx.camera.core.CameraXConfig.Builder setCameraExecutor(java.util.concurrent.Executor);\n+    method @androidx.camera.core.ExperimentalCustomizableThreads public androidx.camera.core.CameraXConfig.Builder setSchedulerHandler(android.os.Handler);\n+  }\n+\n+  public static interface CameraXConfig.Provider {\n+    method public androidx.camera.core.CameraXConfig getCameraXConfig();\n+  }\n+\n+  public final class DisplayOrientedMeteringPointFactory extends androidx.camera.core.MeteringPointFactory {\n+    ctor public DisplayOrientedMeteringPointFactory(android.view.Display, androidx.camera.core.CameraInfo, float, float);\n+  }\n+\n+  @experimental.Experimental @java.lang.annotation.Retention(java.lang.annotation.RetentionPolicy.CLASS) public @interface ExperimentalCameraFilter {\n+  }\n+\n+  @experimental.Experimental @java.lang.annotation.Retention(java.lang.annotation.RetentionPolicy.CLASS) public @interface ExperimentalCustomizableThreads {\n+  }\n+\n+  @experimental.Experimental @java.lang.annotation.Retention(java.lang.annotation.RetentionPolicy.CLASS) public @interface ExperimentalExposureCompensation {\n+  }\n+\n+  @experimental.Experimental @java.lang.annotation.Retention(java.lang.annotation.RetentionPolicy.CLASS) public @interface ExperimentalGetImage {\n+  }\n+\n+  @experimental.Experimental @java.lang.annotation.Retention(java.lang.annotation.RetentionPolicy.CLASS) public @interface ExperimentalUseCaseGroup {\n+  }\n+\n+  @androidx.camera.core.ExperimentalExposureCompensation public interface ExposureState {\n+    method public int getExposureCompensationIndex();\n+    method public android.util.Range<java.lang.Integer!> getExposureCompensationRange();\n+    method public android.util.Rational getExposureCompensationStep();\n+    method public boolean isExposureCompensationSupported();\n+  }\n+\n+  public interface ExtendableBuilder<T> {\n+    method public T build();\n+  }\n+\n+  public final class FocusMeteringAction {\n+    method public long getAutoCancelDurationInMillis();\n+    method public java.util.List<androidx.camera.core.MeteringPoint!> getMeteringPointsAe();\n+    method public java.util.List<androidx.camera.core.MeteringPoint!> getMeteringPointsAf();\n+    method public java.util.List<androidx.camera.core.MeteringPoint!> getMeteringPointsAwb();\n+    method public boolean isAutoCancelEnabled();\n+    field public static final int FLAG_AE = 2; // 0x2\n+    field public static final int FLAG_AF = 1; // 0x1\n+    field public static final int FLAG_AWB = 4; // 0x4\n+  }\n+\n+  public static class FocusMeteringAction.Builder {\n+    ctor public FocusMeteringAction.Builder(androidx.camera.core.MeteringPoint);\n+    ctor public FocusMeteringAction.Builder(androidx.camera.core.MeteringPoint, int);\n+    method public androidx.camera.core.FocusMeteringAction.Builder addPoint(androidx.camera.core.MeteringPoint);\n+    method public androidx.camera.core.FocusMeteringAction.Builder addPoint(androidx.camera.core.MeteringPoint, int);\n+    method public androidx.camera.core.FocusMeteringAction build();\n+    method public androidx.camera.core.FocusMeteringAction.Builder disableAutoCancel();\n+    method public androidx.camera.core.FocusMeteringAction.Builder setAutoCancelDuration(@IntRange(from=1) long, java.util.concurrent.TimeUnit);\n+  }\n+\n+  public final class FocusMeteringResult {\n+    method public boolean isFocusSuccessful();\n+  }\n+\n+  public final class ImageAnalysis extends androidx.camera.core.UseCase {\n+    method public void clearAnalyzer();\n+    method public int getBackpressureStrategy();\n+    method public int getImageQueueDepth();\n+    method public int getTargetRotation();\n+    method public void setAnalyzer(java.util.concurrent.Executor, androidx.camera.core.ImageAnalysis.Analyzer);\n+    method public void setTargetRotation(int);\n+    field public static final int STRATEGY_BLOCK_PRODUCER = 1; // 0x1\n+    field public static final int STRATEGY_KEEP_ONLY_LATEST = 0; // 0x0\n+  }\n+\n+  public static interface ImageAnalysis.Analyzer {\n+    method public void analyze(androidx.camera.core.ImageProxy);\n+  }\n+\n+  public static final class ImageAnalysis.Builder implements androidx.camera.core.ExtendableBuilder<androidx.camera.core.ImageAnalysis> {\n+    ctor public ImageAnalysis.Builder();\n+    method public androidx.camera.core.ImageAnalysis build();\n+    method public androidx.camera.core.ImageAnalysis.Builder setBackgroundExecutor(java.util.concurrent.Executor);\n+    method public androidx.camera.core.ImageAnalysis.Builder setBackpressureStrategy(int);\n+    method public androidx.camera.core.ImageAnalysis.Builder setImageQueueDepth(int);\n+    method public androidx.camera.core.ImageAnalysis.Builder setTargetAspectRatio(int);\n+    method public androidx.camera.core.ImageAnalysis.Builder setTargetName(String);\n+    method public androidx.camera.core.ImageAnalysis.Builder setTargetResolution(android.util.Size);\n+    method public androidx.camera.core.ImageAnalysis.Builder setTargetRotation(int);\n+  }\n+\n+  public final class ImageCapture extends androidx.camera.core.UseCase {\n+    method public int getCaptureMode();\n+    method public int getFlashMode();\n+    method public int getTargetRotation();\n+    method public void setCropAspectRatio(android.util.Rational);\n+    method public void setFlashMode(int);\n+    method public void setTargetRotation(int);\n+    method public void takePicture(java.util.concurrent.Executor, androidx.camera.core.ImageCapture.OnImageCapturedCallback);\n+    method public void takePicture(androidx.camera.core.ImageCapture.OutputFileOptions, java.util.concurrent.Executor, androidx.camera.core.ImageCapture.OnImageSavedCallback);\n+    field public static final int CAPTURE_MODE_MAXIMIZE_QUALITY = 0; // 0x0\n+    field public static final int CAPTURE_MODE_MINIMIZE_LATENCY = 1; // 0x1\n+    field public static final int ERROR_CAMERA_CLOSED = 3; // 0x3\n+    field public static final int ERROR_CAPTURE_FAILED = 2; // 0x2\n+    field public static final int ERROR_FILE_IO = 1; // 0x1\n+    field public static final int ERROR_INVALID_CAMERA = 4; // 0x4\n+    field public static final int ERROR_UNKNOWN = 0; // 0x0\n+    field public static final int FLASH_MODE_AUTO = 0; // 0x0\n+    field public static final int FLASH_MODE_OFF = 2; // 0x2\n+    field public static final int FLASH_MODE_ON = 1; // 0x1\n+  }\n+\n+  public static final class ImageCapture.Builder implements androidx.camera.core.ExtendableBuilder<androidx.camera.core.ImageCapture> {\n+    ctor public ImageCapture.Builder();\n+    method public androidx.camera.core.ImageCapture build();\n+    method public androidx.camera.core.ImageCapture.Builder setCaptureMode(int);\n+    method public androidx.camera.core.ImageCapture.Builder setFlashMode(int);\n+    method public androidx.camera.core.ImageCapture.Builder setIoExecutor(java.util.concurrent.Executor);\n+    method public androidx.camera.core.ImageCapture.Builder setTargetAspectRatio(int);\n+    method public androidx.camera.core.ImageCapture.Builder setTargetName(String);\n+    method public androidx.camera.core.ImageCapture.Builder setTargetResolution(android.util.Size);\n+    method public androidx.camera.core.ImageCapture.Builder setTargetRotation(int);\n+  }\n+\n+  public static final class ImageCapture.Metadata {\n+    ctor public ImageCapture.Metadata();\n+    method public android.location.Location? getLocation();\n+    method public boolean isReversedHorizontal();\n+    method public boolean isReversedVertical();\n+    method public void setLocation(android.location.Location?);\n+    method public void setReversedHorizontal(boolean);\n+    method public void setReversedVertical(boolean);\n+  }\n+\n+  public abstract static class ImageCapture.OnImageCapturedCallback {\n+    ctor public ImageCapture.OnImageCapturedCallback();\n+    method public void onCaptureSuccess(androidx.camera.core.ImageProxy);\n+    method public void onError(androidx.camera.core.ImageCaptureException);\n+  }\n+\n+  public static interface ImageCapture.OnImageSavedCallback {\n+    method public void onError(androidx.camera.core.ImageCaptureException);\n+    method public void onImageSaved(androidx.camera.core.ImageCapture.OutputFileResults);\n+  }\n+\n+  public static final class ImageCapture.OutputFileOptions {\n+  }\n+\n+  public static final class ImageCapture.OutputFileOptions.Builder {\n+    ctor public ImageCapture.OutputFileOptions.Builder(java.io.File);\n+    ctor public ImageCapture.OutputFileOptions.Builder(android.content.ContentResolver, android.net.Uri, android.content.ContentValues);\n+    ctor public ImageCapture.OutputFileOptions.Builder(java.io.OutputStream);\n+    method public androidx.camera.core.ImageCapture.OutputFileOptions build();\n+    method public androidx.camera.core.ImageCapture.OutputFileOptions.Builder setMetadata(androidx.camera.core.ImageCapture.Metadata);\n+  }\n+\n+  public static class ImageCapture.OutputFileResults {\n+    method public android.net.Uri? getSavedUri();\n+  }\n+\n+  public class ImageCaptureException extends java.lang.Exception {\n+    ctor public ImageCaptureException(int, String, Throwable?);\n+    method public int getImageCaptureError();\n+  }\n+\n+  public interface ImageInfo {\n+    method public int getRotationDegrees();\n+    method public long getTimestamp();\n+  }\n+\n+  public interface ImageProxy extends java.lang.AutoCloseable {\n+    method public void close();\n+    method public android.graphics.Rect getCropRect();\n+    method public int getFormat();\n+    method public int getHeight();\n+    method @androidx.camera.core.ExperimentalGetImage public android.media.Image? getImage();\n+    method public androidx.camera.core.ImageInfo getImageInfo();\n+    method public androidx.camera.core.ImageProxy.PlaneProxy![] getPlanes();\n+    method public int getWidth();\n+    method public void setCropRect(android.graphics.Rect?);\n+  }\n+\n+  public static interface ImageProxy.PlaneProxy {\n+    method public java.nio.ByteBuffer getBuffer();\n+    method public int getPixelStride();\n+    method public int getRowStride();\n+  }\n+\n+  public class InitializationException extends java.lang.Exception {\n+    ctor public InitializationException(String?);\n+    ctor public InitializationException(String?, Throwable?);\n+    ctor public InitializationException(Throwable?);\n+  }\n+\n+  public class MeteringPoint {\n+    method public float getSize();\n+  }\n+\n+  public abstract class MeteringPointFactory {\n+    method public final androidx.camera.core.MeteringPoint createPoint(float, float);\n+    method public final androidx.camera.core.MeteringPoint createPoint(float, float, float);\n+    method public static float getDefaultPointSize();\n+  }\n+\n+  public final class Preview extends androidx.camera.core.UseCase {\n+    method public int getTargetRotation();\n+    method @UiThread public void setSurfaceProvider(java.util.concurrent.Executor, androidx.camera.core.Preview.SurfaceProvider?);\n+    method @UiThread public void setSurfaceProvider(androidx.camera.core.Preview.SurfaceProvider?);\n+    method @androidx.camera.core.ExperimentalUseCaseGroup public void setTargetRotation(int);\n+  }\n+\n+  public static final class Preview.Builder implements androidx.camera.core.ExtendableBuilder<androidx.camera.core.Preview> {\n+    ctor public Preview.Builder();\n+    method public androidx.camera.core.Preview build();\n+    method public androidx.camera.core.Preview.Builder setTargetAspectRatio(int);\n+    method public androidx.camera.core.Preview.Builder setTargetName(String);\n+    method public androidx.camera.core.Preview.Builder setTargetResolution(android.util.Size);\n+    method public androidx.camera.core.Preview.Builder setTargetRotation(int);\n+  }\n+\n+  public static interface Preview.SurfaceProvider {\n+    method public void onSurfaceRequested(androidx.camera.core.SurfaceRequest);\n+  }\n+\n+  public class SurfaceOrientedMeteringPointFactory extends androidx.camera.core.MeteringPointFactory {\n+    ctor public SurfaceOrientedMeteringPointFactory(float, float);\n+    ctor public SurfaceOrientedMeteringPointFactory(float, float, androidx.camera.core.UseCase);\n+  }\n+\n+  public final class SurfaceRequest {\n+    method public void addRequestCancellationListener(java.util.concurrent.Executor, Runnable);\n+    method @androidx.camera.core.ExperimentalUseCaseGroup public void clearTransformationInfoListener();\n+    method public android.util.Size getResolution();\n+    method public void provideSurface(android.view.Surface, java.util.concurrent.Executor, androidx.core.util.Consumer<androidx.camera.core.SurfaceRequest.Result!>);\n+    method @androidx.camera.core.ExperimentalUseCaseGroup public void setTransformationInfoListener(java.util.concurrent.Executor, androidx.camera.core.SurfaceRequest.TransformationInfoListener);\n+    method public boolean willNotProvideSurface();\n+  }\n+\n+  @com.google.auto.value.AutoValue public abstract static class SurfaceRequest.Result {\n+    method public abstract int getResultCode();\n+    method public abstract android.view.Surface getSurface();\n+    field public static final int RESULT_INVALID_SURFACE = 2; // 0x2\n+    field public static final int RESULT_REQUEST_CANCELLED = 1; // 0x1\n+    field public static final int RESULT_SURFACE_ALREADY_PROVIDED = 3; // 0x3\n+    field public static final int RESULT_SURFACE_USED_SUCCESSFULLY = 0; // 0x0\n+    field public static final int RESULT_WILL_NOT_PROVIDE_SURFACE = 4; // 0x4\n+  }\n+\n+  @androidx.camera.core.ExperimentalUseCaseGroup @com.google.auto.value.AutoValue public abstract static class SurfaceRequest.TransformationInfo {\n+    method public abstract android.graphics.Rect getCropRect();\n+    method public abstract int getRotationDegrees();\n+  }\n+\n+  @androidx.camera.core.ExperimentalUseCaseGroup public static interface SurfaceRequest.TransformationInfoListener {\n+    method public void onTransformationInfoUpdate(androidx.camera.core.SurfaceRequest.TransformationInfo);\n+  }\n+\n+  public class TorchState {\n+    field public static final int OFF = 0; // 0x0\n+    field public static final int ON = 1; // 0x1\n+  }\n+\n+  public abstract class UseCase {\n+  }\n+\n+  @androidx.camera.core.ExperimentalUseCaseGroup public final class UseCaseGroup {\n+    method public java.util.List<androidx.camera.core.UseCase!> getUseCases();\n+    method public androidx.camera.core.ViewPort? getViewPort();\n+  }\n+\n+  @androidx.camera.core.ExperimentalUseCaseGroup public static final class UseCaseGroup.Builder {\n+    ctor public UseCaseGroup.Builder();\n+    method public androidx.camera.core.UseCaseGroup.Builder addUseCase(androidx.camera.core.UseCase);\n+    method public androidx.camera.core.UseCaseGroup build();\n+    method public androidx.camera.core.UseCaseGroup.Builder setViewPort(androidx.camera.core.ViewPort);\n+  }\n+\n+  @androidx.camera.core.ExperimentalUseCaseGroup public final class ViewPort {\n+    method public android.util.Rational getAspectRatio();\n+    method public int getRotation();\n+    method public int getScaleType();\n+    field public static final int FILL_CENTER = 1; // 0x1\n+    field public static final int FILL_END = 2; // 0x2\n+    field public static final int FILL_START = 0; // 0x0\n+    field public static final int FIT = 3; // 0x3\n+  }\n+\n+  @androidx.camera.core.ExperimentalUseCaseGroup public static final class ViewPort.Builder {\n+    ctor public ViewPort.Builder(android.util.Rational, int);\n+    method public androidx.camera.core.ViewPort build();\n+  }\n+\n+  public interface ZoomState {\n+    method public float getLinearZoom();\n+    method public float getMaxZoomRatio();\n+    method public float getMinZoomRatio();\n+    method public float getZoomRatio();\n+  }\n+\n+}\n+\ndiff --git a/camera/camera-core/api/res-1.0.0-beta11.txt b/camera/camera-core/api/res-1.0.0-beta11.txt\nnew file mode 100644\nindex 00000000000..e69de29bb2d\ndiff --git a/camera/camera-core/api/restricted_1.0.0-beta11.txt b/camera/camera-core/api/restricted_1.0.0-beta11.txt\nnew file mode 100644\nindex 00000000000..0a36e63f351\n--- /dev/null\n+++ b/camera/camera-core/api/restricted_1.0.0-beta11.txt\n@@ -0,0 +1,306 @@\n+// Signature format: 3.0\n+package androidx.camera.core {\n+\n+  public class AspectRatio {\n+    field public static final int RATIO_16_9 = 1; // 0x1\n+    field public static final int RATIO_4_3 = 0; // 0x0\n+  }\n+\n+  public interface Camera {\n+    method public androidx.camera.core.CameraControl getCameraControl();\n+    method public androidx.camera.core.CameraInfo getCameraInfo();\n+  }\n+\n+  public interface CameraControl {\n+    method public com.google.common.util.concurrent.ListenableFuture<java.lang.Void!> cancelFocusAndMetering();\n+    method public com.google.common.util.concurrent.ListenableFuture<java.lang.Void!> enableTorch(boolean);\n+    method public com.google.common.util.concurrent.ListenableFuture<java.lang.Void!> setLinearZoom(@FloatRange(from=0.0f, to=1.0f) float);\n+    method public com.google.common.util.concurrent.ListenableFuture<java.lang.Void!> setZoomRatio(float);\n+    method public com.google.common.util.concurrent.ListenableFuture<androidx.camera.core.FocusMeteringResult!> startFocusAndMetering(androidx.camera.core.FocusMeteringAction);\n+  }\n+\n+  public static final class CameraControl.OperationCanceledException extends java.lang.Exception {\n+  }\n+\n+  public interface CameraInfo {\n+    method public int getSensorRotationDegrees();\n+    method public int getSensorRotationDegrees(int);\n+    method public androidx.lifecycle.LiveData<java.lang.Integer!> getTorchState();\n+    method public androidx.lifecycle.LiveData<androidx.camera.core.ZoomState!> getZoomState();\n+    method public boolean hasFlashUnit();\n+  }\n+\n+  public final class",
    "Enable read - only access for kibana_system user ( elastic / x - pack - elasticsearch <issue_id> ) .": "diff --git a/docs/en/security/authorization.asciidoc b/docs/en/security/authorization.asciidoc\nindex 085d103e8d4..3d54e49b9cb 100644\n--- a/docs/en/security/authorization.asciidoc\n+++ b/docs/en/security/authorization.asciidoc\n@@ -72,10 +72,10 @@ information, see\n {kibana-ref}/xpack-dashboard-only-mode.html[{kib} Dashboard Only Mode].\n \n [[built-in-roles-kibana-system]] `kibana_system` ::\n-Grants access necessary for the {kib} system user\n-to read from and write to the {kib} indices and check the availability of the\n-{es} cluster. For more information, see\n-{kibana-ref}/using-kibana-with-security.html[Configuring Security in {kib}].\n+Grants access necessary for the <<kibana, Kibana system user>>\n+to read from and write to the Kibana indices and check the availability of the\n+Elasticsearch cluster. This role grants read access to the `.monitoring-*`\n+indices and read and write access to the `.reporting-*` indices.\n +\n NOTE: This role should not be assigned to users as the granted permissions may\n change between releases.",
    "avoid URI allocation and Exception creation in HttpBlobHandler": "diff --git a/blob/src/main/java/io/crate/http/netty/HttpBlobHandler.java b/blob/src/main/java/io/crate/http/netty/HttpBlobHandler.java\nindex 79a7955b11..a0988f16c2 100644\n--- a/blob/src/main/java/io/crate/http/netty/HttpBlobHandler.java\n+++ b/blob/src/main/java/io/crate/http/netty/HttpBlobHandler.java\n@@ -36,31 +36,12 @@ import org.elasticsearch.common.util.concurrent.EsRejectedExecutionException;\n import org.elasticsearch.indices.IndexMissingException;\n import org.jboss.netty.buffer.ChannelBuffer;\n import org.jboss.netty.buffer.ChannelBuffers;\n-import org.jboss.netty.channel.ChannelFuture;\n-import org.jboss.netty.channel.ChannelFutureListener;\n-import org.jboss.netty.channel.ChannelFutureProgressListener;\n-import org.jboss.netty.channel.ChannelHandlerContext;\n-import org.jboss.netty.channel.DefaultFileRegion;\n-import org.jboss.netty.channel.ExceptionEvent;\n-import org.jboss.netty.channel.FileRegion;\n-import org.jboss.netty.channel.LifeCycleAwareChannelHandler;\n-import org.jboss.netty.channel.MessageEvent;\n-import org.jboss.netty.channel.SimpleChannelUpstreamHandler;\n-import org.jboss.netty.handler.codec.http.DefaultHttpResponse;\n-import org.jboss.netty.handler.codec.http.HttpChunk;\n-import org.jboss.netty.handler.codec.http.HttpHeaders;\n-import org.jboss.netty.handler.codec.http.HttpMessage;\n-import org.jboss.netty.handler.codec.http.HttpMethod;\n-import org.jboss.netty.handler.codec.http.HttpRequest;\n-import org.jboss.netty.handler.codec.http.HttpResponse;\n-import org.jboss.netty.handler.codec.http.HttpResponseStatus;\n-import org.jboss.netty.handler.codec.http.HttpVersion;\n+import org.jboss.netty.channel.*;\n+import org.jboss.netty.handler.codec.http.*;\n import org.jboss.netty.util.CharsetUtil;\n \n import java.io.IOException;\n import java.io.RandomAccessFile;\n-import java.net.URI;\n-import java.net.URISyntaxException;\n import java.nio.channels.ClosedChannelException;\n import java.util.regex.Matcher;\n import java.util.regex.Pattern;\n@@ -74,20 +55,22 @@ import static org.jboss.netty.handler.codec.http.HttpVersion.HTTP_1_1;\n public class HttpBlobHandler extends SimpleChannelUpstreamHandler implements\n         LifeCycleAwareChannelHandler {\n \n-    public static final String CACHE_CONTROL_VALUE = \"max-age=315360000\";\n-    public static final String EXPIRES_VALUE = \"Thu, 31 Dec 2037 23:59:59 GMT\";\n-    public static final String BLOBS_ENDPOINT = \"/_blobs\";\n-    public static final Pattern pattern = Pattern.compile(String.format(\"^%s/([^_/][^/]*)/([0-9a-f]{40})$\", BLOBS_ENDPOINT));\n-    private static final ESLogger logger = Loggers.getLogger(HttpBlobHandler.class);\n+    private static final String CACHE_CONTROL_VALUE = \"max-age=315360000\";\n+    private static final String EXPIRES_VALUE = \"Thu, 31 Dec 2037 23:59:59 GMT\";\n+    private static final String BLOBS_ENDPOINT = \"/_blobs\";\n+    public static final Pattern BLOBS_PATTERN = Pattern.compile(String.format(\"^%s/([^_/][^/]*)/([0-9a-f]{40})$\", BLOBS_ENDPOINT));\n+    private static final ESLogger LOGGER = Loggers.getLogger(HttpBlobHandler.class);\n \n     private static final ChannelBuffer CONTINUE = ChannelBuffers.copiedBuffer(\n             \"HTTP/1.1 100 Continue\\r\\n\\r\\n\", CharsetUtil.US_ASCII);\n \n+    private static final Pattern CONTENT_RANGE_PATTERN = Pattern.compile(\"^bytes=(\\\\d+)-(\\\\d*)$\");\n+\n+    private final Matcher blobsMatcher = BLOBS_PATTERN.matcher(\"\");\n     private final BlobService blobService;\n     private final BlobIndices blobIndices;\n     private HttpMessage currentMessage;\n     private ChannelHandlerContext ctx;\n-    private static final Pattern contentRangePattern = Pattern.compile(\"^bytes=(\\\\d+)-(\\\\d*)$\");\n \n     private RemoteDigestBlob digestBlob;\n \n@@ -111,7 +94,7 @@ public class HttpBlobHandler extends SimpleChannelUpstreamHandler implements\n                 return true;\n             }\n             if (redirectAddress != null) {\n-                logger.trace(\"redirectAddress: {}\", redirectAddress);\n+                LOGGER.trace(\"redirectAddress: {}\", redirectAddress);\n                 sendRedirect(request, redirectAddress);\n                 return true;\n             }\n@@ -120,77 +103,35 @@ public class HttpBlobHandler extends SimpleChannelUpstreamHandler implements\n     }\n \n     @Override\n-    public void messageReceived(ChannelHandlerContext ctx, MessageEvent e)\n-            throws Exception {\n-\n+    public void messageReceived(ChannelHandlerContext ctx, MessageEvent e) throws Exception {\n         Object msg = e.getMessage();\n-        HttpMessage currentMessage = this.currentMessage;\n \n         if (msg instanceof HttpRequest) {\n-\n-            digestBlob = null;\n             HttpRequest request = (HttpRequest) msg;\n-            URI uri;\n-            try {\n-                uri = new URI(request.getUri());\n-            } catch (URISyntaxException ex) {\n-                // e.g. url like \"localhost:4200//\" throws exception\n-                // sendUpstream so that regular ES status is returned\n-                ctx.sendUpstream(e);\n-                return;\n-            }\n+            String uri = request.getUri();\n \n-            Matcher matcher = pattern.matcher(uri.getPath());\n-            if (uri.getPath().startsWith(BLOBS_ENDPOINT)) {\n-                if (!matcher.matches()) {\n-                    simpleResponse(HttpResponseStatus.NOT_FOUND, null);\n-                    return;\n-                }\n-            } else {\n-                this.currentMessage = null;\n+            if (!uri.startsWith(BLOBS_ENDPOINT)) {\n+                reset();\n                 ctx.sendUpstream(e);\n                 return;\n             }\n \n-            String index = matcher.group(1);\n-            String digest = matcher.group(2);\n-\n-            logger.trace(\"matches index:{} digest:{}\", index, digest);\n-            logger.trace(\"HTTPMessage:\\n{}\", msg);\n-\n-            index = BlobIndices.fullIndexName(index);\n-\n-            if (possibleRedirect(request, index, digest)) {\n+            Matcher matcher = blobsMatcher.reset(uri);\n+            if (!matcher.matches()) {\n                 reset();\n+                simpleResponse(HttpResponseStatus.NOT_FOUND, null);\n                 return;\n             }\n \n-            if (request.getMethod().equals(HttpMethod.GET)) {\n-                get(request, index, digest);\n-                reset();\n-            } else if (request.getMethod().equals(HttpMethod.HEAD)) {\n-                head(request, index, digest);\n-                reset();\n-            } else if (request.getMethod().equals(HttpMethod.PUT)) {\n-                put(request, index, digest);\n-            } else if (request.getMethod().equals(HttpMethod.DELETE)) {\n-                delete(index, digest);\n-                reset();\n-            } else {\n-                simpleResponse(HttpResponseStatus.METHOD_NOT_ALLOWED, null);\n-                reset();\n-            }\n+            handleBlobRequest(request, matcher);\n         } else if (msg instanceof HttpChunk) {\n-            HttpChunk chunk = (HttpChunk) msg;\n             if (currentMessage == null) {\n                 // the chunk is probably from a regular non-blob request.\n                 ctx.sendUpstream(e);\n                 return;\n             }\n-\n-            // write chunk to file\n+            HttpChunk chunk = (HttpChunk) msg;\n             writeToFile(chunk.getContent(), chunk.isLast(), false);\n-\n             if (chunk.isLast()) {\n                 reset();\n             }\n@@ -200,6 +141,38 @@ public class HttpBlobHandler extends SimpleChannelUpstreamHandler implements\n         }\n     }\n \n+    private void handleBlobRequest(HttpRequest request, Matcher matcher) throws IOException {\n+        digestBlob = null;\n+        String index = matcher.group(1);\n+        String digest = matcher.group(2);\n+\n+        LOGGER.trace(\"matches index:{} digest:{}\", index, digest);\n+        LOGGER.trace(\"HTTPMessage:%n{}\", request);\n+\n+        index = BlobIndices.fullIndexName(index);\n+\n+        if (possibleRedirect(request, index, digest)) {\n+            reset();\n+            return;\n+        }\n+\n+        if (request.getMethod().equals(HttpMethod.GET)) {\n+            get(request, index, digest);\n+            reset();\n+        } else if (request.getMethod().equals(HttpMethod.HEAD)) {\n+            head(request, index, digest);\n+            reset();\n+        } else if (request.getMethod().equals(HttpMethod.PUT)) {\n+            put(request, index, digest);\n+        } else if (request.getMethod().equals(HttpMethod.DELETE)) {\n+            delete(index, digest);\n+            reset();\n+        } else {\n+            simpleResponse(HttpResponseStatus.METHOD_NOT_ALLOWED, null);\n+            reset();\n+        }\n+    }\n+\n     private void reset() {\n         currentMessage = null;\n     }\n@@ -236,14 +209,14 @@ public class HttpBlobHandler extends SimpleChannelUpstreamHandler implements\n             throws Exception {\n         Throwable ex = e.getCause();\n         if (ex instanceof ClosedChannelException) {\n-            logger.trace(\"channel closed: {}\", ex.toString());\n+            LOGGER.trace(\"channel closed: {}\", ex.toString());\n             return;\n         } else if (ex instanceof IOException) {\n             String message = ex.getMessage();\n             if (message != null && message.contains(\"Connection reset by peer\")) {\n-                logger.debug(message);\n+                LOGGER.debug(message);\n             } else {\n-                logger.warn(message, e);\n+                LOGGER.warn(message, e);\n             }\n             return;\n         }\n@@ -263,7 +236,7 @@ public class HttpBlobHandler extends SimpleChannelUpstreamHandler implements\n             body = ex.getMessage();\n         } else {\n             status = HttpResponseStatus.INTERNAL_SERVER_ERROR;\n-            logger.error(\"unhandled exception:\", ex);\n+            LOGGER.error(\"unhandled exception:\", ex);\n         }\n         simpleResponse(status, body);\n     }\n@@ -304,9 +277,9 @@ public class HttpBlobHandler extends SimpleChannelUpstreamHandler implements\n     private void partialContentResponse(String range, HttpRequest request, String index, final String digest)\n         throws  IOException {\n         assert(range != null);\n-        Matcher matcher = contentRangePattern.matcher(range);\n+        Matcher matcher = CONTENT_RANGE_PATTERN.matcher(range);\n         if (!matcher.matches()) {\n-            logger.warn(\"Invalid byte-range: {}; returning full content\", range);\n+            LOGGER.warn(\"Invalid byte-range: {}; returning full content\", range);\n             fullContentResponse(request, index, digest);\n             return;\n         }\n@@ -318,7 +291,7 @@ public class HttpBlobHandler extends SimpleChannelUpstreamHandler implements\n             try {\n                 start = Long.parseLong(matcher.group(1));\n                 if (start > raf.length()) {\n-                    logger.warn(\"416 Requested Range not satisfiable\");\n+                    LOGGER.warn(\"416 Requested Range not satisfiable\");\n                     simpleResponse(HttpResponseStatus.REQUESTED_RANGE_NOT_SATISFIABLE, null);\n                     return;\n                 }\n@@ -327,7 +300,7 @@ public class HttpBlobHandler extends SimpleChannelUpstreamHandler implements\n                     end = Long.parseLong(matcher.group(2));\n                 }\n             } catch (NumberFormatException ex) {\n-                logger.error(\"Couldn't parse Range Header\", ex);\n+                LOGGER.error(\"Couldn't parse Range Header\", ex);\n                 start = 0;\n                 end = raf.length();\n             }\n@@ -351,7 +324,7 @@ public class HttpBlobHandler extends SimpleChannelUpstreamHandler implements\n             HttpResponse response = new DefaultHttpResponse(HTTP_1_1, OK);\n             HttpHeaders.setContentLength(response, raf.length());\n             setDefaultGetHeaders(response);\n-            logger.trace(\"HttpResponse: {}\", response);\n+            LOGGER.trace(\"HttpResponse: {}\", response);\n             ctx.getChannel().write(response);\n             ChannelFuture writeFuture = transferFile(digest, raf, 0, raf.length());\n             if (!HttpHeaders.isKeepAlive(request)) {\n@@ -368,13 +341,13 @@ public class HttpBlobHandler extends SimpleChannelUpstreamHandler implements\n         writeFuture.addListener(new ChannelFutureProgressListener() {\n             @Override\n             public void operationProgressed(ChannelFuture future, long amount, long current, long total) throws Exception {\n-                logger.debug(\"{}: {} / {} (+{})\", digest, current, total, amount);\n+                LOGGER.debug(\"{}: {} / {} (+{})\", digest, current, total, amount);\n             }\n \n             @Override\n             public void operationComplete(ChannelFuture future) throws Exception {\n                 region.releaseExternalResources();\n-  ",
    "Add a ScalaGenerator": "diff --git a/jOOQ-codegen/src/main/java/org/jooq/util/GenerationTool.java b/jOOQ-codegen/src/main/java/org/jooq/util/GenerationTool.java\nindex be3d3a2a80..03bd04b974 100644\n--- a/jOOQ-codegen/src/main/java/org/jooq/util/GenerationTool.java\n+++ b/jOOQ-codegen/src/main/java/org/jooq/util/GenerationTool.java\n@@ -496,7 +496,7 @@ public class GenerationTool {\n \n         // [#2801]\n         catch (ClassNotFoundException e) {\n-            if (className.startsWith(\"org.jooq.util.\")) {\n+            if (className.startsWith(\"org.jooq.util.\") && className.endsWith(\"Database\")) {\n                 log.warn(\"Licensing\", \"With jOOQ 3.2, licensing has changed, and your database may no longer be supported with jOOQ Open Source Edition. See http://www.jooq.org/licensing for details\");\n             }\n \ndiff --git a/jOOQ-codegen/src/main/java/org/jooq/util/JavaGenerator.java b/jOOQ-codegen/src/main/java/org/jooq/util/JavaGenerator.java\nindex c72108fc4a..f8d8a6146a 100644\n--- a/jOOQ-codegen/src/main/java/org/jooq/util/JavaGenerator.java\n+++ b/jOOQ-codegen/src/main/java/org/jooq/util/JavaGenerator.java\n@@ -43,6 +43,8 @@ package org.jooq.util;\n \n import static org.jooq.tools.StringUtils.defaultIfBlank;\n import static org.jooq.tools.StringUtils.defaultString;\n+import static org.jooq.util.JavaGenerator.Language.JAVA;\n+import static org.jooq.util.JavaGenerator.Language.SCALA;\n \n import java.io.File;\n import java.io.IOException;\n@@ -54,6 +56,7 @@ import java.util.ArrayList;\n import java.util.Arrays;\n import java.util.Calendar;\n import java.util.Collection;\n+import java.util.Collections;\n import java.util.HashMap;\n import java.util.HashSet;\n import java.util.LinkedHashMap;\n@@ -165,6 +168,24 @@ public class JavaGenerator extends AbstractGenerator {\n      */\n     private Set<File>                     files                        = new LinkedHashSet<File>();\n \n+    private final Language                language;\n+    private final boolean                 scala;\n+    private final String                  tokenVoid;\n+\n+    public JavaGenerator() {\n+        this(JAVA);\n+    }\n+\n+    JavaGenerator(Language language) {\n+        this.language = language;\n+        this.scala = (language == SCALA);\n+        this.tokenVoid = (scala ? \"Unit\" : \"void\");\n+    }\n+\n+    enum Language {\n+        JAVA, SCALA;\n+    }\n+\n     @Override\n     public final void generate(Database db) {\n         this.isoDate = DatatypeConverter.printDateTime(Calendar.getInstance(TimeZone.getTimeZone(\"UTC\")));\n@@ -359,7 +380,7 @@ public class JavaGenerator extends AbstractGenerator {\n         xx [/pro] */\n \n         log.info(\"Removing excess files\");\n-        empty(getStrategy().getFile(schema).getParentFile(), \".java\", files);\n+        empty(getStrategy().getFile(schema).getParentFile(), (scala ? \".scala\" : \".java\"), files);\n         files.clear();\n \n         // XXX [#651] Refactoring-cursor\n@@ -409,7 +430,11 @@ public class JavaGenerator extends AbstractGenerator {\n         xxxxxxxxxxxxxxxxx xxxxxxxx\n         xxxxxxxxxxxxxxxxxxxxxx xxxxxxxxxxxx xxxxxx xx xxx xxxxxx xx x x xxxxxxxxxxxxxxxxxxxxxxxx\n         xxxxxxxxxxxxxxxxxxxxxxxxxx xxxxxxxx\n-        xxxxxxxxxxxxxxxxxxx xxxxx xxxxxx xxxx\n+\n+        xx xxxxxxx\n+        \txxxxxxxxxxxxxxxxxxx xxxxxx xxxx\n+        xxxx\n+            xxxxxxxxxxxxxxxxxxx xxxxx xxxxxx xxxx\n \n         xxx xxxxxxxxxxxxxxxxxxxxxx xxxxx x xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx x\n             xxxxx xxxxxxxxxxxxx xxx x xxxxxxxxxxxxxxx\n@@ -421,7 +446,11 @@ public class JavaGenerator extends AbstractGenerator {\n             xxxxx xxxxxx xxxxxxxx x xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx\n \n             xxxxxxxxxxxxxxxxxxxxxxx xxxxx xxxxxxxxxxxxxxxxx xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx\n-            xxxxxxxxxxxxxxxxxxxxxxxxxx xxxxxx xxxxx xxxxxx xx x xxx xxxxxxxxxxxxxx xxx xxxxxx xxxxxxxxxxxx xxxxxxxxxx xxxxxxxx xxxxxxxxxxxxxxxx xxxxxxxxxx xxxxxxxxxx xxxxxxxxx xxxxxxx\n+\n+            xx xxxxxxx\n+            \txxxxxxxxxxxxxxxxxxxxxxx xx x xxxxxx x xxx xxxxxxxxxxxxxx xxx xxxxx xxxxxxxx xxxxxxxxxxxx xxxxxxxxxx xxxxxxxxxxxxxxxx xxxxxxxxxx xxxxxxxxxx xxxxxxxxx xxxxxxx\n+            xxxx\n+                xxxxxxxxxxxxxxxxxxxxxxxxxx xxxxxx xxxxx xxxxxx xx x xxx xxxxxxxxxxxxxx xxx xxxxxx xxxxxxxxxxxx xxxxxxxxxx xxxxxxxx xxxxxxxxxxxxxxxx xxxxxxxxxx xxxxxxxxxx xxxxxxxxx xxxxxxx\n         x\n \n         xxxxxxxxxxxxxxxxx\n@@ -450,7 +479,11 @@ public class JavaGenerator extends AbstractGenerator {\n             \"A class modelling foreign key relationships between tables of the <code>\" + schema.getOutputName() + \"</code> schema\");\n         printClassAnnotations(out, schema);\n \n-        out.println(\"public class Keys {\");\n+        if (scala)\n+        \tout.println(\"object Keys {\");\n+        else\n+            out.println(\"public class Keys {\");\n+\n         out.tab(1).header(\"IDENTITY definitions\");\n         out.println();\n \n@@ -468,8 +501,13 @@ public class JavaGenerator extends AbstractGenerator {\n                     final String identityId = getStrategy().getJavaIdentifier(identity.getColumn().getContainer());\n                     final int block = allIdentities.size() / INITIALISER_SIZE;\n \n-                    out.tab(1).println(\"public static final %s<%s, %s> IDENTITY_%s = Identities%s.IDENTITY_%s;\",\n-                        Identity.class, identityType, columnType, identityId, block, identityId);\n+                    if (scala)\n+                        out.tab(1).println(\"val IDENTITY_%s = Identities%s.IDENTITY_%s\",\n+                                identityId, block, identityId);\n+                    else\n+                        out.tab(1).println(\"public static final %s<%s, %s> IDENTITY_%s = Identities%s.IDENTITY_%s;\",\n+                            Identity.class, identityType, columnType, identityId, block, identityId);\n+\n                     allIdentities.add(identity);\n                 }\n             }\n@@ -491,7 +529,11 @@ public class JavaGenerator extends AbstractGenerator {\n                     final String keyId = getStrategy().getJavaIdentifier(uniqueKey);\n                     final int block = allUniqueKeys.size() / INITIALISER_SIZE;\n \n-                    out.tab(1).println(\"public static final %s<%s> %s = UniqueKeys%s.%s;\", UniqueKey.class, keyType, keyId, block, keyId);\n+                    if (scala)\n+                        out.tab(1).println(\"val %s = UniqueKeys%s.%s\", keyId, block, keyId);\n+                    else\n+                        out.tab(1).println(\"public static final %s<%s> %s = UniqueKeys%s.%s;\", UniqueKey.class, keyType, keyId, block, keyId);\n+\n                     allUniqueKeys.add(uniqueKey);\n                 }\n             }\n@@ -514,7 +556,11 @@ public class JavaGenerator extends AbstractGenerator {\n                     final String keyId = getStrategy().getJavaIdentifier(foreignKey);\n                     final int block = allForeignKeys.size() / INITIALISER_SIZE;\n \n-                    out.tab(1).println(\"public static final %s<%s, %s> %s = ForeignKeys%s.%s;\", ForeignKey.class, keyType, referencedType, keyId, block, keyId);\n+                    if (scala)\n+                    \tout.tab(1).println(\"val %s = ForeignKeys%s.%s\", keyId, block, keyId);\n+                    else\n+                        out.tab(1).println(\"public static final %s<%s, %s> %s = ForeignKeys%s.%s;\", ForeignKey.class, keyType, referencedType, keyId, block, keyId);\n+\n                     allForeignKeys.add(foreignKey);\n                 }\n             }\n@@ -583,16 +629,30 @@ public class JavaGenerator extends AbstractGenerator {\n             }\n \n             out.println();\n-            out.tab(1).println(\"private static class Identities%s extends %s {\", block, AbstractKeys.class);\n-        }\n \n-        out.tab(2).println(\"public static %s<%s, %s> %s = createIdentity(%s, %s);\",\n-            Identity.class,\n-            out.ref(getStrategy().getFullJavaClassName(identity.getTable(), Mode.RECORD)),\n-            out.ref(getJavaType(identity.getColumn().getType())),\n-            getStrategy().getJavaIdentifier(identity),\n-            out.ref(getStrategy().getFullJavaIdentifier(identity.getColumn().getContainer()), 2),\n-            out.ref(getStrategy().getFullJavaIdentifier(identity.getColumn()), colRefSegments(identity.getColumn())));\n+            if (scala)\n+            \tout.tab(1).println(\"private object Identities%s extends %s {\", block, AbstractKeys.class);\n+            else\n+                out.tab(1).println(\"private static class Identities%s extends %s {\", block, AbstractKeys.class);\n+        }\n+\n+        if (scala)\n+            out.tab(2).println(\"val %s : %s[%s, %s] = %s.createIdentity(%s, %s)\",\n+                    getStrategy().getJavaIdentifier(identity),\n+                    Identity.class,\n+                    out.ref(getStrategy().getFullJavaClassName(identity.getTable(), Mode.RECORD)),\n+                    out.ref(getJavaType(identity.getColumn().getType())),\n+                    AbstractKeys.class,\n+                    out.ref(getStrategy().getFullJavaIdentifier(identity.getColumn().getContainer()), 2),\n+                    out.ref(getStrategy().getFullJavaIdentifier(identity.getColumn()), colRefSegments(identity.getColumn())));\n+        else\n+            out.tab(2).println(\"public static %s<%s, %s> %s = createIdentity(%s, %s);\",\n+                Identity.class,\n+                out.ref(getStrategy().getFullJavaClassName(identity.getTable(), Mode.RECORD)),\n+                out.ref(getJavaType(identity.getColumn().getType())),\n+                getStrategy().getJavaIdentifier(identity),\n+                out.ref(getStrategy().getFullJavaIdentifier(identity.getColumn().getContainer()), 2),\n+                out.ref(getStrategy().getFullJavaIdentifier(identity.getColumn()), colRefSegments(identity.getColumn())));\n     }\n \n     protected void printUniqueKey(JavaWriter out, int uniqueKeyCounter, UniqueKeyDefinition uniqueKey) {\n@@ -605,15 +665,28 @@ public class JavaGenerator extends AbstractGenerator {\n             }\n \n             out.println();\n-            out.tab(1).println(\"private static class UniqueKeys%s extends %s {\", block, AbstractKeys.class);\n+\n+            if (scala)\n+            \tout.tab(1).println(\"private object UniqueKeys%s extends %s {\", block, AbstractKeys.class);\n+            else\n+                out.tab(1).println(\"private static class UniqueKeys%s extends %s {\", block, AbstractKeys.class);\n         }\n \n-        out.tab(2).println(\"public static final %s<%s> %s = createUniqueKey(%s, [[%s]]);\",\n-            UniqueKey.class,\n-            out.ref(getStrategy().getFullJavaClassName(uniqueKey.getTable(), Mode.RECORD)),\n-            getStrategy().getJavaIdentifier(uniqueKey),\n-            out.ref(getStrategy().getFullJavaIdentifier(uniqueKey.getTable()), 2),\n-            out.ref(getStrategy().getFullJavaIdentifiers(uniqueKey.getKeyColumns()), colRefSegments(null)));\n+        if (scala)\n+            out.tab(2).println(\"val %s : %s[%s] = %s.createUniqueKey(%s, [[%s]])\",\n+                    getStrategy().getJavaIdentifier(uniqueKey),\n+                    UniqueKey.class,\n+                    out.ref(getStrategy().getFullJavaClassName(uniqueKey.getTable(), Mode.RECORD)),\n+                    AbstractKeys.class,\n+                    out.ref(getStrategy().getFullJavaIdentifier(uniqueKey.getTable()), 2),\n+                    out.ref(getStrategy().getFullJavaIdentifiers(uniqueKey.getKeyColumns()), colRefSegments(null)));\n+        else\n+            out.tab(2).println(\"public static final %s<%s> %s = createUniqueKey(%s, [[%s]]);\",\n+                UniqueKey.class,\n+                out.ref(getStrategy().getFullJavaClassName(uniqueKey.getTable(), Mode.RECORD)),\n+                getStrategy().getJavaIdentifier(uniqueKey),\n+                out.ref(getStrategy().getFullJavaIdentifier(uniqueKey.getTable()), 2),\n+                out.ref(getStrategy().getFullJavaIdentifiers(uniqueKey.getKeyColumns()), colRefSegments(null)));\n     }\n \n     protected void printForeignKey(JavaWriter out, int foreignKeyCounter, ForeignKeyDefinition foreignKey) {\n@@ -626,17 +699,32 @@ public class JavaGenerator extends AbstractGenerator {\n             }\n \n             out.println();\n-            out.tab(1).println(\"private static class ForeignKeys%s extends %s {\", block, AbstractKeys.class);\n-        }\n \n-        out.tab(2).println(\"public static final %s<%s, %s> %s = createForeignKey(%s, %s, [[%s]]);\",\n-            ForeignKey.class,\n-            out.ref(getStrategy().getFullJavaClassName(foreignKey.getKeyTable(), Mode.RECORD)),\n-            out.ref(getStrategy().getFullJavaClassName(foreignKey.getReferencedTable(), Mode.RECORD)),\n-            getStrategy().getJavaIdentifier(foreignKey),\n-            out.ref(getStrategy().getFullJavaIdentifier(foreignKey.getReferencedKey()), 2),\n-            out.ref(getStrategy().getFullJavaIdentifier(foreignKey.getKeyTable()), 2),\n-            out.ref(getStrategy().getFullJavaIdentifiers(foreignKey.getKeyColumns()), colRefSegments(null)));\n+            if (scala)\n+            \tout.tab(1).println(\"private object ForeignKeys%s extends %s {\", block, AbstractKeys.class);\n+            else\n+                out.tab(1).println(\"private static class ForeignKeys%s extends %s {\", block, AbstractKeys.class);\n+        }\n+\n+        if (scala)\n+        \tout.tab(2).println(\"val %s : %s[%s, %s] = %s.createForeignKey(%s, %s, [[%s]])\",\n+                    getStrategy().getJavaIdentifier(foreignKey),\n+                    ForeignKey.class,\n+                    out.ref(getStrategy().getFullJavaClassName(foreignKey.getKeyTable(), Mode.RECORD)),\n+                    out.ref(getStrategy().getFullJavaClassName(foreignKey.getReferencedTable(), Mode.RECORD)),\n+                    AbstractKeys.class,\n+                    out.ref(getStrategy().getFullJavaIdentifier(foreignKey.getReferencedKey()), 2),\n+                    out.ref(getStrategy().getFullJavaIdentifier(foreignKey.getKeyTable()), 2),\n+                    out.ref(getStrategy().getFullJavaIdentifiers(foreignKey.getKeyColumns()), colRefSegments(null)));\n+        else\n+            out.tab(2).println(\"public static final %s<%s, %s> %s = createForeignKey(%s, %s, [[%s]]);\",\n+                ForeignKey.class,\n+                out.ref(getStrategy().getFullJavaClassName(foreignKey.getKeyTable(), Mode.RECORD)),\n+                out.ref(getStrategy().getFullJavaClassName(foreignKey.getReferencedTable(), Mode.RECORD)),\n+                getStrategy().getJavaIdentifier(foreignKey),\n+                out.ref(getStrategy().getFullJavaIdentifier(foreignKey.getReferencedKey()), 2),\n+                out.ref(getStrategy().getFullJavaIdentifier(foreignKey.getKeyTable()), 2),\n+                out.ref(getStrategy().getFullJavaIdentifiers(foreignKey.getKeyColumns()), colRefSegments(null)));\n     }\n \n     protected void generateRecords(SchemaDefinition schema) {\n@@ -711,7 +799,12 @@ public class JavaGenerator extends AbstractGenerator {\n         // [#3130] Invalid UDTs may have a degree of 0\n         if (degree > 0 && degree <= Constants.MAX_ROW_DEGREE) {\n             rowType = refRowType(out, columns);\n-            rowTypeRecord = out.ref(Record.class.getName() + degree) + \"<\" + rowType + \">\";\n+\n+            if (scala)\n+            \trowTypeRecord = out.ref(Record.class.getName() + degree) + \"[\" + rowType + \"]\";\n+            else\n+                rowTypeRecord = out.ref(Record.class.getName() + degree) + \"<\" + rowType + \">\";\n+\n             interfaces.add(rowTypeRecord);\n         }\n \n@@ -719,14 +812,18 @@ public class JavaGenerator extends AbstractGenerator {\n             interfaces.add(out.ref(getStrategy().getFullJavaClassName(tableOrUdt, Mode.INTERFACE)));\n         }\n \n-        out.println(\"public class %s extends %s<%s>[[before= implements ][%s]] {\", className, baseClass, className, interfaces);\n+        if (scala)\n+            out.println(\"class %s extends %s[%s](%s)[[before= with ][%s]] {\", className, baseClass, className, tableIdentifier, interfaces);\n+        else\n+            out.println(\"public class %s extends %s<%s>[[before= implements ][%s]] {\", className, baseClass, className, interfaces);\n+\n         out.printSerial();\n \n         for (int i = 0; i < degree; i++) {\n             TypedElementDefinition<?> column = columns.get(i);\n \n             final String comment = StringUtils.defaultString(column.getComment());\n-            final String setterReturnType = fluentSetters() ? className : \"void\";\n+            final String setterReturnType = fluentSetters() ? className : tokenVoid;\n             final String setter = getStrategy().getJavaSetterName(column, Mode.DEFAULT);\n             final String getter = getStrategy().getJavaGetterName(column, Mode.DEFAULT);\n             final String type = out.ref(getJavaType(column.getType()));\n@@ -734,12 +831,22 @@ public class JavaGenerator extends AbstractGenerator {\n             final boolean isUDT = column.getType().isUDT();\n \n             out.tab(1).javadoc(\"Setter for <code>%s</code>.%s\", name, defaultIfBlank(\" \" + comment, \"\"));\n-            out.tab(1).overrideIf(generateInterfaces() && !generateImmutablePojos() && !isUDT);\n-            out.tab(1).println(\"public %s %s(%s value) {\", setterReturnType, setter, type);\n-            out.tab(2).println(\"setValue(%s, value);\", i);\n-            if (fluentSetters())\n-                out.tab(2).println(\"return this;\");\n-            out.tab(1).println(\"}\");\n+\n+            if (scala) {\n+                out.tab(1).println(\"def %s(value : %s) : %s = {\", setter, type, setterReturnType);\n+                out.tab(2).println(\"setValue(%s, value)\", i);\n+                if (fluentSetters())\n+                    out.tab(2).println(\"this\");\n+                out.tab(1).println(\"}\");\n+            }\n+            else {\n+                out.tab(1).overrideIf(generateInterfaces() && !generateImmutablePojos() && !isUDT);\n+                out.tab(1).println(\"public %s %s(%s value) {\", setterReturnType, setter, type);\n+                out.tab(2).println(\"setValue(%s, value);\", i);\n+                if (fluentSetters())\n+                    out.tab(2).println(\"return this;\");\n+                out.tab(1).println(\"}\");\n+            }\n \n             // [#3117] Avoid covariant setters for UDTs when generating interfaces\n             if (generateInterfaces() && !generateImmutablePojos() && isUDT) {\n@@ -747,24 +854,46 @@ public class JavaGenerator extends AbstractGenerator {\n \n                 out.tab(1).javadoc(\"Setter for <code>%s</code>.%s\", name, defaultIfBlank(\" \" + comment, \"\"));\n                 out.tab(1).override();\n-                out.tab(1).println(\"public %s %s(%s value) {\", setterReturnType, setter, typeInterface);\n-                out.tab(2).println(\"if (value == null)\");\n-                out.tab(3).println(\"setValue(%s, null);\", i);\n-                out.tab(2).println(\"else\");\n-                out.tab(3).println(\"setValue(%s, value.into(new %s()));\", i, type);\n-                if (fluentSetters())\n-                    out.tab(2).println(\"return this;\");\n-                out.tab(1).println(\"}\");\n+\n+            ",
    "Removing my todo list . . .": "diff --git a/todo_casey.txt b/todo_casey.txt\ndeleted file mode 100644\nindex edabc35be..000000000\n--- a/todo_casey.txt\n+++ /dev/null\n@@ -1,744 +0,0 @@\n-0043 _ALPHA_\n-\n-# Hex colors are always in RGB, if you set colorMode(HSB, 255); and then set a color with #ffffff it will display the color at RGB\n-\n-the println buffer is crashing. run println for a long time watch.\n-\n-\n-/ / / / / / / / / /\n-\n-I'm totally confused about how mouseDown keyDown mouseUp keyUp is supposed to be working so i can't document it. do you have simple examples?\n-below is what i've been trying:\n-\n-int mx = 0;\n-int my = 0;\n-void setup() {\n-  size(200, 200);\n-  background(102);\n-}\n-void loop() {\n-  rect(mx, my, 50, 50);\n-}\n-//public void mouseDown(int x, int y) {\n-//  mx = x;\n-//  my = y;\n-//}\n-//public boolean mouseDown(Event e, int x, int y) {\n-//  mx = x;\n-//  my = y;\n-//  return true;\n-//}\n-public void mouseDown(int x, int y, int button) {\n-  mx = x;\n-  my = y;\n-}\n-  \n-\n-/ / / / / / / / / /\n-\n-\n-\n-\n-\n-\n-\n-\n-Notes from Version 37 -- PC Windows2000 Professional\n-\n-/ / / / / / / / / /\n-Frequently i'll trying to play a program with an error. Proce55ing will tell me that i have a syntax error. I will correct the error, but when i hit run it then give me a sequence of error text:\n-Exception occurred during event dispatching:\n-java.lang.NullPointerException\n-\n-if you quit the environment and then repost in the code it will run fine.\n-\n-for example run this problematic code:\n-ex. \n-color rr = #FFCC00;\n-fill(255);\n-rect(20, 20, 50, 50);\n-fill(rr);\n-rect(50, 50, 50, 50);\n-\n-then fix the error and run again:\n-//ex. \n-color rr = #FFCC00;\n-fill(255);\n-rect(20, 20, 50, 50);\n-fill(rr);\n-rect(50, 50, 50, 50);\n-\n-\n-/ / / / / / / / / /\n-history is super cool. no problems yet with it.\n-\n-/ / / / / / / / / /\n-the \"double\" bug is back\n-proce55ing thinks the following numbers are a double:\n-float a = .5;\n-float b = 0.5;\n-\n-/ / / / / / / / / /\n-when you click on the link for proce55ing reference it should take you to the index page, not the environment page\n-\n-\n-\n-\n-/ / / / / / / / / /\n-/ / / / / / / / / /\n-/ / / / / / / / / /\n-\n-Extended notes from Version 36 -- PC Windows2000 Professional\n-\n-/ / / / / / / / / /\n-background() is not working\n-\n-not working here:\n-size(200, 200);\n-background(255, 255, 255);\n-fill(255, 204, 0);\n-rect(30, 20, 50, 50);\n-\n-but is working here:\n-void setup() {\n-  size(200, 200);\n-  background(255, 255, 255);\n-}\n-void loop() {\n-  noStroke();\n-  fill(255, 204, 0);\n-  rect(30, 20, 50, 50);\n-}\n-\n-/ / / / / / / / / /\n-fill() is not detecting if an int or color is being passed in...\n-\n-ex.\n-color cc = #ffcc00;\n-fill(cc);\n-rect(30, 20, 55, 55);\n-\n-\n-/ / / / / / / / / /\n-\n-\n-\n-Notes from Version 36\n-\n-\n-///////////////////////////////////\n-\n-after an applet with an image exports, it will load fine once, but not\n-after?\n-the applet loads fine the first time and displays the image, but when you\n-hard refresh, it only displays a black box in the place the image was. it\n-will not longer load.\n-actually soft refresh is fine but fn-refresh kills the images. after this\n-point, no images will load. if explorer is restarted the problem is fixed.\n-\n-///////////////////////////////////\n-\n-in advanced mode (java mode) you have to quit p5 and reopen to see changes\n-to the code. if you make a change and hit run button, the change is not\n-visible\n-\n-\n-///////////////////////////////////\n-\n-the fill() method with one parameter is not distinguishing if the one parameter is an int of the datatype color. need to check the first four bits i think.\n-\n-ex. \n-color rr = #FFCC00;\n-fill(255);\n-rect(20, 20, 50, 50);\n-fill(rr);\n-rect(50, 50, 50, 50);\n-\n-\n-///////////////////////////////////\n-\n-\n-Notes from Version 35\n-\n-///////////////////////////////////\n-\n-Tag -- I'm it. Clean and review all documentation. Examples.\n-\n-///////////////////////////////////\n-HIGH PRIORITY\n-\n-background() is not working\n-\n-curveVertex() is not behaving like curve(). is this your intention?\n-\n-imageMode() seems to be gone\n-\n-\n-///////////////////////////////////\n-\n-LOW PRIORITY\n-\n-setPixel(i, j, #99CC00); // not working anymore Syntax error: unexpected token: CC00\n-\n-when the image is 100x100 or so and the window is 120x120, the mouse calls are off when the cursor enters and leaves the upper left corner.\n-ex.\n-void setup() { size(100,100); }\n-void loop() {\n-  fill(102);\n-  rect(mouseX - 5, mouseY - 5, 10, 10);\n-}\n-\n-\n-triangle_strip, quad_strip are no filling without outlines\n-ex.\n-fill(204, 204, 0);\n-beginShape(TRIANGLE_STRIP);\n-vertex(30, 75);\n-vertex(40, 20);\n-vertex(50, 75);\n-vertex(60, 20);\n-vertex(70, 75);\n-vertex(80, 20);\n-vertex(90, 75);\n-endShape();\n-\n-There should be an option to \"delete\" in file menu (the list can get really long)\n-\n-How is the number chosen for sketch_??? (it seems random when \"new\" activated)\n-\n-box is not opaque\n-ex.\n-translate(58, 48, 0); \n-rotateY(0.5);\n-box(40);\n-\n-if there is no call to size() in setup(), could there be a default size?\n-\n-\n-////////////////////////////////////////////////////////////////\n-////////////////////////////////////////////////////////////////\n-\n-more bugs for version35\n-\n-if an image name has a number in it, it will not load\n-\n-after an applet with an image exports, it will load fine once, but not after? \n-it seems that each image will load into the browser once, but no more.\n-the applet loads fine the first time and displays the image, but when you hard refresh, it only displays a black box in the place the image was. it will not longer load.\n-actually soft refresh is fine but fn-refresh kills the images. after this point, no images will load. if explorer is restarted the problem is fixed.\n-\n-in advanced mode (java mode) you have to quit p5 and reopen to see changes to the code. if you make a change and hit run button, the change is not visible\n-\n-questions for documentation\n-are images included in the .jar on export to applet?\n-\n-\n-Fun. Export sketchbook. \n-\n-Exports the entire contents of the sketchbook to a web presentation...\n-\n-\n-////////////////////////////////////////////////////////////////\n-\n-Done (Send to Ben)\n-Icons for 32px and 16px\n-Splash screen\n-New buttons for GUI\n-\n-Todo\n-Add examples to cvs (ask ben where to put)\n-\n-Icons\n-macosx: 128 pixel splash, then 48,32,16,12 pixel sizes\n-macos9: 32, 16, 12 pixel sizes\n-windows: 32, 16 pixel\n-linux: none currently\n-\n-\n-WEB\n-a _ add documentation for \"width\" and \"height\"\n-a _ Re-document environment to account for sketchbook\n-a X Mention images must go in the data directory within the sketch directory\n-a _ New curve docs for Catmull \n-a X Color mode images don't match with the code!\n-a X Make sure Tissue code is correct in the software section\n-\n-a _ Discussion board working\n-a _   Admin password changed\n-a _   Users obscured unless already logged in\n-a _   Finish fixing the type style\n-a _ Script for adding people to the list...\n-a _ What is the status on serial???\n-\n-b _ change header \"radians, degrees, conversion\"\n-b _ increase height of top header\n-b _ javascript for top header to alternate through images\n-b _ Docs for mouseDown and keyDown\n-b _ Switch name of \"Info\" to Information\n-b _   Categories within Information:\n-b _   Proce55ing in brief / Introduction (answer what and why)\n-b _   People\n-b _   Copyright and Licensing\n-b _   Contact and feedback\n-b _   Links\n-b _ Download page\n-b _   Requirements\n-b _   Links to files\n-b _   Installation instructions\n-b _ Include FAQ on the top right of every page (Information / FAQ)\n-b _   Include questions What is Proce55ing? Why is it called Proce55ing? Who is involved?   \n-b _ Remove Happenings from the upper left of every page -- link only from home page\n-b _ Automate the examples section\n-b _ Automate the software section\n-b _ Software\n-b _   Make anti-aliased version of Tissue, change colors to greens\n-b _   Include new software from Peter and Golan\n-b _   Include code for Valence or must remove\n-b _ Email people for participation in Software and Discussion d-designer e-educator a-artist\n-b _   US d    Peter Cho\n-b _   US aed  Golan Levin\n-b _   US a    Kelly Heaton\n-b _   US a    Mark Napier\n-b _   AU a    Lia\n-b _   US ae   Joshua Davis\n-b _   US a    Josh On\n-b _   GB d    James Tindall\n-b _   US e    Dan Boyarski\n-b _   DE de   Joachim Sauter\n-b _   CH de   Elise Co\n-b _   ?? de   James Patterson\n-b _   US eda  Maeda\n-b _   FI ae   Juha Huuskonen\n-b _   GB e    Gillian\n-\n-      In addition, ask people to make software\n-      yugop\n-      *jared\n-      *sami\n-      marius\n-      *erik natski\n-      *manny tan\n-      *omar\n-      axel (busy)\n-      reed\n-      *nik!!!\n-      ade ward\n-\n-\n-EXAMPLES\n-a _ Add to cvs (ask ben where)\n-b _ Complete set for beta\n-\n- \n-REFERENCE\n-a _ Build reference section for type\n-a _ Add datatype conversion between char and byte\n-a _ Alter doc for the 1 pixel lines on 3D objects\n-a X Environment. Editor Features\n-a X Data. Byte, Char, Color, String Datatype conversion\n-a X Object\n-a _ Colors. Creating and Reading color\n-a _ Shape. BeginShape (curveVertex)\n-a _ IO. Serial???\n-b _ Reference (New categories)\n-b _   Download & Installation\n-b _   Getting Started(Language basics)\n-b _   Programming basics\n-b _ Document message window including println() and print()\n-b _ Complete the Complete Reference\n-b _ Add TechNotes? (What is a better name?)\n-b _ Where are classes documented?\n-b _ Where are comments, statement, etc. documented?\n-b _ Make note regarding convex polygons\n-b _ Add a section of programming basics to the reference\n-      comment\n-      block\n-      statement\n-      statement terminator\n-      \"execute\"\n-      parameter\n-b_ Add Getting Started to reference\n-      Comments\n-      Statement\n-      ; Statement terminator\n-\n-\n-Questions\n-_ _ Can we input video through serial???\n-_ _ Can we incorporate helper funcions such at grid() or invisibles() to show the matrix or also\n-    the center points of various shapes that are being drawn\n-_ _ Should basic math function like abs() should have an int prototype\n-_ _ What are we doing about convex polygons?\n-_ _ A key command for inserting function prototypes, such as ctl-f to add a for loop\n-_ _ Make a second version of all drawing primitives that are objects so you can:\n-      rectangle.height = 55;\n-      rectangle.height = 120;\n-      rectangle.angle = PI;\n-_ _ mouseX, mouseY, width, height, pmouseX, pmouseY should be reserved and create errors when people try to assign them (l-value error?)\n-_ _ Should we discuss bitwise operators?\n-_ _ I don't think the links to Proce55ing.net and Reference should be in the \"file\" menu\n-\n-\n-\n-\n-\n-/////////////////////////////////////////////////////\n-\n-BELOW FOLLOW NOTES THAT I DON'T WANT TO LOSE...\n-\n-/////////////////////////////////////////////////////\n-\n-Lessons from Blujay website\n-\n-Tutorial\n-  Foreward\n-  Installation (Windows, Mac, Linux)\n-  Getting Started - edit, compile, execute\n-  A bit more...\n-  Creating a new project\n-  Debugging\n-  Creating applets\n-  Creating stand-alone applications\n-  Other operations\n-\n-Users\n-\n-\n-/////////////////////////////////////////////////////\n-\n-Uploading from CVS to webserver\n-\n-What is the ACG webserver: Gabo\n-\n-- ssh to gabo gabo.media.mit.edu\n-- login as fred, a lovely fellow\n-- navigate to docroot.p5 and...\n-- cvs update -d\n-- cvs update -P\n-\n-\n-\n-/////////////////////////////////////////////////////\n-\n-Proce55ing Concepts (both technical and design)\n-  Coordinate systems (Cartisian, <<radial>> )(object coordinates vs. environmental)\n-  Data ?? or is this broken down into array, variable\n-  File\n-  Color (different spaces and mappings)\n-  Algebra\n-  Parameterized form\n-  Curves (Bezier vs Catmull-Rom, other)\n-  Trigonometry/Geometry\n-  Abstraction\n-  Transformations |using Push and Pop| matrix stack...\n-  Algorithm\n-  Analog vs. Digital\n-  Object-Oriented design\n-  Vector vs. Raster ( a matter of prepresentation, not form )\n-  I/O (Serial Communication . also USB...)\n-\n-  Image (signal) processing\n-  Computer as a generalized system (big computer, small computer)\n-  Array\n-  Variable\n-\n-  Other potential Concepts:\n-  Artificial Life\n-  Artificial Intelligence\n-  Network\n-  Multiuser\n-\n-\n-  There should be a series of tools written (in processing) that help elucidate the concepts\n-  Color picker, Transformations, Curves, Coordinates, Trigonometry, Parameterized form\n-\n-\n-/////////////////////////////////////////////////////\n-\n-THE BOOK\n-\n-How do I discuss the larger issues of interaction, motion, form, structure???\n-A. This is primarily a design/art book. These are the major issues supported through technical discussion\n-\n-It's not about \"how to design\" but how to think about design within the context of programmatic media\n-Or is it programming within the context of design/art. with design/art as a subtext...\n-NO is is definately about the media. interactive media. with programming being essential for support\n-A synthesis or aesthetics and technique. A synthesis of theory and practice...\n-\n-I need to find three excellent sources for each of these concepts...\n-Kernigan & Ritchie, Petzhold, Hillis, Foley and vanDamn, Algorithms, Lev Manevich\n-\n-The reference section explains how something is done and provides definitions\n-The concepts section explains a concept from scratch in detail and in context\n-\n-Both the reference and the examples refer to the topics...\n-The reference can allude to the concepts, but act as a refresher. Concepts \"teach\" from scratch.\n-This is a nonlinear book...\n-Concepts also refer to certain examples...\n-\n-Have a alphabetical reference of methods all keywords that maps to the reference structure\n-Include the general reference in the book, but not the technical reference\n-\n-Proce55ing exists outside of the continually shifting commercial software market\n-\n-Remember to develop a dictionary. Terminology is an important part of learning\n-\n-throughout the book, different feels. should not feel like\n-proce55ing is a tool for only one style\n-  a. clean flat (casey)\n-  b. data viz (ben)\n-  c. drawings+photocopy (rough)\n-  d. photographic polish\n-\n-?? Should arguments be called parameters?\n-\n-computers treat numbers in a mathematical way, \n-but we don't perceive color this way. for us, color perception is relative...\n-we adapt our perception to the context of the environment...\n-\n-\n-\n-////////////////////////////////////////////////////////////////////\n-\n-Questions for profile...\n-\n-When and how did you start making software?\n-Do you consider making art/design and programming separate tasks or the same?\n-\n-\n-\n-\n-////////////////////////////////////////////////////////////////////\n-\n-Structure for the technical reference...\n-\"Category\" is hidden from users\n-\n-Name           Line\n-Category       Shape\n-Example        (image) line(20, 30, 55, 55);\n-Syntax         line(int x1, int y1, int x2, int y2);\n-Parameters     x1  The x-coordinate of the first point\n-               y2  The y-coordinate of the first point\n-               x2  The x-coordinate of the second point\n-               y2  The y-coordinate of the sedond point\n-Description    This method draws a line to the screen. \n-               A line is a direct path between two points.\n-               Blah...\n-Returns        None\n-Availablility  Proce55ing _ALPHA_\n-Related        beginShape(LINES);\n-               beginShape(LINE_STRIP);\n-               beginShape(LINE_LOOP);\n-\n-\n-advanced documentation, bit operators...\n-\n-/////////////////////////////////////////////////////////////////////\n-\n-tail -f /home/web/logs/processing-error_log\n-\n-// Running commands within a perl file\n-`mv BApplet.java BApplet.temp`;\n-\n-//////////////////////////////////////////////////////////////////////\n-\n-Proce55ing Summer Plan\n-\n-June\n-Release alpha\n-\n-July \n-Correct documentation for Alpha\n-Write documentation for Beta, general and technical\n-Commission software and quotes for BBS\n-\n-August\n-Develop complete set of examples\n-\n-September\n-\n-\n-//////////////////////////////////////////////////////////////////////\n-\n-Beginning\n-Environment\n-Data\n-Color\n-Shape\n-Image\n-I/O\n-Control\n-Math\n-Transform\n-Lights & Camera\n-\n-\n-//////////////////////////////////////////////////////////////////////\n-\n-Book\n-Most sections are totally independent...\n-\n-//\n-\n-v1.1\n-Begin (Getting Started: Download, Installation, Programming Basics)\n-Form\n-Motion\n-Interact\n-Color\n-XX Type\n-XX Space\n-Interact\n-End\n-\n-//\n-\n-v1.2\n-Begin (Getting Started: Download, Installation, Running a program)\n-\n-Elements\n-Form \n-Motion\n-Response\n-Color \n-Image\n-Type\n-Space\n-\n-Concepts\n-Reference (API, Language Reference, Alphabetical index & Subject index, Bagel + Java)\n-\n-End\n-\n-//\n-\n-v2.0\n-Adapt  (adaptive interface)  \n-Emerge (emergent systems)\n-Evolve (a-life)\n-Play   (games)\n-Sonic  (sound) // ( This could be an entire book easily )\n-Touch  (tangible) // ( This could be an entire book easily )\n-\n-\n-//////////////////////////////////////////////////////////////////////\n-\n-REFERENCE/DOCUMENTATION\n-\n-v1.0\n-//Download (how to get the software)\n-//Install (how to install the software)\n-Proce55ing Environment (how to use and what it does)\n-Language Reference (the language through prose and examples)\n-Complete Language Reference (categories)\n-TechNotes (the finer points, tricks, and tips)\n-\n-//v1.1\n-//IDE - Environment\n-//API - Reference\n-\n-\n-v1.2\n-\n-//Download (how to get it) - on the download page, very obvious\n-Language (only advanced, the previous basic reference is reformatted as a tutorial)\n-Environment (how to use and what it does)\n-Install (how to install it - WIN, LINUX, MACX, MAC9)\n-TechNotes (the finer points, tricks, and tips)\n-\n-\n-\n-LEARNING\n-\n-Examples - annotated code samples\n-  Elements\n-  Form\n-  Motion\n-  Response\n-  Color\n-  Image\n-  Type\n-  Space\n-Tutorials - walk through different tasks (improved previous reference)\n-  Begin (statement, command, comment, program, ... )\n-  Elements\n-  Form\n-  Motion\n-  Response\n-  Color\n-  Image\n-  Type\n-  Space\n-  Document\n-Concepts - basic ideas that support the work\n-Glossary - definitions, terminology\n-XX Workshops - we do workshops (maybe leave for happenings)\n-XX Curriculum - \n-\n-\n-\n-//////////////////////////////////////////////////////////////////////\n-\n-DICTIONARY/GLOSSARY\n-\n-compiler\n-API\n-IDE\n-variable\n-program\n-algorithm\n-pseudo-random\n-bit\n-byte\n-char\n-boolean\n-bit-depth\n-gif\n-jpg\n-hexidecimal\n-serial\n-block\n-class\n-object\n-instance\n-parameter\n-constant\n-constructor\n-expression\n-statement\n-data tyte\n-operator\n-keyword\n-\n-\n-//////////////////////////////////////////////////////////////////////\n-\n-WEB EXAMPLE SECTIONS (examples of workshop problems -- all designed)\n-\n-Proce55ing ALPHA SUMMER 2002 \n-\n-Proce55ing BETA WINTER 2003\n-\n-Proce55ing 1.0 FALL 2003\n-Elements\n-Form\n-Motion\n-Response (action-reaction)\n-Color \n-Image\n-Type\n-Space\n-\n-Proce55ing 2.0 FALL 2004\n-Adapt    (adaptive interface)  \n-Emerge   (emergent systems)\n-Evolve   (alife)\n-Play     (games)\n-Sonic    (sound synthesis and analysis)\n-Touch    (physical computing)\n-Info     (information visualization)\n-Connect  (multi-user)\n-\n-\n-\n-",
    "Fixed bug in onMeasure ( ) overflow safeguard . . Fixes <issue_id>": "diff --git a/src/org/thoughtcrime/securesms/ConversationItem.java b/src/org/thoughtcrime/securesms/ConversationItem.java\nindex c116579df5..78054f742d 100644\n--- a/src/org/thoughtcrime/securesms/ConversationItem.java\n+++ b/src/org/thoughtcrime/securesms/ConversationItem.java\n@@ -252,8 +252,8 @@ public class ConversationItem extends LinearLayout\n \n     if (needsMeasure) {\n       if (measureCalls < MAX_MEASURE_CALLS) {\n-        measure(widthMeasureSpec, heightMeasureSpec);\n         measureCalls++;\n+        measure(widthMeasureSpec, heightMeasureSpec);\n       } else {\n         Log.w(TAG, \"Hit measure() cap of \" + MAX_MEASURE_CALLS);\n       }",
    "Modify array copy snippets to avoid merge without frame state .": "diff --git a/compiler/src/org.graalvm.compiler.hotspot/src/org/graalvm/compiler/hotspot/phases/aot/ReplaceConstantNodesPhase.java b/compiler/src/org.graalvm.compiler.hotspot/src/org/graalvm/compiler/hotspot/phases/aot/ReplaceConstantNodesPhase.java\nindex e6db0f74d4f..b10f0a36373 100644\n--- a/compiler/src/org.graalvm.compiler.hotspot/src/org/graalvm/compiler/hotspot/phases/aot/ReplaceConstantNodesPhase.java\n+++ b/compiler/src/org.graalvm.compiler.hotspot/src/org/graalvm/compiler/hotspot/phases/aot/ReplaceConstantNodesPhase.java\n@@ -32,6 +32,7 @@ import java.util.HashSet;\n import java.util.List;\n \n import org.graalvm.collections.EconomicMap;\n+import org.graalvm.collections.Equivalence;\n import org.graalvm.compiler.core.common.cfg.BlockMap;\n import org.graalvm.compiler.core.common.type.ObjectStamp;\n import org.graalvm.compiler.core.common.type.Stamp;\n@@ -318,7 +319,7 @@ public class ReplaceConstantNodesPhase extends BasePhase<CoreProviders> {\n         NodeMap<Block> nodeToBlock = schedule.getNodeToBlockMap();\n         BlockMap<List<Node>> blockToNodes = schedule.getBlockToNodesMap();\n \n-        EconomicMap<Block, Node> blockToExisting = EconomicMap.create();\n+        EconomicMap<Block, Node> blockToExisting = EconomicMap.create(Equivalence.IDENTITY);\n         for (Node n : node.usages().filter(n -> isReplacementNode(n))) {\n             blockToExisting.put(nodeToBlock.get(n), n);\n         }\ndiff --git a/compiler/src/org.graalvm.compiler.hotspot/src/org/graalvm/compiler/hotspot/replacements/InstanceOfSnippets.java b/compiler/src/org.graalvm.compiler.hotspot/src/org/graalvm/compiler/hotspot/replacements/InstanceOfSnippets.java\nindex 31b5830f830..f890f42cbf5 100644\n--- a/compiler/src/org.graalvm.compiler.hotspot/src/org/graalvm/compiler/hotspot/replacements/InstanceOfSnippets.java\n+++ b/compiler/src/org.graalvm.compiler.hotspot/src/org/graalvm/compiler/hotspot/replacements/InstanceOfSnippets.java\n@@ -220,7 +220,7 @@ public class InstanceOfSnippets implements Snippets {\n \n     @Snippet\n     public static Object isAssignableFrom(@NonNullParameter Class<?> thisClassNonNull, Class<?> otherClass, Object trueValue, Object falseValue, @ConstantParameter Counters counters) {\n-        if (otherClass == null) {\n+        if (BranchProbabilityNode.probability(BranchProbabilityNode.DEOPT_PROBABILITY, otherClass == null)) {\n             DeoptimizeNode.deopt(DeoptimizationAction.InvalidateReprofile, DeoptimizationReason.NullCheckException);\n             return false;\n         }\ndiff --git a/compiler/src/org.graalvm.compiler.hotspot/src/org/graalvm/compiler/hotspot/replacements/MonitorSnippets.java b/compiler/src/org.graalvm.compiler.hotspot/src/org/graalvm/compiler/hotspot/replacements/MonitorSnippets.java\nindex 0caedabffce..7517ef12a8f 100644\n--- a/compiler/src/org.graalvm.compiler.hotspot/src/org/graalvm/compiler/hotspot/replacements/MonitorSnippets.java\n+++ b/compiler/src/org.graalvm.compiler.hotspot/src/org/graalvm/compiler/hotspot/replacements/MonitorSnippets.java\n@@ -113,6 +113,7 @@ import org.graalvm.compiler.nodes.ReturnNode;\n import org.graalvm.compiler.nodes.StructuredGraph;\n import org.graalvm.compiler.nodes.ValueNode;\n import org.graalvm.compiler.nodes.debug.DynamicCounterNode;\n+import org.graalvm.compiler.nodes.extended.BranchProbabilityNode;\n import org.graalvm.compiler.nodes.extended.ForeignCallNode;\n import org.graalvm.compiler.nodes.extended.MembarNode;\n import org.graalvm.compiler.nodes.java.MethodCallTargetNode;\n@@ -474,7 +475,7 @@ public class MonitorSnippets implements Snippets {\n     public static void monitorenterStub(Object object, @ConstantParameter int lockDepth, @ConstantParameter boolean trace) {\n         verifyOop(object);\n         incCounter();\n-        if (object == null) {\n+        if (BranchProbabilityNode.probability(BranchProbabilityNode.DEOPT_PROBABILITY, object == null)) {\n             DeoptimizeNode.deopt(DeoptimizationAction.InvalidateReprofile, DeoptimizationReason.NullCheckException);\n         }\n         // BeginLockScope nodes do not read from object so a use of object\ndiff --git a/compiler/src/org.graalvm.compiler.hotspot/src/org/graalvm/compiler/hotspot/replacements/NewObjectSnippets.java b/compiler/src/org.graalvm.compiler.hotspot/src/org/graalvm/compiler/hotspot/replacements/NewObjectSnippets.java\nindex 7159baebea5..b4abab0208c 100644\n--- a/compiler/src/org.graalvm.compiler.hotspot/src/org/graalvm/compiler/hotspot/replacements/NewObjectSnippets.java\n+++ b/compiler/src/org.graalvm.compiler.hotspot/src/org/graalvm/compiler/hotspot/replacements/NewObjectSnippets.java\n@@ -78,8 +78,10 @@ import static org.graalvm.compiler.hotspot.replacements.HotspotSnippetsOptions.P\n import static org.graalvm.compiler.nodes.PiArrayNode.piArrayCastToSnippetReplaceeStamp;\n import static org.graalvm.compiler.nodes.PiNode.piCastToSnippetReplaceeStamp;\n import static org.graalvm.compiler.nodes.extended.BranchProbabilityNode.FAST_PATH_PROBABILITY;\n+import static org.graalvm.compiler.nodes.extended.BranchProbabilityNode.VERY_FAST_PATH_PROBABILITY;\n import static org.graalvm.compiler.nodes.extended.BranchProbabilityNode.FREQUENT_PROBABILITY;\n import static org.graalvm.compiler.nodes.extended.BranchProbabilityNode.SLOW_PATH_PROBABILITY;\n+import static org.graalvm.compiler.nodes.extended.BranchProbabilityNode.DEOPT_PROBABILITY;\n import static org.graalvm.compiler.nodes.extended.BranchProbabilityNode.probability;\n import static org.graalvm.compiler.replacements.ReplacementsUtil.REPLACEMENTS_ASSERTIONS_ENABLED;\n import static org.graalvm.compiler.replacements.ReplacementsUtil.runtimeAssert;\n@@ -117,6 +119,7 @@ import org.graalvm.compiler.nodes.StructuredGraph;\n import org.graalvm.compiler.nodes.ValueNode;\n import org.graalvm.compiler.nodes.debug.DynamicCounterNode;\n import org.graalvm.compiler.nodes.debug.VerifyHeapNode;\n+import org.graalvm.compiler.nodes.extended.BranchProbabilityNode;\n import org.graalvm.compiler.nodes.extended.ForeignCallNode;\n import org.graalvm.compiler.nodes.extended.MembarNode;\n import org.graalvm.compiler.nodes.java.DynamicNewArrayNode;\n@@ -295,12 +298,12 @@ public class NewObjectSnippets implements Snippets {\n                     @ConstantParameter boolean emitMemoryBarrier,\n                     @ConstantParameter Register threadRegister,\n                     @ConstantParameter Counters counters) {\n-        if (probability(SLOW_PATH_PROBABILITY, type == null)) {\n+        if (probability(DEOPT_PROBABILITY, type == null)) {\n             DeoptimizeNode.deopt(None, RuntimeConstraint);\n         }\n         Class<?> nonNullType = PiNode.piCastNonNullClass(type, SnippetAnchorNode.anchor());\n \n-        if (probability(SLOW_PATH_PROBABILITY, DynamicNewInstanceNode.throwsInstantiationException(type, classClass))) {\n+        if (probability(DEOPT_PROBABILITY, DynamicNewInstanceNode.throwsInstantiationException(type, classClass))) {\n             DeoptimizeNode.deopt(None, RuntimeConstraint);\n         }\n \n@@ -317,7 +320,7 @@ public class NewObjectSnippets implements Snippets {\n         if (probability(FAST_PATH_PROBABILITY, !hub.isNull())) {\n             KlassPointer nonNullHub = ClassGetHubNode.piCastNonNull(hub, SnippetAnchorNode.anchor());\n \n-            if (probability(FAST_PATH_PROBABILITY, isInstanceKlassFullyInitialized(nonNullHub))) {\n+            if (probability(VERY_FAST_PATH_PROBABILITY, isInstanceKlassFullyInitialized(nonNullHub))) {\n                 int layoutHelper = readLayoutHelper(nonNullHub);\n                 /*\n                  * src/share/vm/oops/klass.hpp: For instances, layout helper is a positive number,\n@@ -489,7 +492,7 @@ public class NewObjectSnippets implements Snippets {\n      * Deoptimizes if {@code obj == null} otherwise returns {@code obj}.\n      */\n     private static Object nonNullOrDeopt(Object obj) {\n-        if (obj == null) {\n+        if (BranchProbabilityNode.probability(BranchProbabilityNode.DEOPT_PROBABILITY, obj == null)) {\n             DeoptimizeNode.deopt(None, RuntimeConstraint);\n         }\n         return obj;\n@@ -539,12 +542,12 @@ public class NewObjectSnippets implements Snippets {\n         }\n \n         KlassPointer klass = loadKlassFromObject(elementType, arrayKlassOffset(INJECTED_VMCONFIG), CLASS_ARRAY_KLASS_LOCATION);\n-        if (klass.isNull()) {\n+        if (probability(DEOPT_PROBABILITY, klass.isNull())) {\n             DeoptimizeNode.deopt(None, RuntimeConstraint);\n         }\n         KlassPointer nonNullKlass = ClassGetHubNode.piCastNonNull(klass, SnippetAnchorNode.anchor());\n \n-        if (length < 0) {\n+        if (probability(DEOPT_PROBABILITY, length < 0)) {\n             DeoptimizeNode.deopt(None, RuntimeConstraint);\n         }\n         int layoutHelper;\ndiff --git a/compiler/src/org.graalvm.compiler.nodes/src/org/graalvm/compiler/nodes/IfNode.java b/compiler/src/org.graalvm.compiler.nodes/src/org/graalvm/compiler/nodes/IfNode.java\nindex 4a2e94be4a8..cc3b823bc19 100644\n--- a/compiler/src/org.graalvm.compiler.nodes/src/org/graalvm/compiler/nodes/IfNode.java\n+++ b/compiler/src/org.graalvm.compiler.nodes/src/org/graalvm/compiler/nodes/IfNode.java\n@@ -1217,7 +1217,7 @@ public final class IfNode extends ControlSplitNode implements Simplifiable, LIRL\n \n         ValuePhiNode phi = (ValuePhiNode) generalPhi;\n \n-        EconomicMap<Node, NodeColor> coloredNodes = EconomicMap.create(8);\n+        EconomicMap<Node, NodeColor> coloredNodes = EconomicMap.create(Equivalence.IDENTITY, 8);\n \n         /*\n          * Check that the condition uses the phi and that there is only one user of the condition\ndiff --git a/compiler/src/org.graalvm.compiler.nodes/src/org/graalvm/compiler/nodes/extended/BranchProbabilityNode.java b/compiler/src/org.graalvm.compiler.nodes/src/org/graalvm/compiler/nodes/extended/BranchProbabilityNode.java\nindex 0414604d959..4866b81b166 100644\n--- a/compiler/src/org.graalvm.compiler.nodes/src/org/graalvm/compiler/nodes/extended/BranchProbabilityNode.java\n+++ b/compiler/src/org.graalvm.compiler.nodes/src/org/graalvm/compiler/nodes/extended/BranchProbabilityNode.java\n@@ -74,6 +74,8 @@ public final class BranchProbabilityNode extends FloatingNode implements Simplif\n     public static final double VERY_FAST_PATH_PROBABILITY = 0.999;\n     public static final double VERY_SLOW_PATH_PROBABILITY = 1 - VERY_FAST_PATH_PROBABILITY;\n \n+    public static final double DEOPT_PROBABILITY = 0.0;\n+\n     /*\n      * This probability may seem excessive, but it makes a difference in long running loops. Lets\n      * say a loop is executed 100k times and it has a few null checks with probability 0.999. As\ndiff --git a/compiler/src/org.graalvm.compiler.phases.common/src/org/graalvm/compiler/phases/common/ConditionalEliminationPhase.java b/compiler/src/org.graalvm.compiler.phases.common/src/org/graalvm/compiler/phases/common/ConditionalEliminationPhase.java\nindex b0d04949148..0f26bdbc6d9 100644\n--- a/compiler/src/org.graalvm.compiler.phases.common/src/org/graalvm/compiler/phases/common/ConditionalEliminationPhase.java\n+++ b/compiler/src/org.graalvm.compiler.phases.common/src/org/graalvm/compiler/phases/common/ConditionalEliminationPhase.java\n@@ -309,7 +309,7 @@ public class ConditionalEliminationPhase extends BasePhase<CoreProviders> {\n             this.conditions = new ArrayDeque<>();\n             tool = GraphUtil.getDefaultSimplifier(context.getMetaAccess(), context.getConstantReflection(), context.getConstantFieldProvider(), false, graph.getAssumptions(), graph.getOptions(),\n                             context.getLowerer());\n-            mergeMaps = EconomicMap.create();\n+            mergeMaps = EconomicMap.create(Equivalence.IDENTITY);\n         }\n \n         protected void processConditionAnchor(ConditionAnchorNode node) {\n@@ -616,7 +616,7 @@ public class ConditionalEliminationPhase extends BasePhase<CoreProviders> {\n                         Stamp newStamp = infoElement.getStamp();\n                         if (phi.stamp(NodeView.DEFAULT).tryImproveWith(newStamp) != null) {\n                             if (mergeMap == null) {\n-                                mergeMap = EconomicMap.create();\n+                                mergeMap = EconomicMap.create(Equivalence.IDENTITY);\n                                 mergeMaps.put(merge, mergeMap);\n                             }\n \ndiff --git a/compiler/src/org.graalvm.compiler.phases.common/src/org/graalvm/compiler/phases/common/FixReadsPhase.java b/compiler/src/org.graalvm.compiler.phases.common/src/org/graalvm/compiler/phases/common/FixReadsPhase.java\nindex 8f413bf408d..ce8db5260f6 100644\n--- a/compiler/src/org.graalvm.compiler.phases.common/src/org/graalvm/compiler/phases/common/FixReadsPhase.java\n+++ b/compiler/src/org.graalvm.compiler.phases.common/src/org/graalvm/compiler/phases/common/FixReadsPhase.java\n@@ -25,6 +25,7 @@\n package org.graalvm.compiler.phases.common;\n \n import org.graalvm.collections.EconomicMap;\n+import org.graalvm.collections.Equivalence;\n import org.graalvm.collections.MapCursor;\n import org.graalvm.compiler.core.common.GraalOptions;\n import org.graalvm.compiler.core.common.cfg.BlockMap;\n@@ -209,7 +210,7 @@ public class FixReadsPhase extends BasePhase<LowTierContext> {\n             this.schedule = schedule;\n             this.metaAccess = metaAccess;\n             blockActionStart = new BlockMap<>(schedule.getCFG());\n-            endMaps = EconomicMap.create();\n+            endMaps = EconomicMap.create(Equivalence.IDENTITY);\n             stampMap = graph.createNodeMap();\n             undoOperations = new NodeStack();\n             replaceConstantInputs = replaceInputsWithConstants && GraalOptions.ReplaceInputsWithConstantsBasedOnStamps.getValue(graph.getOptions());\n@@ -310,7 +311,7 @@ public class FixReadsPhase extends BasePhase<LowTierContext> {\n \n                 if (currentEndMap == null || !currentEndMap.isEmpty()) {\n \n-                    EconomicMap<ValueNode, Stamp> endMap = EconomicMap.create();\n+                    EconomicMap<ValueNode, Stamp> endMap = EconomicMap.create(Equivalence.IDENTITY);\n \n                     // Process phis\n                     for (ValuePhiNode phi : merge.valuePhis()) {\ndiff --git a/compiler/src/org.graalvm.compiler.phases.common/src/org/graalvm/compiler/phases/common/PropagateDeoptimizeProbabilityPhase.java b/compiler/src/org.graalvm.compiler.phases.common/src/org/graalvm/compiler/phases/common/PropagateDeoptimizeProbabilityPhase.java\nindex 372c07aee97..e470003a6da 100644\n--- a/compiler/src/org.graalvm.compiler.phases.common/src/org/graalvm/compiler/phases/common/PropagateDeoptimizeProbabilityPhase.java\n+++ b/compiler/src/org.graalvm.compiler.phases.common/src/org/graalvm/compiler/phases/common/PropagateDeoptimizeProbabilityPhase.java\n@@ -26,6 +26,7 @@ package org.graalvm.compiler.phases.common;\n \n import org.graalvm.collections.EconomicMap;\n import org.graalvm.collections.EconomicSet;\n+import org.graalvm.collections.Equivalence;\n import org.graalvm.collections.MapCursor;\n import org.graalvm.compiler.graph.NodeStack;\n import org.graalvm.compiler.nodes.AbstractBeginNode;\n@@ -52,7 +53,7 @@ public class PropagateDeoptimizeProbabilityPhase extends BasePhase<CoreProviders\n         if (graph.hasNode(AbstractDeoptimizeNode.TYPE)) {\n \n             NodeStack stack = new NodeStack();\n-            EconomicMap<ControlSplitNode, EconomicSet<AbstractBeginNode>> reachableSplits = EconomicMap.create();\n+            EconomicMap<ControlSplitNode, EconomicSet<AbstractBeginNode>> reachableSplits = EconomicMap.create(Equivalence.IDENTITY);\n \n             // Mark all control flow nodes that are post-dominated by a deoptimization.\n             for (AbstractDeoptimizeNode d : graph.getNodes(AbstractDeoptimizeNode.TYPE)) {\ndiff --git a/compiler/src/org.graalvm.compiler.phases.common/src/org/graalvm/compiler/phases/common/inlining/InliningUtil.java b/compiler/src/org.graalvm.compiler.phases.common/src/org/graalvm/compiler/phases/common/inlining/InliningUtil.java\nindex 55e38416df9..94b93e128d1 100644\n--- a/compiler/src/org.graalvm.compiler.phases.common/src/org/graalvm/compiler/phases/common/inlining/InliningUtil.java\n+++ b/compiler/src/org.graalvm.compiler.phases.common/src/org/graalvm/compiler/phases/common/inlining/InliningUtil.java\n@@ -728,7 +728,7 @@ public class InliningUtil extends ValueMergeUtil {\n         FrameState stateAtReturn = invoke.stateAfter();\n         FrameState outerFrameState = null;\n         JavaKind invokeReturnKind = invoke.asNode().getStackKind();\n-        EconomicMap<Node, Node> replacements = EconomicMap.create();\n+        EconomicMap<Node, Node> replacements = EconomicMap.create(Equivalence.IDENTITY);\n         for (FrameState original : inlineGraph.getNodes(FrameState.TYPE)) {\n             FrameState frameState = (FrameState) duplicates.get(original);\n             if (frameState != null && frameState.isAlive()) {\ndiff --git a/compiler/src/org.graalvm.compiler.replacements.aarch64/src/org/graalvm/compiler/replacements/aarch64/AArch64IntegerArithmeticSnippets.java b/compiler/src/org.graalvm.compiler.replacements.aarch64/src/org/graalvm/compiler/replacements/aarch64/AArch64IntegerArithmeticSnippets.java\nindex 0763c12dda7..7e0ec631286 100644\n--- a/compiler/src/org.graalvm.compiler.replacements.aarch64/src/org/graalvm/compiler/replacements/aarch64/AArch64IntegerArithmeticSnippets.java\n+++ b/compiler/src/org.graalvm.compiler.replacements.aarch64/src/org/graalvm/compiler/replacements/aarch64/AArch64IntegerArithmeticSnippets.java\n@@ -44,6 +44,7 @@ import org.graalvm.compiler.nodes.calc.SignedDivNode;\n import org.graalvm.compiler.nodes.calc.SignedRemNode;\n import org.graalvm.compiler.nodes.calc.UnsignedDivNode;\n import org.graalvm.compiler.nodes.calc.UnsignedRemNode;\n+import org.graalvm.compiler.nodes.extended.BranchProbabilityNode;\n import org.graalvm.compiler.nodes.spi.LoweringTool;\n import org.graalvm.compiler.nodes.spi.NodeLIRBuilderTool;\n import org.graalvm.compiler.options.OptionValues;\n@@ -183,14 +184,14 @@ public class AArch64IntegerArithmeticSnippets extends AbstractTemplates implemen\n     }\n \n     private static void checkForZero(int y) {\n-        if (y == 0) {\n+        if (BranchProbabilityNode.probability(BranchProbabilityNode.DEOPT_PROBABILITY, y == 0)) {\n             // \"/ by zero\"\n             DeoptimizeNode.deopt(DeoptimizationAction.InvalidateReprofile, DeoptimizationReason.ArithmeticException);\n         }\n     }\n \n     private static void checkForZero(long y) {\n-        if (y == 0) {\n+        if (BranchProbabilityNode.probability(BranchProbabilityNode.DEOPT_PROBABILITY, y == 0)) {\n             // \"/ by zero\"\n             DeoptimizeNode.deopt(DeoptimizationAction.InvalidateReprofile, DeoptimizationReason.ArithmeticException);\n         }\ndiff --git a/compiler/src/org.graalvm.compiler.replacements.amd64/src/org/graalvm/compiler/replacements/amd64/AMD64StringUTF16Substitutions.java b/compiler/src/org.graalvm.compiler.replacements.amd64/src/org/graalvm/compiler/replacements/amd64/AMD64StringUTF16Substitutions.java\nindex be73d734fdd..fc1a2de922e 100644\n--- a/compiler/src/org.graalvm.compiler.replacements.amd64/src/org/graalvm/compiler/replacements/amd64/AMD64StringUTF16Substitutions.java\n+++ b/compiler/src/org.graalvm.compiler.replacements.amd64/src/org/graalvm/compiler/replacements/amd64/AMD64StringUTF16Substitutions.java\n@@ -181,9 +181,7 @@ public class AMD64StringUTF16Substitutions {\n      */\n     @MethodSubstitution\n     public static int compress(char[] src, int srcIndex, byte[] dest, int destIndex, int len) {\n-        if (len < 0 || srcIndex < 0 || (srcIndex + len > src.length) || destIndex < 0 || (destIndex + len > dest.length)) {\n-            DeoptimizeNode.deopt(DeoptimizationAction.None, DeoptimizationReason.BoundsCheckException);\n-        }\n+        checkLimits(src.length, srcIndex, dest.length, destIndex, len);\n \n         Pointer srcPointer = Word.objectToTrackedPointer(src).add(charArrayBaseOffset(INJECTED)).add(srcIndex * charArrayIndexScale(INJECTED));\n         Pointer destPointer = Word.objectToTrackedPointer(dest).add(byteArrayBaseOffset(INJECTED)).add(destIndex * byteArrayIndexScale(INJECTED));\n@@ -204,13 +202,17 @@ public class AMD64StringUTF16Substitutions {\n      */\n     @MethodSubstitution\n     public static int compress(byte[] src, int srcIndex, byte[] dest, int destIndex, int len) {\n-        if (len < 0 || srcIndex < 0 || (srcIndex * 2 + len * 2 > src.length) || destIndex < 0 || (destIndex + len > dest.length)) {\n-            DeoptimizeNode.deopt(DeoptimizationAction.None, DeoptimizationReason.BoundsCheckException);\n-        }\n+        checkLimits(src.length >> 1, srcIndex, dest.length, destIndex, len);\n \n         Pointer srcPointer = Word.objectToTrackedPointer(src).add(byteArrayBaseOffset(INJECTED)).add(srcIndex * 2 * byteArrayIndexScale(INJECTED));\n         Pointer destPointer = Word.objectToTrackedPointer(dest).add(byteArrayBaseOffset(INJECTED)).add(destIndex * byteArrayIndexScale(INJECTED));\n         return AMD64StringUTF16CompressNode.compress(srcPointer, destPointer, len, JavaKind.Byte);\n     }\n \n+    private static void checkLimits(int srcLen, int srcIndex, int destLen, int destIndex, int len) {\n+        if (len < 0 || srcIndex < 0 || (srcIndex + len > srcLen) || destIndex < 0 || (destIndex + len > destLen)) {\n+            DeoptimizeNode.deopt(DeoptimizationAction.None, DeoptimizationReason.BoundsCheckException);\n+        }\n+    }\n+\n }\ndiff --git a/compiler/src/org.graalvm.compiler.replacements/src/org/graalvm/compiler/replacements/ArraySubstitutions.java b/compiler/src/org.graalvm.compiler.replacements/src/org/graalvm/compiler/replacements/ArraySubstitutions.java\nindex 980a0691ca5..afae42a0a9a 100644\n--- a/compiler/src/org.graalvm.compiler.replacements/src/org/graalvm/compiler/replacements/ArraySubstitutions.java\n+++ b/compiler/src/org.graalvm.compiler.replacements/src/org/graalvm/compiler/replacements/ArraySubstitutions.java\n@@ -29,6 +29,7 @@ import java.lang.reflect.Array;\n import org.graalvm.compiler.api.replacements.ClassSubstitution;\n import org.graalvm.compiler.api.replacements.MethodSubstitution;\n import org.graalvm.compiler.nodes.DeoptimizeNode;\n+import org.graalvm.compiler.nodes.extended.BranchProbabilityNode;\n import org.graalvm.compiler.nodes.java.ArrayLengthNode;\n \n import jdk.vm.ci.meta.DeoptimizationAction;\n@@ -44,7 +45,7 @@ public class ArraySubstitutions {\n \n     @MethodSubstitution\n     public static int getLength(Object array) {\n-        if (!array.getClass().isArray()) {\n+        if (BranchProbabilityNode.probability(BranchProbabilityNode.DEOPT_PROBABILITY, !array.getClass().isArray())) {\n             DeoptimizeNode.deopt(DeoptimizationAction.None, DeoptimizationReason.RuntimeConstraint);\n         }\n         return ArrayLengthNode.arrayLength(array);\ndiff --git a/compiler/src/org.graalvm.compiler.replacements/src/org/graalvm/compiler/replacements/arraycopy/ArrayCopySnippets.java b/compiler/src/org.graalvm.compiler.replacements/src/org/graalvm/compiler/replacements/arraycopy/ArrayCopySnippets.java\nindex e9929cc1704..56f3443b4d0 100644\n--- a/compiler/src/org.graalvm.compiler.replacements/src/org/graalvm/compiler/replacements/arraycopy/ArrayCopySnippets.java\n+++ b/compiler/src/org.graalvm.compiler.replacements/src/org/graalvm/compiler/replacements/arraycopy/ArrayCopySnippets.java\n@@ -30,6 +30,7 @@ import static org.graalvm.compiler.nodes.extended.BranchProbabilityNode.FREQUENT\n import static org.graalvm.compiler.nodes.extended.BranchProbabilityNode.LIKELY_PROBABILITY;\n import static org.graalvm.compiler.nodes.extended.BranchProbabilityNode.NOT_FREQUENT_PROBABILITY;\n import static org.graalvm.compiler.nodes.extended.BranchProbabilityNode.SLOW_PATH_PROBABILITY;\n+import static org.graalvm.compiler.nodes.extended.BranchProbabilityNode.DEOPT_PROBABILITY;\n import static org.graalvm.compiler.nodes.extended.BranchProbabilityNode.probability;\n \n import java.util.EnumMap;\n@@ -254,12 +255,27 @@ public abstract class ArrayCopySnippets implements Snippets {\n         }\n     }\n \n+    /**\n+     * Writing this as individual if statements to avoid a merge without a frame state.\n+     */\n     private static void checkLimits(Object src, int srcPos, Object dest, int destPos, int length, Counters counters) {\n-        if (probability(SLOW_PATH_PROBABILITY, srcPos < 0) ||\n-                        probability(SLOW_PATH_PROBABILITY, destPos < 0) ||\n-                        probability(SLOW_PATH_PROBABILITY, length < 0) ||\n-                        probability(SLOW_PATH_PROBABILITY, srcPos > ArrayLengthNode.arrayLength(src) - length) ||\n-                        probability(SLOW_PATH_PROBABILITY, destPos > ArrayLengthNode.arrayLength(dest) - length)) {\n+        if (probability(DEOPT_PROBABILITY, srcPos < 0)) {\n+            counters.checkAIOOBECounter.inc();\n+            DeoptimizeNode.deopt(DeoptimizationAction.None, DeoptimizationReason.RuntimeConstraint);\n+        }\n+        if (probability(DEOPT_PROBABILITY, destPos < 0)) {\n+            counters.checkAIOOBECounter.inc();\n+            DeoptimizeNode.deopt(DeoptimizationAction.None, DeoptimizationReason.RuntimeConstraint);\n+        }\n+        if (probability(DEOPT_PROBABILITY, length < 0)) {\n+            counters.checkAIOOBECounter.inc();\n+            DeoptimizeNode.deopt(DeoptimizationAction.None, DeoptimizationReason.RuntimeConstraint);\n+        }\n+        if (probability(DEOPT_PROBABILITY, srcPos > ArrayLengthNode.arrayLength(src) - length)) {\n+            counters.checkAIOOBECounter.inc();\n+            DeoptimizeNode.deopt(DeoptimizationAction.None, DeoptimizationReason.RuntimeConstraint);\n+        }\n+        if (probability(DEOPT_PROBABILITY, destPos > ArrayLengthNode.arrayLength(dest) - length)) {\n             counters.checkAIOOBECounter.inc();\n             DeoptimizeNode.deopt(DeoptimizationAction.None, DeoptimizationReason.RuntimeConstraint);\n         }\n@@ -272,13 +288,13 @@ public abstract class ArrayCopySnippets implements Snippets {\n         } else if (arrayTypeCheck == ArrayCopyTypeCheck.HUB_BASED_ARRAY_TYPE_CHECK) {\n             Pointer srcHub = loadHub(nonNullSrc);\n             Pointer destHub = loadHub(nonNullDest);\n-            if (probability(SLOW_PATH_PROBABILITY, srcHub != destHub)) {\n+            if (probability(DEOPT_PROBABILITY, srcHub != destHub)) {\n                 DeoptimizeNode.deopt(DeoptimizationAction.None, DeoptimizationReason.RuntimeConstraint);\n             }\n         } else if (arrayTypeCheck == ArrayCopyTypeCheck.LAYOUT_HELPER_BASED_ARRAY_TYPE_CHECK) {\n             Pointer srcHub = loadHub(nonNullSrc);\n             Pointer destHub = loadHub(nonNullDest);\n-            if (probability(SLOW_PATH_PROBABILITY, getReadLayoutHelper(srcHub) != getReadLayoutHelper(destHub))) {\n+            if (probability(DEOPT_PROBABILITY, getReadLayoutHelper(srcHub) != getReadLayoutHelper(destHub))) {\n                 DeoptimizeNode.deopt(DeoptimizationAction.None, DeoptimizationReason.RuntimeConstraint);\n             }\n         } else {",
    "added getters to line .": "diff --git a/src/main/java/com/googlecode/mp4parser/authoring/tracks/TextTrackImpl.java b/src/main/java/com/googlecode/mp4parser/authoring/tracks/TextTrackImpl.java\nindex d21a62b6..93df1785 100644\n--- a/src/main/java/com/googlecode/mp4parser/authoring/tracks/TextTrackImpl.java\n+++ b/src/main/java/com/googlecode/mp4parser/authoring/tracks/TextTrackImpl.java\n@@ -130,6 +130,18 @@ public class TextTrackImpl extends AbstractTrack {\n             this.to = to;\n             this.text = text;\n         }\n+\n+        public long getFrom() {\n+            return from;\n+        }\n+\n+        public String getText() {\n+            return text;\n+        }\n+\n+        public long getTo() {\n+ ",
    "Add support for querying case instances by case definition category": "diff --git a/modules/flowable-cmmn-rest/src/main/java/org/flowable/cmmn/rest/service/api/runtime/caze/BaseCaseInstanceResource.java b/modules/flowable-cmmn-rest/src/main/java/org/flowable/cmmn/rest/service/api/runtime/caze/BaseCaseInstanceResource.java\nindex 7d08526fb7..63c5925063 100644\n--- a/modules/flowable-cmmn-rest/src/main/java/org/flowable/cmmn/rest/service/api/runtime/caze/BaseCaseInstanceResource.java\n+++ b/modules/flowable-cmmn-rest/src/main/java/org/flowable/cmmn/rest/service/api/runtime/caze/BaseCaseInstanceResource.java\n@@ -78,6 +78,9 @@ public class BaseCaseInstanceResource {\n         if (queryRequest.getCaseDefinitionId() != null) {\n             query.caseDefinitionId(queryRequest.getCaseDefinitionId());\n         }\n+        if (queryRequest.getCaseDefinitionCategory() != null) {\n+            query.caseDefinitionCategory(queryRequest.getCaseDefinitionCategory());\n+        }\n         if (queryRequest.getCaseBusinessKey() != null) {\n             query.caseInstanceBusinessKey(queryRequest.getCaseBusinessKey());\n         }\ndiff --git a/modules/flowable-cmmn-rest/src/main/java/org/flowable/cmmn/rest/service/api/runtime/caze/CaseInstanceCollectionResource.java b/modules/flowable-cmmn-rest/src/main/java/org/flowable/cmmn/rest/service/api/runtime/caze/CaseInstanceCollectionResource.java\nindex 20436b6c28..818de0a8e6 100644\n--- a/modules/flowable-cmmn-rest/src/main/java/org/flowable/cmmn/rest/service/api/runtime/caze/CaseInstanceCollectionResource.java\n+++ b/modules/flowable-cmmn-rest/src/main/java/org/flowable/cmmn/rest/service/api/runtime/caze/CaseInstanceCollectionResource.java\n@@ -63,6 +63,7 @@ public class CaseInstanceCollectionResource extends BaseCaseInstanceResource {\n             @ApiImplicitParam(name = \"id\", dataType = \"string\", value = \"Only return models with the given version.\", paramType = \"query\"),\n             @ApiImplicitParam(name = \"caseDefinitionKey\", dataType = \"string\", value = \"Only return case instances with the given case definition key.\", paramType = \"query\"),\n             @ApiImplicitParam(name = \"caseDefinitionId\", dataType = \"string\", value = \"Only return case instances with the given case definition id.\", paramType = \"query\"),\n+            @ApiImplicitParam(name = \"caseDefinitionCategory\", dataType = \"string\", value = \"Only return case instances with the given case definition category.\", paramType = \"query\"),\n             @ApiImplicitParam(name = \"businessKey\", dataType = \"string\", value = \"Only return case instances with the given businessKey.\", paramType = \"query\"),\n             @ApiImplicitParam(name = \"superCaseInstanceId\", dataType = \"string\", value = \"Only return case instances which have the given super case instance id (for cases that have a case tasks).\", paramType = \"query\"),\n             @ApiImplicitParam(name = \"includeCaseVariables\", dataType = \"boolean\", value = \"Indication to include case variables in the result.\", paramType = \"query\"),\n@@ -92,6 +93,10 @@ public class CaseInstanceCollectionResource extends BaseCaseInstanceResource {\n             queryRequest.setCaseDefinitionId(allRequestParams.get(\"caseDefinitionId\"));\n         }\n \n+        if (allRequestParams.containsKey(\"caseDefinitionCategory\")) {\n+            queryRequest.setCaseDefinitionCategory(allRequestParams.get(\"caseDefinitionCategory\"));\n+        }\n+\n         if (allRequestParams.containsKey(\"businessKey\")) {\n             queryRequest.setCaseBusinessKey(allRequestParams.get(\"businessKey\"));\n         }\ndiff --git a/modules/flowable-cmmn-rest/src/main/java/org/flowable/cmmn/rest/service/api/runtime/caze/CaseInstanceQueryRequest.java b/modules/flowable-cmmn-rest/src/main/java/org/flowable/cmmn/rest/service/api/runtime/caze/CaseInstanceQueryRequest.java\nindex 3a5c73fac2..39d6fa0271 100644\n--- a/modules/flowable-cmmn-rest/src/main/java/org/flowable/cmmn/rest/service/api/runtime/caze/CaseInstanceQueryRequest.java\n+++ b/modules/flowable-cmmn-rest/src/main/java/org/flowable/cmmn/rest/service/api/runtime/caze/CaseInstanceQueryRequest.java\n@@ -30,6 +30,7 @@ public class CaseInstanceQueryRequest extends PaginateRequest {\n     private String caseBusinessKey;\n     private String caseDefinitionId;\n     private String caseDefinitionKey;\n+    private String caseDefinitionCategory;\n     private String caseInstanceParentId;\n     private String involvedUser;\n     private Boolean includeCaseVariables;\n@@ -70,6 +71,14 @@ public class CaseInstanceQueryRequest extends PaginateRequest {\n         this.caseDefinitionKey = caseDefinitionKey;\n     }\n \n+    public String getCaseDefinitionCategory() {\n+        return caseDefinitionCategory;\n+    }\n+\n+    public void setCaseDefinitionCategory(String caseDefinitionCategory) {\n+        this.caseDefinitionCategory = caseDefinitionCategory;\n+    }\n+\n     public String getCaseInstanceParentId() {\n         return caseInstanceParentId;\n     }\ndiff --git a/modules/flowable-cmmn-rest/src/test/java/org/flowable/cmmn/rest/service/api/runtime/CaseInstanceCollectionResourceTest.java b/modules/flowable-cmmn-rest/src/test/java/org/flowable/cmmn/rest/service/api/runtime/CaseInstanceCollectionResourceTest.java\nindex f64bfb3542..b99a07c932 100644\n--- a/modules/flowable-cmmn-rest/src/test/java/org/flowable/cmmn/rest/service/api/runtime/CaseInstanceCollectionResourceTest.java\n+++ b/modules/flowable-cmmn-rest/src/test/java/org/flowable/cmmn/rest/service/api/runtime/CaseInstanceCollectionResourceTest.java\n@@ -500,6 +500,35 @@ public class CaseInstanceCollectionResourceTest extends BaseSpringRestTestCase {\n         }\n     }\n \n+    @CmmnDeployment(resources = {\n+            \"org/flowable/cmmn/rest/service/api/runtime/CaseInstanceCollectionResourceTest.oneHumanTaskCaseTestCategory.cmmn\",\n+            \"org/flowable/cmmn/rest/service/api/runtime/CaseInstanceCollectionResourceTest.oneHumanTaskCaseExampleCategory.cmmn\"\n+    })\n+    public void testGetCaseInstancesByCategory() throws Exception {\n+        CaseInstance exampleCase = runtimeService.createCaseInstanceBuilder()\n+                .caseDefinitionKey(\"oneHumanTaskCaseExampleCategory\")\n+                .businessKey(\"example\")\n+                .start();\n+        CaseInstance testCase = runtimeService.createCaseInstanceBuilder()\n+                .caseDefinitionKey(\"oneHumanTaskCaseTestCategory\")\n+                .businessKey(\"test\")\n+                .start();\n+\n+        String exampleCaseId = exampleCase.getId();\n+        String testCaseId = testCase.getId();\n+\n+        // Test without any parameters\n+        String url = CmmnRestUrls.createRelativeResourceUrl(CmmnRestUrls.URL_CASE_INSTANCE_COLLECTION);\n+        assertResultsPresentInDataResponse(url, testCaseId, exampleCaseId);\n+\n+        // Case Definition Category\n+        url = CmmnRestUrls.createRelativeResourceUrl(CmmnRestUrls.URL_CASE_INSTANCE_COLLECTION) + \"?caseDefinitionCategory=Example\";\n+        assertResultsPresentInDataResponse(url, exampleCaseId);\n+\n+        url = CmmnRestUrls.createRelativeResourceUrl(CmmnRestUrls.URL_CASE_INSTANCE_COLLECTION) + \"?caseDefinitionCategory=Unknown\";\n+        assertResultsPresentInDataResponse(url);\n+    }\n+\n     /**\n      * Test starting a process instance, covering all edge-cases.\n      */\ndiff --git a/modules/flowable-cmmn-rest/src/test/resources/org/flowable/cmmn/rest/service/api/runtime/CaseInstanceCollectionResourceTest.oneHumanTaskCaseExampleCategory.cmmn b/modules/flowable-cmmn-rest/src/test/resources/org/flowable/cmmn/rest/service/api/runtime/CaseInstanceCollectionResourceTest.oneHumanTaskCaseExampleCategory.cmmn\nnew file mode 100644\nindex 0000000000..45445a0d2f\n--- /dev/null\n+++ b/modules/flowable-cmmn-rest/src/test/resources/org/flowable/cmmn/rest/service/api/runtime/CaseInstanceCollectionResourceTest.oneHumanTaskCaseExampleCategory.cmmn\n@@ -0,0 +1,17 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<definitions xmlns=\"http://www.omg.org/spec/CMMN/20151109/MODEL\"\n+             xmlns:flowable=\"http://flowable.org/cmmn\"\n+             targetNamespace=\"Example\">\n+\n+    <case id=\"oneHumanTaskCaseExampleCategory\" name=\"One Human Task Case\">\n+        <documentation>A human task case</documentation>\n+        <casePlanModel id=\"myPlanModel\" name=\"My CasePlanModel\">\n+            <planItem id=\"planItem1\" name=\"The Task\" definitionRef=\"theTask\"/>\n+            <humanTask id=\"theTask\" name=\"The Task\" isBlocking=\"true\" flowable:assignee=\"johnDoe\" flowable:formKey=\"testFormKey\" flowable:priority=\"50\"\n+                       flowable:dueDate=\"2018-01-01\">\n+                <documentation>This is a test documentation</documentation>\n+            </humanTask>\n+        </casePlanModel>\n+    </case>\n+\n+</definitions>\ndiff --git a/modules/flowable-cmmn-rest/src/test/resources/org/flowable/cmmn/rest/service/api/runtime/CaseInstanceCollectionResourceTest.oneHumanTaskCaseTestCategory.cmmn b/modules/flowable-cmmn-rest/src/test/resources/org/flowable/cmmn/rest/service/api/runtime/CaseInstanceCollectionResourceTest.oneHumanTaskCaseTestCategory.cmmn\nnew file mode 100644\nindex 0000000000..77645bfa43\n--- /dev/null\n+++ b/modules/flowable-cmmn-rest/src/test/resources/org/flowable/cmmn/rest/service/api/runtime/CaseInstanceCollectionResourceTest.oneHumanTaskCaseTestCategory.cmmn\n@@ -0,0 +1,17 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<definitions xmlns=\"http://www.omg.org/spec/CMMN/20151109/MODEL\"\n+             xmlns:flowable=\"http://flowable.org/cmmn\"\n+             targetNamespace=\"Test\">\n+\n+    <case id=\"oneHumanTaskCaseTestCategory\" name=\"One Human Task Case\">\n+        <documentation>A human task case</documentation>\n+        <casePlanModel id=\"myPlanModel\" name=\"My CasePlanModel\">\n+            <planItem id=\"planItem1\" name=\"The Task\" definitionRef=\"theTask\"/>\n+            <humanTask id=\"theTask\" name=\"The Task\" isBlocking=\"true\" flowable:assignee=\"johnDoe\" flowable:formKey=\"testFormKey\" flowable:priority=\"50\"\n+                       flowable:dueDate=\"2018-01-01\">\n+                <documentation>This is a test documentation</documentation>\n+            </humanTask>\n+        </casePlanModel>\n+    </case>\n+\n+</definitions>",
    "Add support for arrays and structs in the VM": "diff --git a/modules/ballerina-core/src/main/java/org/ballerinalang/bre/bvm/BLangVM.java b/modules/ballerina-core/src/main/java/org/ballerinalang/bre/bvm/BLangVM.java\nindex 96f0b483f08..776cbcbb2c7 100644\n--- a/modules/ballerina-core/src/main/java/org/ballerinalang/bre/bvm/BLangVM.java\n+++ b/modules/ballerina-core/src/main/java/org/ballerinalang/bre/bvm/BLangVM.java\n@@ -17,6 +17,13 @@\n */\n package org.ballerinalang.bre.bvm;\n \n+import org.ballerinalang.model.values.BBooleanArray;\n+import org.ballerinalang.model.values.BFloatArray;\n+import org.ballerinalang.model.values.BIntArray;\n+import org.ballerinalang.model.values.BRefValueArray;\n+import org.ballerinalang.model.values.BStringArray;\n+import org.ballerinalang.model.values.BStruct;\n+import org.ballerinalang.model.values.StructureType;\n import org.ballerinalang.util.codegen.FunctionInfo;\n import org.ballerinalang.util.codegen.Instruction;\n import org.ballerinalang.util.codegen.InstructionCodes;\n@@ -28,6 +35,7 @@ import org.ballerinalang.util.codegen.cpentries.FunctionCallCPEntry;\n import org.ballerinalang.util.codegen.cpentries.FunctionReturnCPEntry;\n import org.ballerinalang.util.codegen.cpentries.IntegerCPEntry;\n import org.ballerinalang.util.codegen.cpentries.StringCPEntry;\n+import org.ballerinalang.util.codegen.cpentries.StructCPEntry;\n \n /**\n  * @since 0.87\n@@ -76,8 +84,14 @@ public class BLangVM {\n         int k;\n         int lvIndex;\n         int cpIndex;\n+        int fieldIndex;\n \n-//        BIntegerArray bIntArray;\n+        BIntArray bIntArray;\n+        BFloatArray bFloatArray;\n+        BStringArray bStringArray;\n+        BBooleanArray bBooleanArray;\n+        BRefValueArray bArray;\n+        StructureType structureType;\n \n         // TODO use HALT Instruction in the while condition\n         while (ip < code.length && fp >= 0) {\n@@ -170,12 +184,45 @@ public class BLangVM {\n                     i = operands[1];\n                     sf.stringRegs[i] = sf.stringLocalVars[lvIndex];\n                     break;\n+                case InstructionCodes.rload:\n+                    lvIndex = operands[0];\n+                    i = operands[1];\n+                    sf.bValueRegs[i] = sf.bValueLocalVars[lvIndex];\n+                    break;\n                 case InstructionCodes.iaload:\n                     i = operands[0];\n                     j = operands[1];\n                     k = operands[2];\n-//                    bIntArray = (BIntegerArray) sf.bValueLocalVars[i];\n-//                    sf.longRegs[k] = bIntArray.get(j);\n+                    bIntArray = (BIntArray) sf.bValueRegs[i];\n+                    sf.longRegs[k] = bIntArray.get(sf.longRegs[j]);\n+                    break;\n+                case InstructionCodes.faload:\n+                    i = operands[0];\n+                    j = operands[1];\n+                    k = operands[2];\n+                    bFloatArray = (BFloatArray) sf.bValueRegs[i];\n+                    sf.doubleRegs[k] = bFloatArray.get(sf.longRegs[j]);\n+                    break;\n+                case InstructionCodes.saload:\n+                    i = operands[0];\n+                    j = operands[1];\n+                    k = operands[2];\n+                    bStringArray = (BStringArray) sf.bValueRegs[i];\n+                    sf.stringRegs[k] = bStringArray.get(sf.longRegs[j]);\n+                    break;\n+                case InstructionCodes.baload:\n+                    i = operands[0];\n+                    j = operands[1];\n+                    k = operands[2];\n+                    bBooleanArray = (BBooleanArray) sf.bValueRegs[i];\n+                    sf.intRegs[k] = bBooleanArray.get(sf.longRegs[j]);\n+                    break;\n+                case InstructionCodes.raload:\n+                    i = operands[0];\n+                    j = operands[1];\n+                    k = operands[2];\n+                    bArray = (BRefValueArray) sf.bValueRegs[i];\n+                    sf.bValueRegs[k] = bArray.get(sf.longRegs[j]);\n                     break;\n                 case InstructionCodes.istore:\n                     i = operands[0];\n@@ -187,12 +234,115 @@ public class BLangVM {\n                     lvIndex = operands[1];\n                     sf.stringLocalVars[lvIndex] = sf.stringRegs[i];\n                     break;\n+                case InstructionCodes.rstore:\n+                    i = operands[0];\n+                    lvIndex = operands[1];\n+                    sf.bValueLocalVars[lvIndex] = sf.bValueRegs[i];\n+                    break;\n                 case InstructionCodes.iastore:\n                     i = operands[0];\n                     j = operands[1];\n                     k = operands[2];\n-//                    bIntArray = (BIntegerArray) sf.bValueLocalVars[i];\n-//                    bIntArray.add(j, sf.longRegs[k]);\n+                    bIntArray = (BIntArray) sf.bValueRegs[i];\n+                    bIntArray.add(sf.longRegs[j], sf.longRegs[k]);\n+                    break;\n+                case InstructionCodes.fastore:\n+                    i = operands[0];\n+                    j = operands[1];\n+                    k = operands[2];\n+                    bFloatArray = (BFloatArray) sf.bValueRegs[i];\n+                    bFloatArray.add(sf.longRegs[j], sf.doubleRegs[k]);\n+                    break;\n+                case InstructionCodes.sastore:\n+                    i = operands[0];\n+                    j = operands[1];\n+                    k = operands[2];\n+                    bStringArray = (BStringArray) sf.bValueRegs[i];\n+                    bStringArray.add(sf.longRegs[j], sf.stringRegs[k]);\n+                    break;\n+                case InstructionCodes.bastore:\n+                    i = operands[0];\n+                    j = operands[1];\n+                    k = operands[2];\n+                    bBooleanArray = (BBooleanArray) sf.bValueRegs[i];\n+                    bBooleanArray.add(sf.longRegs[j], sf.intRegs[k]);\n+                    break;\n+                case InstructionCodes.rastore:\n+                    i = operands[0];\n+                    j = operands[1];\n+                    k = operands[2];\n+                    bArray = (BRefValueArray) sf.bValueRegs[i];\n+                    bArray.add(sf.longRegs[j], sf.bValueRegs[k]);\n+                    break;\n+                case InstructionCodes.ifieldload:\n+                    i = operands[0];\n+                    fieldIndex = operands[1];\n+                    j = operands[2];\n+                    structureType = (StructureType) sf.bValueRegs[i];\n+                    sf.longRegs[j] = structureType.getIntField(fieldIndex);\n+                    break;\n+                case InstructionCodes.ffieldload:\n+                    i = operands[0];\n+                    fieldIndex = operands[1];\n+                    j = operands[2];\n+                    structureType = (StructureType) sf.bValueRegs[i];\n+                    sf.doubleRegs[j] = structureType.getFloatField(fieldIndex);\n+                    break;\n+                case InstructionCodes.sfieldload:\n+                    i = operands[0];\n+                    fieldIndex = operands[1];\n+                    j = operands[2];\n+                    structureType = (StructureType) sf.bValueRegs[i];\n+                    sf.stringRegs[j] = structureType.getStringField(fieldIndex);\n+                    break;\n+                case InstructionCodes.bfieldload:\n+                    i = operands[0];\n+                    fieldIndex = operands[1];\n+                    j = operands[2];\n+                    structureType = (StructureType) sf.bValueRegs[i];\n+                ",
    "Skipped \\' 0b6e482 \\' from release - 2 . 3 : Bumped version to 2 . 3beta20 .": "diff --git a/AndroidManifest.xml b/AndroidManifest.xml\nindex b9df4aa993..2dcc07ee8f 100644\n--- a/AndroidManifest.xml\n+++ b/AndroidManifest.xml\n@@ -21,8 +21,8 @@\n <manifest xmlns:android=\"http://schemas.android.com/apk/res/android\"\n     package=\"com.ichi2.anki\"\n     android:installLocation=\"auto\"\n-    android:versionCode=\"20300220\"\n-    android:versionName=\"2.3beta20\" >\n+    android:versionCode=\"20400000\"\n+    android:versionName=\"2.4dev\" >\n \n     <!--\n         The version number is of the form:",
    "Add Instana to the list of users ( <issue_id> )": "diff --git a/README.md b/README.md\nindex 8feb3709e8e..cddde638281 100644\n--- a/README.md\n+++ b/README.md\n@@ -598,6 +598,7 @@ Here are some companies/projects (alphabetical order) using OpenAPI Generator in\n - [GoDaddy](https://godaddy.com)\n - [Here](https://developer.here.com/)\n - [IBM](https://www.ibm.com/)\n+- [Instana](https://www.instana.com)\n - [JustStar](https://www.juststarinfo.com)\n - [k6.io](https://k6.io/)\n - [Klarna](https://www.klarna.com/)",
    "Make a few simplifications to Truth API in tests .": "diff --git a/test/com/google/debugging/sourcemap/SourceMapGeneratorV3Test.java b/test/com/google/debugging/sourcemap/SourceMapGeneratorV3Test.java\nindex 392a70ef1..775f371ca 100644\n--- a/test/com/google/debugging/sourcemap/SourceMapGeneratorV3Test.java\n+++ b/test/com/google/debugging/sourcemap/SourceMapGeneratorV3Test.java\n@@ -583,7 +583,7 @@ public final class SourceMapGeneratorV3Test extends SourceMapTestCase {\n     assertThat(sourceMap.has(\"google_test\")).isFalse();\n     assertThat(sourceMap.get(\"x_google_test\").getAsJsonObject().get(\"number\").getAsInt())\n         .isEqualTo(1);\n-    assertThat(sourceMap.get(\"x_google_array\").getAsJsonArray()).hasSize(0);\n+    assertThat(sourceMap.get(\"x_google_array\").getAsJsonArray()).isEmpty();\n     assertThat(sourceMap.get(\"x_google_int\").getAsInt()).isEqualTo(2);\n     assertThat(sourceMap.get(\"x_google_str\").getAsString()).isEqualTo(\"Some text\");\n   }",
    "optimize download times a bit for jnlp": "diff --git a/trunk/JLanguageTool/jnlp/LanguageTool.jnlp b/trunk/JLanguageTool/jnlp/LanguageTool.jnlp\nindex 90bdd7832d..d4f0d4a5a0 100644\n--- a/trunk/JLanguageTool/jnlp/LanguageTool.jnlp\n+++ b/trunk/JLanguageTool/jnlp/LanguageTool.jnlp\n@@ -25,42 +25,42 @@\n \t\t<j2se version=\"1.6+\" />\r\n \t\t<jar href=\"@morfologik.stemming.lib@\" />\r\n \t\t<jar href=\"@morfologik.fsa.lib@\" />\r\n-\t\t<jar href=\"@morfologik.speller.lib@\" />\r\n-\t\t<jar href=\"@tika.lib@\" />\r\n+\t\t<jar href=\"@morfologik.speller.lib@\" download=\"lazy\" />\r\n+\t\t<jar href=\"@tika.lib@\" download=\"lazy\" />\r\n \t\t<jar href=\"@segment.lib@\" />\r\n-\t\t<jar href=\"@logging.lib@\" />\r\n+\t\t<jar href=\"@logging.lib@\" download=\"lazy\" />\r\n \t\t<jar href=\"@commons.lang.lib@\" />\r\n \t\t<jar href=\"rules.jar\" />\r\n \t\t<jar href=\"resource.jar\" />\r\n-\t\t<jar href=\"jWordSplitter.jar\" />\r\n-\t\t<jar href=\"@ictclas4j.lib@\" />\r\n-\t\t<jar href=\"@CJFtransform.lib@\" />\r\n+\t\t<jar href=\"jWordSplitter.jar\" download=\"lazy\" />\r\n+\t\t<jar href=\"@ictclas4j.lib@\" download=\"lazy\" />\r\n+\t\t<jar href=\"@CJFtransform.lib@\" download=\"lazy\" />\r\n \t\t<jar href=\"LanguageTool.jar\" />\r\n \t\t<jar href=\"LanguageToolGUI.jar\" main=\"true\" />\r\n-\t\t<jar href=\"jna.jar\" />\r\n+\t\t<jar href=\"jna.jar\" download=\"lazy\" />\r\n \t</resources>\r\n \r\n \r\n \t<resources os=\"Windows\" arch=\"x86\">\r\n-\t\t<jar href=\"hunspell-win32-x86.jar\" />\t\t\r\n+\t\t<jar href=\"hunspell-win32-x86.jar\" download=\"lazy\" />\t\t\r\n \t</resources>\r\n \t<resources os=\"Windows\" arch=\"amd64\">\r\n-\t\t<jar href=\"hunspell-win32-amd64.jar\" />\t\t\r\n+\t\t<jar href=\"hunspell-win32-amd64.jar\" download=\"lazy\" />\t\t\r\n \t</resources>\r\n \t<resources os=\"Linux\" arch=\"x86\">\r\n-\t\t<jar href=\"hunspell-linux-i386.jar\" />\t\t\r\n+\t\t<jar href=\"hunspell-linux-i386.jar\" download=\"lazy\" />\t\t\r\n \t</resources>\t\t\r\n \t<resources os=\"Linux\" arch=\"amd64\">\r\n-\t\t<jar href=\"hunspell-linux-amd64.jar\" />\t\t\r\n+\t\t<jar href=\"hunspell-linux-amd64.jar\" download=\"lazy\" />\t\t\r\n \t</resources>\r\n \t<resources os=\"Mac OS X\" arch=\"x86\">\r\n-\t\t<jar href=\"hunspell-darwin-i386.jar\" />\t\t\r\n+\t\t<jar href=\"hunspell-darwin-i386.jar\" download=\"lazy\" />\t\t\r\n \t</resources>\t\r\n \t<resources os=\"Mac OS X\" arch=\"amd64\">\r\n-\t\t<jar href=\"hunspell-darwin-amd64.jar\" />\t\t\r\n+\t\t<jar href=\"hunspell-darwin-amd64.jar\" download=\"lazy\" />\t\t\r\n \t</resources>\r\n \t<resources os=\"Mac OS X\" arch=\"ppc\">\r\n-\t\t<jar href=\"hunspell-darwin-ppc.jar\" />\t\t\r\n+\t\t<jar href=\"hunspell-darwin-ppc.jar\" download=\"lazy\" />\t\t\r\n \t</resources>\r\n \r\n \r\ndiff --git a/trunk/JLanguageTool/jnlp/LanguageToolServer.jnlp b/trunk/JLanguageTool/jnlp/LanguageToolServer.jnlp\nindex def88a25bf..197a5f5b54 100644\n--- a/trunk/JLanguageTool/jnlp/LanguageToolServer.jnlp\n+++ b/trunk/JLanguageTool/jnlp/LanguageToolServer.jnlp\n@@ -26,42 +26,42 @@\n \t\t<j2se version=\"1.6+\" />\n \t\t<jar href=\"@morfologik.stemming.lib@\" />\n \t\t<jar href=\"@morfologik.fsa.lib@\" />\n-\t\t<jar href=\"@morfologik.speller.lib@\" />\n-\t\t<jar href=\"@tika.lib@\" />\n+\t\t<jar href=\"@morfologik.speller.lib@\" download=\"lazy\" />\n+\t\t<jar href=\"@tika.lib@\" download=\"lazy\" />\n \t\t<jar href=\"@segment.lib@\" />\n-\t\t<jar href=\"@logging.lib@\" />\n+\t\t<jar href=\"@logging.lib@\" download=\"lazy\" />\n \t\t<jar href=\"@commons.lang.lib@\" />\n \t\t<jar href=\"rules.jar\" />\n \t\t<jar href=\"resource.jar\" />\n-\t\t<jar href=\"jWordSplitter.jar\" />\n-\t\t<jar href=\"@ictclas4j.lib@\" />\n-\t\t<jar href=\"@CJFtransform.lib@\" />\n+\t\t<jar href=\"jWordSplitter.jar\" download=\"lazy\" />\n+\t\t<jar href=\"@ictclas4j.lib@\" download=\"lazy\" />\n+\t\t<jar href=\"@CJFtransform.lib@\" download=\"lazy\" />\n \t\t<jar href=\"LanguageTool.jar\" />\n \t\t<jar href=\"LanguageToolGUI.jar\" main=\"true\" />\n-\t\t<jar href=\"jna.jar\" />\n+\t\t<jar href=\"jna.jar\" download=\"lazy\" />\n \t</resources>\n \n \n \t<resources os=\"Windows\" arch=\"x86\">\n-\t\t<jar href=\"hunspell-win32-x86.jar\" />\t\t\n+\t\t<jar href=\"hunspell-win32-x86.jar\" download=\"lazy\" />\t\t\n \t</resources>\n \t<resources os=\"Windows\" arch=\"amd64\">\n-\t\t<jar href=\"hunspell-win32-amd64.jar\" />\t\t\n+\t\t<jar href=\"hunspell-win32-amd64.jar\" download=\"lazy\" />\t\t\n \t</resources>\n \t<resources os=\"Linux\" arch=\"x86\">\n-\t\t<jar href=\"hunspell-linux-i386.jar\" />\t\t\n+\t\t<jar href=\"hunspell-linux-i386.jar\" download=\"lazy\" />\t\t\n \t</resources>\t\t\n \t<resources os=\"Linux\" arch=\"amd64\">\n-\t\t<jar href=\"hunspell-linux-amd64.jar\" />\t\t\n+\t\t<jar href=\"hunspell-linux-amd64.jar\" download=\"lazy\" />\t\t\n \t</resources>\n \t<resources os=\"Mac OS X\" arch=\"x86\">\n-\t\t<jar href=\"hunspell-darwin-i386.jar\" />\t\t\n+\t\t<jar href=\"hunspell-darwin-i386.jar\" download=\"lazy\" />\t\t\n \t</resources>\t\n \t<resources os=\"Mac OS X\" arch=\"amd64\">\n-\t\t<jar href=\"hunspell-darwin-amd64.jar\" />\t\t\n+\t\t<jar href=\"hunspell-darwin-amd64.jar\" download=\"lazy\" />\t\t\n \t</resources>\n \t<resources os=\"Mac OS X\" arch=\"ppc\">\n-\t\t<jar href=\"hunspell-darwin-ppc.jar\" />\t\t\n+\t\t<jar href=\"hunspell-darwin-ppc.jar\" download=\"lazy\" />\t\t\n \t</resources>\n \n \t<application-desc main-class=\"org.languagetool.server.HTTPServer\">",
    "Discard subtitles with invalid positions .": "diff --git a/library/src/main/java/com/google/android/exoplayer2/ui/SubtitlePainter.java b/library/src/main/java/com/google/android/exoplayer2/ui/SubtitlePainter.java\nindex 5ca97403f1..d4f09b1721 100644\n--- a/library/src/main/java/com/google/android/exoplayer2/ui/SubtitlePainter.java\n+++ b/library/src/main/java/com/google/android/exoplayer2/ui/SubtitlePainter.java\n@@ -266,6 +266,12 @@ import com.google.android.exoplayer2.util.Util;\n       textRight = textLeft + textWidth;\n     }\n \n+    textWidth = textRight - textLeft;\n+    if (textWidth <= 0) {\n+      Log.w(TAG, \"Skipped drawing subtitle cue (invalid horizontal positioning)\");\n+      return;\n+    }\n+\n     int textTop;\n     if (cueLine != Cue.DIMEN_UNSET) {\n       int anchorPosition;\n@@ -292,8 +298,6 @@ import com.google.android.exoplayer2.util.Util;\n       textTop = parentBottom - textHeight - (int) (parentHeight * bottomPaddingFraction);\n     }\n \n-    textWidth = textRight - textLeft;\n-\n     // Update the derived drawing variables.\n     this.textLayout = new StaticLayout(cueText, textPaint, textWidth, textAlignment, spacingMult,\n         spacingAdd, true);",
    "Throw exception if call to node - maintainer fails": "diff --git a/node-admin/src/main/java/com/yahoo/vespa/hosted/node/admin/maintenance/StorageMaintainer.java b/node-admin/src/main/java/com/yahoo/vespa/hosted/node/admin/maintenance/StorageMaintainer.java\nindex 1fc753ddbdb..d6145958e0f 100644\n--- a/node-admin/src/main/java/com/yahoo/vespa/hosted/node/admin/maintenance/StorageMaintainer.java\n+++ b/node-admin/src/main/java/com/yahoo/vespa/hosted/node/admin/maintenance/StorageMaintainer.java\n@@ -286,9 +286,8 @@ public class StorageMaintainer {\n                                                 docker.executeInContainer(executeIn, command);\n \n             if (! result.isSuccess()) {\n-                PrefixLogger logger = PrefixLogger.getNodeAgentLogger(StorageMaintainer.class, executeIn);\n-                logger.warning(\"Failed to run maintenance jobs: \" + args + result);\n                 numberOfNodeAdminMaintenanceFails.add();\n+               ",
    "Require the ` javac ` plugin .": "diff --git a/src/com/facebook/buck/jvm/java/plugin/PluginLoader.java b/src/com/facebook/buck/jvm/java/plugin/PluginLoader.java\nindex 91c57fefd4..467cf28231 100644\n--- a/src/com/facebook/buck/jvm/java/plugin/PluginLoader.java\n+++ b/src/com/facebook/buck/jvm/java/plugin/PluginLoader.java\n@@ -17,7 +17,6 @@\n package com.facebook.buck.jvm.java.plugin;\n \n import com.facebook.buck.jvm.java.plugin.api.PluginClassLoader;\n-import com.facebook.buck.log.Logger;\n import com.facebook.buck.util.ClassLoaderCache;\n import com.google.common.collect.ImmutableList;\n import com.google.common.io.ByteStreams;\n@@ -34,7 +33,7 @@ import javax.tools.JavaCompiler;\n \n /**\n  * Loads the Buck javac plugin JAR using the {@link ClassLoader} of a particular compiler instance.\n- *\n+ * <p>\n  * {@link com.sun.source.tree} and {@link com.sun.source.util} packages are public APIs whose\n  * implementation is packaged with javac rather than in the Java runtime jar. Code that needs\n  * to work with these must be loaded using the same {@link ClassLoader} as the instance of javac\n@@ -42,24 +41,19 @@ import javax.tools.JavaCompiler;\n  */\n public final class PluginLoader implements PluginClassLoader {\n   private static final String JAVAC_PLUGIN_JAR_RESOURCE_PATH = \"javac-plugin.jar\";\n-  @Nullable\n   private static final URL JAVAC_PLUGIN_JAR_URL = extractJavacPluginJar();\n-  private static final Logger LOG = Logger.get(PluginLoader.class);\n \n-  @Nullable\n   private final ClassLoader classLoader;\n \n   /**\n    * Extracts the jar containing the Buck javac plugin and returns a URL that can be given\n    * to a {@link java.net.URLClassLoader} to load it.\n    */\n-  @Nullable\n   private static URL extractJavacPluginJar() {\n     @Nullable final URL resourceURL =\n         PluginLoader.class.getResource(JAVAC_PLUGIN_JAR_RESOURCE_PATH);\n     if (resourceURL == null) {\n-      LOG.warn(\"Could not find javac plugin jar\");\n-      return null;\n+      throw new RuntimeException(\"Could not find javac plugin jar; Buck may be corrupted.\");\n     } else if (\"file\".equals(resourceURL.getProtocol())) {\n       // When Buck is running from the repo, the jar is actually already on disk, so no extraction\n       // is necessary\n@@ -75,39 +69,33 @@ public final class PluginLoader implements PluginClassLoader {\n           return tempFile.toURI().toURL();\n         }\n       } catch (IOException e) {\n-        LOG.warn(e, \"Failed to extract javac plugin jar\");\n-        return null;\n+        throw new RuntimeException(\"Failed to extract javac plugin jar; cannot continue\", e);\n       }\n     }\n   }\n \n-  /** Returns a class loader that can be used to load classes from the compiler plugin jar. */\n-  @Nullable\n+  /**\n+   * Returns a class loader that can be used to load classes from the compiler plugin jar.\n+   */\n   public static ClassLoader getPluginClassLoader(\n       ClassLoaderCache classLoaderCache,\n       JavaCompiler.CompilationTask compiler) {\n-    if (JAVAC_PLUGIN_JAR_URL == null) {\n-      return null;\n-    }\n-\n     final ClassLoader compilerClassLoader = compiler.getClass().getClassLoader();\n     return classLoaderCache.getClassLoaderForClassPath(\n         compilerClassLoader,\n         ImmutableList.of(JAVAC_PLUGIN_JAR_URL));\n   }\n \n-  @Nullable\n   public static PluginLoader newInstance(\n       ClassLoaderCache classLoaderCache,\n       JavaCompiler.CompilationTask compiler) {\n     return new PluginLoader(getPluginClassLoader(classLoaderCache, compiler));\n   }\n \n-  private PluginLoader(@Nullable ClassLoader classLoader) {\n+  private PluginLoader(ClassLoader classLoader) {\n     this.classLoader = classLoader;\n   }\n \n-  @Nullable\n   @Override\n   public <T> Class<? extends T> loadClass(String name, Class<T> superclass) {\n     if (classLoader == null) {\n@@ -118,12 +106,7 @@ public final class PluginLoader implements PluginClassLoader {\n     try {\n       return Class.forName(name, false, classLoader).asSubclass(superclass);\n     } catch (ClassNotFoundException e) {\n-      // Deliberately eat the stack trace to avoid log spam.\n-      LOG.warn(\n-          \"Failed loading %s: %s. Perhaps that class is not compatible with this version of javac?\",\n-          name,\n-          e.getMessage());\n-      return null;\n+      throw new RuntimeException(String.format(\"Failed loading %s\", name), e);\n     }\n   }\n }",
    "Add SQL Console module to jOOQ - Debugger renaming .": "diff --git a/jOOQ-sql-console/src/main/java/org/jooq/debug/DebuggerExecuteListener.java b/jOOQ-sql-console/src/main/java/org/jooq/debug/DebugListener.java\nsimilarity index 95%\nrename from jOOQ-sql-console/src/main/java/org/jooq/debug/DebuggerExecuteListener.java\nrename to jOOQ-sql-console/src/main/java/org/jooq/debug/DebugListener.java\nindex 7a775104d7..0af81aca09 100644\n--- a/jOOQ-sql-console/src/main/java/org/jooq/debug/DebuggerExecuteListener.java\n+++ b/jOOQ-sql-console/src/main/java/org/jooq/debug/DebugListener.java\n@@ -45,7 +45,7 @@ import org.jooq.ExecuteContext;\n import org.jooq.ExecuteType;\r\n import org.jooq.impl.DefaultExecuteListener;\r\n \r\n-public class DebuggerExecuteListener extends DefaultExecuteListener {\r\n+public class DebugListener extends DefaultExecuteListener {\r\n \r\n \tprivate boolean isLogging;\r\n \r",
    "remove unused codes": "diff --git a/src/main/java/org/tron/core/services/http/GetExpandedSpendingKeyServlet.java b/src/main/java/org/tron/core/services/http/GetExpandedSpendingKeyServlet.java\nindex 040ee3f44..84b077cd3 100644\n--- a/src/main/java/org/tron/core/services/http/GetExpandedSpendingKeyServlet.java\n+++ b/src/main/java/org/tron/core/services/http/GetExpandedSpendingKeyServlet.java\n@@ -1,6 +1,5 @@\n package org.tron.core.services.http;\n \n-import com.alibaba.fastjson.JSON;\n import com.google.protobuf.ByteString;\n import java.io.IOException;\n import java.util.stream.Collectors;\n@@ -14,7 +13,6 @@ import org.tron.api.GrpcAPI.BytesMessage;\n import org.tron.api.GrpcAPI.ExpandedSpendingKeyMessage;\n import org.tron.common.utils.ByteArray;\n import org.tron.core.Wallet;\n-import org.tron.core.zen.address.ExpandedSpendingKey;\n \n @Component\n @Slf4j(topic = \"API\")",
    "Add base class for PersistentTopic and NonPersistentTopic ( <issue_id> ) .": "diff --git a/pulsar-broker/src/main/java/org/apache/pulsar/broker/admin/impl/PersistentTopicsBase.java b/pulsar-broker/src/main/java/org/apache/pulsar/broker/admin/impl/PersistentTopicsBase.java\nindex 2d2b7bde94..b7302f7b4c 100644\n--- a/pulsar-broker/src/main/java/org/apache/pulsar/broker/admin/impl/PersistentTopicsBase.java\n+++ b/pulsar-broker/src/main/java/org/apache/pulsar/broker/admin/impl/PersistentTopicsBase.java\n@@ -769,7 +769,7 @@ public class PersistentTopicsBase extends AdminResource {\n             validateAdminAccessForSubscriber(subName, authoritative);\n             PersistentTopic topic = (PersistentTopic) getTopicReference(topicName);\n             try {\n-                if (subName.startsWith(topic.replicatorPrefix)) {\n+                if (subName.startsWith(topic.getReplicatorPrefix())) {\n                     String remoteCluster = PersistentReplicator.getRemoteCluster(subName);\n                     PersistentReplicator repl = (PersistentReplicator) topic.getPersistentReplicator(remoteCluster);\n                     checkNotNull(repl);\n@@ -801,7 +801,7 @@ public class PersistentTopicsBase extends AdminResource {\n         validateAdminAccessForSubscriber(subName, authoritative);\n         PersistentTopic topic = (PersistentTopic) getTopicReference(topicName);\n         try {\n-            if (subName.startsWith(topic.replicatorPrefix)) {\n+            if (subName.startsWith(topic.getReplicatorPrefix())) {\n                 String remoteCluster = PersistentReplicator.getRemoteCluster(subName);\n                 PersistentReplicator repl = (PersistentReplicator) topic.getPersistentReplicator(remoteCluster);\n                 checkNotNull(repl);\n@@ -1050,13 +1050,13 @@ public class PersistentTopicsBase extends AdminResource {\n         PersistentReplicator repl = null;\n         PersistentSubscription sub = null;\n         Entry entry = null;\n-        if (subName.startsWith(topic.replicatorPrefix)) {\n+        if (subName.startsWith(topic.getReplicatorPrefix())) {\n             repl = getReplicatorReference(subName, topic);\n         } else {\n             sub = (PersistentSubscription) getSubscriptionReference(subName, topic);\n         }\n         try {\n-            if (subName.startsWith(topic.replicatorPrefix)) {\n+            if (subName.startsWith(topic.getReplicatorPrefix())) {\n                 entry = repl.peekNthMessage(messagePosition).get();\n             } else {\n                 entry = sub.peekNthMessage(messagePosition).get();\n@@ -1200,7 +1200,7 @@ public class PersistentTopicsBase extends AdminResource {\n             }\n             PersistentTopic topic = (PersistentTopic) getTopicReference(topicName);\n             try {\n-                if (subName.startsWith(topic.replicatorPrefix)) {\n+                if (subName.startsWith(topic.getReplicatorPrefix())) {\n                     String remoteCluster = PersistentReplicator.getRemoteCluster(subName);\n                     PersistentReplicator repl = (PersistentReplicator) topic.getPersistentReplicator(remoteCluster);\n                     checkNotNull(repl);\ndiff --git a/pulsar-broker/src/main/java/org/apache/pulsar/broker/service/AbstractTopic.java b/pulsar-broker/src/main/java/org/apache/pulsar/broker/service/AbstractTopic.java\nnew file mode 100644\nindex 0000000000..31b27f763d\n--- /dev/null\n+++ b/pulsar-broker/src/main/java/org/apache/pulsar/broker/service/AbstractTopic.java\n@@ -0,0 +1,203 @@\n+/**\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+package org.apache.pulsar.broker.service;\n+\n+import com.google.common.base.MoreObjects;\n+import org.apache.bookkeeper.mledger.util.StatsBuckets;\n+import org.apache.pulsar.broker.admin.AdminResource;\n+import org.apache.pulsar.broker.service.schema.SchemaCompatibilityStrategy;\n+import org.apache.pulsar.broker.service.schema.SchemaRegistryService;\n+import org.apache.pulsar.common.naming.TopicName;\n+import org.apache.pulsar.common.policies.data.Policies;\n+import org.apache.pulsar.common.schema.SchemaData;\n+import org.apache.pulsar.common.schema.SchemaVersion;\n+import org.apache.pulsar.common.util.collections.ConcurrentOpenHashSet;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+import java.util.Objects;\n+import java.util.concurrent.CompletableFuture;\n+import java.util.concurrent.atomic.AtomicBoolean;\n+import java.util.concurrent.locks.ReentrantReadWriteLock;\n+\n+import static org.apache.bookkeeper.mledger.impl.ManagedLedgerMBeanImpl.ENTRY_LATENCY_BUCKETS_USEC;\n+import static org.apache.pulsar.broker.cache.ConfigurationCacheService.POLICIES;\n+\n+public abstract class AbstractTopic implements Topic {\n+    private static final Logger log = LoggerFactory.getLogger(AbstractTopic.class);\n+\n+    protected static final long POLICY_UPDATE_FAILURE_RETRY_TIME_SECONDS = 60;\n+\n+    protected final String topic;\n+\n+    // Producers currently connected to this topic\n+    protected final ConcurrentOpenHashSet<Producer> producers;\n+\n+    protected final BrokerService brokerService;\n+\n+    // Prefix for replication cursors\n+    protected final String replicatorPrefix;\n+\n+    protected final ReentrantReadWriteLock lock = new ReentrantReadWriteLock();\n+\n+    protected volatile boolean isFenced;\n+\n+    // Timestamp of when this topic was last seen active\n+    protected volatile long lastActive;\n+\n+    // Flag to signal that producer of this topic has published batch-message so, broker should not allow consumer which\n+    // doesn't support batch-message\n+    protected volatile boolean hasBatchMessagePublished = false;\n+\n+    protected StatsBuckets addEntryLatencyStatsUsec = new StatsBuckets(ENTRY_LATENCY_BUCKETS_USEC);\n+\n+    // Whether messages published must be encrypted or not in this topic\n+    protected volatile boolean isEncryptionRequired = false;\n+    protected volatile SchemaCompatibilityStrategy schemaCompatibilityStrategy =\n+            SchemaCompatibilityStrategy.FULL;\n+    // schema validation enforced flag\n+    protected volatile boolean schemaValidationEnforced = false;\n+\n+    public AbstractTopic(String topic, BrokerService brokerService) {\n+        this.topic = topic;\n+        this.brokerService = brokerService;\n+        this.producers = new ConcurrentOpenHashSet<>(16, 1);\n+        this.isFenced = false;\n+        this.replicatorPrefix = brokerService.pulsar().getConfiguration().getReplicatorPrefix();\n+        this.lastActive = System.nanoTime();\n+    }\n+\n+    protected boolean isProducersExceeded() {\n+        Policies policies;\n+        try {\n+            policies = brokerService.pulsar().getConfigurationCache().policiesCache()\n+                    .get(AdminResource.path(POLICIES, TopicName.get(topic).getNamespace()))\n+                    .orElseGet(() -> new Policies());\n+        } catch (Exception e) {\n+            policies = new Policies();\n+        }\n+        final int maxProducers = policies.max_producers_per_topic > 0 ?\n+                policies.max_producers_per_topic :\n+                brokerService.pulsar().getConfiguration().getMaxProducersPerTopic();\n+        if (maxProducers > 0 && maxProducers <= producers.size()) {\n+            return true;\n+        }\n+        return false;\n+    }\n+\n+    protected boolean hasLocalProducers() {\n+        AtomicBoolean foundLocal = new AtomicBoolean(false);\n+        producers.forEach(producer -> {\n+            if (!producer.isRemote()) {\n+                foundLocal.set(true);\n+            }\n+        });\n+\n+        return foundLocal.get();\n+    }\n+\n+    @Override\n+    public String toString() {\n+        return MoreObjects.toStringHelper(this).add(\"topic\", topic).toString();\n+    }\n+\n+    @Override\n+    public ConcurrentOpenHashSet<Producer> getProducers() {\n+        return producers;\n+    }\n+\n+\n+    public BrokerService getBrokerService() {\n+        return brokerService;\n+    }\n+\n+    @Override\n+    public String getName() {\n+        return topic;\n+    }\n+\n+    @Override\n+    public boolean isEncryptionRequired() {\n+        return isEncryptionRequired;\n+    }\n+\n+    @Override\n+    public boolean getSchemaValidationEnforced() {\n+        return schemaValidationEnforced;\n+    }\n+\n+    public void markBatchMessagePublished() {\n+        this.hasBatchMessagePublished = true;\n+    }\n+\n+    public String getReplicatorPrefix() {\n+        return replicatorPrefix;\n+    }\n+\n+    @Override\n+    public CompletableFuture<Boolean> hasSchema() {\n+        String base = TopicName.get(getName()).getPartitionedTopicName();\n+        String id = TopicName.get(base).getSchemaName();\n+        return brokerService.pulsar()\n+                .getSchemaRegistryService()\n+                .getSchema(id).thenApply(Objects::nonNull);\n+    }\n+\n+    @Override\n+    public CompletableFuture<SchemaVersion> addSchema(SchemaData schema) {\n+        if (schema == null) {\n+            return CompletableFuture.completedFuture(SchemaVersion.Empty);\n+        }\n+\n+        String base = TopicName.get(getName()).getPartitionedTopicName();\n+        String id = TopicName.get(base).getSchemaName();\n+        return brokerService.pulsar()\n+                .getSchemaRegistryService()\n+                .putSchemaIfAbsent(id, schema, schemaCompatibilityStrategy);\n+    }\n+\n+    @Override\n+    public CompletableFuture<SchemaVersion> deleteSchema() {\n+        String base = TopicName.get(getName()).getPartitionedTopicName();\n+        String id = TopicName.get(base).getSchemaName();\n+        SchemaRegistryService schemaRegistryService = brokerService.pulsar().getSchemaRegistryService();\n+        return schemaRegistryService.getSchema(id)\n+                .thenCompose(schema -> {\n+                    if (schema != null) {\n+                        return schemaRegistryService.deleteSchema(id, \"\");\n+                    } else {\n+                        return CompletableFuture.completedFuture(null);\n+                    }\n+                });\n+    }\n+\n+    @Override\n+    public CompletableFuture<Boolean> isSchemaCompatible(SchemaData schema) {\n+        String base = TopicName.get(getName()).getPartitionedTopicName();\n+        String id = TopicName.get(base).getSchemaName();\n+        return brokerService.pulsar()\n+                .getSchemaRegistryService()\n+                .isCompatible(id, schema, schemaCompatibilityStrategy);\n+    }\n+\n+    @Override\n+    public void recordAddLatency(long latencyUSec) {\n+        addEntryLatencyStatsUsec.addValue(latencyUSec);\n+    }\n+}\ndiff --git a/pulsar-broker/src/main/java/org/apache/pulsar/broker/service/nonpersistent/NonPersistentReplicator.java b/pulsar-broker/src/main/java/org/apache/pulsar/broker/service/nonpersistent/NonPersistentReplicator.java\nindex 10e16ffc83..b6ea53ae9c 100644\n--- a/pulsar-broker/src/main/java/org/apache/pulsar/broker/service/nonpersistent/NonPersistentReplicator.java\n+++ b/pulsar-broker/src/main/java/org/apache/pulsar/broker/service/nonpersistent/NonPersistentReplicator.java\n@@ -51,7 +51,7 @@ public class NonPersistentReplicator extends AbstractReplicator implements Repli\n \n     public NonPersistentReplicator(NonPersistentTopic topic, String localCluster, String remoteCluster,\n             BrokerService brokerService) throws NamingException {\n-        super(topic.getName(), topic.replicatorPrefix, localCluster, remoteCluster, brokerService);\n+        super(topic.getName(), topic.getReplicatorPrefix(), localCluster, remoteCluster, brokerService);\n \n         producerBuilder.blockIfQueueFull(false);\n \ndiff --git a/pulsar-broker/src/main/java/org/apache/pulsar/broker/service/nonpersistent/NonPersistentTopic.java b/pulsar-broker/src/main/java/org/apache/pulsar/broker/service/nonpersistent/NonPersistentTopic.java\nindex 3499afcb05..c8779d9531 100644\n--- a/pulsar-broker/src/main/java/org/apache/pulsar/broker/service/nonpersistent/NonPersistentTopic.java\n+++ b/pulsar-broker/src/main/java/org/apache/pulsar/broker/service/nonpersistent/NonPersistentTopic.java\n@@ -20,11 +20,9 @@ package org.apache.pulsar.broker.service.nonpersistent;\n \n import static com.google.common.base.Preconditions.checkArgument;\n import static org.apache.bookkeeper.mledger.impl.EntryCacheManager.create;\n-import static org.apache.bookkeeper.mledger.impl.ManagedLedgerMBeanImpl.ENTRY_LATENCY_BUCKETS_USEC;\n import static org.apache.pulsar.broker.cache.ConfigurationCacheService.POLICIES;\n \n import com.carrotsearch.hppc.ObjectObjectHashMap;\n-import com.google.common.base.MoreObjects;\n import com.google.common.collect.Lists;\n import com.google.common.collect.Maps;\n \n@@ -39,13 +37,11 @@ import java.util.concurrent.CompletableFuture;\n import java.util.concurrent.TimeUnit;\n import java.util.concurrent.atomic.AtomicBoolean;\n import java.util.concurrent.atomic.AtomicLongFieldUpdater;\n-import java.util.concurrent.locks.ReentrantReadWriteLock;\n \n-import org.apache.bookkeeper.common.util.OrderedExecutor;\n import org.apache.bookkeeper.mledger.Entry;\n import org.apache.bookkeeper.mledger.Position;\n-import org.apache.bookkeeper.mledger.util.StatsBuckets;\n import org.apache.pulsar.broker.admin.AdminResource;\n+import org.apache.pulsar.broker.service.AbstractTopic;\n import org.apache.pulsar.broker.service.BrokerService;\n import org.apache.pulsar.broker.service.BrokerServiceException;\n import org.apache.pulsar.broker.service.BrokerServiceException.ConsumerBusyException;\n@@ -65,7 +61,6 @@ import org.apache.pulsar.broker.service.StreamingStats;\n import org.apache.pulsar.broker.service.Subscription;\n import org.apache.pulsar.broker.service.Topic;\n import org.apache.pulsar.broker.service.schema.SchemaCompatibilityStrategy;\n-import org.apache.pulsar.broker.service.schema.SchemaRegistryService;\n import org.apache.pulsar.broker.stats.ClusterReplicationMetrics;\n import org.apache.pulsar.broker.stats.NamespaceStats;\n import org.apache.pulsar.client.api.MessageId;\n@@ -83,54 +78,29 @@ import org.apache.pulsar.common.policies.data.PersistentTopicInternalStats.Curso\n import org.apache.pulsar.common.policies.data.Policies;\n import org.apache.pulsar.common.policies.data.PublisherStats;\n import org.apache.pulsar.common.schema.SchemaData;\n-import org.apache.pulsar.common.schema.SchemaVersion;\n import org.apache.pulsar.common.util.FutureUtil;\n import org.apache.pulsar.common.util.collections.ConcurrentOpenHashMap;\n-import org.apache.pulsar.common.util.collections.ConcurrentOpenHashSet;\n import org.apache.pulsar.policies.data.loadbalancer.NamespaceBundleStats;\n import org.apache.pulsar.utils.StatsOutputStream;\n import org.apache.zookeeper.KeeperException;\n import org.slf4j.Logger;\n import org.slf4j.LoggerFactory;\n \n-public class NonPersistentTopic implements Topic {\n-    private final String topic;\n-\n-    // Producers currently connected to this topic\n-    private final ConcurrentOpenHashSet<Producer> producers;\n+public class NonPersistentTopic extends AbstractTopic implements Topic {\n \n     // Subscriptions to this topic\n     private final ConcurrentOpenHashMap<String, NonPersistentSubscription> subscriptions;\n \n     private final ConcurrentOpenHashMap<String, NonPersistentReplicator> replicators;\n \n-    private final BrokerService brokerService;\n-\n-    private volatile boolean isFenced;\n-\n-    // Prefix for replication cursors\n-    public final String replicatorPrefix;\n-\n     protected static final AtomicLongFieldUpdater<NonPersistentTopic> USAGE_COUNT_UPDATER = AtomicLongFieldUpdater\n             .newUpdater(NonPersistentTopic.class, \"usageCount\");\n     private volatile long usageCount = 0;\n \n-    private final OrderedExecutor executor;\n-\n-    private final ReentrantReadWriteLock lock = new ReentrantReadWriteLock();\n-\n-    // Timestamp of when this topic was last seen active\n-    private volatile long lastActive;\n-\n-    // Flag to signal that producer of this topic has published batch-message so, broker should not allow consumer which\n-    // doesn't support batch-message\n-    private volatile boolean hasBatchMessagePublished = false;\n     // Ever increasing counter of entries added\n-    static final AtomicLongFieldUpdater<NonPersistentTopic> ENTRIES_ADDED_COUNTER_UPDATER = AtomicLongFieldUpdater\n+    private static final AtomicLongFieldUpdater<NonPersistentTopic> ENTRIES_ADDED_COUNTER_UPDATER = AtomicLongFieldUpdater\n             .newUpdater(NonPersistentTopic.class, \"entriesAddedCounter\");\n     private volatile long entriesAddedCounter = 0;\n-    private static final long POLICY_UPDATE_FAILURE_RETRY_TIME_SECONDS = 60;\n-    private StatsBuckets addEntryLatencyStatsUsec = new StatsBuckets(ENTRY_LATENCY_BUCKETS_USEC);\n \n     private static final FastThreadLocal<TopicStats> threadLocalTopicStats = new FastThreadLocal<TopicStats>() {\n         @Override\n@@ -139,13 +109,6 @@ public class NonPersistentTopic implements Topic {\n         }\n     };\n \n-    // Whether messages published must be encrypted or not in this topic\n-    private volatile boolean isEncryptionRequired = false;\n-    private volatile SchemaCompatibilityStrategy schemaCompatibilityStrategy =\n-        SchemaCompatibilityStrategy.FULL;\n-    // schema validation enforced flag\n-    private volatile boolean schemaValidationEnforced = false;\n-\n     private static class TopicStats {\n         public double averageMsgSize;\n         public double aggMsgRateIn;\n@@ -170,18 +133,12 @@ public class NonPersistentTopic implements Topic {\n     }\n \n     public NonPersistentTopic(String topic, BrokerService brokerService) {\n-        this.topic = topic;\n-        this.brokerService = brokerService;\n-        this.producers = new ConcurrentOpenHashSet<Producer>(16, 1);\n+        super(topic, brokerService);\n         this.subscriptions = new ConcurrentOpenHashMap<>(16, 1);\n         this.replicators = new ConcurrentOpenHashMap<>(16, 1);\n         this.isFenced = false;\n-        this.replicatorPrefix = brokerService.pulsar().getConfiguration().getReplicatorPrefix();\n-        this.executor = brokerService.getTopicOrderedExecutor();\n         USAGE_COUNT_UPDATER.set(this, 0);\n \n-        this.lastActive = System.nanoTime();\n-\n         try {\n             Policies policies = brokerService.pulsar().getConfigurationCache().policiesCache()\n                     .get(AdminResource.path(POLICIES, TopicName.get(topic).getNamespace()))\n@@ -265,40 +222,11 @@ public class NonPersistentTopic implements Topic {\n         }\n     }\n \n-    private boolean isProducersExceeded() {\n-        Policies policies;\n-        try {\n-            policies =  brokerService.pulsar().getConfigurationCache().policiesCache()\n-                    .get(AdminResource.path(POLICIES, TopicName.get(topic).getNamespace()))\n-                    .orElseGet(() -> new Policies());\n-        } catch (Exception e) {\n-            policies = new Policies();\n-        }\n-        final int maxProducers = policies.max_producers_per_topic > 0 ?\n-                policies.max_producers_per_topic :\n-                brokerService.pulsar().getConfiguration().getMaxProducersPerTopic();\n-        if (maxProducers > 0 && maxProducers <= producers.size()) {\n-            return true;\n-        }\n-        return false;\n-    }\n-\n     @Override\n     public void checkMessageDeduplicationInfo() {\n         // No-op\n     }\n \n-    private boolean hasLocalProducers() {\n-        AtomicBoolean foundLocal = new AtomicBoolean(false);\n-        producers.forEach(producer -> {\n-            if (!producer.isRemote()) {\n-                foundLocal.set(true);\n-            }\n-        });\n-\n-        return foundLocal.get();\n-    }\n-\n     @Override\n     public void removeProducer(Producer producer) {\n         checkArgument(producer.getTopic() == this);\n@@ -673,16 +601,6 @@ public class NonPersistentTopic implements Topic {\n         // No-op\n     }\n \n-    @Override\n-    public String toString() {\n-        return MoreObjects.toStringHelper(this).add(\"topic\", topic).toString();\n-    }\n-\n-    @Override\n-    public ConcurrentOpenHashSet<Producer> getProducers() {\n-        return producers;\n-    }\n-\n     public int getNumberOfConsumers() {\n         int count = 0;\n         for (NonPersistentSubscription subscription : subscriptions.values()) {\n@@ -710,15 +628,6 @@ public class NonPersistentTopic implements Topic {\n         return replicators.get(remoteCluster);\n     }\n \n-    public BrokerService getBrokerService() {\n-        return brokerService;\n-    }\n-\n-    @Override\n-    public String getName() {\n-        return topic;\n-    }\n-\n     public void updateRates(NamespaceStats nsStats, NamespaceBundleStats bundleStats, StatsOutputStream topicStatsStream,\n             ClusterReplicationMetrics replStats, String namespace, boolean hydratePublishers) {\n \n@@ -995,14 +904,6 @@ public class NonPersistentTopic implements Topic {\n         return false;\n     }\n \n-    @Override\n-    public boolean isEncryptionRequired() {\n-        return isEncryptionRequired;\n-    }\n-\n-    @Override\n-    public boolean getSchemaValidationEnforced() { return schemaValidationEnforced; }\n-\n     @Override\n     public boolean isReplicated() {\n         return replicators.size() > 1;\n@@ -1019,57 +920,8 @@ public class NonPersistentTopic implements Topic {\n         throw new UnsupportedOperationException(\"getLastMessageId is not supported on non-persistent topic\");\n     }\n \n-    public void markBatchMessagePublished() {\n-        this.hasBatchMessagePublished = true;\n-    }\n-\n     private static final Logger log = LoggerFactory.getLogger(NonPersistentTopic.class);\n \n-    @Override\n-    public CompletableFuture<Boolean> hasSchema() {\n-        String base = TopicName.get(getName()).getPartitionedTopicName();\n-        String id = TopicName.get(base).getSchemaName();\n-        return brokerService.pulsar()\n-            .getSchemaRegistryService()\n-            .getSchema(id).thenApply((schema) -> schema != null);\n-    }\n-\n-    @Override\n-    public CompletableFuture<SchemaVersion> addSchema(SchemaData schema) {\n-        if (schema == null) {\n-            return CompletableFuture.completedFuture(SchemaVersion.Empty);\n-        }\n-\n-        String base = TopicName.get(getName()).getPartitionedTopicName();\n-        String id = TopicName.get(base).getSchemaName();\n-        return brokerService.pulsar()\n-            .getSchemaRegistryService()\n-            .putSchemaIfAbsent(id, schema, schemaCompatibilityStrategy);\n-    }\n-\n-    @Override\n-    public CompletableFuture<SchemaVersion> deleteSchema() {\n-        String base = TopicName.get(getName()).getPartitionedTopicName();\n-        String id = TopicName.get(base).getSchemaName();\n-        SchemaRegistryService schemaRegistryService = brokerService.pulsar().getSchemaRegistryService();\n-        return schemaRegistryService.getSchema(id)\n-                .thenCompose(schema -> {\n-                    if (schema != null) {\n-                        return schemaRegistryService.deleteSchema(id, \"\");\n-                    } else {\n-                        return CompletableFuture.completedFuture(null);\n-                    }\n-                });\n-    }\n-\n-    @Override\n-    public CompletableFuture<Boolean> isSchemaCompatible(SchemaData schema) {\n-        String base = TopicName.get(getName()).getPartitionedTopicName();\n-        String id = TopicName.get(base).getSchemaName();\n-        return brokerService.pulsar()\n-            .getSchemaRegistryService()\n-            .isCompatible(id, schema, schemaCompatibilityStrategy);\n-    }\n \n     @Override\n     public CompletableFuture<Boolean> addSchemaIfIdleOrCheckCompatible(SchemaData schema) {\n@@ -1082,9 +934,4 @@ public class NonPersistentTopic implements Topic {\n                     }\n                 });\n     }\n-    \n-    @Override\n-    public void recordAddLatency(long latencyUSec) {\n-        addEntryLatencyStatsUsec.addValue(latencyUSec);\n-    }\n }\ndiff --git a/pulsar-broker/src/main/java/org/apache/pulsar/broker/service/persistent/PersistentDispatcherSingleActiveConsumer.java b/pulsar-broker/src/main/java/org/apache/pulsar/broker/service/persistent/PersistentDispatcherSingleActiveConsumer.java\nindex e0b561642f..75d2b49f0b 100644\n--- a/pulsar-broker/src/main/java/org/apache/pulsar/broker/service/persistent/PersistentDispatcherSingleActiveConsumer.java\n+++ b/pulsar-broker/src/main/java/org/apache/pulsar/broker/service/persistent/PersistentDispatcherSingleActiveConsumer.java\n@@ -421,7 +421,7 @@ public final class PersistentDispatcherSingleActiveConsumer extends AbstractDisp\n             }\n             havePendingRead = true;\n             if (consumer.readCompacted()) {\n-                topic.compactedTopic.asyncReadEntriesOrWait(cursor, messagesToRead, this, consumer);\n+                topic.getCompactedTopic().asyncReadEntriesOrWait(cursor, messagesToRead, this, consumer);\n             } else {\n                 cursor.asyncReadEntriesOrWait(messagesToRead, this, consumer);\n             }\ndiff --git a/pulsar-broker/src/main/java/org/apache/pulsar/broker/service/persistent/PersistentReplicator.java b/pulsar-broker/src/main/java/org/apache/pulsar/broker/service/persistent/PersistentReplicator.java\nindex 01c547e7c9..dc5752e195 100644\n--- a/pulsar-broker/src/main/java/org/apache/pulsar/broker/service/persistent/PersistentReplicator.java\n+++ b/pulsar-broker/src/main/java/org/apache/pulsar/broker/service/persistent/PersistentReplicator.java\n@@ -98,7 +98,7 @@ public class PersistentReplicator extends AbstractReplicator implements Replicat\n \n     public PersistentReplicator(PersistentTopic topic, ManagedCursor cursor, String localCluster, String remoteCluster,\n             BrokerService brokerService) throws NamingException {\n-        super(topic.getName(), topic.replicatorPrefix, localCluster, remoteCluster, brokerService);\n+        super(topic.getName(), topic.getReplicatorPrefix(), localCluster, remoteCluster, brokerService);\n         this.topic = topic;\n         this.cursor = cursor;\n         this.expiryMonitor = new PersistentMessageExpiryMonitor(topicName, Codec.decode(cursor.getName()), cursor);\ndiff --git a/pulsar-broker/src/main/java/org/apache/pulsar/broker/service/persistent/PersistentTopic.java b/pulsar-broker/src/main/java/org/apache/pulsar/broker/service/persistent/PersistentTopic.java\nindex f60302ece5..a1ed823466 100644\n--- a/pulsar-broker/src/main/java/org/apache/pulsar/broker/service/persistent/PersistentTopic.java\n+++ b/pulsar-broker/src/main/java/org/apache/pulsar/broker/service/persistent/PersistentTopic.java\n@@ -20,7 +20,6 @@ package org.apache.pulsar.broker.service.persistent;\n \n import static com.google.common.base.Preconditions.checkArgument;\n import static com.google.common.base.Preconditions.checkNotNull;\n-import static org.apache.bookkeeper.mledger.impl.ManagedLedgerMBeanImpl.ENTRY_LATENCY_BUCKETS_USEC;\n import static org.apache.commons.lang3.StringUtils.isBlank;\n import static org.apache.pulsar.broker.cache.ConfigurationCacheService.POLICIES;\n \n@@ -35,7",
    "Fix test number \\' 0 \\' issue ( <issue_id> ) .": "diff --git a/blueocean-dashboard/src/main/js/components/RunDetails.jsx b/blueocean-dashboard/src/main/js/components/RunDetails.jsx\nindex a535f9395..46e72d318 100644\n--- a/blueocean-dashboard/src/main/js/components/RunDetails.jsx\n+++ b/blueocean-dashboard/src/main/js/components/RunDetails.jsx\n@@ -179,7 +179,7 @@ class RunDetails extends Component {\n         const base = { base: baseUrl };\n \n         const failureCount = Math.min(99, currentRun.testSummary && parseInt(currentRun.testSummary.failed) || 0);\n-        const testsBadge = failureCount && (\n+        const testsBadge = failureCount > 0 && (\n             <div className=\"TabBadgeIcon\">{ failureCount }</div>\n         );\n ",
    "Generate spring - boot auto configuration for all Camel components that has options that can be configured .": "diff --git a/components/camel-cxf/pom.xml b/components/camel-cxf/pom.xml\nindex 55622d3b50b..e8dd19f10da 100644\n--- a/components/camel-cxf/pom.xml\n+++ b/components/camel-cxf/pom.xml\n@@ -31,6 +31,8 @@\n \n   <properties>\n     <camel.osgi.import>\n+      !org.springframework.boot.*,\n+      !org.springframework.context.annotation.*;resolution:=optional,\n       !org.apache.camel.component.cxf,\n       !org.apache.camel.component.cxf.blueprint,\n       !org.apache.camel.component.cxf.converter,\n@@ -61,7 +63,6 @@\n       org.apache.camel.blueprint;resolution:=optional,\n       *\n     </camel.osgi.import>\n-\n     <camel.osgi.export>\n       org.apache.camel.component.cxf;${camel.osgi.version},\n       org.apache.camel.component.cxf.blueprint;${camel.osgi.version},\ndiff --git a/components/camel-spring/pom.xml b/components/camel-spring/pom.xml\nindex 026a6c464b7..971148c8a25 100644\n--- a/components/camel-spring/pom.xml\n+++ b/components/camel-spring/pom.xml\n@@ -32,6 +32,8 @@\n   <properties>\n     <!-- use spring-all-version-range to support camel-spring-dm also -->\n     <camel.osgi.import>\n+      !org.springframework.boot.*,\n+      !org.springframework.context.annotation.*;resolution:=optional,\n       !org.apache.camel.spring.*,\n       !org.apache.camel.component,\n       !org.apache.camel.component.event,",
    "suppress stacktrace in response by default .": "diff --git a/jaxrs/src/main/java/org/killbill/billing/jaxrs/json/BillingExceptionJson.java b/jaxrs/src/main/java/org/killbill/billing/jaxrs/json/BillingExceptionJson.java\nindex a009eb5dc6..181fa6d9b7 100644\n--- a/jaxrs/src/main/java/org/killbill/billing/jaxrs/json/BillingExceptionJson.java\n+++ b/jaxrs/src/main/java/org/killbill/billing/jaxrs/json/BillingExceptionJson.java\n@@ -54,12 +54,13 @@ public class BillingExceptionJson {\n         this.stackTrace = stackTrace;\n     }\n \n-    public BillingExceptionJson(final Exception exception) {\n+    public BillingExceptionJson(final Exception exception, final boolean withStackTrace) {\n         this(exception.getClass().getName(),\n              exception instanceof BillingExceptionBase ? ((BillingExceptionBase) exception).getCode() : null,\n              exception.getLocalizedMessage(),\n              exception.getCause() == null ? null : exception.getCause().getClass().getName(),\n              exception.getCause() == null ? null : exception.getCause().getLocalizedMessage(),\n+             !withStackTrace ? ImmutableList.<StackTraceElementJson>of() :\n              Lists.<StackTraceElement, StackTraceElementJson>transform(ImmutableList.<StackTraceElement>copyOf(exception.getStackTrace()),\n                                                                        new Function<StackTraceElement, StackTraceElementJson>() {\n                                                                            @Override\ndiff --git a/jaxrs/src/main/java/org/killbill/billing/jaxrs/mappers/ExceptionMapperBase.java b/jaxrs/src/main/java/org/killbill/billing/jaxrs/mappers/ExceptionMapperBase.java\nindex 7e32c1db15..047d76e618 100644\n--- a/jaxrs/src/main/java/org/killbill/billing/jaxrs/mappers/ExceptionMapperBase.java\n+++ b/jaxrs/src/main/java/org/killbill/billing/jaxrs/mappers/ExceptionMapperBase.java\n@@ -48,6 +48,8 @@ public abstract class ExceptionMapperBase {\n     private static final Logger log = LoggerFactory.getLogger(ExceptionMapperBase.class);\n     private static final ObjectMapper mapper = new ObjectMapper();\n \n+    private static final String QUERY_WITH_STACK_TRACE = \"withStackTrace\";\n+\n     protected Response fallback(final Exception exception, final UriInfo uriInfo) {\n         if (exception.getCause() == null) {\n             return buildBadRequestResponse(exception, uriInfo);\n@@ -114,7 +116,7 @@ public abstract class ExceptionMapperBase {\n         log.warn(\"Conflicting request\", e);\n \n         final Response.ResponseBuilder responseBuilder = Response.status(Status.CONFLICT);\n-        serializeException(e, responseBuilder);\n+        serializeException(e, uriInfo, responseBuilder);\n         return responseBuilder.build();\n     }\n \n@@ -123,7 +125,7 @@ public abstract class ExceptionMapperBase {\n         log.info(\"Not found\", e);\n \n         final Response.ResponseBuilder responseBuilder = Response.status(Status.NOT_FOUND);\n-        serializeException(e, responseBuilder);\n+        serializeException(e, uriInfo, responseBuilder);\n         return responseBuilder.build();\n     }\n \n@@ -132,7 +134,7 @@ public abstract class ExceptionMapperBase {\n         log.warn(\"Bad request\", e);\n \n         final Response.ResponseBuilder responseBuilder = Response.status(Status.BAD_REQUEST);\n-        serializeException(e, responseBuilder);\n+        serializeException(e, uriInfo, responseBuilder);\n         return responseBuilder.build();\n     }\n \n@@ -142,7 +144,7 @@ public abstract class ExceptionMapperBase {\n \n         // TODO Forbidden?\n         final Response.ResponseBuilder responseBuilder = Response.status(Status.UNAUTHORIZED);\n-        serializeException(e, responseBuilder);\n+        serializeException(e, uriInfo, responseBuilder);\n         return responseBuilder.build();\n     }\n \n@@ -151,23 +153,24 @@ public abstract class ExceptionMapperBase {\n         log.warn(\"Internal error\", e);\n \n         final Response.ResponseBuilder responseBuilder = Response.status(Status.INTERNAL_SERVER_ERROR);\n-        serializeException(e, responseBuilder);\n+        serializeException(e, uriInfo, responseBuilder);\n         return responseBuilder.build();\n     }\n \n     protected Response buildPluginTimeoutResponse(final Exception e, final UriInfo uriInfo) {\n         final Response.ResponseBuilder responseBuilder = Response.status(Status.ACCEPTED);\n-        serializeException(e, responseBuilder);\n+        serializeException(e, uriInfo, responseBuilder);\n         return responseBuilder.build();\n     }\n \n-    private void serializeException(final Exception e, final Response.ResponseBuilder responseBuilder) {\n-        final BillingExceptionJson billingExceptionJson = new BillingExceptionJson(e);\n+    private void serializeException(final Exception e, final UriInfo uriInfo, final Response.ResponseBuilder responseBuilder) {\n+        final boolean withStackTrace = uriInfo.getQueryParameters() != null && \"true\".equals(uriInfo.getQueryParameters().getFirst(QUERY_WITH_STACK_TRACE));\n+        final BillingExceptionJson billingExceptionJson = new BillingExceptionJson(e, withStackTrace);\n \n         try {\n             final String billingExceptionJsonAsString = mapper.writeValueAsString(billingExceptionJson);\n             responseBuilder.entity(billingExceptionJsonAsString).type(MediaType.APPLICATION_JSON);\n-        } catch (JsonProcessingException jsonException) {\n+        } catch (final JsonProcessingException jsonException) {\n             log.warn(\"Unable to serialize exception\", jsonException);\n             responseBuilder.entity(e.toString()).type(MediaType.TEXT_PLAIN_TYPE);\n         }\ndiff --git a/jaxrs/src/test/java/org/killbill/billing/jaxrs/json/TestBillingExceptionJson.java b/jaxrs/src/test/java/org/killbill/billing/jaxrs/json/TestBillingExceptionJson.java\nindex 86b605c2bf..626df425b1 100644\n--- a/jaxrs/src/test/java/org/killbill/billing/jaxrs/json/TestBillingExceptionJson.java\n+++ b/jaxrs/src/test/java/org/killbill/billing/jaxrs/json/TestBillingExceptionJson.java\n@@ -56,7 +56,7 @@ public class TestBillingExceptionJson extends JaxrsTestSuiteNoDB {\n             nil.toString();\n             Assert.fail();\n         } catch (final NullPointerException e) {\n-            final BillingExceptionJson exceptionJson = new BillingExceptionJson(e);\n+            final BillingExceptionJson exceptionJson = new BillingExceptionJson(e, true);\n             Assert.assertEquals(exceptionJson.getClassName(), e.getClass().getName());\n             Assert.assertNull(exceptionJson.getCode());\n             Assert.assertNull(exceptionJson.getMessage());\n@@ -66,6 +66,14 @@ public class TestBillingExceptionJson extends JaxrsTestSuiteNoDB {\n             Assert.assertEquals(exceptionJson.getStackTrace().get(0).getClassName(), TestBillingExceptionJson.class.getName());\n             Assert.assertEquals(exceptionJson.getStackTrace().get(0).getMethodName(), \"testFromException\");\n             Assert.assertFalse(exceptionJson.getStackTrace().get(0).getNativeMethod());\n+\n+            final BillingExceptionJson exceptionJsonNoStackTrace = new BillingExceptionJson(e, false);\n+            Assert.assertEquals(exceptionJsonNoStackTrace.getClassName(), e.getClass().getName());\n+            Assert.assertNull(exceptionJsonNoStackTrace.getCode());\n+            Assert.assertNull(exceptionJsonNoStackTrace.getMessage());\n+            Assert.assertNull(exceptionJsonNoStackTrace.getCauseClassName());\n+            Assert.assertNull(exceptionJsonNoStackTrace.getCauseMessage());\n+            Assert.assertTrue(exceptionJsonNoStackTrace.getStackTrace().isEmpty());\n         }\n     }\n }",
    "Including an option to show only the active file ( trans / job ) in the main tree to reduce confusion . . git - svn - id : svn : / / source . pentaho . org / svnkettleroot / Kettle / trunk @ 3076 5fb7f6ec - 07c1 - 534a - b4ca - 9155e429e800": "diff --git a/src/be/ibridge/kettle/core/Props.java b/src/be/ibridge/kettle/core/Props.java\nindex 5a32106712..c5f0939816 100644\n--- a/src/be/ibridge/kettle/core/Props.java\n+++ b/src/be/ibridge/kettle/core/Props.java\n@@ -148,6 +148,8 @@ public class Props implements Cloneable\n \n     private static final String STRING_MAX_NR_LINES_IN_LOG = \"MaxNrOfLinesInLog\";\n \n+    private static final String STRING_ONLY_SHOW_ACTIVE_FILE = \"OnlyShowActiveFileInTree\";\n+\n     private LogWriter log = LogWriter.getInstance();\n \tprivate Properties properties;\n \t\n@@ -1526,7 +1528,7 @@ public class Props implements Cloneable\n     \n     public boolean isBrandingActive()\n     {\n-        String show = properties.getProperty(STRING_SHOW_BRANDING_GRAPHICS, \"Y\");\n+        String show = properties.getProperty(STRING_SHOW_BRANDING_GRAPHICS, \"N\");\n         return \"Y\".equalsIgnoreCase(show);\n     }\n     \n@@ -1535,4 +1537,14 @@ public class Props implements Cloneable\n         properties.setProperty(STRING_SHOW_BRANDING_GRAPHICS, active?\"Y\":\"N\");\n     }\n \n+    public boolean isOnlyActiveFileShownInTree()\n+    {\n+        String show = properties.getProperty(STRING_ONLY_SHOW_ACTIVE_FILE, \"Y\");\n+        return \"Y\".equalsIgnoreCase(show);\n+    }\n+    \n+    public void setOnlyActiveFileShownInTree(boolean show)\n+    {\n+        properties.setProperty(STRING_ONLY_SHOW_ACTIVE_FILE, show?\"Y\":\"N\");\n+    }\n }\ndiff --git a/src/be/ibridge/kettle/core/dialog/EnterOptionsDialog.java b/src/be/ibridge/kettle/core/dialog/EnterOptionsDialog.java\nindex 71e2b23aac..1a950daa18 100644\n--- a/src/be/ibridge/kettle/core/dialog/EnterOptionsDialog.java\n+++ b/src/be/ibridge/kettle/core/dialog/EnterOptionsDialog.java\n@@ -160,6 +160,9 @@ public class EnterOptionsDialog extends Dialog\n \tprivate Label        wlAutoSave;\r\n \tprivate Button       wAutoSave;\r\n \n+    private Label        wlOnlyActiveFile;\n+    private Button       wOnlyActiveFile;\n+\n     private Label        wlDBConnXML;\n     private Button       wDBConnXML;\n \n@@ -1126,13 +1129,31 @@ public class EnterOptionsDialog extends Dialog\n         fdAutoSave.right= new FormAttachment(100, 0);\n         wAutoSave.setLayoutData(fdAutoSave);\n \n+        // Auto save changed files?\n+        wlOnlyActiveFile=new Label(wGeneralComp, SWT.RIGHT);\n+        wlOnlyActiveFile.setText(Messages.getString(\"EnterOptionsDialog.OnlyActiveFile.Label\"));\n+        props.setLook(wlOnlyActiveFile);\n+        FormData fdlOnlyActiveFile = new FormData();\n+        fdlOnlyActiveFile.left = new FormAttachment(0, 0);\n+        fdlOnlyActiveFile.top  = new FormAttachment(wAutoSave, margin);\n+        fdlOnlyActiveFile.right= new FormAttachment(middle, -margin);\n+        wlOnlyActiveFile.setLayoutData(fdlOnlyActiveFile);\n+        wOnlyActiveFile=new Button(wGeneralComp, SWT.CHECK);\n+        props.setLook(wOnlyActiveFile);\n+        wOnlyActiveFile.setSelection(props.isOnlyActiveFileShownInTree());\n+        FormData fdOnlyActiveFile = new FormData();\n+        fdOnlyActiveFile.left = new FormAttachment(middle, 0);\n+        fdOnlyActiveFile.top  = new FormAttachment(wAutoSave, margin);\n+        fdOnlyActiveFile.right= new FormAttachment(100, 0);\n+        wOnlyActiveFile.setLayoutData(fdOnlyActiveFile);\n+\n         // Only save used connections to XML?\n         wlDBConnXML=new Label(wGeneralComp, SWT.RIGHT);\n         wlDBConnXML.setText(Messages.getString(\"EnterOptionsDialog.OnlySaveUsedConnections.Label\"));\n         props.setLook(wlDBConnXML);\n         FormData fdlDBConnXML = new FormData();\n         fdlDBConnXML.left = new FormAttachment(0, 0);\n-        fdlDBConnXML.top  = new FormAttachment(wAutoSave, margin);\n+        fdlDBConnXML.top  = new FormAttachment(wOnlyActiveFile, margin);\n         fdlDBConnXML.right= new FormAttachment(middle, -margin);\n         wlDBConnXML.setLayoutData(fdlDBConnXML);\n         wDBConnXML=new Button(wGeneralComp, SWT.CHECK);\n@@ -1140,7 +1161,7 @@ public class EnterOptionsDialog extends Dialog\n         wDBConnXML.setSelection(props.areOnlyUsedConnectionsSavedToXML());\n         FormData fdDBConnXML = new FormData();\n         fdDBConnXML.left = new FormAttachment(middle, 0);\n-        fdDBConnXML.top  = new FormAttachment(wAutoSave, margin);\n+        fdDBConnXML.top  = new FormAttachment(wOnlyActiveFile, margin);\n         fdDBConnXML.right= new FormAttachment(100, 0);\n         wDBConnXML.setLayoutData(fdDBConnXML);\n \ndiff --git a/src/be/ibridge/kettle/core/dialog/messages/messages_en_US.properties b/src/be/ibridge/kettle/core/dialog/messages/messages_en_US.properties\nindex a6a1bb1f02..bb5d1e9c15 100644\n--- a/src/be/ibridge/kettle/core/dialog/messages/messages_en_US.properties\n+++ b/src/be/ibridge/kettle/core/dialog/messages/messages_en_US.properties\n@@ -191,6 +191,7 @@ EnterOptionsDialog.ShowWelcomePage.Label=Show welcome page at startup?\n EnterOptionsDialog.UseDatabaseCache.Label=Use database cache? \r\n EnterOptionsDialog.OpenLastFileStartup.Label=Open last file at startup? \r\n EnterOptionsDialog.AutoSave.Label=Auto save changed files? \r\n+EnterOptionsDialog.OnlyActiveFile.Label=Only show the active file in the main tree?\r\n EnterOptionsDialog.OnlySaveUsedConnections.Label=Only save used connections to XML? \r\n EnterOptionsDialog.ReplaceDBAsk.Label=Ask about replacing existing connections on open/import?\r\n EnterOptionsDialog.ReplaceDBAsk.Tooltip=If transformations are opened or imported and database connections exist with the same name as current ones,\\na dialog may be shown to ask the user whether to replace existing connections or not.\r\ndiff --git a/src/be/ibridge/kettle/job/JobMeta.java b/src/be/ibridge/kettle/job/JobMeta.java\nindex 8a116ca091..6875667882 100644\n--- a/src/be/ibridge/kettle/job/JobMeta.java\n+++ b/src/be/ibridge/kettle/job/JobMeta.java\n@@ -74,7 +74,7 @@ import be.ibridge.kettle.trans.HasDatabasesInterface;\n  * @since 11-08-2003\n  * \n  */\n-public class JobMeta implements Cloneable, XMLInterface, UndoInterface, HasDatabasesInterface, ChangedFlagInterface\n+public class JobMeta implements Cloneable, Comparable, XMLInterface, UndoInterface, HasDatabasesInterface, ChangedFlagInterface\n {\n     public static final String  XML_TAG              = \"job\"; //$NON-NLS-1$\n \n@@ -290,6 +290,11 @@ public class JobMeta implements Cloneable, XMLInterface, UndoInterface, HasDatab\n         }\n         return t1.getName().compareTo(t2.getName());\n     }\n+    \n+    public int compareTo(Object o)\n+    {\n+        return compare(this, o);\n+    }\n \n     public boolean equals(Object obj)\n     {\ndiff --git a/src/be/ibridge/kettle/spoon/Spoon.java b/src/be/ibridge/kettle/spoon/Spoon.java\nindex c35721d2e0..3011a3c403 100644\n--- a/src/be/ibridge/kettle/spoon/Spoon.java\n+++ b/src/be/ibridge/kettle/spoon/Spoon.java\n@@ -22,6 +22,7 @@ import java.lang.reflect.InvocationTargetException;\n import java.net.MalformedURLException;\r\n import java.util.ArrayList;\r\n import java.util.Collection;\r\n+import java.util.Collections;\r\n import java.util.Date;\r\n import java.util.Enumeration;\r\n import java.util.Hashtable;\r\n@@ -335,7 +336,7 @@ public class Spoon implements AddUndoPositionInterface\n     \r\n     private TransExecutionConfiguration executionConfiguration;\r\n \r\n-    private TreeItem tiTrans, tiJobs;\r\n+    // private TreeItem tiTrans, tiJobs;\r\n \r\n     private Menu spoonMenu; // Connections, Steps & hops\r\n     private MenuItem miFileClose, miFileSave, miFileSaveAs, miFilePrint;\r\n@@ -1660,12 +1661,6 @@ public class Spoon implements AddUndoPositionInterface\n         // Add a tree memory as well...\r\n         TreeMemory.addTreeListener(selectionTree, STRING_SPOON_MAIN_TREE);\r\n         \r\n-        tiTrans  = new TreeItem(selectionTree, SWT.NONE); tiTrans.setText(STRING_TRANSFORMATIONS);\r\n-        tiTrans.setImage(GUIResource.getInstance().getImageBol());\r\n-\r\n-        tiJobs   = new TreeItem(selectionTree, SWT.NONE); tiJobs.setText(STRING_JOBS);\r\n-        tiJobs.setImage(GUIResource.getInstance().getImageBol());\r\n-\r\n         selectionTree.addSelectionListener(new SelectionAdapter() { public void widgetSelected(SelectionEvent e) { setMenu(); } });\r\n         selectionTree.addSelectionListener(new SelectionAdapter() { public void widgetSelected(SelectionEvent e) { showSelection(); } });\r\n         selectionTree.addSelectionListener(new SelectionAdapter() { public void widgetDefaultSelected(SelectionEvent e){ doubleClickedInTree(); } });\r\n@@ -2821,8 +2816,10 @@ public class Spoon implements AddUndoPositionInterface\n                     ArrayList collection = new ArrayList();\r\n                     collection.addAll(tabMap.values());\r\n \t\t\t\t\t\r\n+                    // See which core objects to show\r\n+                    //\r\n                     for (Iterator iter = collection.iterator(); iter.hasNext();)\r\n-                    {                   \t\r\n+                    {\r\n                         TabMapEntry entry = (TabMapEntry) iter.next();\r\n                         if (event.item.equals(entry.getTabItem())) \r\n                         {\r\n@@ -2860,7 +2857,9 @@ public class Spoon implements AddUndoPositionInterface\n                             }                            \r\n                         }\r\n                     }\r\n-\r\n+                    \r\n+                    // Also refresh the tree\r\n+                    refreshTree();\r\n \t\t\t\t}        \t\r\n             });\r\n         \r\n@@ -4621,208 +4620,257 @@ public class Spoon implements AddUndoPositionInterface\n         if (shell.isDisposed()) return;\r\n         \r\n         GUIResource guiResource = GUIResource.getInstance();\r\n+        TransMeta activeTransMeta = getActiveTransformation();\r\n+        JobMeta activeJobMeta = getActiveJob();\r\n+        boolean showAll = activeTransMeta==null && activeJobMeta==null;\r\n         \r\n         // get a list of transformations from the transformation map\r\n-        Collection transformations = transformationMap.values();\r\n+        List transformations = new ArrayList(transformationMap.values());\r\n+        Collections.sort(transformations);\r\n         TransMeta[] transMetas = (TransMeta[]) transformations.toArray(new TransMeta[transformations.size()]);\r\n-\r\n+        \r\n         // get a list of jobs from the job map\r\n-        Collection jobs = jobMap.values();\r\n+        List jobs = new ArrayList(jobMap.values());\r\n+        Collections.sort(jobs);\r\n         JobMeta[] jobMetas = (JobMeta[]) jobs.toArray(new JobMeta[jobs.size()]);\r\n \r\n         // Refresh the content of the tree for those transformations\r\n         //\r\n         // First remove the old ones.\r\n-        tiTrans.removeAll();\r\n-        tiJobs.removeAll();\r\n-\r\n+        selectionTree.removeAll();\r\n+        \r\n         // Now add the data back \r\n         //\r\n-        for (int t=0;t<transMetas.length;t++)\r\n+        if (!props.isOnlyActiveFileShownInTree() || showAll || activeTransMeta!=null )\r\n         {\r\n-            TransMeta transMeta = transMetas[t];\r\n-            \r\n-            // Add a tree item with the name of transformation\r\n-            //\r\n-            TreeItem tiTransName = new TreeItem(tiTrans, SWT.NONE);\r\n-            String name = makeTransGraphTabName(transMeta);\r\n-            if (Const.isEmpty(name)) name = STRING_TRANS_NO_NAME;\r\n-            tiTransName.setText(name);\r\n-            tiTransName.setImage(guiResource.getImageBol());\r\n-            \r\n-            ///////////////////////////////////////////////////////\r\n-            //\r\n-            // Now add the database connections\r\n-            //\r\n-            TreeItem tiDbTitle = new TreeItem(tiTransName, SWT.NONE);\r\n-            tiDbTitle.setText(STRING_CONNECTIONS);\r\n-            tiDbTitle.setImage(guiResource.getImageConnection());\r\n+            TreeItem tiTrans = new TreeItem(selectionTree, SWT.NONE); \r\n+            tiTrans.setText(STRING_TRANSFORMATIONS);\r\n+            tiTrans.setImage(GUIResource.getInstance().getImageBol());\r\n             \r\n-            // Draw the connections themselves below it.\r\n-            for (int i=0;i<transMeta.nrDatabases();i++)\r\n+            // Set expanded if this is the only transformation shown.\r\n+            if (props.isOnlyActiveFileShownInTree())\r\n             {\r\n-                DatabaseMeta databaseMeta = transMeta.getDatabase(i);\r\n-                TreeItem tiDb = new TreeItem(tiDbTitle, SWT.NONE);\r\n-                tiDb.setText(databaseMeta.getName());\r\n-                if (databaseMeta.isShared()) tiDb.setFont(guiResource.getFontBold());\r\n-                tiDb.setImage(guiResource.getImageConnection());\r\n+                TreeMemory.getInstance().storeExpanded(STRING_SPOON_MAIN_TREE, tiTrans, true);\r\n             }\r\n \r\n-            ///////////////////////////////////////////////////////\r\n-            //\r\n-            // The steps\r\n-            //\r\n-            TreeItem tiStepTitle = new TreeItem(tiTransName, SWT.NONE);\r\n-            tiStepTitle.setText(STRING_STEPS);\r\n-            tiStepTitle.setImage(guiResource.getImageBol());\r\n-            \r\n-            // Put the steps below it.\r\n-            for (int i=0;i<transMeta.nrSteps();i++)\r\n-            {\r\n-                StepMeta stepMeta = transMeta.getStep(i);\r\n-                TreeItem tiStep = new TreeItem(tiStepTitle, SWT.NONE);\r\n-                tiStep.setText(stepMeta.getName());\r\n-                if (stepMeta.isShared()) tiStep.setFont(guiResource.getFontBold());\r\n-                if (!stepMeta.isDrawn()) tiStep.setForeground(guiResource.getColorGray());\r\n-                tiStep.setImage(guiResource.getImageBol());\r\n-            }\r\n-            \r\n-            ///////////////////////////////////////////////////////\r\n-            //\r\n-            // The hops\r\n-            //\r\n-            TreeItem tiHopTitle = new TreeItem(tiTransName, SWT.NONE);\r\n-            tiHopTitle.setText(STRING_HOPS);\r\n-            tiHopTitle.setImage(guiResource.getImageHop());\r\n-            \r\n-            // Put the steps below it.\r\n-            for (int i=0;i<transMeta.nrTransHops();i++)\r\n-            {\r\n-                TransHopMeta hopMeta = transMeta.getTransHop(i);\r\n-                TreeItem tiHop = new TreeItem(tiHopTitle, SWT.NONE);\r\n-                tiHop.setText(hopMeta.toString());\r\n-                tiHop.setImage(guiResource.getImageHop());\r\n-            }\r\n-\r\n-            ///////////////////////////////////////////////////////\r\n-            //\r\n-            // The partitions\r\n-            //\r\n-            TreeItem tiPartitionTitle = new TreeItem(tiTransName, SWT.NONE);\r\n-            tiPartitionTitle.setText(STRING_PARTITIONS);\r\n-            tiPartitionTitle.setImage(guiResource.getImageConnection());\r\n-            \r\n-            // Put the steps below it.\r\n-            for (int i=0;i<transMeta.getPartitionSchemas().size();i++)\r\n+            for (int t=0;t<transMetas.length;t++)\r\n             {\r\n-                PartitionSchema partitionSchema = (PartitionSchema) transMeta.getPartitionSchemas().get(i);\r\n-                TreeItem tiPartition = new TreeItem(tiPartitionTitle, SWT.NONE);\r\n-                tiPartition.setText(partitionSchema.getName());\r\n-                tiPartition.setImage(guiResource.getImageBol());\r\n-                if (partitionSchema.isShared()) tiPartition.setFont(guiResource.getFontBold());\r\n-            }\r\n+                TransMeta transMeta = transMetas[t];\r\n+                \r\n+                if (!props.isOnlyActiveFileShownInTree() || showAll || (activeTransMeta!=null && activeTransMeta.equals(transMeta)))\r\n+                {\r\n+                    // Add a tree item with the name of transformation\r\n+                    //\r\n+                    TreeItem tiTransName = new TreeItem(tiTrans, SWT.NONE);\r\n+                    String name = makeTransGraphTabName(transMeta);\r\n+                    if (Const.isEmpty(name)) name = STRING_TRANS_NO_NAME;\r\n+                    tiTransName.setText(name);\r\n+                    tiTransName.setImage(guiResource.getImageBol());\r\n+                    \r\n+                    // Set expanded if this is the only transformation shown.\r\n+                    if (props.isOnlyActiveFileShownInTree())\r\n+                    {\r\n+                        TreeMemory.getInstance().storeExpanded(STRING_SPOON_MAIN_TREE, tiTransName, true);\r\n+                    }\r\n \r\n-            ///////////////////////////////////////////////////////\r\n-            //\r\n-            // The slaves\r\n-            //\r\n-            TreeItem tiSlaveTitle = new TreeItem(tiTransName, SWT.NONE);\r\n-            tiSlaveTitle.setText(STRING_SLAVES);\r\n-            tiSlaveTitle.setImage(guiResource.getImageBol());\r\n-            \r\n-            // Put the steps below it.\r\n-            for (int i=0;i<transMeta.getSlaveServers().size();i++)\r\n-            {\r\n-                SlaveServer slaveServer = (SlaveServer) transMeta.getSlaveServers().get(i);\r\n-                TreeItem tiSlave = new TreeItem(tiSlaveTitle, SWT.NONE);\r\n-                tiSlave.setText(slaveServer.getName());\r\n-                tiSlave.setImage(guiResource.getImageBol());\r\n-                if (slaveServer.isShared()) tiSlave.setFont(guiResource.getFontBold());\r\n-            }\r\n-            \r\n-            ///////////////////////////////////////////////////////\r\n-            //\r\n-            // The clusters\r\n-            //\r\n-            TreeItem tiClusterTitle = new TreeItem(tiTransName, SWT.NONE);\r\n-            tiClusterTitle.setText(STRING_CLUSTERS);\r\n-            tiClusterTitle.setImage(guiResource.getImageBol());\r\n-            \r\n-            // Put the steps below it.\r\n-            for (int i=0;i<transMeta.getClusterSchemas().size();i++)\r\n-            {\r\n-                ClusterSchema clusterSchema = (ClusterSchema) transMeta.getClusterSchemas().get(i);\r\n-                TreeItem tiCluster = new TreeItem(tiClusterTitle, SWT.NONE);\r\n-                tiCluster.setText(clusterSchema.toString());\r\n-                tiCluster.setImage(guiResource.getImageBol());\r\n-                if (clusterSchema.isShared()) tiCluster.setFont(guiResource.getFontBold());\r\n+                    ///////////////////////////////////////////////////////\r\n+                    //\r\n+                    // Now add the database connections\r\n+                    //\r\n+                    TreeItem tiDbTitle = new TreeItem(tiTransName, SWT.NONE);\r\n+                    tiDbTitle.setText(STRING_CONNECTIONS);\r\n+                    tiDbTitle.setImage(guiResource.getImageConnection());\r\n+                    \r\n+                    // Draw the connections themselves below it.\r\n+                    for (int i=0;i<transMeta.nrDatabases();i++)\r\n+                    {\r\n+                        DatabaseMeta databaseMeta = transMeta.getDatabase(i);\r\n+                        TreeItem tiDb = new TreeItem(tiDbTitle, SWT.NONE);\r\n+                        tiDb.setText(databaseMeta.getName());\r\n+                        if (databaseMeta.isShared()) tiDb.setFont(guiResource.getFontBold());\r\n+                     ",
    "Added KeySampler and KeyVersionSampler tools as a first step towards replacing \\\" entropy \\\" tool .": "diff --git a/src/java/voldemort/client/protocol/admin/AdminClient.java b/src/java/voldemort/client/protocol/admin/AdminClient.java\nindex d3cfae325..e9c1a1230 100644\n--- a/src/java/voldemort/client/protocol/admin/AdminClient.java\n+++ b/src/java/voldemort/client/protocol/admin/AdminClient.java\n@@ -1432,7 +1432,8 @@ public class AdminClient {\n                                           boolean fetchValues,\n                                           boolean fetchMasterEntries,\n                                           Cluster initialCluster,\n-                                          long skipRecords) throws IOException {\n+                                          long skipRecords,\n+                                          long maxRecords) throws IOException {\n             HashMap<Integer, List<Integer>> filteredReplicaToPartitionList = Maps.newHashMap();\n             if(fetchMasterEntries) {\n                 if(!replicaToPartitionList.containsKey(0)) {\n@@ -1447,7 +1448,8 @@ public class AdminClient {\n                                                                                                                     .setFetchValues(fetchValues)\n                                                                                                                     .addAllReplicaToPartition(ProtoUtils.encodePartitionTuple(filteredReplicaToPartitionList))\n                                                                                                                     .setStore(storeName)\n-                                                                                                                    .setSkipRecords(skipRecords);\n+                                                                                                                    .setSkipRecords(skipRecords)\n+                                                                                                                    .setMaxRecords(maxRecords);\n \n             try {\n                 if(filter != null) {\n@@ -1574,14 +1576,16 @@ public class AdminClient {\n                                                                          List<Integer> partitionList,\n                                                                          VoldemortFilter filter,\n                                                                          boolean fetchMasterEntries,\n-                                                                         long skipRecords) {\n+                                                                         long skipRecords,\n+                                                                         long maxRecords) {\n             return fetchEntries(nodeId,\n                                 storeName,\n                                 helperOps.getReplicaToPartitionMap(nodeId, storeName, partitionList),\n                                 filter,\n                                 fetchMasterEntries,\n                                 null,\n-                                skipRecords);\n+                                skipRecords,\n+                                maxRecords);\n         }\n \n         /**\n@@ -1603,9 +1607,13 @@ public class AdminClient {\n                                                                          List<Integer> partitionList,\n                                                                          VoldemortFilter filter,\n                                                                          boolean fetchMasterEntries) {\n-            return fetchEntries(nodeId, storeName, partitionList, filter, fetchMasterEntries, 0);\n+            return fetchEntries(nodeId, storeName, partitionList, filter, fetchMasterEntries, 0, 0);\n         }\n \n+        // TODO: \" HashMap<Integer, List<Integer>> replicaToPartitionList,\" is a\n+        // confusing/opaque argument. Can this be made a type, or even\n+        // unrolled/simplified?\n+\n         // TODO: The use of \"Pair\" in the return for a fundamental type is\n         // awkward. We should have a core KeyValue type that effectively wraps\n         // up a ByteArray and a Versioned<byte[]>.\n@@ -1645,7 +1653,8 @@ public class AdminClient {\n                                                                          VoldemortFilter filter,\n                                                                          boolean fetchMasterEntries,\n                                                                          Cluster initialCluster,\n-                                                                         long skipRecords) {\n+                                                                         long skipRecords,\n+                                                                         long maxRecords) {\n \n             Node node = AdminClient.this.getAdminClientCluster().getNodeById(nodeId);\n             final SocketDestination destination = new SocketDestination(node.getHost(),\n@@ -1663,7 +1672,8 @@ public class AdminClient {\n                                      true,\n                                      fetchMasterEntries,\n                                      initialCluster,\n-                                     skipRecords);\n+                                     skipRecords,\n+                                     maxRecords);\n             } catch(IOException e) {\n                 helperOps.close(sands.getSocket());\n                 socketPool.checkin(destination, sands);\n@@ -1790,14 +1800,16 @@ public class AdminClient {\n                                              List<Integer> partitionList,\n                                              VoldemortFilter filter,\n                                              boolean fetchMasterEntries,\n-                                             long skipRecords) {\n+                                             long skipRecords,\n+                                             long maxRecords) {\n             return fetchKeys(nodeId,\n                              storeName,\n                              helperOps.getReplicaToPartitionMap(nodeId, storeName, partitionList),\n                              filter,\n                              fetchMasterEntries,\n                              null,\n-                             skipRecords);\n+                             skipRecords,\n+                             maxRecords);\n         }\n \n         /**\n@@ -1819,7 +1831,7 @@ public class AdminClient {\n                                              List<Integer> partitionList,\n                                              VoldemortFilter filter,\n                                              boolean fetchMasterEntries) {\n-            return fetchKeys(nodeId, storeName, partitionList, filter, fetchMasterEntries, 0);\n+            return fetchKeys(nodeId, storeName, partitionList, filter, fetchMasterEntries, 0, 0);\n         }\n \n         /**\n@@ -1843,7 +1855,8 @@ public class AdminClient {\n                                              VoldemortFilter filter,\n                                              boolean fetchMasterEntries,\n                                              Cluster initialCluster,\n-                                             long skipRecords) {\n+                                             long skipRecords,\n+                                             long maxRecords) {\n             Node node = AdminClient.this.getAdminClientCluster().getNodeById(nodeId);\n             final SocketDestination destination = new SocketDestination(node.getHost(),\n                                                                         node.getAdminPort(),\n@@ -1860,7 +1873,8 @@ public class AdminClient {\n                                      false,\n                                      fetchMasterEntries,\n                                      initialCluster,\n-                                     skipRecords);\n+                                     skipRecords,\n+                                     maxRecords);\n             } catch(IOException e) {\n                 helperOps.close(sands.getSocket());\n                 socketPool.checkin(destination, sands);\ndiff --git a/src/java/voldemort/client/protocol/pb/VAdminProto.java b/src/java/voldemort/client/protocol/pb/VAdminProto.java\nindex b4c1914cf..a67c5b387 100644\n--- a/src/java/voldemort/client/protocol/pb/VAdminProto.java\n+++ b/src/java/voldemort/client/protocol/pb/VAdminProto.java\n@@ -4507,6 +4507,13 @@ public final class VAdminProto {\n     public boolean hasFetchOrphaned() { return hasFetchOrphaned; }\n     public boolean getFetchOrphaned() { return fetchOrphaned_; }\n     \n+    // optional int64 max_records = 8;\n+    public static final int MAX_RECORDS_FIELD_NUMBER = 8;\n+    private boolean hasMaxRecords;\n+    private long maxRecords_ = 0L;\n+    public boolean",
    "Improve match expression grammar": "diff --git a/tool-plugins/intellij/src/main/gen/org/ballerinalang/plugins/idea/parser/BallerinaParser.java b/tool-plugins/intellij/src/main/gen/org/ballerinalang/plugins/idea/parser/BallerinaParser.java\nindex d91a476023f..996a73e045c 100644\n--- a/tool-plugins/intellij/src/main/gen/org/ballerinalang/plugins/idea/parser/BallerinaParser.java\n+++ b/tool-plugins/intellij/src/main/gen/org/ballerinalang/plugins/idea/parser/BallerinaParser.java\n@@ -3334,14 +3334,15 @@ public class BallerinaParser implements PsiParser, LightPsiParser {\n   // TypeName identifier? EQUAL_GT Expression\n   public static boolean MatchExpressionPatternClause(PsiBuilder b, int l) {\n     if (!recursion_guard_(b, l, \"MatchExpressionPatternClause\")) return false;\n-    boolean r;\n+    boolean r, p;\n     Marker m = enter_section_(b, l, _NONE_, MATCH_EXPRESSION_PATTERN_CLAUSE, \"<match expression pattern clause>\");\n     r = TypeName(b, l + 1, -1);\n-    r = r && MatchExpressionPatternClause_1(b, l + 1);\n-    r = r && consumeToken(b, EQUAL_GT);\n-    r = r && Expression(b, l + 1, -1);\n-    exit_section_(b, l, m, r, false, null);\n-    return r;\n+    p = r; // pin = 1\n+    r = r && report_error_(b, MatchExpressionPatternClause_1(b, l + 1));\n+    r = p && report_error_(b, consumeToken(b, EQUAL_GT)) && r;\n+    r = p && Expression(b, l + 1, -1) && r;\n+    exit_section_(b, l, m, r, p, null);\n+    return r || p;\n   }\n \n   // identifier?\n@@ -7456,42 +7457,55 @@ public class BallerinaParser implements PsiParser, LightPsiParser {\n   }\n \n   /* ********************************************************** */\n-  // but LEFT_BRACE MatchExpressionPatternClause (COMMA MatchExpressionPatternClause)* RIGHT_BRACE\n+  // but (LEFT_BRACE MatchExpressionPatternClause (COMMA MatchExpressionPatternClause)* RIGHT_BRACE)\n   public static boolean matchExpression(PsiBuilder b, int l) {\n     if (!recursion_guard_(b, l, \"matchExpression\")) return false;\n     if (!nextTokenIs(b, BUT)) return false;\n     boolean r, p;\n     Marker m = enter_section_(b, l, _NONE_, MATCH_EXPRESSION, null);\n-    r = consumeTokens(b, 1, BUT, LEFT_BRACE);\n+    r = consumeToken(b, BUT);\n+    p = r; // pin = 1\n+    r = r && matchExpression_1(b, l + 1);\n+    exit_section_(b, l, m, r, p, null);\n+    return r || p;\n+  }\n+\n+  // LEFT_BRACE MatchExpressionPatternClause (COMMA MatchExpressionPatternClause)* RIGHT_BRACE\n+  private static boolean matchExpression_1(PsiBuilder b, int l) {\n+    if (!recursion_guard_(b, l, \"matchExpression_1\")) return false;\n+    boolean r, p;\n+    Marker m = enter_section_(b, l, _NONE_);\n+    r = consumeToken(b, LEFT_BRACE);\n     p = r; // pin = 1\n     r = r && report_error_(b, MatchExpressionPatternClause(b, l + 1));\n-    r = p && report_error_(b, matchExpression_3(b, l + 1)) && r;\n+    r = p && report_error_(b, matchExpression_1_2(b, l + 1)) && r;\n     r = p && consumeToken(b, RIGHT_BRACE) && r;\n     exit_section_(b, l, m, r, p, null);\n     return r || p;\n   }\n \n   // (COMMA MatchExpressionPatternClause)*\n-  private static boolean matchExpression_3(PsiBuilder b, int l) {\n-    if (!recursion_guard_(b, l, \"matchExpression_3\")) return false;\n+  private static boolean matchExpression_1_2(PsiBuilder b, int l) {\n+    if (!recursion_guard_(b, l, \"matchExpression_1_2\")) return false;\n     int c = current_position_(b);\n     while (true) {\n-      if (!matchExpression_3_0(b, l + 1)) break;\n-      if (!empty_element_parsed_guard_(b, \"matchExpression_3\", c)) break;\n+      if (!matchExpression_1_2_0(b, l + 1)) break;\n+      if (!empty_element_parsed_guard_(b, \"matchExpression_1_2\", c)) break;\n       c = current_position_(b);\n     }\n     return true;\n   }\n \n   // COMMA MatchExpressionPatternClause\n-  private static boolean matchExpression_3_0(PsiBuilder b, int l) {\n-    if (!recursion_guard_(b, l, \"matchExpression_3_0\")) return false;\n-    boolean r;\n-    Marker m = enter_section_(b);\n+  private static boolean matchExpression_1_2_0(PsiBuilder b, int l) {\n+    if (!recursion_guard_(b, l, \"matchExpression_1_2_0\")) return false;\n+    boolean r, p;\n+    Marker m = enter_section_(b, l, _NONE_);\n     r = consumeToken(b, COMMA);\n+    p = r; // pin = 1\n     r = r && MatchExpressionPatternClause(b, l + 1);\n-    exit_section_(b, m, null, r);\n-    return r;\n+    exit_section_(b, l, m, r, p, null);\n+    return r || p;\n   }\n \n   /* ********************************************************** */\ndiff --git a/tool-plugins/intellij/src/main/gen/org/ballerinalang/plugins/idea/psi/BallerinaMatchExpressionPatternClause.java b/tool-plugins/intellij/src/main/gen/org/ballerinalang/plugins/idea/psi/BallerinaMatchExpressionPatternClause.java\nindex 9d585f79f03..dcd1240a20c 100644\n--- a/tool-plugins/intellij/src/main/gen/org/ballerinalang/plugins/idea/psi/BallerinaMatchExpressionPatternClause.java\n+++ b/tool-plugins/intellij/src/main/gen/org/ballerinalang/plugins/idea/psi/BallerinaMatchExpressionPatternClause.java\n@@ -23,13 +23,13 @@ import com.intellij.psi.PsiElement;\n \n public interface BallerinaMatchExpressionPatternClause extends BallerinaCompositeElement {\n \n-  @NotNull\n+  @Nullable\n   BallerinaExpression getExpression();\n \n   @NotNull\n   BallerinaTypeName getTypeName();\n \n-  @NotNull\n+  @Nullable\n   PsiElement getEqualGt();\n \n   @Nullable\ndiff --git a/tool-plugins/intellij/src/main/gen/org/ballerinalang/plugins/idea/psi/impl/BallerinaMatchExpressionPatternClauseImpl.java b/tool-plugins/intellij/src/main/gen/org/ballerinalang/plugins/idea/psi/impl/BallerinaMatchExpressionPatternClauseImpl.java\nindex a83c1c253b3..5759cf166df 100644\n--- a/tool-plugins/intellij/src/main/gen/org/ballerinalang/plugins/idea/psi/impl/BallerinaMatchExpressionPatternClauseImpl.java\n+++ b/tool-plugins/intellij/src/main/gen/org/ballerinalang/plugins/idea/psi/impl/BallerinaMatchExpressionPatternClauseImpl.java\n@@ -42,9 +42,9 @@ public class BallerinaMatchExpressionPatternClauseImpl extends BallerinaComposit\n   }\n \n   @Override\n-  @NotNull\n+  @Nullable\n   public BallerinaExpression getExpression() {\n-    return notNullChild(PsiTreeUtil.getChildOfType(this, BallerinaExpression.class));\n+    return PsiTreeUtil.getChildOfType(this, BallerinaExpression.class);\n   }\n \n   @Override\n@@ -54,9 +54,9 @@ public class BallerinaMatchExpressionPatternClauseImpl extends BallerinaComposit\n   }\n \n   @Override\n-  @NotNull\n+  @Nullable\n   public PsiElement getEqualGt() {\n-    return notNullChild(findChildByType(EQUAL_GT));\n+    return findChildByType(EQUAL_GT);\n   }\n \n   @Override\ndiff --git a/tool-plugins/intellij/src/main/java/org/ballerinalang/plugins/idea/grammar/Ballerina.bnf b/tool-plugins/intellij/src/main/java/org/ballerinalang/plugins/idea/grammar/Ballerina.bnf\nindex 979e9a71a50..b480b02f0e8 100644\n--- a/tool-plugins/intellij/src/main/java/org/ballerinalang/plugins/idea/grammar/Ballerina.bnf\n+++ b/tool-plugins/intellij/src/main/java/org/ballerinalang/plugins/idea/grammar/Ballerina.bnf\n@@ -703,9 +703,9 @@ AwaitExpression ::= await Expression\n MatchExprExpression ::= Expression matchExpression\n CheckedExpression ::= check Expression\n \n-matchExpression ::= but LEFT_BRACE MatchExpressionPatternClause (COMMA MatchExpressionPatternClause)* RIGHT_BRACE {pin=1}\n+matchExpression ::= but (LEFT_BRACE MatchExpressionPatternClause (COMMA MatchExpressionPatternClause)* RIGHT_BRACE) {pin(\".*\")=1}\n \n-MatchExpressionPatternClause ::= TypeName identifier? EQUAL_GT Expression\n+MatchExpressionPatternClause ::= TypeName identifier? EQUAL_GT Expression {pin=1}\n \n //reusable productions\n ",
    "Apply trim paths to shape fills .": "diff --git a/LottieSample/screenshots/Tests_TrimPathFill 0.png b/LottieSample/screenshots/Tests_TrimPathFill 0.png\nnew file mode 100644\nindex 00000000..b912ce5d\nBinary files /dev/null and b/LottieSample/screenshots/Tests_TrimPathFill 0.png differ\ndiff --git a/LottieSample/src/androidTest/java/com/airbnb/lottie/LottieTest.java b/LottieSample/src/androidTest/java/com/airbnb/lottie/LottieTest.java\nindex 187217b4..532b665a 100644\n--- a/LottieSample/src/androidTest/java/com/airbnb/lottie/LottieTest.java\n+++ b/LottieSample/src/androidTest/java/com/airbnb/lottie/LottieTest.java\n@@ -35,5 +35,6 @@ public class LottieTest extends ActivityInstrumentationTestCase2<MainActivity> {\n     TestRobot.testAnimation(getActivity(), \"Tests/EllipseTrimPath.json\");\n     TestRobot.testAnimation(getActivity(), \"Tests/SplitDimensions.json\");\n     TestRobot.testAnimation(getActivity(), \"Tests/TrimPathsFull.json\");\n+    TestRobot.testStatic(getActivity(), \"Tests/TrimPathFill.json\");\n   }\n }\ndiff --git a/LottieSample/src/androidTest/java/com/airbnb/lottie/TestRobot.java b/LottieSample/src/androidTest/java/com/airbnb/lottie/TestRobot.java\nindex db8e3e91..f0e88cca 100644\n--- a/LottieSample/src/androidTest/java/com/airbnb/lottie/TestRobot.java\n+++ b/LottieSample/src/androidTest/java/com/airbnb/lottie/TestRobot.java\n@@ -9,6 +9,10 @@ import java.util.Locale;\n class TestRobot {\n   private static final float[] DEFAULT_ANIMATED_PROGRESS = {0f, 0.05f, 0.10f, 0.2f, 0.5f, 1f};\n \n+  static void testStatic(MainActivity activity, String fileName) {\n+    testAnimation(activity, fileName, new float[] {0});\n+  }\n+\n   static void testAnimation(MainActivity activity, String fileName) {\n     testAnimation(activity, fileName, DEFAULT_ANIMATED_PROGRESS);\n   }\ndiff --git a/LottieSample/src/main/assets/Tests/TrimPathFill.json b/LottieSample/src/main/assets/Tests/TrimPathFill.json\nnew file mode 100644\nindex 00000000..26a4ceeb\n--- /dev/null\n+++ b/LottieSample/src/main/assets/Tests/TrimPathFill.json\n@@ -0,0 +1 @@\n+{\"assets\":[],\"layers\":[{\"ddd\":0,\"ind\":0,\"ty\":4,\"nm\":\"Shape Layer 2\",\"ks\":{\"o\":{\"k\":100},\"r\":{\"k\":0},\"p\":{\"k\":[200,200,0]},\"a\":{\"k\":[0,0,0]},\"s\":{\"k\":[100,100,100]}},\"ao\":0,\"shapes\":[{\"ty\":\"gr\",\"it\":[{\"d\":1,\"ty\":\"el\",\"s\":{\"k\":[147.008,97.246]},\"p\":{\"k\":[0,0]},\"nm\":\"Ellipse Path 1\",\"mn\":\"ADBE Vector Shape - Ellipse\"},{\"ty\":\"tm\",\"s\":{\"k\":0,\"ix\":1},\"e\":{\"k\":50,\"ix\":2},\"o\":{\"k\":0,\"ix\":3},\"m\":1,\"ix\":2,\"nm\":\"Trim Paths 1\",\"mn\":\"ADBE Vector Filter - Trim\"},{\"ty\":\"st\",\"fillEnabled\":true,\"c\":{\"k\":[0,0.06,1,1]},\"o\":{\"k\":100},\"w\":{\"k\":11},\"lc\":1,\"lj\":1,\"ml\":4,\"nm\":\"Stroke 1\",\"mn\":\"ADBE Vector Graphic - Stroke\"},{\"ty\":\"fl\",\"fillEnabled\":true,\"c\":{\"k\":[1,0,0,1]},\"o\":{\"k\":100},\"nm\":\"Fill 1\",\"mn\":\"ADBE Vector Graphic - Fill\"},{\"ty\":\"tr\",\"p\":{\"k\":[-54.496,-56.377],\"ix\":2},\"a\":{\"k\":[0,0],\"ix\":1},\"s\":{\"k\":[100,100],\"ix\":3},\"r\":{\"k\":0,\"ix\":6},\"o\":{\"k\":100,\"ix\":7},\"sk\":{\"k\":0,\"ix\":4},\"sa\":{\"k\":0,\"ix\":5},\"nm\":\"Transform\"}],\"nm\":\"Ellipse 1\",\"np\":4,\"mn\":\"ADBE Vector Group\"}],\"ip\":0,\"op\":1800,\"st\":0,\"bm\":0,\"sr\":1},{\"ddd\":0,\"ind\":1,\"ty\":4,\"nm\":\"Shape Layer 1\",\"ks\":{\"o\":{\"k\":100},\"r\":{\"k\":0},\"p\":{\"k\":[200,200,0]},\"a\":{\"k\":[0,0,0]},\"s\":{\"k\":[100,100,100]}},\"ao\":0,\"shapes\":[{\"ty\":\"gr\",\"it\":[{\"ind\":0,\"ty\":\"sh\",\"ks\":{\"k\":{\"i\":[[0,0],[0,0],[0,0],[0,0]],\"o\":[[0,0],[0,0],[0,0],[0,0]],\"v\":[[100.922,-82.055],[100.922,82.055],[-100.922,82.055],[-100.922,-82.055]],\"c\":true}},\"nm\":\"Path 1\",\"mn\":\"ADBE Vector Shape - Group\"},{\"ty\":\"tm\",\"s\":{\"k\":0,\"ix\":1},\"e\":{\"k\":50,\"ix\":2},\"o\":{\"k\":0,\"ix\":3},\"m\":1,\"ix\":2,\"nm\":\"Trim Paths 1\",\"mn\":\"ADBE Vector Filter - Trim\"},{\"ty\":\"st\",\"fillEnabled\":true,\"c\":{\"k\":[0,0.09,1,1]},\"o\":{\"k\":100},\"w\":{\"k\":21},\"lc\":1,\"lj\":1,\"ml\":4,\"nm\":\"Stroke 1\",\"mn\":\"ADBE Vector Graphic - Stroke\"},{\"ty\":\"fl\",\"fillEnabled\":true,\"c\":{\"k\":[1,0,0,1]},\"o\":{\"k\":100},\"nm\":\"Fill 1\",\"mn\":\"ADBE Vector Graphic - Fill\"},{\"ty\":\"tr\",\"p\":{\"k\":[70.992,93.828],\"ix\":2},\"a\":{\"k\":[0,0],\"ix\":1},\"s\":{\"k\":[100,100],\"ix\":3},\"r\":{\"k\":0,\"ix\":6},\"o\":{\"k\":100,\"ix\":7},\"sk\":{\"k\":0,\"ix\":4},\"sa\":{\"k\":0,\"ix\":5},\"nm\":\"Transform\"}],\"nm\":\"Rectangle 1\",\"np\":4,\"mn\":\"ADBE Vector Group\"}],\"ip\":0,\"op\":1800,\"st\":0,\"bm\":0,\"sr\":1}],\"v\":\"4.5.0\",\"ddd\":0,\"ip\":0,\"op\":1800,\"fr\":60,\"w\":400,\"h\":400}\n\\ No newline at end of file\ndiff --git a/lottie/src/main/java/com/airbnb/lottie/EllipseShapeLayer.java b/lottie/src/main/java/com/airbnb/lottie/EllipseShapeLayer.java\nindex 1d3b25d9..180b016b 100644\n--- a/lottie/src/main/java/com/airbnb/lottie/EllipseShapeLayer.java\n+++ b/lottie/src/main/java/com/airbnb/lottie/EllipseShapeLayer.java\n@@ -26,6 +26,10 @@ class EllipseShapeLayer extends AnimatableLayer {\n       fillLayer.updateCircle(\n           circleShape.getPosition().createAnimation(),\n           circleShape.getSize().createAnimation());\n+      if (trim != null) {\n+        fillLayer.setTrimPath(trim.getStart().createAnimation(), trim.getEnd().createAnimation(),\n+            trim.getOffset().createAnimation());\n+      }\n       addLayer(fillLayer);\n     }\n \ndiff --git a/lottie/src/main/java/com/airbnb/lottie/ShapeLayerView.java b/lottie/src/main/java/com/airbnb/lottie/ShapeLayerView.java\nindex 69471808..78320f90 100644\n--- a/lottie/src/main/java/com/airbnb/lottie/ShapeLayerView.java\n+++ b/lottie/src/main/java/com/airbnb/lottie/ShapeLayerView.java\n@@ -28,6 +28,10 @@ class ShapeLayerView extends AnimatableLayer {\n       fillLayer.setShapeAlpha(fill.getOpacity().createAnimation());\n       fillLayer.setTransformAlpha(transformModel.getOpacity().createAnimation());\n       fillLayer.setScale(scale.createAnimation());\n+      if (trim != null) {\n+        fillLayer.setTrimPath(trim.getStart().createAnimation(), trim.getEnd().createAnimation(),\n+            trim.getOffset().createAnimation());\n+      }\n       addLayer(fillLayer);\n     }\n ",
    "Add note to documentation about silent mode for HTTP BASIC auth": "diff --git a/docs/src/main/asciidoc/_elytron/Using_the_Elytron_Subsystem.adoc b/docs/src/main/asciidoc/_elytron/Using_the_Elytron_Subsystem.adoc\nindex a73d22b666..8c980733fe 100644\n--- a/docs/src/main/asciidoc/_elytron/Using_the_Elytron_Subsystem.adoc\n+++ b/docs/src/main/asciidoc/_elytron/Using_the_Elytron_Subsystem.adoc\n@@ -689,6 +689,14 @@ Example _web.xml_ with _BASIC_ Authentication\n </web-app>\n ----\n \n+_BASIC_ Authentication can be configured to be silent\n+[source, xml]\n+----\n+<auth-method>BASIC?silent=true</auth-method>\n+----\n+Basic authentication in silent mode will send challenge to authenticate only if the request\n+contained authorization header, otherwise it is assumed another method will send the challenge.\n+\n [[configure-your-application-to-use-a-security-domain.]]\n ==== Configure your application to use a security domain.\n ",
    "add ICLAs for Lukasz Cwik , Juan Pablo Santos , Gareth Davis , Marek Szalik , Christoph Zauner to file": "diff --git a/src/main/clas/signed-clas.txt b/src/main/clas/signed-clas.txt\nindex 9793c1608..e01dd79bf 100755\n--- a/src/main/clas/signed-clas.txt\n+++ b/src/main/clas/signed-clas.txt\n@@ -37,6 +37,11 @@ Adam Gent                MA, USA               2014-04-01\n Sebastian Groebler       Berlin, Germany       2014-07-17\n Alexander Dorokhine      CA, USA               2014-12-07\n Yuji Okazawa             Tokyo, Japan          2015-04-01\n+Lukasz Cwik              WA, USA               2015-06-11\n+Juan Pablo Santos        Madrid, Spain        ",
    "removed kotlin plugin ( <issue_id> )": "diff --git a/app/build.gradle b/app/build.gradle\nindex 3ed59742..2a40e77e 100755\n--- a/app/build.gradle\n+++ b/app/build.gradle\n@@ -1,7 +1,5 @@\n apply plugin: 'com.android.application'\n apply plugin: 'jacoco-android'\n-apply plugin: 'kotlin-android'\n-apply plugin: 'kotlin-kapt'\n apply plugin: 'realm-android'\n \n android {\n@@ -115,19 +113,17 @@ dependencies {\n     compile \"com.android.support:support-vector-drawable:$rootProject.supportLibraryVersion\"\n     testCompile \"junit:junit:$rootProject.junitVersion\"\n     compile \"com.jakewharton:butterknife:$rootProject.butterknifeVersion\"\n-    kapt \"com.jakewharton:butterknife-compiler:$rootProject.butterknifeVersion\"\n+    annotationProcessor \"com.jakewharton:butterknife-compiler:$rootProject.butterknifeVersion\"\n     compile \"com.android.support:palette-v7:$rootProject.supportLibraryVersion\"\n     compile \"com.android.support:cardview-v7:$rootProject.supportLibraryVersion\"\n     compile \"com.android.support:customtabs:$rootProject.supportLibraryVersion\"\n     compile project(':photoview')\n-    compile \"org.jetbrains.kotlin:kotlin-stdlib-jre7:$kotlin_version\"\n     compile \"com.twitter.sdk.android:twitter:$rootProject.twitterVersion\"\n     compile \"com.android.support:support-v4:$rootProject.supportLibraryVersion\"\n     compile \"com.facebook.stetho:stetho-okhttp3:$rootProject.stethoVersion\"\n     compile \"com.squareup.picasso:picasso:$rootProject.picassoVersion\"\n     compile \"com.github.amlcurran.showcaseview:library:$rootProject.showcaseVersion\"\n \n-    compile \"org.jetbrains.kotlin:kotlin-stdlib-jre7:$kotlin_version\"\n     compile \"com.twitter.sdk.android:twitter:$rootProject.twitterVersion\"\n     compile \"com.android.support:support-v4:$rootProject.supportLibraryVersion\"\n     compile \"com.facebook.stetho:stetho-okhttp3:$rootProject.stethoVersion\"\n@@ -167,8 +163,4 @@ dependencies {\n     compile 'com.android.support:multidex:1.0.1'\n     androidTestCompile 'com.google.code.findbugs:jsr305:3.0.0'\n     compile project(':pdk')\n-}\n-\n-kapt {\n-    generateStubs = true\n }\n\\ No newline at end of file\ndiff --git a/app/src/main/java/org/fossasia/phimpme/accounts/AccountActivity.java b/app/src/main/java/org/fossasia/phimpme/accounts/AccountActivity.java\nindex 95311ba6..518e7830 100644\n--- a/app/src/main/java/org/fossasia/phimpme/accounts/AccountActivity.java\n+++ b/app/src/main/java/org/fossasia/phimpme/accounts/AccountActivity.java\n@@ -22,6 +22,10 @@ import com.facebook.GraphRequest;\n import com.facebook.GraphResponse;\n import com.facebook.login.LoginManager;\n import com.facebook.login.LoginResult;\n+import com.pinterest.android.pdk.PDKCallback;\n+import com.pinterest.android.pdk.PDKClient;\n+import com.pinterest.android.pdk.PDKException;\n+import com.pinterest.android.pdk.PDKResponse;\n import com.twitter.sdk.android.core.Callback;\n import com.twitter.sdk.android.core.Result;\n import com.twitter.sdk.android.core.TwitterCore;\n@@ -36,7 +40,6 @@ import org.fossasia.phimpme.base.RecyclerItemClickListner;\n import org.fossasia.phimpme.base.ThemedActivity;\n import org.fossasia.phimpme.data.local.AccountDatabase;\n import org.fossasia.phimpme.data.local.DatabaseHelper;\n-import org.fossasia.phimpme.leafpic.util.ThemeHelper;\n import org.fossasia.phimpme.sharedrupal.DrupalLogin;\n import org.fossasia.phimpme.sharewordpress.WordpressLoginActivity;\n import org.fossasia.phimpme.utilities.ActivitySwitchHelper;\n@@ -51,12 +54,6 @@ import java.util.List;\n import io.realm.Realm;\n import io.realm.RealmQuery;\n \n-import com.pinterest.android.pdk.PDKCallback;\n-import com.pinterest.android.pdk.PDKClient;\n-import com.pinterest.android.pdk.PDKException;\n-import com.pinterest.android.pdk.PDKResponse;\n-\n-\n import static android.support.design.widget.Snackbar.LENGTH_LONG;\n \n /**\ndiff --git a/app/src/main/java/org/fossasia/phimpme/accounts/AccountContract.kt b/app/src/main/java/org/fossasia/phimpme/accounts/AccountContract.java\nsimilarity index 60%\nrename from app/src/main/java/org/fossasia/phimpme/accounts/AccountContract.kt\nrename to app/src/main/java/org/fossasia/phimpme/accounts/AccountContract.java\nindex 7f9371b7..5a4b9229 100644\n--- a/app/src/main/java/org/fossasia/phimpme/accounts/AccountContract.kt\n+++ b/app/src/main/java/org/fossasia/phimpme/accounts/AccountContract.java\n@@ -1,10 +1,11 @@\n-package org.fossasia.phimpme.accounts\n+package org.fossasia.phimpme.accounts;\n \n-import android.content.Context\n-import io.realm.RealmQuery\n-import org.fossasia.phimpme.base.MvpView\n-import org.fossasia.phimpme.data.local.AccountDatabase\n+import android.content.Context;\n \n+import org.fossasia.phimpme.base.MvpView;\n+import org.fossasia.phimpme.data.local.AccountDatabase;\n+\n+import io.realm.RealmQuery;\n \n /**\n  * Created by pa1pal on 6/6/17.\n@@ -13,41 +14,40 @@ import org.fossasia.phimpme.data.local.AccountDatabase\n  * required functions.\n  */\n \n-class AccountContract {\n-    internal interface View : MvpView{\n+public class AccountContract {\n+    interface View extends MvpView{\n \n         /**\n          * Setting up the recyclerView. The layout manager, decorator etc.\n          */\n-        fun setUpRecyclerView()\n+        void setUpRecyclerView();\n \n         /**\n          * Account Presenter calls this function after taking data from Database Helper Class\n          */\n-        fun setUpAdapter(accountDetails: RealmQuery<AccountDatabase>)\n+        void setUpAdapter(RealmQuery<AccountDatabase> accountDetails);\n \n         /**\n          * Shows the error log\n          */\n-        fun showError()\n+        void showError();\n \n         /**\n          * Get the context\n          */\n-        fun getContext(): Context?\n+        Context getContext();\n     }\n \n-    internal interface Presenter {\n-\n+    interface Presenter{\n         /**\n          * function to load data from database, using Database Helper class\n          */\n-        fun loadFromDatabase()\n+        void loadFromDatabase();\n \n         /**\n          * setting up the recyclerView adapter from here\n          */\n-        fun handleResults(accountDetails: RealmQuery<AccountDatabase>)\n+        void handleResults(RealmQuery<AccountDatabase> accountDetails);\n \n         /**\n          * This function check if the selected account is already existed.\n@@ -55,6 +55,6 @@ class AccountContract {\n          * @param s Name of the account from accountList e.g. Twitter\n          * @return true is existed, false otherwise\n          */\n-        fun checkAlreadyExist(s: String) : Boolean\n+        boolean checkAlreadyExist(String s);\n     }\n-}\n\\ No newline at end of file\n+}\ndiff --git a/app/src/main/java/org/fossasia/phimpme/data/local/AccountDatabase.java b/app/src/main/java/org/fossasia/phimpme/data/local/AccountDatabase.java\nnew file mode 100644\nindex 00000000..5869619e\n--- /dev/null\n+++ b/app/src/main/java/org/fossasia/phimpme/data/local/AccountDatabase.java\n@@ -0,0 +1,42 @@\n+package org.fossasia.phimpme.data.local;\n+\n+import io.realm.RealmObject;\n+import io.realm.annotations.PrimaryKey;\n+\n+/**\n+ * Created by pa1pal on 08/06/17.\n+ *\n+ * Model class for accounts. Where we store relevant details related to accounts, which we required\n+ * to access their SDKs and APIs\n+ */\n+\n+public class AccountDatabase extends RealmObject{\n+    @PrimaryKey\n+    String name;\n+    String username;\n+    String token;\n+\n+    public String getName() {\n+        return name;\n+    }\n+\n+    public void setName(String name) {\n+        this.name = name;\n+    }\n+\n+    public String getUsername() {\n+        return username;\n+    }\n+\n+    public void setUsername(String username) {\n+        this.username = username;\n+    }\n+\n+    public String getToken() {\n+        return token;\n+    }\n+\n+    public void setToken(String token) {\n+        this.token = token;\n+    }\n+}\ndiff --git a/app/src/main/java/org/fossasia/phimpme/data/local/AccountDatabase.kt b/app/src/main/java/org/fossasia/phimpme/data/local/AccountDatabase.kt\ndeleted file mode 100644\nindex 8b237b92..00000000\n--- a/app/src/main/java/org/fossasia/phimpme/data/local/AccountDatabase.kt\n+++ /dev/null\n@@ -1,22 +0,0 @@\n-\n-package org.fossasia.phimpme.data.local\n-\n-import io.realm.RealmObject\n-import io.realm.annotations.PrimaryKey\n-\n-/**\n- * Created by pa1pal on 08/06/17.\n- *\n- * Model class for accounts. Where we store relevant details related to accounts, which we required\n- * to access their SDKs and APIs\n- */\n-\n-open class AccountDatabase(\n-        @PrimaryKey var name: String = \"\",\n-        var username: String = \"\",\n-        var token: String = \"\"\n-) : RealmObject(){\n-    /**\n-     * No need to create getter and setter property in Kotlin Model\n-     */\n-}\n\\ No newline at end of file\ndiff --git a/build.gradle b/build.gradle\nindex 43e02cbf..42261b31 100755\n--- a/build.gradle\n+++ b/build.gradle\n@@ -1,17 +1,15 @@\n // Top-level build file where you can add configuration options common to all sub-projects/modules.\n \n buildscript {\n-    ext.kotlin_version = '1.1.2-5'\n     ext.realm_version = '3.3.1'\n     repositories {\n         jcenter()\n         maven { url 'https://jitpack.io' }\n     }\n     dependencies {\n-        classpath 'com.android.tools.build:gradle:2.3.2'\n+        classpath 'com.android.tools.build:gradle:2.3.3'\n         classpath 'com.google.gms:google-services:3.0.0'\n         classpath 'com.dicedmelon.gradle:jacoco-android:0.1.1'\n-        classpath \"org.jetbrains.kotlin:kotlin-gradle-plugin:$kotlin_version\"\n         classpath \"io.realm:realm-gradle-plugin:$realm_version\"\n     }\n }",
    "Hide splash screen when map is shown": "diff --git a/OsmAnd/src/net/osmand/SecondSplashScreenFragment.java b/OsmAnd/src/net/osmand/SecondSplashScreenFragment.java\nindex 76b01d9d78..a5db155510 100644\n--- a/OsmAnd/src/net/osmand/SecondSplashScreenFragment.java\n+++ b/OsmAnd/src/net/osmand/SecondSplashScreenFragment.java\n@@ -22,7 +22,7 @@ import net.osmand.plus.helpers.AndroidUiHelper;\n public class SecondSplashScreenFragment extends Fragment {\n     public static final String TAG = \"SecondSplashScreenFragment\";\n     public static boolean SHOW = true;\n-    private static final int SECOND_SPLASH_TIME_OUT = 5000;\n+    private static final int SECOND_SPLASH_TIME_OUT = 8000;\n     private boolean started = false;\n     private FragmentActivity activity;\n     private OsmandApplication app;\n@@ -142,18 +142,15 @@ public class SecondSplashScreenFragment extends Fragment {\n         }\n         if (!started) {\n             started = true;\n+            SecondSplashScreenFragment.SHOW = false;\n             new Handler().postDelayed(new Runnable() {\n \n                 @Override\n                 public void run() {\n-                    if (activity instanceof MapActivity) {\n-                        activity.setRequestedOrientation(ActivityInfo.SCREEN_ORIENTATION_UNSPECIFIED);\n-                        if (app.getSettings().MAP_SCREEN_ORIENTATION.get() != activity.getRequestedOrientation()) {\n-                            activity.setRequestedOrientation(app.getSettings().MAP_SCREEN_ORIENTATION.get());\n-                            // can't return from this method we are not sure if activity will be recreated or not\n-                        }\n+                    android.util.Log.d(\"Splash\", \"dismisssplashinsplash\");\n+                    if (activity instanceof MapActivity && !((MapActivity) activity).isActivityDestroyed()) {\n+                        ((MapActivity)activity).dismissSecondSplashScreen();\n                     }\n-                    activity.getSupportFragmentManager().beginTransaction().remove(SecondSplashScreenFragment.this).commitAllowingStateLoss();\n                 }\n             }, SECOND_SPLASH_TIME_OUT);\n         }\ndiff --git a/OsmAnd/src/net/osmand/plus/activities/MapActivity.java b/OsmAnd/src/net/osmand/plus/activities/MapActivity.java\nindex c01d74dc5c..6316753ddd 100644\n--- a/OsmAnd/src/net/osmand/plus/activities/MapActivity.java\n+++ b/OsmAnd/src/net/osmand/plus/activities/MapActivity.java\n@@ -189,6 +189,8 @@ public class MapActivity extends OsmandActionBarActivity implements DownloadEven\n \tprivate boolean mIsDestroyed = false;\n \tprivate InAppHelper inAppHelper;\n \n+\tprivate SecondSplashScreenFragment secondSplashScreenFragment;\n+\n \t@Override\n \tpublic void onCreate(Bundle savedInstanceState) {\n \t\tsetRequestedOrientation(AndroidUiHelper.getScreenOrientation(this));\n@@ -692,7 +694,8 @@ public class MapActivity extends OsmandActionBarActivity implements DownloadEven\n \t\t}\n \t\tFirstUsageWelcomeFragment.SHOW = false;\n \t\tif (SecondSplashScreenFragment.SHOW) {\n-\t\t\tgetSupportFragmentManager().beginTransaction().add(R.id.fragmentContainer, new SecondSplashScreenFragment(), SecondSplashScreenFragment.TAG).commitAllowingStateLoss();\n+\t\t\tsecondSplashScreenFragment = new SecondSplashScreenFragment();\n+\t\t\tgetSupportFragmentManager().beginTransaction().add(R.id.fragmentContainer, secondSplashScreenFragment, SecondSplashScreenFragment.TAG).commitAllowingStateLoss();\n \t\t} else {\n \t\t\tsetRequestedOrientation(ActivityInfo.SCREEN_ORIENTATION_UNSPECIFIED);\n \t\t\tif (settings.MAP_SCREEN_ORIENTATION.get() != getRequestedOrientation()) {\n@@ -700,7 +703,16 @@ public class MapActivity extends OsmandActionBarActivity implements DownloadEven\n \t\t\t\t// can't return from this method we are not sure if activity will be recreated or not\n \t\t\t}\n \t\t}\n+\t}\n+\n+\tpublic void dismissSecondSplashScreen() {\n \t\tSecondSplashScreenFragment.SHOW = false;\n+\t\tgetSupportFragmentManager().beginTransaction().remove(secondSplashScreenFragment).commitAllowingStateLoss();\n+\t\tsetRequestedOrientation(ActivityInfo.SCREEN_ORIENTATION_UNSPECIFIED);\n+\t\tif (app.getSettings().MAP_SCREEN_ORIENTATION.get() != getRequestedOrientation()) {\n+\t\t\tsetRequestedOrientation(app.getSettings().MAP_SCREEN_ORIENTATION.get());\n+\t\t\t// can't return from this method we are not sure if activity will be recreated or not\n+\t\t}\n \t}\n \n \t@Override\ndiff --git a/OsmAnd/src/net/osmand/plus/views/OsmandMapTileView.java b/OsmAnd/src/net/osmand/plus/views/OsmandMapTileView.java\nindex da4a3e5630..89bd4769c3 100644\n--- a/OsmAnd/src/net/osmand/plus/views/OsmandMapTileView.java\n+++ b/OsmAnd/src/net/osmand/plus/views/OsmandMapTileView.java\n@@ -29,6 +29,7 @@ import android.view.WindowManager;\n import android.widget.Toast;\n \n import net.osmand.PlatformUtil;\n+import net.osmand.SecondSplashScreenFragment;\n import net.osmand.access.AccessibilityActionsProvider;\n import net.osmand.core.android.MapRendererView;\n import net.osmand.data.LatLon;\n@@ -655,6 +656,9 @@ public class OsmandMapTileView implements IMapDownloaderCallback {\n \t\t} else if (doubleTapScaleDetector.isInZoomMode()) {\n \t\t\tdrawMapPosition(canvas, doubleTapScaleDetector.getCenterX(), doubleTapScaleDetector.getCenterY());\n \t\t}\n+\t\tif (activity instanceof MapActivity && !((MapActivity) activity).isActivityDestroyed() && ((MapActivity) activity).getSupportFragmentManager().findFragmentByTag(SecondSplashScreenFragment.TAG) != null) {\n+\t\t\t((MapActivity) activity).dismissSecondSplashScreen();\n+\t\t}\n \t}\n \n ",
    "add section about Enum Types to user manual": "diff --git a/docs/index.adoc b/docs/index.adoc\nindex 20042fa2..be829939 100644\n--- a/docs/index.adoc\n+++ b/docs/index.adoc\n@@ -618,6 +618,12 @@ class TypeDemo {\n }\n ----\n \n+=== Enum Types\n+It is encouraged to use `enum` types for options or positional parameters with a limited set of valid values.\n+Not only will picocli validate the input, it allows you to <<Show Default Values,show all values>> in the usage help message with `@Option(description = \"Valid values: ${COMPLETION-CANDIDATES}\")`.\n+\n+Enum value matching is case-sensitive by default, but from 3.4 this can be controlled with `CommandLine::setCaseInsensitiveEnumValuesAllowed` and `CommandSpec::caseInsensitiveEnumValuesAllowed`.\n+\n == Default Values\n It is possible to define a default value for an option or positional parameter, that is assigned when the user did not specify this option or positional parameter on the command line.\n ",
    "Add NFIType annotation to override NFI types base on signature .": "diff --git a/src/com.oracle.truffle.espresso/src/com/oracle/truffle/espresso/jni/NFIType.java b/src/com.oracle.truffle.espresso/src/com/oracle/truffle/espresso/jni/NFIType.java\nnew file mode 100644\nindex 00000000000..71e943f797b\n--- /dev/null\n+++ b/src/com.oracle.truffle.espresso/src/com/oracle/truffle/espresso/jni/NFIType.java\n@@ -0,0 +1,13 @@\n+package com.oracle.truffle.espresso.jni;\n+\n+import java.lang.annotation.Retention;\n+import java.lang.annotation.RetentionPolicy;\n+import java.lang.annotation.Target;\n+\n+import static java.lang.annotation.ElementType.TYPE_USE;\n+\n+@Retention(RetentionPolicy.RUNTIME)\n+@Target(value = {TYPE_USE})\n+public @interface NFIType {\n+    String value();\n+}",
    "Fix a use of deallocated memory ( <issue_id> )": "diff --git a/frameworks/C/h2o/src/world.c b/frameworks/C/h2o/src/world.c\nindex d7b03fc0c..08a1956bf 100644\n--- a/frameworks/C/h2o/src/world.c\n+++ b/frameworks/C/h2o/src/world.c\n@@ -39,10 +39,14 @@\n #include \"utility.h\"\n #include \"world.h\"\n \n+#define DO_CLEANUP 4\n+#define DO_UPDATE 1\n #define ID_KEY \"id\"\n+#define IS_COMPLETED 8\n #define MAX_QUERIES 500\n #define QUERIES_PARAMETER \"queries=\"\n #define RANDOM_NUM_KEY \"randomNumber\"\n+#define USE_CACHE 2\n \n typedef struct multiple_query_ctx_t multiple_query_ctx_t;\n typedef struct update_ctx_t update_ctx_t;\n@@ -79,9 +83,7 @@ struct multiple_query_ctx_t {\n \tsize_t num_query;\n \tsize_t num_query_in_progress;\n \tsize_t num_result;\n-\tbool cleanup;\n-\tbool do_update;\n-\tbool use_cache;\n+\tuint_fast32_t flags;\n \tquery_result_t res[];\n };\n \n@@ -125,12 +127,14 @@ static void cleanup_multiple_query_request(void *data)\n {\n \tmultiple_query_ctx_t * const query_ctx = *(multiple_query_ctx_t **) data;\n \n-\tif (query_ctx->cleanup) {\n+\tquery_ctx->flags |= IS_COMPLETED;\n+\n+\tif (query_ctx->flags & DO_CLEANUP) {\n \t\tif (!query_ctx->num_query_in_progress)\n \t\t\tcleanup_multiple_query(query_ctx);\n \t}\n \telse\n-\t\tquery_ctx->cleanup = true;\n+\t\tquery_ctx->flags |= DO_CLEANUP;\n }\n \n static void cleanup_single_query(single_query_ctx_t *query_ctx)\n@@ -160,10 +164,10 @@ static void complete_multiple_query(multiple_query_ctx_t *query_ctx)\n {\n \tassert(query_ctx->num_result == query_ctx->num_query);\n \n-\tif (query_ctx->do_update)\n+\tif (query_ctx->flags & DO_UPDATE)\n \t\tdo_updates(query_ctx);\n \telse {\n-\t\tquery_ctx->cleanup = true;\n+\t\tquery_ctx->flags |= DO_CLEANUP;\n \t\tquery_ctx->gen = get_json_generator(&query_ctx->ctx->json_generator,\n \t\t                                    &query_ctx->ctx->json_generator_num);\n \n@@ -216,12 +220,14 @@ static int do_multiple_queries(bool do_update, bool use_cache, h2o_req_t *req)\n \t\tquery_ctx->ctx = ctx;\n \t\tquery_ctx->num_query = num_query;\n \t\tquery_ctx->req = req;\n-\t\tquery_ctx->do_update = do_update;\n-\t\tquery_ctx->use_cache = use_cache;\n \t\tquery_ctx->query_param = (query_param_t *) ((char *) query_ctx + base_size);\n \t\tinitialize_ids(num_query, query_ctx->res, &ctx->random_seed);\n \n+\t\tif (do_update)\n+\t\t\tquery_ctx->flags |= DO_UPDATE;\n+\n \t\tif (use_cache) {\n+\t\t\tquery_ctx->flags |= USE_CACHE;\n \t\t\tfetch_from_cache(h2o_now(ctx->event_loop.h2o_ctx.loop),\n \t\t\t                 &ctx->global_data->world_cache,\n \t\t\t                 query_ctx);\n@@ -256,7 +262,7 @@ static int do_multiple_queries(bool do_update, bool use_cache, h2o_req_t *req)\n \n \t\t\tif (execute_query(ctx, &query_ctx->query_param[i].param)) {\n \t\t\t\tquery_ctx->num_query_in_progress = i;\n-\t\t\t\tquery_ctx->cleanup = true;\n+\t\t\t\tquery_ctx->flags |= DO_CLEANUP;\n \t\t\t\tsend_service_unavailable_error(DB_REQ_ERROR, req);\n \t\t\t\treturn 0;\n \t\t\t}\n@@ -318,7 +324,7 @@ static void do_updates(multiple_query_ctx_t *query_ctx)\n \t\tgoto error;\n \n \tif (execute_query(query_ctx->ctx, &query_ctx->query_param->param)) {\n-\t\tquery_ctx->cleanup = true;\n+\t\tquery_ctx->flags |= DO_CLEANUP;\n \t\tsend_service_unavailable_error(DB_REQ_ERROR, query_ctx->req);\n \t}\n \telse\n@@ -326,7 +332,7 @@ static void do_updates(multiple_query_ctx_t *query_ctx)\n \n \treturn;\n error:\n-\tquery_ctx->cleanup = true;\n+\tquery_ctx->flags |= DO_CLEANUP;\n \tLIBRARY_ERROR(\"snprintf\", \"Truncated output.\");\n \tsend_error(INTERNAL_SERVER_ERROR, REQ_ERROR, query_ctx->req);\n }\n@@ -397,12 +403,12 @@ static void on_multiple_query_error(db_query_param_t *param, const char *error_s\n \n \tquery_ctx->num_query_in_progress--;\n \n-\tif (query_ctx->cleanup) {\n-\t\tif (!query_ctx->num_query_in_progress)\n+\tif (query_ctx->flags & DO_CLEANUP) {\n+\t\tif (!query_ctx->num_query_in_progress && query_ctx->flags & IS_COMPLETED)\n \t\t\tcleanup_multiple_query(query_ctx);\n \t}\n \telse {\n-\t\tquery_ctx->cleanup = true;\n+\t\tquery_ctx->flags |= DO_CLEANUP;\n \t\tsend_error(BAD_GATEWAY, error_string, query_ctx->req);\n \t}\n }\n@@ -414,14 +420,14 @@ static result_return_t on_multiple_query_result(db_query_param_t *param, PGresul\n \n \tquery_ctx->num_query_in_progress--;\n \n-\tif (query_ctx->cleanup) {\n-\t\tif (!query_ctx->num_query_in_progress)\n+\tif (query_ctx->flags & DO_CLEANUP) {\n+\t\tif (!query_ctx->num_query_in_progress && query_ctx->flags & IS_COMPLETED)\n \t\t\tcleanup_multiple_query(query_ctx);\n \t}\n \telse if (PQresultStatus(result) == PGRES_TUPLES_OK) {\n \t\tprocess_result(result, query_ctx->res + query_ctx->num_result);\n \n-\t\tif (query_ctx->use_cache) {\n+\t\tif (query_ctx->flags & USE_CACHE) {\n \t\t\tquery_result_t * const r = malloc(sizeof(*r));\n \n \t\t\tif (r) {\n@@ -446,7 +452,7 @@ static result_return_t on_multiple_query_result(db_query_param_t *param, PGresul\n \t\t\tquery_param->id = htonl(query_ctx->res[idx].id);\n \n \t\t\tif (execute_query(query_ctx->ctx, &query_param->param)) {\n-\t\t\t\tquery_ctx->cleanup = true;\n+\t\t\t\tquery_ctx->flags |= DO_CLEANUP;\n \t\t\t\tsend_service_unavailable_error(DB_REQ_ERROR, query_ctx->req);\n \t\t\t}\n \t\t\telse\n@@ -456,7 +462,7 @@ static result_return_t on_multiple_query_result(db_query_param_t *param, PGresul\n \t\t\tcomplete_multiple_query(query_ctx);\n \t}\n \telse {\n-\t\tquery_ctx->cleanup = true;\n+\t\tquery_ctx->flags |= DO_CLEANUP;\n \t\tLIBRARY_ERROR(\"PQresultStatus\", PQresultErrorMessage(result));\n \t\tsend_error(BAD_GATEWAY, DB_ERROR, query_ctx->req);\n \t}\n@@ -472,12 +478,12 @@ static void on_multiple_query_timeout(db_query_param_t *param)\n \n \tquery_ctx->num_query_in_progress--;\n \n-\tif (query_ctx->cleanup) {\n-\t\tif (!query_ctx->num_query_in_progress)\n+\tif (query_ctx->flags & DO_CLEANUP) {\n+\t\tif (!query_ctx->num_query_in_progress && query_ctx->flags & IS_COMPLETED)\n \t\t\tcleanup_multiple_query(query_ctx);\n \t}\n \telse {\n-\t\tquery_ctx->cleanup = true;\n+\t\tquery_ctx->flags |= DO_CLEANUP;\n \t\tsend_error(GATEWAY_TIMEOUT, DB_TIMEOUT_ERROR, query_ctx->req);\n \t}\n }\n@@ -561,9 +567,9 @@ static result_return_t on_update_result(db_query_param_t *param, PGresult *resul\n {\n \tquery_param_t * const query_param = H2O_STRUCT_FROM_MEMBER(query_param_t, param, param);\n \tmultiple_query_ctx_t * const query_ctx = query_param->ctx;\n-\tconst bool cleanup = query_ctx->cleanup;\n+\tconst bool cleanup = query_ctx->flags & DO_CLEANUP;\n \n-\tquery_ctx->cleanup = true;\n+\tquery_ctx->flags |= DO_CLEANUP;\n \tquery_ctx->num_query_in_progress--;\n \n \tif (cleanup)",
    "add ability to build WebRTC with bitcode": "diff --git a/tools/build-webrtc.py b/tools/build-webrtc.py\nindex 9e0c4fb..d28ebe6 100644\n--- a/tools/build-webrtc.py\n+++ b/tools/build-webrtc.py\n@@ -31,7 +31,7 @@ GN_COMMON_ARGS = [\n \n _GN_IOS_ARGS = [\n     'enable_dsyms=true',\n-    'enable_ios_bitcode=false',\n+    'enable_ios_bitcode=%s',\n     'ios_deployment_target=\"9.0\"',\n     'ios_enable_code_signing=false',\n     'target_os=\"ios\"',\n@@ -105,7 +105,7 @@ def setup(target_dir, platform):\n         sh('./build/install-build-deps.sh')\n \n \n-def build(target_dir, platform, debug):\n+def build(target_dir, platform, debug, bitcode):\n     build_dir = os.path.join(target_dir, 'build', platform)\n     build_type = 'Debug' if debug else 'Release'\n     depot_tools_dir = os.path.join(target_dir, 'depot_tools')\n@@ -138,7 +138,7 @@ def build(target_dir, platform, debug):\n     if platform == 'ios':\n         for arch in IOS_BUILD_ARCHS:\n             gn_out_dir = 'out/%s-%s' % (build_type, arch)\n-            gn_args = GN_IOS_ARGS % (str(debug).lower(), arch)\n+            gn_args = GN_IOS_ARGS % (str(debug).lower(), arch, str(bitcode).lower())\n             gn_cmd = 'gn gen %s %s' % (gn_out_dir, gn_args)\n             sh(gn_cmd, env)\n     else:\n@@ -202,6 +202,7 @@ if __name__ == \"__main__\":\n     parser.add_argument('--ios', help='Use iOS as the target platform', action='store_true')\n     parser.add_argument('--android', help='Use Android as the target platform', action='store_true')\n     parser.add_argument('--debug', help='Make a Debug build (defaults to false)', action='store_true')\n+    parser.add_argument('--bitcode', help='Enable bitcode (defaults to false)', action='store_true')\n \n     args = parser.parse_args()\n \n@@ -234,7 +235,7 @@ if __name__ == \"__main__\":\n         sys.exit(0)\n \n     if args.build:\n-        build(target_dir, platform, args.debug)\n+        build(target_dir, platform, args.debug, args.bitcode)\n         print('WebRTC build for %s completed in %s' % (platform, target_dir))\n         sys.exit(0)\n \ndiff --git a/tools/downloadBitcode.sh b/tools/downloadBitcode.sh\nindex 06da867..9b38824 100755\n--- a/tools/downloadBitcode.sh\n+++ b/tools/downloadBitcode.sh\n@@ -3,8 +3,8 @@\n set -euo pipefail\n \n # Files to be downloaded\n-WEBRTC_FRAMEWORK=\"https://dl.bintray.com/saghul/react-native-webrtc/M69-1/WebRTC.framework.tar.xz\"\n-WEBRTC_DSYM=\"https://dl.bintray.com/saghul/react-native-webrtc/M69-1/WebRTC.dSYM.tar.xz\"\n+WEBRTC_FRAMEWORK=\"https://dl.bintray.com/webrtc-builds/webrtc-builds/M69-1/WebRTC.framework.tar.xz\"\n+WEBRTC_DSYM=\"https://dl.bintray.com/webrtc-builds/webrtc-builds/M69-1/WebRTC.dSYM.tar.xz\"\n \n \n THIS_DIR=$(cd -P \"$(dirname \"$(readlink \"${BASH_SOURCE[0]}\" || echo \"${BASH_SOURCE[0]}\")\")\" && pwd)",
    "disable BWC as preparation for <issue_id> ( <issue_id> ) .": "diff --git a/build.gradle b/build.gradle\nindex 2dbf94ae7da..a151683b484 100644\n--- a/build.gradle\n+++ b/build.gradle\n@@ -221,8 +221,8 @@ task verifyVersions {\n  * after the backport of the backcompat code is complete.\n  */\n \n-boolean bwc_tests_enabled = true\n-final String bwc_tests_disabled_issue = \"\" /* place a PR link here when committing bwc changes */\n+boolean bwc_tests_enabled = false\n+final String bwc_tests_disabled_issue = \"https://github.com/elastic/elasticsearch/pull/53695\" /* place a PR link here when committing bwc changes */\n if (bwc_tests_enabled == false) {\n   if (bwc_tests_disabled_issue.isEmpty()) {\n     throw new GradleException(\"bwc_tests_disabled_issue must be set when bwc_tests_enabled == false\")",
    "Clarify outlook email action setup .": "diff --git a/docs/en/watcher/actions/email.asciidoc b/docs/en/watcher/actions/email.asciidoc\nindex 4a45a2bf801..e8a24231291 100644\n--- a/docs/en/watcher/actions/email.asciidoc\n+++ b/docs/en/watcher/actions/email.asciidoc\n@@ -347,10 +347,13 @@ xpack.notification.email.account:\n             starttls.enable: true\n             host: smtp-mail.outlook.com\n             port: 587\n-            user: <username>\n+            user: <email.address>\n             password: <password>\n --------------------------------------------------\n \n+When sending emails, you have to provide a from address, either a default one\n+in your account configuration or as part of the email action in the watch.\n+\n NOTE:   You need to use a unique App Password if two-step verification is enabled.\n         See http://windows.microsoft.com/en-us/windows/app-passwords-two-step-verification[App\n         passwords and two-step verification] for more information.",
    "Allow building with Java 9 . . - Must suppress deprecation warning for unit tests because .": "diff --git a/vespalog/src/main/java/com/yahoo/log/event/Count.java b/vespalog/src/main/java/com/yahoo/log/event/Count.java\nindex 175e8b9f69f..1915e151908 100644\n--- a/vespalog/src/main/java/com/yahoo/log/event/Count.java\n+++ b/vespalog/src/main/java/com/yahoo/log/event/Count.java\n@@ -23,7 +23,7 @@ public class Count extends Event {\n     @Override\n     public Event setValue (String name, String value) {\n         if (name.equals(\"value\")) {\n-            super.setValue(name, Long.toString((new Double(value)).longValue()));\n+            super.setValue(name, Long.toString((Double.valueOf(value)).longValue()));\n         } else {\n             super.setValue(name , value);\n         }\ndiff --git a/vespalog/src/main/java/com/yahoo/log/event/Event.java b/vespalog/src/main/java/com/yahoo/log/event/Event.java\nindex 76fdf16c4ef..a897292af91 100644\n--- a/vespalog/src/main/java/com/yahoo/log/event/Event.java\n+++ b/vespalog/src/main/java/com/yahoo/log/event/Event.java\n@@ -322,7 +322,7 @@ public abstract class Event implements Serializable {\n \n         Event event;\n         try {\n-            event = (Event) Class.forName(className).newInstance();\n+            event = (Event) Class.forName(className).getDeclaredConstructor().newInstance();\n         }\n         catch (ClassNotFoundException e) {\n             event = new Unknown().setName(eventName);\ndiff --git a/vespalog/src/test/java/com/yahoo/log/LogSetupTestCase.java b/vespalog/src/test/java/com/yahoo/log/LogSetupTestCase.java\nindex 70eb65b1463..d476b111e4f 100644\n--- a/vespalog/src/test/java/com/yahoo/log/LogSetupTestCase.java\n+++ b/vespalog/src/test/java/com/yahoo/log/LogSetupTestCase.java\n@@ -20,6 +20,8 @@ import static org.hamcrest.CoreMatchers.is;\n  *\n  * @author Bjorn Borud\n  */\n+// TODO: Remove annotation and replace setMillis with setInstant when we don't support Java 8 anymore.\n+@SuppressWarnings(\"deprecation\")\n public class LogSetupTestCase {\n     // For testing zookeeper log records\n     protected static LogRecord zookeeperLogRecord;\ndiff --git a/vespalog/src/test/java/com/yahoo/log/VespaFormatterTestCase.java b/vespalog/src/test/java/com/yahoo/log/VespaFormatterTestCase.java\nindex 5dac2e34786..9da71b2ad2e 100644\n--- a/vespalog/src/test/java/com/yahoo/log/VespaFormatterTestCase.java\n+++ b/vespalog/src/test/java/com/yahoo/log/VespaFormatterTestCase.java\n@@ -14,6 +14,8 @@ import static org.hamcrest.CoreMatchers.is;\n /**\n  * @author  Bjorn Borud\n  */\n+// TODO: Remove annotation and replace setMillis with setInstant when we don't support Java 8 anymore.\n+@SuppressWarnings(\"deprecation\")\n public class VespaFormatterTestCase {\n \n     private String hostname;\ndiff --git a/vespalog/src/test/java/com/yahoo/log/VespaLogHandlerTestCase.java b/vespalog/src/test/java/com/yahoo/log/VespaLogHandlerTestCase.java\nindex 3e51d194a5e..5cbd130c05a 100644\n--- a/vespalog/src/test/java/com/yahoo/log/VespaLogHandlerTestCase.java\n+++ b/vespalog/src/test/java/com/yahoo/log/VespaLogHandlerTestCase.java\n@@ -20,6 +20,8 @@ import static org.junit.Assert.*;\n /**\n  * @author  Bjorn Borud\n  */\n+// TODO: Remove annotation and replace setMillis with setInstant when we don't support Java 8 anymore.\n+@SuppressWarnings(\"deprecation\")\n public class VespaLogHandlerTestCase {\n     protected static String hostname;\n     protected static String pid;",
    "Reconsider default option for ClassPathURLCheck change done in JDK - 8195874 .": "diff --git a/src/java.base/share/classes/jdk/internal/loader/URLClassPath.java b/src/java.base/share/classes/jdk/internal/loader/URLClassPath.java\nindex f6ac8eda1c1..4bda10c668c 100644\n--- a/src/java.base/share/classes/jdk/internal/loader/URLClassPath.java\n+++ b/src/java.base/share/classes/jdk/internal/loader/URLClassPath.java\n@@ -103,7 +103,7 @@ public class URLClassPath {\n         DISABLE_ACC_CHECKING = p != null ? p.equals(\"true\") || p.equals(\"\") : false;\n \n         // This property will be removed in a later release\n-        p = props.getProperty(\"jdk.net.URLClassPath.disableClassPathURLCheck\");\n+        p = props.getProperty(\"jdk.net.URLClassPath.disableClassPathURLCheck\", \"true\");\n \n         DISABLE_CP_URL_CHECK = p != null ? p.equals(\"true\") || p.isEmpty() : false;\n         DEBUG_CP_URL_CHECK = \"debug\".equals(p);",
    "add sentiment score distribution to JSON output": "diff --git a/src/edu/stanford/nlp/pipeline/JSONOutputter.java b/src/edu/stanford/nlp/pipeline/JSONOutputter.java\nindex a7564a55e..b66d3ad89 100644\n--- a/src/edu/stanford/nlp/pipeline/JSONOutputter.java\n+++ b/src/edu/stanford/nlp/pipeline/JSONOutputter.java\n@@ -94,9 +94,12 @@ public class JSONOutputter extends AnnotationOutputter {\n           Tree sentimentTree = sentence.get(SentimentCoreAnnotations.SentimentAnnotatedTree.class);\n           if (sentimentTree != null) {\n             int sentiment = RNNCoreAnnotations.getPredictedClass(sentimentTree);\n+            List<String> sentimentPredictions =\n+                RNNCoreAnnotations.getPredictionsAsStringList(sentimentTree);\n             String sentimentClass = sentence.get(SentimentCoreAnnotations.SentimentClass.class);\n             l2.set(\"sentimentValue\", Integer.toString(sentiment));\n             l2.set(\"sentiment\", sentimentClass.replaceAll(\" \", \"\"));\n+            l2.set(\"sentimentDistribution\", sentimentPredictions);\n           }\n           // (openie)\n          ",
    "improve the nak flyweight so it is compliant with the specification": "diff --git a/aeron-util/src/main/java/uk/co/real_logic/aeron/util/protocol/NakFlyweight.java b/aeron-util/src/main/java/uk/co/real_logic/aeron/util/protocol/NakFlyweight.java\nindex d8c8dd015..7461ac859 100644\n--- a/aeron-util/src/main/java/uk/co/real_logic/aeron/util/protocol/NakFlyweight.java\n+++ b/aeron-util/src/main/java/uk/co/real_logic/aeron/util/protocol/NakFlyweight.java\n@@ -21,31 +21,40 @@ import static java.nio.ByteOrder.LITTLE_ENDIAN;\n  * Flyweight for a Nak Packet\n  *\n  * <p>\n- * 0                   1                   2                   3\n- * 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1\n- * +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n- * |  Vers       |B|E| Flags       |             Type (=0x01)      |\n- * +-------+-+-+-+-+-+-+-+-+-+-+-+-+-------------------------------+\n- * |                         Frame Length                          |\n- * +---------------------------------------------------------------+\n- * |                        Sequence Number                        |\n- * +---------------------------------------------------------------+\n- * |                          Session ID                           |\n- * +---------------------------------------------------------------+\n- * |                          Channel ID                           |\n- * +---------------------------------------------------------------+\n- * |                            Term ID                            |\n- * +---------------------------------------------------------------+\n+ * @see <a href=\"https://github.com/real-logic/Aeron/wiki/Protocol-Specification#data-recovery-via-retransmit-request\">Data Recovery</a>\n  */\n public class NakFlyweight extends HeaderFlyweight\n {\n-    /** Size of the Nak Packet */\n-    public static final int LENGTH = 24;\n+    public static final int MAX_SEQUENCE_NUMBER_RANGES = 16;\n \n-    private static final int SEQUENCE_NUMBER_FIELD_OFFSET = 8;\n-    private static final int SESSION_ID_FIELD_OFFSET = 12;\n-    private static final int CHANNEL_ID_FIELD_OFFSET = 16;\n-    private static final int TERM_ID_FIELD_OFFSET = 20;\n+    private static final int SEQUENCE_NUMBER_RANGE_SIZE = 16;\n+    private static final int START_TERM_ID_RELATIVE_OFFSET = 0;\n+    private static final int START_SEQUENCE_NUMBER_RELATIVE_OFFSET = 4;\n+    private static final int END_TERM_ID_RELATIVE_OFFSET = 8;\n+    private static final int END_SEQUENCE_NUMBER_RELATIVE_OFFSET = 12;\n+\n+    private static final int SESSION_ID_FIELD_OFFSET = 8;\n+    private static final int CHANNEL_ID_FIELD_OFFSET = 12;\n+    private static final int SEQUENCE_RANGES_FIELDS_OFFSET = 16;\n+\n+    public NakFlyweight countOfSequenceNumberRanges(int countOfSequenceNumberRanges)\n+    {\n+        if (countOfSequenceNumberRanges > MAX_SEQUENCE_NUMBER_RANGES)\n+        {\n+            String message = String.format(\"You may request up to %d sequence number ranges, not %d\",\n+                                           MAX_SEQUENCE_NUMBER_RANGES,\n+                                           countOfSequenceNumberRanges);\n+            throw new IllegalArgumentException(message);\n+        }\n+\n+        frameLength(SEQUENCE_RANGES_FIELDS_OFFSET + countOfSequenceNumberRanges * SEQUENCE_NUMBER_RANGE_SIZE);\n+        return this;\n+    }\n+\n+    public int countOfSequenceNumberRanges()\n+    {\n+        return (frameLength() - SEQUENCE_RANGES_FIELDS_OFFSET) / SEQUENCE_NUMBER_RANGE_SIZE;\n+    }\n \n     /**\n      * return session id field\n@@ -90,46 +99,47 @@ public class NakFlyweight extends HeaderFlyweight\n     }\n \n     /**\n-     * return sequence number field\n+     * set a sequence range\n      *\n-     * @return sequence number field\n+     * @return flyweight\n      */\n-    public long sequenceNumber()\n+    public NakFlyweight sequenceRange(final long startTermId,\n+                                      final long startSequenceNumber,\n+                                      final long endTermId,\n+                                      final long endSequenceNumber,\n+                                      final int index)\n     {\n-        return uint32Get(offset() + SEQUENCE_NUMBER_FIELD_OFFSET, LITTLE_ENDIAN);\n+        final int offset = sequenceRangeOffset(index);\n+        uint32Put(offset + START_TERM_ID_RELATIVE_OFFSET, startTermId, LITTLE_ENDIAN);\n+        uint32Put(offset + START_SEQUENCE_NUMBER_RELATIVE_OFFSET, startSequenceNumber, LITTLE_ENDIAN);\n+        uint32Put(offset + END_TERM_ID_RELATIVE_OFFSET, endTermId, LITTLE_ENDIAN);\n+        uint32Put(offset + END_SEQUENCE_NUMBER_RELATIVE_OFFSET, endSequenceNumber, LITTLE_ENDIAN);\n+        return this;\n     }\n \n-    /**\n-     * set sequence number field\n-     *\n-     * @param sequenceNumber field value\n-     * @return flyweight\n-     */\n-    public NakFlyweight sequenceNumber(final long sequenceNumber)\n+    public long startTermId(final int index)\n     {\n-        uint32Put(offset() + SEQUENCE_NUMBER_FIELD_OFFSET, sequenceNumber, LITTLE_ENDIAN);\n-        return this;\n+        return uint32Get(sequenceRangeOffset(index) + START_TERM_ID_RELATIVE_OFFSET, LITTLE_ENDIAN);\n     }\n \n-    /**\n-     * return term id field\n-     *\n-     * @return term id field\n-     */\n-    public long termId()\n+    public long startSequenceNumber(final int index)\n     {\n-        return uint32Get(offset() + TERM_ID_FIELD_OFFSET, LITTLE_ENDIAN);\n+        return uint32Get(sequenceRangeOffset(index) + START_SEQUENCE_NUMBER_RELATIVE_OFFSET, LITTLE_ENDIAN);\n     }\n \n-    /**\n-     * set term id field\n-     *\n-     * @param termId field value\n-     * @return flyweight\n-     */\n-    public NakFlyweight termId(final long termId)\n+    public long endTermId(final int index)\n     {\n-        uint32Put(offset() + TERM_ID_FIELD_OFFSET, termId, LITTLE_ENDIAN);\n-        return this;\n+        return uint32Get(sequenceRangeOffset(index) + END_TERM_ID_RELATIVE_OFFSET, LITTLE_ENDIAN);\n     }\n+\n+    public long endSequenceNumber(final int index)\n+    {\n+        return uint32Get(sequenceRangeOffset(index) + END_SEQUENCE_NUMBER_RELATIVE_OFFSET, LITTLE_ENDIAN);\n+    }\n+\n+    private int sequenceRangeOffset(final int index)\n+    {\n+        return offset() + SEQUENCE_RANGES_FIELDS_OFFSET + (SEQUENCE_NUMBER_RANGE_SIZE * index);\n+    }\n+\n }\ndiff --git a/aeron-util/src/test/java/uk/co/real_logic/aeron/util/protocol/NakFlyweightTest.java b/aeron-util/src/test/java/uk/co/real_logic/aeron/util/protocol/NakFlyweightTest.java\nnew file mode 100644\nindex 000000000..dd30fff47\n--- /dev/null\n+++ b/aeron-util/src/test/java/uk/co/real_logic/aeron/util/protocol/NakFlyweightTest.java\n@@ -0,0 +1,62 @@\n+/*\n+ * Copyright 2014 Real Logic Ltd.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package uk.co.real_logic.aeron.util.protocol;\n+\n+import org.junit.Test;\n+\n+import java.nio.ByteBuffer;\n+\n+import static org.hamcrest.Matchers.is;\n+import static org.junit.Assert.assertThat;\n+\n+public class NakFlyweightTest\n+{\n+    @Test\n+    public void canEncodeAndDecodeMultipleSequenceNakPacket()\n+    {\n+        final NakFlyweight writer = new NakFlyweight();\n+        final ByteBuffer buffer = ByteBuffer.allocate(256);\n+        writer.wrap(buffer);\n+\n+        writer.channelId(1L);\n+        writer.sessionId(2L);\n+\n+        writer.sequenceRange(3L, 4L, 5L, 6L, 0);\n+\n+        writer.sequenceRange(7L, 8L, 9L, 10L, 1);\n+\n+        writer.countOfSequenceNumberRanges(2);\n+\n+        final NakFlyweight reader = new NakFlyweight();\n+        reader.wrap(buffer);\n+\n+        assertThat(reader.channelId(), is(1L));\n+        assertThat(reader.sessionId(), is(2L));\n+\n+        assertThat(reader.startTermId(0), is(3L));\n+        assertThat(reader.startSequenceNumber(0), is(4L));\n+        assertThat(reader.endTermId(0), is(5L));\n+        assertThat(reader.endSequenceNumber(0), is(6L));\n+\n+        assertThat(reader.startTermId(1), is(7L));\n+        assertThat(reader.startSequenceNumber(1), is(8L));\n+        assertThat(reader.endTermId(1), is(9L));\n+        assertThat(reader.endSequenceNumber(1), is(10L));\n+\n+        assertThat(reader.countOfSequenceNumberRanges(), is(2));\n+    }\n+\n+}",
    "Add class for new validation task .": "diff --git a/core/server/common/src/main/java/alluxio/cli/validation/SecurityValidationTask.java b/core/server/common/src/main/java/alluxio/cli/validation/SecurityValidationTask.java\nnew file mode 100644\nindex 0000000000..c6c66b75c3\n--- /dev/null\n+++ b/core/server/common/src/main/java/alluxio/cli/validation/SecurityValidationTask.java\n@@ -0,0 +1,83 @@\n+/*\n+ * The Alluxio Open Foundation licenses this work under the Apache License, version 2.0\n+ * (the \"License\"). You may not use this work except in compliance with the License, which is\n+ * available at www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * This software is distributed on an \"AS IS\" basis, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND,\n+ * either express or implied, as more fully set forth in the License.\n+ *\n+ * See the NOTICE file distributed with this work for information regarding copyright ownership.\n+ */\n+\n+package alluxio.cli.validation;\n+\n+import alluxio.PropertyKey;\n+\n+import org.apache.hadoop.conf.Configuration;\n+\n+import java.io.BufferedReader;\n+import java.io.InputStreamReader;\n+import java.io.IOException;\n+\n+/**\n+ * Task for validating security configurations.\n+ */\n+public class SecurityValidationTask implements ValidationTask {\n+    private static final String ALLUXIO_BIN = \"./bin/alluxio\";\n+    private static final String GETCONF_CMD = \"getConf\";\n+\n+    public SecurityValidationTask(){\n+    }\n+    @Override\n+    public boolean validate() {\n+        String authType = getOutputFromProcess(new String[] {ALLUXIO_BIN, GETCONF_CMD,\n+            PropertyKey.SECURITY_AUTHENTICATION_TYPE.getName()});\n+        String masterPrinc = getOutputFromProcess(new String[] {ALLUXIO_BIN, GETCONF_CMD,\n+            PropertyKey.MASTER_PRINCIPAL.getName()});\n+        String masterKeytab = getOutputFromProcess(new String[] {ALLUXIO_BIN, GETCONF_CMD,\n+            PropertyKey.MASTER_KEYTAB_KEY_FILE.getName()});\n+        String workerPrinc = getOutputFromProcess(new String[] {ALLUXIO_BIN, GETCONF_CMD,\n+            PropertyKey.WORKER_PRINCIPAL.getName()});\n+        String workerKeytab = getOutputFromProcess(new String[] {ALLUXIO_BIN, GETCONF_CMD,\n+            PropertyKey.WORKER_KEYTAB_FILE.getName()});\n+        if (authType.equals(\"KERBEROS\")) {\n+            System.err.format(\"Alluxio does not support KERBEROS authentication.%n\");\n+            return false;\n+        }\n+        if (masterPrinc.isEmpty() && workerPrinc.isEmpty()) {\n+            System.out.println(\"Alluxio is not using Kerberos authentication\"\n+                + \" because both master and worker principals are empty.\");\n+            return true;\n+        } else if (masterPrinc.isEmpty() && !workerPrinc.isEmpty()\n+            || !masterPrinc.isEmpty() && workerPrinc.isEmpty()) {\n+            System.err.format(\"Master principal is %s, but worker principal is %s.%n\",\n+                masterPrinc, workerPrinc);\n+            return false;\n+        } else {\n+            // Login with master principal\n+        }\n+        return true;\n+    }\n+\n+    private String getOutputFromProcess(String[] args) {\n+        try {\n+            Process process = Runtime.getRuntime().exec(args);\n+            try (BufferedReader processOutputReader = new BufferedReader(\n+                new InputStreamReader(process.getInputStream()))) {\n+                String line = processOutputReader.readLine();\n+                if (line==null) {\n+                    return \"\";\n+                }\n+                return line.trim();\n+            }\n+        } catch (IOException e) {\n+            StringBuilder sb = new StringBuilder();\n+            for (String s : args) {\n+                sb.append(s);\n+                sb.append(\" \");\n+            }\n+            System.err.format(\"Unable to run command %s.%n\", sb.toString().trim());\n+            return null;\n+        }\n+    }\n+}",
    "Automated merge with https : / / hg . netbeans . org / jet - main": "diff --git a/lib.profiler.ui/src/org/netbeans/lib/profiler/ui/LiveResultsWindowContributor.java b/lib.profiler.ui/src/org/netbeans/lib/profiler/ui/LiveResultsWindowContributor.java\nindex f62cabe20..49f101740 100644\n--- a/lib.profiler.ui/src/org/netbeans/lib/profiler/ui/LiveResultsWindowContributor.java\n+++ b/lib.profiler.ui/src/org/netbeans/lib/profiler/ui/LiveResultsWindowContributor.java\n@@ -41,8 +41,8 @@\n  */\n package org.netbeans.lib.profiler.ui;\n \n-import javax.swing.JToolBar;\n import org.netbeans.lib.profiler.ProfilerClient;\n+import org.netbeans.lib.profiler.ui.components.ProfilerToolbar;\n import org.netbeans.lib.profiler.ui.cpu.LiveFlatProfilePanel;\n import org.openide.util.Lookup;\n \n@@ -55,11 +55,11 @@ public interface LiveResultsWindowContributor {\n     public static abstract class Adapter implements LiveResultsWindowContributor {\n \n         @Override\n-        public void addToCpuResults(LiveFlatProfilePanel cpuPanel, JToolBar toolbar, ProfilerClient client, Lookup.Provider project) {\n+        public void addToCpuResults(LiveFlatProfilePanel cpuPanel, ProfilerToolbar toolbar, ProfilerClient client, Lookup.Provider project) {\n         }\n \n         @Override\n-        public void addToMemoryResults(LiveFlatProfilePanel memoryPanel, JToolBar toolbar, ProfilerClient client, Lookup.Provider project) {\n+        public void addToMemoryResults(LiveFlatProfilePanel memoryPanel, ProfilerToolbar toolbar, ProfilerClient client, Lookup.Provider project) {\n         }\n \n         @Override\n@@ -79,9 +79,9 @@ public interface LiveResultsWindowContributor {\n         }\n     }\n \n-    void addToCpuResults(LiveFlatProfilePanel cpuPanel, JToolBar toolbar, ProfilerClient client, Lookup.Provider project);\n+    void addToCpuResults(LiveFlatProfilePanel cpuPanel, ProfilerToolbar toolbar, ProfilerClient client, Lookup.Provider project);\n \n-    void addToMemoryResults(LiveFlatProfilePanel memoryPanel, JToolBar toolbar, ProfilerClient client, Lookup.Provider project);\n+    void addToMemoryResults(LiveFlatProfilePanel memoryPanel, ProfilerToolbar toolbar, ProfilerClient client, Lookup.Provider project);\n \n     void show();\n \ndiff --git a/lib.profiler.ui/src/org/netbeans/lib/profiler/ui/UIUtils.java b/lib.profiler.ui/src/org/netbeans/lib/profiler/ui/UIUtils.java\nindex ba758a596..d8256ec9a 100644\n--- a/lib.profiler.ui/src/org/netbeans/lib/profiler/ui/UIUtils.java\n+++ b/lib.profiler.ui/src/org/netbeans/lib/profiler/ui/UIUtils.java\n@@ -51,6 +51,8 @@ import java.awt.image.PixelGrabber;\n import java.lang.reflect.InvocationTargetException;\n import java.util.logging.Logger;\n import javax.swing.*;\n+import javax.swing.border.Border;\n+import javax.swing.border.CompoundBorder;\n import javax.swing.event.TreeExpansionEvent;\n import javax.swing.event.TreeExpansionListener;\n import javax.swing.plaf.basic.BasicButtonListener;\n@@ -77,6 +79,7 @@ public final class UIUtils {\n     private static boolean toolTipValuesInitialized = false;\n     private static Color unfocusedSelBg;\n     private static Color unfocusedSelFg;\n+    private static Color disabledLineColor;\n \n     //~ Methods ------------------------------------------------------------------------------------------------------------------\n     public static JPanel createFillerPanel() {\n@@ -614,6 +617,22 @@ public final class UIUtils {\n             }\n         }\n     }\n+    \n+    public static void addBorder(JComponent c, Border b) {\n+        Border cb = c.getBorder();\n+        Border nb = cb == null ? b : new CompoundBorder(cb, b);\n+        c.setBorder(nb);\n+    }\n+    \n+    public static Color getDisabledLineColor() {\n+        if (disabledLineColor == null) {\n+            disabledLineColor = UIManager.getColor(\"Label.disabledForeground\"); // NOI18N\n+            if (disabledLineColor == null)\n+                disabledLineColor = UIManager.getColor(\"Label.disabledText\"); // NOI18N\n+            if (disabledLineColor == null) disabledLineColor = Color.GRAY;\n+        }\n+        return disabledLineColor;\n+    } \n \n     private static BufferedImage createComponentScreenshot(final Component component) {\n         final BufferedImage[] result = new BufferedImage[1];\ndiff --git a/lib.profiler.ui/src/org/netbeans/lib/profiler/ui/components/ProfilerToolbar.java b/lib.profiler.ui/src/org/netbeans/lib/profiler/ui/components/ProfilerToolbar.java\nnew file mode 100644\nindex 000000000..721c0de97\n--- /dev/null\n+++ b/lib.profiler.ui/src/org/netbeans/lib/profiler/ui/components/ProfilerToolbar.java\n@@ -0,0 +1,207 @@\n+/*\n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS HEADER.\n+ *\n+ * Copyright 1997-2010 Oracle and/or its affiliates. All rights reserved.\n+ *\n+ * Oracle and Java are registered trademarks of Oracle and/or its affiliates.\n+ * Other names may be trademarks of their respective owners.\n+ *\n+ * The contents of this file are subject to the terms of either the GNU\n+ * General Public License Version 2 only (\"GPL\") or the Common\n+ * Development and Distribution License(\"CDDL\") (collectively, the\n+ * \"License\"). You may not use this file except in compliance with the\n+ * License. You can obtain a copy of the License at\n+ * http://www.netbeans.org/cddl-gplv2.html\n+ * or nbbuild/licenses/CDDL-GPL-2-CP. See the License for the\n+ * specific language governing permissions and limitations under the\n+ * License.  When distributing the software, include this License Header\n+ * Notice in each file and include the License file at\n+ * nbbuild/licenses/CDDL-GPL-2-CP.  Oracle designates this\n+ * particular file as subject to the \"Classpath\" exception as provided\n+ * by Oracle in the GPL Version 2 section of the License file that\n+ * accompanied this code. If applicable, add the following below the\n+ * License Header, with the fields enclosed by brackets [] replaced by\n+ * your own identifying information:\n+ * \"Portions Copyrighted [year] [name of copyright owner]\"\n+ *\n+ * Contributor(s):\n+ * The Original Software is NetBeans. The Initial Developer of the Original\n+ * Software is Sun Microsystems, Inc. Portions Copyright 1997-2006 Sun\n+ * Microsystems, Inc. All Rights Reserved.\n+ *\n+ * If you wish your version of this file to be governed by only the CDDL\n+ * or only the GPL Version 2, indicate your decision by adding\n+ * \"[Contributor] elects to include this software in this distribution\n+ * under the [CDDL or GPL Version 2] license.\" If you do not indicate a\n+ * single choice of license, a recipient has the option to distribute\n+ * your version of this file under either the CDDL, the GPL Version 2 or\n+ * to extend the choice of license to its licensees as provided above.\n+ * However, if you add GPL Version 2 code and therefore, elected the GPL\n+ * Version 2 license, then the option applies only if the new code is\n+ * made subject to such option by the copyright holder.\n+ */\n+package org.netbeans.lib.profiler.ui.components;\n+\n+import java.awt.*;\n+import javax.swing.*;\n+import org.netbeans.lib.profiler.ui.UIUtils;\n+import org.openide.util.Lookup;\n+\n+/**\n+ *\n+ * @author Jiri Sedlacek\n+ */\n+public abstract class ProfilerToolbar {\n+    \n+    public static ProfilerToolbar create(boolean showSeparator) {\n+        Provider provider = Lookup.getDefault().lookup(Provider.class);\n+        return provider != null ? provider.create(showSeparator) :\n+                                  new Impl(showSeparator);\n+    }\n+    \n+    \n+    public abstract JComponent getComponent();\n+    \n+    \n+    public abstract Component add(Action action);\n+    \n+    public abstract Component add(Component component);\n+    \n+    public abstract Component add(Component component, int index);\n+    \n+    public abstract void addSeparator();\n+    \n+    public abstract void addSpace(int width);\n+    \n+    public abstract void addFiller();\n+    \n+    public abstract void remove(Component component);\n+    \n+    public abstract void remove(int index);\n+    \n+    public abstract int getComponentCount();\n+    \n+    \n+    protected ProfilerToolbar() {}\n+    \n+    \n+    public static abstract class Provider {\n+        \n+        public abstract ProfilerToolbar create(boolean showSeparator);\n+        \n+    }\n+    \n+    public static class Impl extends ProfilerToolbar {\n+        \n+        protected final JComponent component;\n+        protected final JToolBar toolbar;\n+        \n+        protected Impl(boolean showSeparator) {\n+            toolbar = new JToolBar() {\n+                public Component add(Component comp) {\n+                    if (comp instanceof JButton)\n+                        UIUtils.fixButtonUI((JButton) comp);\n+                    return super.add(comp);\n+                }\n+            };\n+            toolbar.setBorder(BorderFactory.createEmptyBorder(1, 2, 1, 2));\n+            toolbar.setBorderPainted(false);\n+            toolbar.setRollover(true);\n+            toolbar.setFloatable(false);\n+            \n+            final boolean customPaint = UIUtils.isNimbus();\n+            \n+            if (showSeparator) {\n+                JSeparator separator = new JSeparator() {\n+                    public Dimension getMaximumSize() {\n+                        return new Dimension(super.getMaximumSize().width, 1);\n+                    }\n+                    public Dimension getPreferredSize() {\n+                        return new Dimension(super.getPreferredSize().width, 1);\n+                    }\n+                    public void paint(Graphics g) {\n+                        if (customPaint) {\n+                            g.setColor(UIUtils.getDisabledLineColor());\n+                            g.fillRect(0, 0, getWidth(), getHeight());\n+                        } else {\n+                            super.paint(g);\n+                        }\n+                    }\n+                };\n+                separator.setBackground(toolbar.getBackground());\n+                \n+                component = new JPanel(new BorderLayout(0, 0));\n+                component.setOpaque(false);\n+                component.add(toolbar, BorderLayout.CENTER);\n+                component.add(separator, BorderLayout.SOUTH);\n+            } else {\n+                component = toolbar;\n+            }\n+        }\n+        \n+        @Override\n+        public JComponent getComponent() {\n+            return component;\n+        }\n+\n+        @Override\n+        public Component add(Action action) {\n+            return toolbar.add(action);\n+        }\n+\n+        @Override\n+        public Component add(Component component) {\n+            return toolbar.add(component);\n+        }\n+        \n+        @Override\n+        public Component add(Component component, int index) {\n+            return toolbar.add(component, index);\n+        }\n+\n+        @Override\n+        public void addSeparator() {\n+            toolbar.addSeparator();\n+        }\n+        \n+        @Override\n+        public void addSpace(int width) {\n+            toolbar.addSeparator(new Dimension(width, 0));\n+        }\n+        \n+        @Override\n+        public void addFiller() {\n+            JPanel toolbarFiller = new JPanel(new FlowLayout(FlowLayout.LEADING, 0, 0)) {\n+                public Dimension getPreferredSize() {\n+                    if (UIUtils.isGTKLookAndFeel() || UIUtils.isNimbusLookAndFeel()) {\n+                        int currentWidth = toolbar.getSize().width;\n+                        int minimumWidth = toolbar.getMinimumSize().width;\n+                        int extraWidth = currentWidth - minimumWidth;\n+                        return new Dimension(Math.max(extraWidth, 0), 0);\n+                    } else {\n+                        return super.getPreferredSize();\n+                    }\n+                }\n+            };\n+            toolbarFiller.setOpaque(false);\n+            toolbar.add(toolbarFiller);\n+        }\n+        \n+        @Override\n+        public void remove(Component component) {\n+            toolbar.remove(component);\n+        }\n+        \n+        @Override\n+        public void remove(int index) {\n+            toolbar.remove(index);\n+        }\n+        \n+        @Override\n+        public int getComponentCount() {\n+            return toolbar.getComponentCount();\n+        }\n+        \n+    }\n+    \n+}\ndiff --git a/lib.profiler.ui/src/org/netbeans/lib/profiler/ui/threads/ThreadsDetailsPanel.java b/lib.profiler.ui/src/org/netbeans/lib/profiler/ui/threads/ThreadsDetailsPanel.java\nindex 20a885586..6ff593b1b 100644\n--- a/lib.profiler.ui/src/org/netbeans/lib/profiler/ui/threads/ThreadsDetailsPanel.java\n+++ b/lib.profiler.ui/src/org/netbeans/lib/profiler/ui/threads/ThreadsDetailsPanel.java\n@@ -59,6 +59,7 @@ import java.util.HashMap;\n import java.util.Iterator;\n import java.util.ResourceBundle;\n import javax.swing.*;\n+import org.netbeans.lib.profiler.ui.components.ProfilerToolbar;\n import org.netbeans.modules.profiler.api.icons.Icons;\n import org.netbeans.modules.profiler.api.icons.ProfilerIcons;\n \n@@ -123,7 +124,7 @@ public class ThreadsDetailsPanel extends JPanel implements ActionListener, DataM\n     private JPanel content;\n     private JPanel noContentPanel;\n     private JScrollPane scrollPane;\n-    private JToolBar buttonsToolBar;\n+    private ProfilerToolbar buttonsToolBar;\n     private ThreadsDataManager manager;\n     private boolean internalChange = false;\n     private boolean noContent = false;\n@@ -180,15 +181,7 @@ public class ThreadsDetailsPanel extends JPanel implements ActionListener, DataM\n         showLabel.setDisplayedMnemonic(showLabel.getText().charAt(mnemCharIndex));\n         showLabel.setDisplayedMnemonicIndex(mnemCharIndex);\n \n-        buttonsToolBar = new JToolBar(JToolBar.HORIZONTAL) {\n-                public Component add(Component comp) {\n-                    if (comp instanceof JButton) {\n-                        UIUtils.fixButtonUI((JButton) comp);\n-                    }\n-\n-                    return super.add(comp);\n-                }\n-            };\n+        buttonsToolBar = ProfilerToolbar.create(false);\n         content = new JPanel() {\n                 public Dimension getPreferredSize() {\n                     Dimension dim = super.getPreferredSize();\n@@ -205,11 +198,6 @@ public class ThreadsDetailsPanel extends JPanel implements ActionListener, DataM\n                                      JScrollPane.HORIZONTAL_SCROLLBAR_NEVER);\n         scrollPane.getVerticalScrollBar().setUnitIncrement(30);\n \n-        // set properties\n-        buttonsToolBar.setBorder(BorderFactory.createEmptyBorder(1, 1, 1, 1));\n-        buttonsToolBar.setFloatable(false);\n-        buttonsToolBar.putClientProperty(\"JToolBar.isRollover\", Boolean.TRUE); // NOI18N\n-\n         // perform layout\n         setBorder(BorderFactory.createEmptyBorder(5, 5, 5, 5));\n         setLayout(new BorderLayout());\n@@ -239,9 +227,10 @@ public class ThreadsDetailsPanel extends JPanel implements ActionListener, DataM\n            });*/\n \n         contentPanel.add(content, BorderLayout.NORTH);\n+        buttonsToolBar.addSeparator();\n         buttonsToolBar.add(showLabel);\n         buttonsToolBar.add(threadsSelectionCombo);\n-        add(buttonsToolBar, BorderLayout.NORTH);\n+        add(buttonsToolBar.getComponent(), BorderLayout.NORTH);\n         add(scrollPane, BorderLayout.CENTER);\n         //add (scrollBar, BorderLayout.EAST);\n         threadsSelectionCombo.addActionListener(this);\n@@ -369,11 +358,9 @@ public class ThreadsDetailsPanel extends JPanel implements ActionListener, DataM\n \n     // --- Save Current View action support --------------------------------------\n     public void addSaveViewAction(AbstractAction saveViewAction) {\n-        JButton actionButton = buttonsToolBar.add(saveViewAction);\n+        Component actionButton = buttonsToolBar.add(saveViewAction);\n         buttonsToolBar.remove(actionButton);\n-\n         buttonsToolBar.add(actionButton, 0);\n-        buttonsToolBar.add(new JToolBar.Separator(), 1);\n     }\n \n     /** Called when data in manager change */\ndiff --git a/lib.profiler.ui/src/org/netbeans/lib/profiler/ui/threads/ThreadsPanel.java b/lib.profiler.ui/src/org/netbeans/lib/profiler/ui/threads/ThreadsPanel.java\nindex 8848302c2..94cdcd0a7 100644\n--- a/lib.profiler.ui/src/org/netbeans/lib/profiler/ui/threads/ThreadsPanel.java\n+++ b/lib.profiler.ui/src/org/netbeans/lib/profiler/ui/threads/ThreadsPanel.java\n@@ -69,6 +69,7 @@ import javax.swing.event.TableColumnModelListener;\n import javax.swing.table.AbstractTableModel;\n import javax.swing.table.DefaultTableCellRenderer;\n import javax.swing.table.TableColumnModel;\n+import org.netbeans.lib.profiler.ui.components.ProfilerToolbar;\n import org.netbeans.modules.profiler.api.icons.GeneralIcons;\n import org.netbeans.modules.profiler.api.icons.Icons;\n import org.netbeans.modules.profiler.api.icons.ProfilerIcons;\n@@ -232,7 +233,7 @@ public class ThreadsPanel extends JPanel implements AdjustmentListener, ActionLi\n     private JScrollBar scrollBar; // scrollbar that is displayed in zoomed mode that allows to scroll in history\n     private JScrollPane tableScroll;\n     private JTable table; // table that displays individual threads\n-    private JToolBar buttonsToolBar;\n+    private ProfilerToolbar buttonsToolBar;\n     private ThreadsDataManager manager;\n     private ThreadsDetailsCallback detailsCallback;\n     private boolean internalChange = false; // prevents cycles in event handling\n@@ -305,15 +306,7 @@ public class ThreadsPanel extends JPanel implements AdjustmentListener, ActionLi\n         showLabel.setDisplayedMnemonic(showLabel.getText().charAt(mnemCharIndex));\n         showLabel.setDisplayedMnemonicIndex(mnemCharIndex);\n \n-        buttonsToolBar = new JToolBar(JToolBar.HORIZONTAL) {\n-                public Component add(Component comp) {\n-                    if (comp instanceof JButton) {\n-                        UIUtils.fixButtonUI((JButton) comp);\n-                    }\n-\n-                    return super.add(comp);\n-                }\n-            };\n+        buttonsToolBar = ProfilerToolbar.create(false);\n \n         JPanel tablePanel = new JPanel();\n         JPanel scrollPanel = new JPanel();\n@@ -369,14 +362,13 @@ public class ThreadsPanel extends JPanel implements AdjustmentListener, ActionLi\n         columnModel.setColumnMargin(0);\n         table.setDefaultRenderer(ThreadNameCellRenderer.class, new ThreadNameCellRenderer(this));\n         table.setDefaultRenderer(ThreadStateCellRenderer.class, new ThreadStateCellRenderer(this));\n-        buttonsToolBar.setFloatable(false);\n-        buttonsToolBar.putClientProperty(\"JToolBar.isRollover\", Boolean.TRUE); // NOI18N\n \n         // perform layout\n         tablePanel.setLayout(new BorderLayout());\n         scrollPanel.setLayout(new BorderLayout());\n         scrollPanel.setBackground(Color.WHITE);\n \n+        buttonsToolBar.addSeparator();\n         buttonsToolBar.add(zoomInButton);\n         buttonsToolBar.add(zoomOutButton);\n         buttonsToolBar.add(scaleToFitButton);\n@@ -478,7 +470,7 @@ public class ThreadsPanel extends JPanel implements AdjustmentListener, ActionLi\n         contentPanel.add(notificationPanel, ENABLE_THREADS_PROFILING);\n         contentPanel.add(tablePanel, THREADS_TABLE);\n \n-        add(buttonsToolBar, BorderLayout.NORTH);\n+        add(buttonsToolBar.getComponent(), BorderLayout.NORTH);\n         add(contentPanel, BorderLayout.CENTER);\n \n         scrollBar.addAdjustmentListener(this);\n@@ -682,11 +674,9 @@ public class ThreadsPanel extends JPanel implements AdjustmentListener, ActionLi\n \n     // --- Save Current View action support --------------------------------------\n     public void addSaveViewAction(AbstractAction saveViewAction) {\n-        JButton actionButton = buttonsToolBar.add(saveViewAction);\n+        Component actionButton = buttonsToolBar.add(saveViewAction);\n         buttonsToolBar.remove(actionButton);\n-\n         buttonsToolBar.add(actionButton, 0);\n-        buttonsToolBar.add(new JToolBar.Separator(), 1);\n     }\n \n     // ---------------------------------------------------------------------------------------\ndiff --git a/lib.profiler.ui/src/org/netbeans/lib/profiler/ui/threads/ThreadsTablePanel.java b/lib.profiler.ui/src/org/netbeans/lib/profiler/ui/threads/ThreadsTablePanel.java\nindex 32c6433ab..5a2830b54 100644\n--- a/lib.profiler.ui/src/org/netbeans/lib/profiler/ui/threads/ThreadsTablePanel.java\n+++ b/lib.profiler.ui/src/org/netbeans/lib/profiler/ui/threads/ThreadsTablePanel.java\n@@ -67,21 +67,7 @@ import java.util.Comparator;\n import java.util.HashSet;\n import java.util.ResourceBundle;\n import java.util.Set;\n-import javax.swing.AbstractAction;\n-import javax.swing.BorderFactory;\n-import javax.swing.DefaultComboBoxModel;\n-import javax.swing.JButton;\n-import javax.swing.JComboBox;\n-import javax.swing.JLabel;\n-import javax.swing.JMenuItem;\n-import javax.swing.JPanel;\n-import javax.swing.JPopupMenu;\n-import javax.swing.JSeparator;\n-import javax.swing.JTable;\n-import javax.swing.JToolBar;\n-import javax.swing.KeyStroke;\n-import javax.swing.ListSelectionModel;\n-import javax.swing.SwingUtilities;\n+import javax.swing.*;\n import javax.swing.table.TableCellRenderer;\n import javax.swing.table.TableColumnModel;\n import org.netbeans.lib.profiler.global.CommonConstants;\n@@ -91,6 +77,7 @@ import org.netbeans.lib.profiler.results.threads.ThreadsDataManager;\n import org.netbeans.lib.profiler.ui.UIConstants;\n import org.netbeans.lib.profiler.ui.UIUtils;\n import org.netbeans.lib.profiler.ui.components.JExtendedTable;\n+import org.netbeans.lib.profiler.ui.components.ProfilerToolbar;\n import org.netbeans.lib.profiler.ui.components.table.ExtendedTableModel;\n import org.netbeans.lib.profiler.ui.components.table.JExtendedTablePanel;\n import org.netbeans.lib.profiler.ui.components.table.LabelBracketTableCellRenderer;\n@@ -343,11 +330,9 @@ public class ThreadsTablePanel extends JPanel implements ActionListener, DataMan\n     \n     // --- Save Current View action support --------------------------------------\n     public void addSaveViewAction(AbstractAction saveViewAction) {\n-        JButton actionButton = buttonsToolBar.add(saveViewAction);\n+        Component actionButton = buttonsToolBar.add(saveViewAction);\n         buttonsToolBar.remove(actionButton);\n-\n         buttonsToolBar.add(actionButton, 0);\n-        buttonsToolBar.add(new JToolBar.Separator(), 1);\n     }\n     \n     public boolean fitsVisibleArea() {\n@@ -601,25 +586,16 @@ public class ThreadsTablePanel extends JPanel implements ActionListener, DataMan\n         showLabel.setDisplayedMnemonic(showLabel.getText().charAt(mnemCharIndex));\n         showLabel.setDisplayedMnemonicIndex(mnemCharIndex);\n \n-        buttonsToolBar = new JToolBar(JToolBar.HORIZONTAL) {\n-            public Component add(Component comp) {\n-                if (comp instanceof JButton) {\n-                    UIUtils.fixButtonUI((JButton) comp);\n-                }\n-\n-                return super.add(comp);\n-            }\n-        };\n-        buttonsToolBar.setFloatable(false);\n-        buttonsToolBar.putClientProperty(\"JToolBar.isRollover\", Boolean.TRUE); // NOI18N\n-        buttonsToolBar.setBorder(BorderFactory.createCompoundBorder(\n-         ",
    "Remove unused exclude - statements in assembly - descriptor ( exclude elements can only define artifacts , not paths )": "diff --git a/stratosphere-dist/src/main/assemblies/bin.xml b/stratosphere-dist/src/main/assemblies/bin.xml\nindex 1953a3d7eaf..da7d1e3e79b 100644\n--- a/stratosphere-dist/src/main/assemblies/bin.xml\n+++ b/stratosphere-dist/src/main/assemblies/bin.xml\n@@ -25,9 +25,11 @@\n \t\t\t<useTransitiveFiltering>true</useTransitiveFiltering>\n \t\t\t\n \t\t\t<excludes>\n+\t\t\t\t<!--\n \t\t\t\t<exclude>**/*examples*.jar</exclude>\n \t\t\t\t<exclude>**/*javadoc*</exclude>\n \t\t\t\t<exclude>**/*sources*</exclude>\n+\t\t\t\t-->\n <!-- \t\t\t\t<exclude>eu.stratosphere:pact-clients:**</exclude> -->\n \t\t\t\t<!--\n \t\t\t\t  This is a hardcoded exclude-list containing all libraries that are exclusively used in pact-clients.\n@@ -50,11 +52,13 @@\n \t\t\t\t<include>eu.stratosphere:pact-clients:**</include>\n \t\t\t</includes>\n \t\t\t\n+\t\t\t<!--\n \t\t\t<excludes>\n \t\t\t\t<exclude>**/*examples*.jar</exclude>\n \t\t\t\t<exclude>**/*javadoc*</exclude>\n \t\t\t\t<exclude>**/*sources*</exclude>\n \t\t\t</excludes>\n+\t\t\t-->\n \t\t</dependencySet>\n \t</dependencySets>\n ",
    "Rename ConstraintsTracker to WorkConstraintsTracker .": "diff --git a/background/workmanager/src/androidTest/java/android/arch/background/workmanager/impl/background/systemalarm/SystemAlarmServiceImplTest.java b/background/workmanager/src/androidTest/java/android/arch/background/workmanager/impl/background/systemalarm/SystemAlarmServiceImplTest.java\nindex 6e5eaa45598..7c519adeb27 100644\n--- a/background/workmanager/src/androidTest/java/android/arch/background/workmanager/impl/background/systemalarm/SystemAlarmServiceImplTest.java\n+++ b/background/workmanager/src/androidTest/java/android/arch/background/workmanager/impl/background/systemalarm/SystemAlarmServiceImplTest.java\n@@ -28,7 +28,7 @@ import android.arch.background.workmanager.Constraints;\n import android.arch.background.workmanager.Work;\n import android.arch.background.workmanager.WorkManagerTest;\n import android.arch.background.workmanager.impl.background.BackgroundProcessor;\n-import android.arch.background.workmanager.impl.constraints.ConstraintsTracker;\n+import android.arch.background.workmanager.impl.constraints.WorkConstraintsTracker;\n import android.arch.background.workmanager.impl.model.WorkSpec;\n import android.arch.background.workmanager.worker.TestWorker;\n import android.content.Context;\n@@ -45,7 +45,7 @@ import java.util.List;\n public class SystemAlarmServiceImplTest extends WorkManagerTest {\n     private SystemAlarmServiceImpl mSystemAlarmServiceImpl;\n     private BackgroundProcessor mMockProcessor;\n-    private ConstraintsTracker mMockConstraintsTracker;\n+    private WorkConstraintsTracker mMockWorkConstraintsTracker;\n     private SystemAlarmServiceImpl.AllWorkExecutedCallback mMockCallback;\n     private Context mContext;\n \n@@ -53,10 +53,10 @@ public class SystemAlarmServiceImplTest extends WorkManagerTest {\n     public void setUp() {\n         mContext = InstrumentationRegistry.getTargetContext();\n         mMockProcessor = mock(BackgroundProcessor.class);\n-        mMockConstraintsTracker = mock(ConstraintsTracker.class);\n+        mMockWorkConstraintsTracker = mock(WorkConstraintsTracker.class);\n         mMockCallback = mock(SystemAlarmServiceImpl.AllWorkExecutedCallback.class);\n         mSystemAlarmServiceImpl = new SystemAlarmServiceImpl(\n-                mContext, mMockProcessor, mMockConstraintsTracker, mMockCallback);\n+                mContext, mMockProcessor, mMockWorkConstraintsTracker, mMockCallback);\n     }\n \n     @Test\n@@ -71,7 +71,7 @@ public class SystemAlarmServiceImplTest extends WorkManagerTest {\n         mSystemAlarmServiceImpl.onEligibleWorkChanged(workSpecs);\n \n         verify(mMockProcessor).process(workSpec.getId());\n-        verify(mMockConstraintsTracker).replace(Collections.<WorkSpec>emptyList());\n+        verify(mMockWorkConstraintsTracker).replace(Collections.<WorkSpec>emptyList());\n         verifyZeroInteractions(mMockCallback);\n         assertThat(mSystemAlarmServiceImpl.getDelayMetWorkSpecs(), is(empty()));\n         assertThat(mSystemAlarmServiceImpl.getDelayNotMetWorkSpecs(), is(empty()));\n@@ -89,7 +89,7 @@ public class SystemAlarmServiceImplTest extends WorkManagerTest {\n \n         mSystemAlarmServiceImpl.onEligibleWorkChanged(workSpecs);\n \n-        verify(mMockConstraintsTracker).replace(workSpecs);\n+        verify(mMockWorkConstraintsTracker).replace(workSpecs);\n         verifyZeroInteractions(mMockProcessor, mMockCallback);\n         assertThat(mSystemAlarmServiceImpl.getDelayMetWorkSpecs(), is(workSpecs));\n         assertThat(mSystemAlarmServiceImpl.getDelayNotMetWorkSpecs(), is(empty()));\n@@ -107,7 +107,7 @@ public class SystemAlarmServiceImplTest extends WorkManagerTest {\n \n         mSystemAlarmServiceImpl.onEligibleWorkChanged(workSpecs);\n \n-        verify(mMockConstraintsTracker).replace(Collections.<WorkSpec>emptyList());\n+        verify(mMockWorkConstraintsTracker).replace(Collections.<WorkSpec>emptyList());\n         verifyZeroInteractions(mMockProcessor);\n         assertThat(mSystemAlarmServiceImpl.getDelayMetWorkSpecs(), is(empty()));\n         assertThat(mSystemAlarmServiceImpl.getDelayNotMetWorkSpecs(), is(workSpecs));\n@@ -119,7 +119,7 @@ public class SystemAlarmServiceImplTest extends WorkManagerTest {\n         String workSpecId = \"SOME_WORKSPEC_WHOSE_DELAY_IS_MET\";\n         Intent intent = SystemAlarmService.createDelayMetIntent(mContext, workSpecId);\n         mSystemAlarmServiceImpl.onStartCommand(intent);\n-        verifyZeroInteractions(mMockConstraintsTracker, mMockProcessor, mMockCallback);\n+        verifyZeroInteractions(mMockWorkConstraintsTracker, mMockProcessor, mMockCallback);\n     }\n \n     @Test\n@@ -160,7 +160,7 @@ public class SystemAlarmServiceImplTest extends WorkManagerTest {\n \n         assertThat(mSystemAlarmServiceImpl.getDelayNotMetWorkSpecs(), is(workSpecs));\n         assertThat(mSystemAlarmServiceImpl.getDelayMetWorkSpecs(), is(empty()));\n-        verify(mMockConstraintsTracker).replace(Collections.<WorkSpec>emptyList());\n+        verify(mMockWorkConstraintsTracker).replace(Collections.<WorkSpec>emptyList());\n \n         // Delay has been met\n         Intent intent = SystemAlarmService.createDelayMetIntent(mContext, workSpec.getId());\n@@ -169,7 +169,7 @@ public class SystemAlarmServiceImplTest extends WorkManagerTest {\n         assertThat(mSystemAlarmServiceImpl.getDelayNotMetWorkSpecs(), is(empty()));\n         assertThat(mSystemAlarmServiceImpl.getDelayMetWorkSpecs(), is(workSpecs));\n         // TODO(xbhatnag): Why times(2)? this method is invoked exactly once with these arguments.\n-        verify(mMockConstraintsTracker, times(2)).replace(workSpecs);\n+        verify(mMockWorkConstraintsTracker, times(2)).replace(workSpecs);\n     }\n \n     @Test\n@@ -184,14 +184,14 @@ public class SystemAlarmServiceImplTest extends WorkManagerTest {\n         WorkSpec workSpec = getWorkSpec(work);\n         List<WorkSpec> workSpecs = Collections.singletonList(workSpec);\n         mSystemAlarmServiceImpl.onEligibleWorkChanged(workSpecs);\n-        verify(mMockConstraintsTracker).replace(Collections.<WorkSpec>emptyList());\n+        verify(mMockWorkConstraintsTracker).replace(Collections.<WorkSpec>emptyList());\n \n         // Delay has been met\n         Intent intent = SystemAlarmService.createDelayMetIntent(mContext, workSpec.getId());\n         mSystemAlarmServiceImpl.onStartCommand(intent);\n         assertThat(mSystemAlarmServiceImpl.getDelayMetWorkSpecs(), is(workSpecs));\n         // TODO(xbhatnag): Why times(2)? this method is invoked exactly once with these arguments.\n-        verify(mMockConstraintsTracker, times(2)).replace(workSpecs);\n+        verify(mMockWorkConstraintsTracker, times(2)).replace(workSpecs);\n \n         // Constraints met\n         List<String> workSpecIds = Collections.singletonList(workSpec.getId());\n@@ -202,6 +202,6 @@ public class SystemAlarmServiceImplTest extends WorkManagerTest {\n         mSystemAlarmServiceImpl.onExecuted(workSpec.getId(), false);\n         assertThat(mSystemAlarmServiceImpl.getDelayMetWorkSpecs(), is(empty()));\n         // TODO(xbhatnag): Why times(3)? this method is invoked exactly twice with these arguments.\n-        verify(mMockConstraintsTracker, times(3)).replace(Collections.<WorkSpec>emptyList());\n+        verify(mMockWorkConstraintsTracker, times(3)).replace(Collections.<WorkSpec>emptyList());\n     }\n }\ndiff --git a/background/workmanager/src/androidTest/java/android/arch/background/workmanager/impl/constraints/ConstraintsTrackerTest.java b/background/workmanager/src/androidTest/java/android/arch/background/workmanager/impl/constraints/WorkConstraintsTrackerTest.java\nsimilarity index 84%\nrename from background/workmanager/src/androidTest/java/android/arch/background/workmanager/impl/constraints/ConstraintsTrackerTest.java\nrename to background/workmanager/src/androidTest/java/android/arch/background/workmanager/impl/constraints/WorkConstraintsTrackerTest.java\nindex 2162038a174..fe2d0d39ee6 100644\n--- a/background/workmanager/src/androidTest/java/android/arch/background/workmanager/impl/constraints/ConstraintsTrackerTest.java\n+++ b/background/workmanager/src/androidTest/java/android/arch/background/workmanager/impl/constraints/WorkConstraintsTrackerTest.java\n@@ -40,7 +40,7 @@ import java.util.List;\n \n @SmallTest\n @RunWith(AndroidJUnit4.class)\n-public class ConstraintsTrackerTest {\n+public class WorkConstraintsTrackerTest {\n     private static final List<String> TEST_WORKSPEC_IDS = new ArrayList<>();\n     static {\n         TEST_WORKSPEC_IDS.add(\"A\");\n@@ -48,7 +48,7 @@ public class ConstraintsTrackerTest {\n         TEST_WORKSPEC_IDS.add(\"C\");\n     }\n \n-    private ConstraintsMetCallback mCallback = new ConstraintsMetCallback() {\n+    private WorkConstraintsCallback mCallback = new WorkConstraintsCallback() {\n         @Override\n         public void onAllConstraintsMet(@NonNull List<String> workSpecIds) {\n             mUnconstrainedWorkSpecIds = workSpecIds;\n@@ -63,30 +63,30 @@ public class ConstraintsTrackerTest {\n     private ConstraintController mMockController = mock(ConstraintController.class);\n     private List<String> mUnconstrainedWorkSpecIds;\n     private List<String> mConstrainedWorkSpecIds;\n-    private ConstraintsTracker mConstraintsTracker;\n+    private WorkConstraintsTracker mWorkConstraintsTracker;\n \n     @Before\n     public void setUp() {\n         ConstraintController[] controllers = new ConstraintController[] {mMockController};\n-        mConstraintsTracker = new ConstraintsTracker(mCallback, controllers);\n+        mWorkConstraintsTracker = new WorkConstraintsTracker(mCallback, controllers);\n     }\n \n     @Test\n     public void testReplace() {\n         List<WorkSpec> emptyList = Collections.emptyList();\n-        mConstraintsTracker.replace(emptyList);\n+        mWorkConstraintsTracker.replace(emptyList);\n         verify(mMockController).replace(emptyList);\n     }\n \n     @Test\n     public void testReset() {\n-        mConstraintsTracker.reset();\n+        mWorkConstraintsTracker.reset();\n         verify(mMockController).reset();\n     }\n \n     @Test\n     public void testOnConstraintMet_controllerInvoked() {\n-        mConstraintsTracker.onConstraintMet(TEST_WORKSPEC_IDS);\n+        mWorkConstraintsTracker.onConstraintMet(TEST_WORKSPEC_IDS);\n         for (String id : TEST_WORKSPEC_IDS) {\n             verify(mMockController).isWorkSpecConstrained(id);\n         }\n@@ -95,7 +95,7 @@ public class ConstraintsTrackerTest {\n     @Test\n     public void testOnConstraintMet_allConstraintsMet() {\n         when(mMockController.isWorkSpecConstrained(any(String.class))).thenReturn(false);\n-        mConstraintsTracker.onConstraintMet(TEST_WORKSPEC_IDS);\n+        mWorkConstraintsTracker.onConstraintMet(TEST_WORKSPEC_IDS);\n         assertThat(mUnconstrainedWorkSpecIds, is(TEST_WORKSPEC_IDS));\n     }\n \n@@ -104,7 +104,7 @@ public class ConstraintsTrackerTest {\n         when(mMockController.isWorkSpecConstrained(TEST_WORKSPEC_IDS.get(0))).thenReturn(true);\n         when(mMockController.isWorkSpecConstrained(TEST_WORKSPEC_IDS.get(1))).thenReturn(false);\n         when(mMockController.isWorkSpecConstrained(TEST_WORKSPEC_IDS.get(2))).thenReturn(false);\n-        mConstraintsTracker.onConstraintMet(TEST_WORKSPEC_IDS);\n+        mWorkConstraintsTracker.onConstraintMet(TEST_WORKSPEC_IDS);\n         assertThat(mUnconstrainedWorkSpecIds,\n                 containsInAnyOrder(TEST_WORKSPEC_IDS.get(1), TEST_WORKSPEC_IDS.get(2)));\n     }\n@@ -112,13 +112,13 @@ public class ConstraintsTrackerTest {\n     @Test\n     public void testOnConstraintMet_allConstraintsNotMet() {\n         when(mMockController.isWorkSpecConstrained(any(String.class))).thenReturn(true);\n-        mConstraintsTracker.onConstraintMet(TEST_WORKSPEC_IDS);\n+        mWorkConstraintsTracker.onConstraintMet(TEST_WORKSPEC_IDS);\n         assertThat(mUnconstrainedWorkSpecIds, is(empty()));\n     }\n \n     @Test\n     public void testOnConstraintNotMet() {\n-        mConstraintsTracker.onConstraintNotMet(TEST_WORKSPEC_IDS);\n+        mWorkConstraintsTracker.onConstraintNotMet(TEST_WORKSPEC_IDS);\n         assertThat(mConstrainedWorkSpecIds, is(TEST_WORKSPEC_IDS));\n     }\n }\ndiff --git a/background/workmanager/src/main/java/android/arch/background/workmanager/impl/background/systemalarm/SystemAlarmService.java b/background/workmanager/src/main/java/android/arch/background/workmanager/impl/background/systemalarm/SystemAlarmService.java\nindex 653ff0afef0..5b188ec8aac 100644\n--- a/background/workmanager/src/main/java/android/arch/background/workmanager/impl/background/systemalarm/SystemAlarmService.java\n+++ b/background/workmanager/src/main/java/android/arch/background/workmanager/impl/background/systemalarm/SystemAlarmService.java\n@@ -24,8 +24,8 @@ import android.arch.background.workmanager.impl.Scheduler;\n import android.arch.background.workmanager.impl.WorkDatabase;\n import android.arch.background.workmanager.impl.WorkManagerImpl;\n import android.arch.background.workmanager.impl.background.BackgroundProcessor;\n-import android.arch.background.workmanager.impl.constraints.ConstraintsMetCallback;\n-import android.arch.background.workmanager.impl.constraints.ConstraintsTracker;\n+import android.arch.background.workmanager.impl.constraints.WorkConstraintsCallback;\n+import android.arch.background.workmanager.impl.constraints.WorkConstraintsTracker;\n import android.arch.background.workmanager.impl.model.WorkSpec;\n import android.arch.background.workmanager.impl.utils.LiveDataUtils;\n import android.arch.lifecycle.LifecycleService;\n@@ -46,7 +46,7 @@ import java.util.List;\n  */\n @RestrictTo(RestrictTo.Scope.LIBRARY_GROUP)\n public class SystemAlarmService extends LifecycleService implements ExecutionListener,\n-        Observer<List<WorkSpec>>, ConstraintsMetCallback,\n+        Observer<List<WorkSpec>>, WorkConstraintsCallback,\n         SystemAlarmServiceImpl.AllWorkExecutedCallback {\n \n     private static final String TAG = \"SystemAlarmService\";\n@@ -66,9 +66,9 @@ public class SystemAlarmService extends LifecycleService implements ExecutionLis\n                 scheduler,\n                 workManagerImpl.getBackgroundExecutorService(),\n                 this);\n-        ConstraintsTracker constraintsTracker = new ConstraintsTracker(context, this);\n+        WorkConstraintsTracker workConstraintsTracker = new WorkConstraintsTracker(context, this);\n         mSystemAlarmServiceImpl =\n-                new SystemAlarmServiceImpl(context, processor, constraintsTracker, this);\n+                new SystemAlarmServiceImpl(context, processor, workConstraintsTracker, this);\n \n         LiveDataUtils\n                 .dedupedLiveDataFor(database.workSpecDao().getSystemAlarmEligibleWorkSpecs())\ndiff --git a/background/workmanager/src/main/java/android/arch/background/workmanager/impl/background/systemalarm/SystemAlarmServiceImpl.java b/background/workmanager/src/main/java/android/arch/background/workmanager/impl/background/systemalarm/SystemAlarmServiceImpl.java\nindex 286055d04e0..f36372c8b47 100644\n--- a/background/workmanager/src/main/java/android/arch/background/workmanager/impl/background/systemalarm/SystemAlarmServiceImpl.java\n+++ b/background/workmanager/src/main/java/android/arch/background/workmanager/impl/background/systemalarm/SystemAlarmServiceImpl.java\n@@ -20,7 +20,7 @@ import android.app.Service;\n import android.arch.background.workmanager.BaseWork;\n import android.arch.background.workmanager.Constraints;\n import android.arch.background.workmanager.impl.background.BackgroundProcessor;\n-import android.arch.background.workmanager.impl.constraints.ConstraintsTracker;\n+import android.arch.background.workmanager.impl.constraints.WorkConstraintsTracker;\n import android.arch.background.workmanager.impl.model.WorkSpec;\n import android.content.Context;\n import android.content.Intent;\n@@ -52,16 +52,16 @@ class SystemAlarmServiceImpl {\n     private final Context mContext;\n     private final AllWorkExecutedCallback mCallback;\n     private final BackgroundProcessor mProcessor;\n-    private final ConstraintsTracker mConstraintsTracker;\n+    private final WorkConstraintsTracker mWorkConstraintsTracker;\n \n     SystemAlarmServiceImpl(\n             @NonNull Context context,\n             @NonNull BackgroundProcessor processor,\n-            @NonNull ConstraintsTracker constraintsTracker,\n+            @NonNull WorkConstraintsTracker workConstraintsTracker,\n             @NonNull AllWorkExecutedCallback callback) {\n         mContext = context.getApplicationContext();\n         mProcessor = processor;\n-        mConstraintsTracker = constraintsTracker;\n+        mWorkConstraintsTracker = workConstraintsTracker;\n         mCallback = callback;\n     }\n \n@@ -91,7 +91,7 @@ class SystemAlarmServiceImpl {\n     }\n \n     private void updateConstraintsTrackerAndProxy() {\n-        mConstraintsTracker.replace(mDelayMetWorkSpecs);\n+        mWorkConstraintsTracker.replace(mDelayMetWorkSpecs);\n         ConstraintProxy.updateAll(mContext, mDelayMetWorkSpecs);\n     }\n \ndiff --git a/background/workmanager/src/main/java/android/arch/background/workmanager/impl/constraints/ConstraintsMetCallback.java b/background/workmanager/src/main/java/android/arch/background/workmanager/impl/constraints/WorkConstraintsCallback.java\nsimilarity index 96%\nrename from background/workmanager/src/main/java/android/arch/background/workmanager/impl/constraints/ConstraintsMetCallback.java\nrename to background/workmanager/src/main/java/android/arch/background/workmanager/impl/constraints/WorkConstraintsCallback.java\nindex c786ed08152..4b200d837a7 100644\n--- a/background/workmanager/src/main/java/android/arch/background/workmanager/impl/constraints/ConstraintsMetCallback.java\n+++ b/background/workmanager/src/main/java/android/arch/background/workmanager/impl/constraints/WorkConstraintsCallback.java\n@@ -24,7 +24,7 @@ import java.util.List;\n  * A callback for when constraints change.\n  */\n \n-public interface ConstraintsMetCallback {\n+public interface WorkConstraintsCallback {\n     /**\n      * Called when all constraints are met.\n      *\ndiff --git a/background/workmanager/src/main/java/android/arch/background/workmanager/impl/constraints/ConstraintsTracker.java b/background/workmanager/src/main/java/android/arch/background/workmanager/impl/constraints/WorkConstraintsTracker.java\nsimilarity index 87%\nrename from background/workmanager/src/main/java/android/arch/background/workmanager/impl/constraints/ConstraintsTracker.java\nrename to background/workmanager/src/main/java/android/arch/background/workmanager/impl/constraints/WorkConstraintsTracker.java\nindex 5d40719166b..6fa27a04052 100644\n--- a/background/workmanager/src/main/java/android/arch/background/workmanager/impl/constraints/ConstraintsTracker.java\n+++ b/background/workmanager/src/main/java/android/arch/background/workmanager/impl/constraints/WorkConstraintsTracker.java\n@@ -15,6 +15,7 @@\n  */\n package android.arch.background.workmanager.impl.constraints;\n \n+import android.arch.background.workmanager.Constraints;\n import android.arch.background.workmanager.impl.constraints.controllers.BatteryChargingController;\n import android.arch.background.workmanager.impl.constraints.controllers.BatteryNotLowController;\n import android.arch.background.workmanager.impl.constraints.controllers.ConstraintController;\n@@ -33,17 +34,18 @@ import java.util.ArrayList;\n import java.util.List;\n \n /**\n- * A class to update the current status of various constraints.\n+ * Tracks {@link WorkSpec}s and their {@link Constraints}, and notifies a\n+ * {@link WorkConstraintsCallback} when all of their constraints are met or not met.\n  */\n \n-public class ConstraintsTracker implements ConstraintController.OnConstraintUpdatedCallback {\n+public class WorkConstraintsTracker implements ConstraintController.OnConstraintUpdatedCallback {\n \n-    private static final String TAG = \"ConstraintsTracker\";\n+    private static final String TAG = \"WorkConstraintsTracker\";\n \n-    private final ConstraintsMetCallback mCallback;\n+    private final WorkConstraintsCallback mCallback;\n     private final ConstraintController[] mConstraintControllers;\n \n-    public ConstraintsTracker(Context context, ConstraintsMetCallback callback) {\n+    public WorkConstraintsTracker(Context context, WorkConstraintsCallback callback) {\n         Context appContext = context.getApplicationContext();\n         mCallback = callback;\n         mConstraintControllers = new ConstraintController[] {\n@@ -58,7 +60,7 @@ public class ConstraintsTracker implements ConstraintController.OnConstraintUpda\n     }\n \n     @VisibleForTesting\n-    ConstraintsTracker(ConstraintsMetCallback callback, ConstraintController[] controllers) {\n+    WorkConstraintsTracker(WorkConstraintsCallback callback, ConstraintController[] controllers) {\n         mCallback = callback;\n         mConstraintControllers = controllers;\n     }\ndiff --git a/background/workmanager/src/main/java/android/arch/background/workmanager/impl/foreground/ForegroundProcessor.java b/background/workmanager/src/main/java/android/arch/background/workmanager/impl/foreground/ForegroundProcessor.java\nindex 21a453177a1..ae2bff5571e 100644\n--- a/background/workmanager/src/main/java/android/arch/background/workmanager/impl/foreground/ForegroundProcessor.java\n+++ b/background/workmanager/src/main/java/android/arch/background/workmanager/impl/foreground/ForegroundProcessor.java\n@@ -21,8 +21,8 @@ import android.arch.background.workmanager.Constraints;\n import android.arch.background.workmanager.impl.Processor;\n import android.arch.background.workmanager.impl.Scheduler;\n import android.arch.background.workmanager.impl.WorkDatabase;\n-import android.arch.background.workmanager.impl.constraints.ConstraintsMetCallback;\n-import android.arch.background.workmanager.impl.constraints.ConstraintsTracker;\n+import android.arch.background.workmanager.impl.constraints.WorkConstraintsCallback;\n+import android.arch.background.workmanager.impl.constraints.WorkConstraintsTracker;\n import android.arch.background.workmanager.impl.model.WorkSpec;\n import android.arch.background.workmanager.impl.utils.LiveDataUtils;\n import android.arch.lifecycle.Lifecycle;\n@@ -48,12 +48,12 @@ import java.util.concurrent.Future;\n  */\n @RestrictTo(RestrictTo.Scope.LIBRARY_GROUP)\n public class ForegroundProcessor extends Processor\n-        implements Observer<List<WorkSpec>>, LifecycleObserver, ConstraintsMetCallback {\n+        implements Observer<List<WorkSpec>>, LifecycleObserver, WorkConstraintsCallback {\n \n     private static final String TAG = \"ForegroundProcessor\";\n \n     private LifecycleOwner mLifecycleOwner;\n-    private ConstraintsTracker mConstraintsTracker;\n+    private WorkConstraintsTracker mWorkConstraintsTracker;\n \n     public ForegroundProcessor(\n             Context appContext,\n@@ -64,7 +64,7 @@ public class ForegroundProcessor extends Processor\n         super(appContext, workDatabase, scheduler, executorService);\n         mLifecycleOwner = lifecycleOwner;\n         mLifecycleOwner.getLifecycle().addObserver(this);\n-        mConstraintsTracker = new ConstraintsTracker(mAppContext, this);\n+        mWorkConstraintsTracker = new WorkConstraintsTracker(mAppContext, this);\n         LiveDataUtils.dedupedLiveDataFor(\n                 mWorkDatabase.workSpecDao().getForegroundEligibleWorkSpecs())\n                 .observe(mLifecycleOwner, this);\n@@ -97,9 +97,9 @@ public class ForegroundProcessor extends Processor\n                 process(workSpec.getId());\n             }\n         }\n-        // ConstraintsTracker will only consider WorkSpecs which have constraints that it can\n+        // WorkConstraintsTracker will only consider WorkSpecs which have constraints that it can\n         // monitor. The rest will be ignored.\n-        mConstraintsTracker.replace(workSpecs);\n+        mWorkConstraintsTracker.replace(workSpecs);\n     }\n \n     /**\n@@ -108,7 +108,7 @@ public class ForegroundProcessor extends Processor\n     @OnLifecycleEvent(Lifecycle.Event.ON_STOP)\n     public void onLifecycleStop() {\n         Log.d(TAG, \"onLifecycleStop\");\n-        mConstraintsTracker.reset();\n+        mWorkConstraintsTracker.reset();\n         Iterator<Map.Entry<String, Future<?>>> it = mEnqueuedWorkMap.entrySet().iterator();\n         while (it.hasNext()) {\n             Map.Entry<String, Future<?>> entry = it.next();",
    "remove scm tag in pom . xml": "diff --git a/pom.xml b/pom.xml\nindex 725b2accb..bf726069b 100644\n--- a/pom.xml\n+++ b/pom.xml\n@@ -242,7 +242,6 @@\n     <scm>\n         <connection>scm:git:https://gitbox.apache.org/repos/asf/storm.git</connection>\n         <developerConnection>scm:git:https://gitbox.apache.org/repos/asf/storm.git</developerConnection>\n-        <tag>v2.0.0</tag>\n         <url>https://gitbox.apache.org/repos/asf/storm</url>\n     </scm>\n ",
    "Apply shard failures in a single batch": "diff --git a/core/src/main/java/org/elasticsearch/cluster/action/shard/ShardStateAction.java b/core/src/main/java/org/elasticsearch/cluster/action/shard/ShardStateAction.java\nindex 8a7340f2ae4..da014e15b6b 100644\n--- a/core/src/main/java/org/elasticsearch/cluster/action/shard/ShardStateAction.java\n+++ b/core/src/main/java/org/elasticsearch/cluster/action/shard/ShardStateAction.java\n@@ -153,22 +153,22 @@ public class ShardStateAction extends AbstractComponent {\n         @Override\n         public BatchResult<ShardRoutingEntry> execute(ClusterState currentState, List<ShardRoutingEntry> tasks) throws Exception {\n             BatchResult.Builder<ShardRoutingEntry> builder = BatchResult.builder();\n-            ClusterState accumulator = ClusterState.builder(currentState).build();\n+            List<FailedRerouteAllocation.FailedShard> shardRoutingsToBeApplied = new ArrayList<>(tasks.size());\n             for (ShardRoutingEntry task : tasks) {\n                 task.processed = true;\n-                try {\n-                    RoutingAllocation.Result result = allocationService.applyFailedShard(\n-                            currentState,\n-                            new FailedRerouteAllocation.FailedShard(task.shardRouting, task.message, task.failure));\n-                    builder.success(task);\n-                    if (result.changed()) {\n-                        accumulator = ClusterState.builder(accumulator).routingResult(result).build();\n-                    }\n-                } catch (Throwable t) {\n-                    builder.failure(task, t);\n+                shardRoutingsToBeApplied.add(new FailedRerouteAllocation.FailedShard(task.shardRouting, task.message, task.failure));\n+            }\n+          ",
    "Updating IE driver to latest JavaScript atoms": "diff --git a/cpp/iedriver/Generated/atoms.h b/cpp/iedriver/Generated/atoms.h\nindex 31e46fb4a7..f71338b934 100644\n--- a/cpp/iedriver/Generated/atoms.h\n+++ b/cpp/iedriver/Generated/atoms.h\n@@ -26,12 +26,889 @@ namespace atoms {\n \n \n const wchar_t* const CLICK[] = {\n-    L\"function(){return function(){var h,aa=this;function l(a){return void 0\",\n-    L\"!==a}function m(a){return\\\"string\\\"==typeof a}function ca(a){return\\\"n\",\n-    L\"umber\\\"==typeof a}function da(a,b){a=a.split(\\\".\\\");var c=aa;a[0]in c|\",\n+    L\"function(){return function(){var l,ba=this;function n(c){return void 0\",\n+    L\"!==c}function q(c){return\\\"string\\\"==typeof c}function ca(c){return\\\"n\",\n+    L\"umber\\\"==typeof c}function da(c,d){c=c.split(\\\".\\\");var e=ba;c[0]in e|\",\n+    L\"|!e.execScript||e.execScript(\\\"var \\\"+c[0]);for(var f;c.length&&(f=c.s\",\n+    L\"hift());)!c.length&&n(d)?e[f]=d:e[f]&&e[f]!==Object.prototype[f]?e=e[f\",\n+    L\"]:e=e[f]={}}\\nfunction ea(c){var d=typeof c;if(\\\"object\\\"==d)if(c){if(\",\n+    L\"c instanceof Array)return\\\"array\\\";if(c instanceof Object)return d;var\",\n+    L\" e=Object.prototype.toString.call(c);if(\\\"[object Window]\\\"==e)return\",\n+    L\"\\\"object\\\";if(\\\"[object Array]\\\"==e||\\\"number\\\"==typeof c.length&&\\\"un\",\n+    L\"defined\\\"!=typeof c.splice&&\\\"undefined\\\"!=typeof c.propertyIsEnumerab\",\n+    L\"le&&!c.propertyIsEnumerable(\\\"splice\\\"))return\\\"array\\\";if(\\\"[object F\",\n+    L\"unction]\\\"==e||\\\"undefined\\\"!=typeof c.call&&\\\"undefined\\\"!=typeof c.p\",\n+    L\"ropertyIsEnumerable&&!c.propertyIsEnumerable(\\\"call\\\"))return\\\"functio\",\n+    L\"n\\\"}else return\\\"null\\\";\\nelse if(\\\"function\\\"==d&&\\\"undefined\\\"==type\",\n+    L\"of c.call)return\\\"object\\\";return d}function fa(c){return\\\"function\\\"=\",\n+    L\"=ea(c)}function ha(c){var d=typeof c;return\\\"object\\\"==d&&null!=c||\\\"f\",\n+    L\"unction\\\"==d}function ia(c,d,e){return c.call.apply(c.bind,arguments)}\",\n+    L\"\\nfunction ja(c,d,e){if(!c)throw Error();if(2<arguments.length){var f=\",\n+    L\"Array.prototype.slice.call(arguments,2);return function(){var e=Array.\",\n+    L\"prototype.slice.call(arguments);Array.prototype.unshift.apply(e,f);ret\",\n+    L\"urn c.apply(d,e)}}return function(){return c.apply(d,arguments)}}funct\",\n+    L\"ion ka(c,d,e){Function.prototype.bind&&-1!=Function.prototype.bind.toS\",\n+    L\"tring().indexOf(\\\"native code\\\")?ka=ia:ka=ja;return ka.apply(null,argu\",\n+    L\"ments)}\\nfunction la(c,d){var e=Array.prototype.slice.call(arguments,1\",\n+    L\");return function(){var d=e.slice();d.push.apply(d,arguments);return c\",\n+    L\".apply(this,d)}}function t(c,d){function e(){}e.prototype=d.prototype;\",\n+    L\"c.U=d.prototype;c.prototype=new e;c.prototype.constructor=c;c.S=functi\",\n+    L\"on(c,e,h){for(var f=Array(arguments.length-2),g=2;g<arguments.length;g\",\n+    L\"++)f[g-2]=arguments[g];return d.prototype[e].apply(c,f)}};var ma=windo\",\n+    L\"w;var na;var oa=String.prototype.trim?function(c){return c.trim()}:fun\",\n+    L\"ction(c){return c.replace(/^[\\\\s\\\\xa0]+|[\\\\s\\\\xa0]+$/g,\\\"\\\")};\\nfuncti\",\n+    L\"on pa(c,d){var e=0;c=oa(String(c)).split(\\\".\\\");d=oa(String(d)).split(\",\n+    L\"\\\".\\\");for(var f=Math.max(c.length,d.length),g=0;0==e&&g<f;g++){var h=\",\n+    L\"c[g]||\\\"\\\",k=d[g]||\\\"\\\";do{h=/(\\\\d*)(\\\\D*)(.*)/.exec(h)||[\\\"\\\",\\\"\\\",\\\"\",\n+    L\"\\\",\\\"\\\"];k=/(\\\\d*)(\\\\D*)(.*)/.exec(k)||[\\\"\\\",\\\"\\\",\\\"\\\",\\\"\\\"];if(0==h[0\",\n+    L\"].length&&0==k[0].length)break;e=qa(0==h[1].length?0:parseInt(h[1],10)\",\n+    L\",0==k[1].length?0:parseInt(k[1],10))||qa(0==h[2].length,0==k[2].length\",\n+    L\")||qa(h[2],k[2]);h=h[3];k=k[3]}while(0==e)}return e}function qa(c,d){r\",\n+    L\"eturn c<d?-1:c>d?1:0}\\nfunction ra(c){return String(c).replace(/\\\\-([a\",\n+    L\"-z])/g,function(c,e){return e.toUpperCase()})}function sa(c){isFinite(\",\n+    L\"c)&&(c=String(c));return q(c)?/^\\\\s*-?0x/i.test(c)?parseInt(c,16):pars\",\n+    L\"eInt(c,10):NaN};function ta(c,d){if(q(c))return q(d)&&1==d.length?c.in\",\n+    L\"dexOf(d,0):-1;for(var e=0;e<c.length;e++)if(e in c&&c[e]===d)return e;\",\n+    L\"return-1}function w(c,d){for(var e=c.length,f=q(c)?c.split(\\\"\\\"):c,g=0\",\n+    L\";g<e;g++)g in f&&d.call(void 0,f[g],g,c)}function ua(c,d){for(var e=c.\",\n+    L\"length,f=[],g=0,h=q(c)?c.split(\\\"\\\"):c,k=0;k<e;k++)if(k in h){var m=h[\",\n+    L\"k];d.call(void 0,m,k,c)&&(f[g++]=m)}return f}function va(c,d,e){var f=\",\n+    L\"e;w(c,function(e,h){f=d.call(void 0,f,e,h,c)});return f}\\nfunction wa(\",\n+    L\"c,d){for(var e=c.length,f=q(c)?c.split(\\\"\\\"):c,g=0;g<e;g++)if(g in f&&\",\n+    L\"d.call(void 0,f[g],g,c))return!0;return!1}function xa(c,d){for(var e=c\",\n+    L\".length,f=q(c)?c.split(\\\"\\\"):c,g=0;g<e;g++)if(g in f&&!d.call(void 0,f\",\n+    L\"[g],g,c))return!1;return!0}function ya(c,d){a:{for(var e=c.length,f=q(\",\n+    L\"c)?c.split(\\\"\\\"):c,g=0;g<e;g++)if(g in f&&d.call(void 0,f[g],g,c)){d=g\",\n+    L\";break a}d=-1}return 0>d?null:q(c)?c.charAt(d):c[d]}function za(c){ret\",\n+    L\"urn Array.prototype.concat.apply([],arguments)}\\nfunction Aa(c,d,e){re\",\n+    L\"turn 2>=arguments.length?Array.prototype.slice.call(c,d):Array.prototy\",\n+    L\"pe.slice.call(c,d,e)};var Ca={aliceblue:\\\"#f0f8ff\\\",antiquewhite:\\\"#fa\",\n+    L\"ebd7\\\",aqua:\\\"#00ffff\\\",aquamarine:\\\"#7fffd4\\\",azure:\\\"#f0ffff\\\",beige\",\n+    L\":\\\"#f5f5dc\\\",bisque:\\\"#ffe4c4\\\",black:\\\"#000000\\\",blanchedalmond:\\\"#ff\",\n+    L\"ebcd\\\",blue:\\\"#0000ff\\\",blueviolet:\\\"#8a2be2\\\",brown:\\\"#a52a2a\\\",burly\",\n+    L\"wood:\\\"#deb887\\\",cadetblue:\\\"#5f9ea0\\\",chartreuse:\\\"#7fff00\\\",chocolat\",\n+    L\"e:\\\"#d2691e\\\",coral:\\\"#ff7f50\\\",cornflowerblue:\\\"#6495ed\\\",cornsilk:\\\"\",\n+    L\"#fff8dc\\\",crimson:\\\"#dc143c\\\",cyan:\\\"#00ffff\\\",darkblue:\\\"#00008b\\\",da\",\n+    L\"rkcyan:\\\"#008b8b\\\",darkgoldenrod:\\\"#b8860b\\\",darkgray:\\\"#a9a9a9\\\",dark\",\n+    L\"green:\\\"#006400\\\",\\ndarkgrey:\\\"#a9a9a9\\\",darkkhaki:\\\"#bdb76b\\\",darkmag\",\n+    L\"enta:\\\"#8b008b\\\",darkolivegreen:\\\"#556b2f\\\",darkorange:\\\"#ff8c00\\\",dar\",\n+    L\"korchid:\\\"#9932cc\\\",darkred:\\\"#8b0000\\\",darksalmon:\\\"#e9967a\\\",darksea\",\n+    L\"green:\\\"#8fbc8f\\\",darkslateblue:\\\"#483d8b\\\",darkslategray:\\\"#2f4f4f\\\",\",\n+    L\"darkslategrey:\\\"#2f4f4f\\\",darkturquoise:\\\"#00ced1\\\",darkviolet:\\\"#9400\",\n+    L\"d3\\\",deeppink:\\\"#ff1493\\\",deepskyblue:\\\"#00bfff\\\",dimgray:\\\"#696969\\\",\",\n+    L\"dimgrey:\\\"#696969\\\",dodgerblue:\\\"#1e90ff\\\",firebrick:\\\"#b22222\\\",flora\",\n+    L\"lwhite:\\\"#fffaf0\\\",forestgreen:\\\"#228b22\\\",fuchsia:\\\"#ff00ff\\\",gainsbo\",\n+    L\"ro:\\\"#dcdcdc\\\",\\nghostwhite:\\\"#f8f8ff\\\",gold:\\\"#ffd700\\\",goldenrod:\\\"#\",\n+    L\"daa520\\\",gray:\\\"#808080\\\",green:\\\"#008000\\\",greenyellow:\\\"#adff2f\\\",gr\",\n+    L\"ey:\\\"#808080\\\",honeydew:\\\"#f0fff0\\\",hotpink:\\\"#ff69b4\\\",indianred:\\\"#c\",\n+    L\"d5c5c\\\",indigo:\\\"#4b0082\\\",ivory:\\\"#fffff0\\\",khaki:\\\"#f0e68c\\\",lavende\",\n+    L\"r:\\\"#e6e6fa\\\",lavenderblush:\\\"#fff0f5\\\",lawngreen:\\\"#7cfc00\\\",lemonchi\",\n+    L\"ffon:\\\"#fffacd\\\",lightblue:\\\"#add8e6\\\",lightcoral:\\\"#f08080\\\",lightcya\",\n+    L\"n:\\\"#e0ffff\\\",lightgoldenrodyellow:\\\"#fafad2\\\",lightgray:\\\"#d3d3d3\\\",l\",\n+    L\"ightgreen:\\\"#90ee90\\\",lightgrey:\\\"#d3d3d3\\\",lightpink:\\\"#ffb6c1\\\",ligh\",\n+    L\"tsalmon:\\\"#ffa07a\\\",\\nlightseagreen:\\\"#20b2aa\\\",lightskyblue:\\\"#87cefa\",\n+    L\"\\\",lightslategray:\\\"#778899\\\",lightslategrey:\\\"#778899\\\",lightsteelblu\",\n+    L\"e:\\\"#b0c4de\\\",lightyellow:\\\"#ffffe0\\\",lime:\\\"#00ff00\\\",limegreen:\\\"#32\",\n+    L\"cd32\\\",linen:\\\"#faf0e6\\\",magenta:\\\"#ff00ff\\\",maroon:\\\"#800000\\\",medium\",\n+    L\"aquamarine:\\\"#66cdaa\\\",mediumblue:\\\"#0000cd\\\",mediumorchid:\\\"#ba55d3\\\"\",\n+    L\",mediumpurple:\\\"#9370db\\\",mediumseagreen:\\\"#3cb371\\\",mediumslateblue:\",\n+    L\"\\\"#7b68ee\\\",mediumspringgreen:\\\"#00fa9a\\\",mediumturquoise:\\\"#48d1cc\\\",\",\n+    L\"mediumvioletred:\\\"#c71585\\\",midnightblue:\\\"#191970\\\",mintcream:\\\"#f5ff\",\n+    L\"fa\\\",mistyrose:\\\"#ffe4e1\\\",\\nmoccasin:\\\"#ffe4b5\\\",navajowhite:\\\"#ffdea\",\n+    L\"d\\\",navy:\\\"#000080\\\",oldlace:\\\"#fdf5e6\\\",olive:\\\"#808000\\\",olivedrab:\",\n+    L\"\\\"#6b8e23\\\",orange:\\\"#ffa500\\\",orangered:\\\"#ff4500\\\",orchid:\\\"#da70d6\",\n+    L\"\\\",palegoldenrod:\\\"#eee8aa\\\",palegreen:\\\"#98fb98\\\",paleturquoise:\\\"#af\",\n+    L\"eeee\\\",palevioletred:\\\"#db7093\\\",papayawhip:\\\"#ffefd5\\\",peachpuff:\\\"#f\",\n+    L\"fdab9\\\",peru:\\\"#cd853f\\\",pink:\\\"#ffc0cb\\\",plum:\\\"#dda0dd\\\",powderblue:\",\n+    L\"\\\"#b0e0e6\\\",purple:\\\"#800080\\\",red:\\\"#ff0000\\\",rosybrown:\\\"#bc8f8f\\\",r\",\n+    L\"oyalblue:\\\"#4169e1\\\",saddlebrown:\\\"#8b4513\\\",salmon:\\\"#fa8072\\\",sandyb\",\n+    L\"rown:\\\"#f4a460\\\",seagreen:\\\"#2e8b57\\\",\\nseashell:\\\"#fff5ee\\\",sienna:\\\"\",\n+    L\"#a0522d\\\",silver:\\\"#c0c0c0\\\",skyblue:\\\"#87ceeb\\\",slateblue:\\\"#6a5acd\\\"\",\n+    L\",slategray:\\\"#708090\\\",slategrey:\\\"#708090\\\",snow:\\\"#fffafa\\\",springgr\",\n+    L\"een:\\\"#00ff7f\\\",steelblue:\\\"#4682b4\\\",tan:\\\"#d2b48c\\\",teal:\\\"#008080\\\"\",\n+    L\",thistle:\\\"#d8bfd8\\\",tomato:\\\"#ff6347\\\",turquoise:\\\"#40e0d0\\\",violet:\",\n+    L\"\\\"#ee82ee\\\",wheat:\\\"#f5deb3\\\",white:\\\"#ffffff\\\",whitesmoke:\\\"#f5f5f5\\\"\",\n+    L\",yellow:\\\"#ffff00\\\",yellowgreen:\\\"#9acd32\\\"};var Da=\\\"backgroundColor \",\n+    L\"borderTopColor borderRightColor borderBottomColor borderLeftColor colo\",\n+    L\"r outlineColor\\\".split(\\\" \\\"),Ea=/#([0-9a-fA-F])([0-9a-fA-F])([0-9a-fA\",\n+    L\"-F])/,Fa=/^#(?:[0-9a-f]{3}){1,2}$/i,Ga=/^(?:rgba)?\\\\((\\\\d{1,3}),\\\\s?(\",\n+    L\"\\\\d{1,3}),\\\\s?(\\\\d{1,3}),\\\\s?(0|1|0\\\\.\\\\d*)\\\\)$/i,Ha=/^(?:rgb)?\\\\((0|[\",\n+    L\"1-9]\\\\d{0,2}),\\\\s?(0|[1-9]\\\\d{0,2}),\\\\s?(0|[1-9]\\\\d{0,2})\\\\)$/i;functi\",\n+    L\"on x(c,d){this.code=c;this.a=y[c]||Ia;this.message=d||\\\"\\\";c=this.a.re\",\n+    L\"place(/((?:^|\\\\s+)[a-z])/g,function(c){return c.toUpperCase().replace(\",\n+    L\"/^[\\\\s\\\\xa0]+/g,\\\"\\\")});d=c.length-5;if(0>d||c.indexOf(\\\"Error\\\",d)!=d\",\n+    L\")c+=\\\"Error\\\";this.name=c;c=Error(this.message);c.name=this.name;this.\",\n+    L\"stack=c.stack||\\\"\\\"}t(x,Error);var Ia=\\\"unknown error\\\",y={15:\\\"elemen\",\n+    L\"t not selectable\\\",11:\\\"element not visible\\\"};y[31]=Ia;y[30]=Ia;y[24]\",\n+    L\"=\\\"invalid cookie domain\\\";y[29]=\\\"invalid element coordinates\\\";y[12]\",\n+    L\"=\\\"invalid element state\\\";\\ny[32]=\\\"invalid selector\\\";y[51]=\\\"invali\",\n+    L\"d selector\\\";y[52]=\\\"invalid selector\\\";y[17]=\\\"javascript error\\\";y[4\",\n+    L\"05]=\\\"unsupported operation\\\";y[34]=\\\"move target out of bounds\\\";y[27\",\n+    L\"]=\\\"no such alert\\\";y[7]=\\\"no such element\\\";y[8]=\\\"no such frame\\\";y[\",\n+    L\"23]=\\\"no such window\\\";y[28]=\\\"script timeout\\\";y[33]=\\\"session not cr\",\n+    L\"eated\\\";y[10]=\\\"stale element reference\\\";y[21]=\\\"timeout\\\";y[25]=\\\"un\",\n+    L\"able to set cookie\\\";y[26]=\\\"unexpected alert open\\\";y[13]=Ia;y[9]=\\\"u\",\n+    L\"nknown command\\\";x.prototype.toString=function(){return this.name+\\\": \",\n+    L\"\\\"+this.message};var Ja;a:{var Ka=ba.navigator;if(Ka){var La=Ka.userAg\",\n+    L\"ent;if(La){Ja=La;break a}}Ja=\\\"\\\"};function Ma(c,d){var e=Na;return Ob\",\n+    L\"ject.prototype.hasOwnProperty.call(e,c)?e[c]:e[c]=d(c)};var Oa=-1!=Ja.\",\n+    L\"indexOf(\\\"Macintosh\\\"),Pa=-1!=Ja.indexOf(\\\"Windows\\\");function Qa(){va\",\n+    L\"r c=ba.document;return c?c.documentMode:void 0}var Ra,Sa=\\\"\\\",Ta=/\\\\b(\",\n+    L\"?:MSIE|rv)[: ]([^\\\\);]+)(\\\\)|;)/.exec(Ja);Ta&&(Sa=Ta?Ta[1]:\\\"\\\");var U\",\n+    L\"a=Qa();Ra=null!=Ua&&Ua>parseFloat(Sa)?String(Ua):Sa;var Na={};function\",\n+    L\" Va(c){return Ma(c,function(){return 0<=pa(Ra,c)})}function z(c){retur\",\n+    L\"n Number(Wa)>=c}var Xa;var Ya=ba.document;Xa=Ya?Qa()||(\\\"CSS1Compat\\\"=\",\n+    L\"=Ya.compatMode?parseInt(Ra,10):5):void 0;var Wa=Xa;var Za;try{Za=!!(ba\",\n+    L\".b||ba.a).extension}catch(c){Za=!1}var $a=Za,ab=!z(8),bb=z(9),cb=!z(9)\",\n+    L\",db=z(10),eb=-1!=Ja.indexOf(\\\"IEMobile\\\");function fb(c,d){this.x=n(c)\",\n+    L\"?c:0;this.y=n(d)?d:0}l=fb.prototype;l.toString=function(){return\\\"(\\\"+\",\n+    L\"this.x+\\\", \\\"+this.y+\\\")\\\"};l.ceil=function(){this.x=Math.ceil(this.x)\",\n+    L\";this.y=Math.ceil(this.y);return this};l.floor=function(){this.x=Math.\",\n+    L\"floor(this.x);this.y=Math.floor(this.y);return this};l.round=function(\",\n+    L\"){this.x=Math.round(this.x);this.y=Math.round(this.y);return this};l.s\",\n+    L\"cale=function(c,d){d=ca(d)?d:c;this.x*=c;this.y*=d;return this};functi\",\n+    L\"on gb(c,d){this.width=c;this.height=d}l=gb.prototype;l.toString=functi\",\n+    L\"on(){return\\\"(\\\"+this.width+\\\" x \\\"+this.height+\\\")\\\"};l.aspectRatio=f\",\n+    L\"unction(){return this.width/this.height};l.ceil=function(){this.width=\",\n+    L\"Math.ceil(this.width);this.height=Math.ceil(this.height);return this};\",\n+    L\"l.floor=function(){this.width=Math.floor(this.width);this.height=Math.\",\n+    L\"floor(this.height);return this};l.round=function(){this.width=Math.rou\",\n+    L\"nd(this.width);this.height=Math.round(this.height);return this};\\nl.sc\",\n+    L\"ale=function(c,d){d=ca(d)?d:c;this.width*=c;this.height*=d;return this\",\n+    L\"};function hb(c){return c.scrollingElement?c.scrollingElement:\\\"CSS1Co\",\n+    L\"mpat\\\"==c.compatMode?c.documentElement:c.body||c.documentElement}funct\",\n+    L\"ion ib(c){return c?c.parentWindow||c.defaultView:window}function jb(c)\",\n+    L\"{for(;c&&1!=c.nodeType;)c=c.previousSibling;return c}function kb(c,d){\",\n+    L\"if(!c||!d)return!1;if(c.contains&&1==d.nodeType)return c==d||c.contain\",\n+    L\"s(d);if(\\\"undefined\\\"!=typeof c.compareDocumentPosition)return c==d||!\",\n+    L\"!(c.compareDocumentPosition(d)&16);for(;d&&c!=d;)d=d.parentNode;return\",\n+    L\" d==c}\\nfunction lb(c,d){if(c==d)return 0;if(c.compareDocumentPosition\",\n+    L\")return c.compareDocumentPosition(d)&2?1:-1;if(!z(9)){if(9==c.nodeType\",\n+    L\")return-1;if(9==d.nodeType)return 1}if(\\\"sourceIndex\\\"in c||c.parentNo\",\n+    L\"de&&\\\"sourceIndex\\\"in c.parentNode){var e=1==c.nodeType,f=1==d.nodeTyp\",\n+    L\"e;if(e&&f)return c.sourceIndex-d.sourceIndex;var g=c.parentNode,h=d.pa\",\n+    L\"rentNode;return g==h?mb(c,d):!e&&kb(g,d)?-1*nb(c,d):!f&&kb(h,c)?nb(d,c\",\n+    L\"):(e?c.sourceIndex:g.sourceIndex)-(f?d.sourceIndex:h.sourceIndex)}f=A(\",\n+    L\"c);e=f.createRange();e.selectNode(c);\\ne.collapse(!0);c=f.createRange(\",\n+    L\");c.selectNode(d);c.collapse(!0);return e.compareBoundaryPoints(ba.Ran\",\n+    L\"ge.START_TO_END,c)}function nb(c,d){var e=c.parentNode;if(e==d)return-\",\n+    L\"1;for(;d.parentNode!=e;)d=d.parentNode;return mb(d,c)}function mb(c,d)\",\n+    L\"{for(;d=d.previousSibling;)if(d==c)return-1;return 1}function A(c){ret\",\n+    L\"urn 9==c.nodeType?c:c.ownerDocument||c.document}var ob={SCRIPT:1,STYLE\",\n+    L\":1,HEAD:1,IFRAME:1,OBJECT:1},pb={IMG:\\\" \\\",BR:\\\"\\\\n\\\"};\\nfunction qb(c\",\n+    L\",d,e){if(!(c.nodeName in ob))if(3==c.nodeType)e?d.push(String(c.nodeVa\",\n+    L\"lue).replace(/(\\\\r\\\\n|\\\\r|\\\\n)/g,\\\"\\\")):d.push(c.nodeValue);else if(c.\",\n+    L\"nodeName in pb)d.push(pb[c.nodeName]);else for(c=c.firstChild;c;)qb(c,\",\n+    L\"d,e),c=c.nextSibling}function sb(c,d,e){c&&!e&&(c=c.parentNode);for(e=\",\n+    L\"0;c;){if(d(c))return c;c=c.parentNode;e++}return null}function tb(c){t\",\n+    L\"his.a=c||ba.document||document}tb.prototype.getElementsByTagName=funct\",\n+    L\"ion(c,d){return(d||this.a).getElementsByTagName(String(c))};function v\",\n+    L\"b(c,d){d=d.toLowerCase();return\\\"style\\\"==d?wb(c.style.cssText):ab&&\\\"\",\n+    L\"value\\\"==d&&B(c,\\\"INPUT\\\")?c.value:cb&&!0===c[d]?String(c.getAttribute\",\n+    L\"(d)):(c=c.getAttributeNode(d))&&c.specified?c.value:null}var xb=/[;]+(\",\n+    L\"?=(?:(?:[^\\\"]*\\\"){2})*[^\\\"]*$)(?=(?:(?:[^']*'){2})*[^']*$)(?=(?:[^()]*\",\n+    L\"\\\\([^()]*\\\\))*[^()]*$)/;\\nfunction wb(c){var d=[];w(c.split(xb),functi\",\n+    L\"on(c){var e=c.indexOf(\\\":\\\");0<e&&(c=[c.slice(0,e),c.slice(e+1)],2==c.\",\n+    L\"length&&d.push(c[0].toLowerCase(),\\\":\\\",c[1],\\\";\\\"))});d=d.join(\\\"\\\");\",\n+    L\"return d=\\\";\\\"==d.charAt(d.length-1)?d:d+\\\";\\\"}function yb(c,d){ab&&\\\"\",\n+    L\"value\\\"==d&&B(c,\\\"OPTION\\\")&&null===vb(c,\\\"value\\\")?(d=[],qb(c,d,!1),c\",\n+    L\"=d.join(\\\"\\\")):c=c[d];return c}function B(c,d){d&&\\\"string\\\"!==typeof \",\n+    L\"d&&(d=d.toString());return!!c&&1==c.nodeType&&(!d||c.tagName.toUpperCa\",\n+    L\"se()==d)}\\nfunction zb(c){return B(c,\\\"OPTION\\\")?!0:B(c,\\\"INPUT\\\")?(c=\",\n+    L\"c.type.toLowerCase(),\\\"checkbox\\\"==c||\\\"radio\\\"==c):!1}function Ab(c){\",\n+    L\"if(!zb(c))throw new x(15,\\\"Element is not selectable\\\");var d=\\\"select\",\n+    L\"ed\\\",e=c.type&&c.type.toLowerCase();if(\\\"checkbox\\\"==e||\\\"radio\\\"==e)d\",\n+    L\"=\\\"checked\\\";return!!yb(c,d)};/*\\n\\n The MIT License\\n\\n Copyright (c)\",\n+    L\" 2007 Cybozu Labs, Inc.\\n Copyright (c) 2012 Google Inc.\\n\\n Permissio\",\n+    L\"n is hereby granted, free of charge, to any person obtaining a copy\\n \",\n+    L\"of this software and associated documentation files (the \\\"Software\\\")\",\n+    L\", to\\n deal in the Software without restriction, including without lim\",\n+    L\"itation the\\n rights to use, copy, modify, merge, publish, distribute,\",\n+    L\" sublicense, and/or\\n sell copies of the Software, and to permit perso\",\n+    L\"ns to whom the Software is\\n furnished to do so, subject to the follow\",\n+    L\"ing conditions:\\n\\n The above copyright notice and this permission not\",\n+    L\"ice shall be included in\\n all copies or substantial portions of the S\",\n+    L\"oftware.\\n\\n THE SOFTWARE IS PROVIDED \\\"AS IS\\\", WITHOUT WARRANTY OF A\",\n+    L\"NY KIND, EXPRESS OR\\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRAN\",\n+    L\"TIES OF MERCHANTABILITY,\\n FITNESS FOR A PARTICULAR PURPOSE AND NONINF\",\n+    L\"RINGEMENT. IN NO EVENT SHALL THE\\n AUTHORS OR COPYRIGHT HOLDERS BE LIA\",\n+    L\"BLE FOR ANY CLAIM, DAMAGES OR OTHER\\n LIABILITY, WHETHER IN AN ACTION \",\n+    L\"OF CONTRACT, TORT OR OTHERWISE, ARISING\\n FROM, OUT OF OR IN CONNECTIO\",\n+    L\"N WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS\\n IN THE SOFTWARE.\\n*\",\n+    L\"/\\nfunction Bb(c,d,e){this.a=c;this.b=d||1;this.f=e||1};var Cb=!z(9),D\",\n+    L\"b=!z(8);function Eb(c,d,e,f){this.a=c;this.nodeName=e;this.nodeValue=f\",\n+    L\";this.nodeType=2;this.parentNode=this.ownerElement=d}function Fb(c,d){\",\n+    L\"var e=Db&&\\\"href\\\"==d.nodeName?c.getAttribute(d.nodeName,2):d.nodeValu\",\n+    L\"e;return new Eb(d,c,d.nodeName,e)};function Gb(c){this.b=c;this.a=0}fu\",\n+    L\"nction Hb(c){c=c.match(Ib);for(var d=0;d<c.length;d++)Jb.test(c[d])&&c\",\n+    L\".splice(d,1);return new Gb(c)}var Ib=/\\\\$?(?:(?![0-9-\\\\.])(?:\\\\*|[\\\\w-\",\n+    L\"\\\\.]+):)?(?![0-9-\\\\.])(?:\\\\*|[\\\\w-\\\\.]+)|\\\\/\\\\/|\\\\.\\\\.|::|\\\\d+(?:\\\\.\",\n+    L\"\\\\d*)?|\\\\.\\\\d+|\\\"[^\\\"]*\\\"|'[^']*'|[!<>]=|\\\\s+|./g,Jb=/^\\\\s/;function C\",\n+    L\"(c,d){return c.b[c.a+(d||0)]}function D(c){return c.b[c.a++]}function \",\n+    L\"Kb(c){return c.b.length<=c.a};function E(c){var d=null,e=c.nodeType;1=\",\n+    L\"=e&&(d=c.textContent,d=void 0==d||null==d?c.innerText:d,d=void 0==d||n\",\n+    L\"ull==d?\\\"\\\":d);if(\\\"string\\\"!=typeof d)if(Cb&&\\\"title\\\"==c.nodeName.to\",\n+    L\"LowerCase()&&1==e)d=c.text;else if(9==e||1==e){c=9==e?c.documentElemen\",\n+    L\"t:c.firstChild;e=0;var f=[];for(d=\\\"\\\";c;){do 1!=c.nodeType&&(d+=c.nod\",\n+    L\"eValue),Cb&&\\\"title\\\"==c.nodeName.toLowerCase()&&(d+=c.text),f[e++]=c;\",\n+    L\"while(c=c.firstChild);for(;e&&!(c=f[--e].nextSibling););}}else d=c.nod\",\n+    L\"eValue;return d}\\nfunction Lb(c,d,e){if(null===d)return!0;try{if(!c.ge\",\n+    L\"tAttribute)return!1}catch(f){return!1}Db&&\\\"class\\\"==d&&(d=\\\"className\",\n+    L\"\\\");return null==e?!!c.getAttribute(d):c.getAttribute(d,2)==e}function\",\n+    L\" Mb(c,d,e,f,g){return(Cb?Nb:Ob).call(null,c,d,q(e)?e:null,q(f)?f:null,\",\n+    L\"g||new F)}\\nfunction Nb(c,d,e,f,g){if(c instanceof Pb||8==c.b||e&&null\",\n+    L\"===c.b){var h=d.all;if(!h)return g;c=Qb(c);if(\\\"*\\\"!=c&&(h=d.getElemen\",\n+    L\"tsByTagName(c),!h))return g;if(e){for(var k=[],m=0;d=h[m++];)Lb(d,e,f)\",\n+    L\"&&k.push(d);h=k}for(m=0;d=h[m++];)\\\"*\\\"==c&&\\\"!\\\"==d.tagName||g.add(d)\",\n+    L\";return g}Rb(c,d,e,f,g);return g}\\nfunction Ob(c,d,e,f,g){d.getElement\",\n+    L\"sByClassName&&f&&\\\"class\\\"==e?(d=d.getElementsByClassName(f),w(d,funct\",\n+    L\"ion(d){d.className==f&&c.a(d)&&g.add(d)})):c instanceof I?Rb(c,d,e,f,g\",\n+    L\"):d.getElementsByTagName&&(d=d.getElementsByTagName(c.f()),w(d,functio\",\n+    L\"n(c){Lb(c,e,f)&&g.add(c)}));return g}\\nfunction Sb(c,d,e,f,g){var h;if\",\n+    L\"((c instanceof Pb||8==c.b||e&&null===c.b)&&(h=d.childNodes)){var k=Qb(\",\n+    L\"c);if(\\\"*\\\"!=k&&(h=ua(h,function(c){return c.tagName&&c.tagName.toLowe\",\n+    L\"rCase()==k}),!h))return g;e&&(h=ua(h,function(c){return Lb(c,e,f)}));w\",\n+    L\"(h,function(c){\\\"*\\\"==k&&(\\\"!\\\"==c.tagName||\\\"*\\\"==k&&1!=c.nodeType)||\",\n+    L\"g.add(c)});return g}return Tb(c,d,e,f,g)}function Tb(c,d,e,f,g){for(d=\",\n+    L\"d.firstChild;d;d=d.nextSibling)Lb(d,e,f)&&c.a(d)&&g.add(d);return g}\\n\",\n+    L\"function Rb(c,d,e,f,g){for(d=d.firstChild;d;d=d.nextSibling)Lb(d,e,f)&\",\n+    L\"&c.a(d)&&g.add(d),Rb(c,d,e,f,g)}function Qb(c){if(c instanceof I){if(8\",\n+    L\"==c.b)return\\\"!\\\";if(null===c.b)return\\\"*\\\"}return c.f()};function F()\",\n+    L\"{this.b=this.a=null;this.u=0}function Vb(c){this.f=c;this.a=this.b=nul\",\n+    L\"l}function Wb(c,d){if(!c.a)return d;if(!d.a)return c;var e=c.a;d=d.a;f\",\n+    L\"or(var f=null,g,h=0;e&&d;){g=e.f;var k=d.f;g==k||g instanceof Eb&&k in\",\n+    L\"stanceof Eb&&g.a==k.a?(g=e,e=e.a,d=d.a):0<lb(e.f,d.f)?(g=d,d=d.a):(g=e\",\n+    L\",e=e.a);(g.b=f)?f.a=g:c.a=g;f=g;h++}for(g=e||d;g;)g.b=f,f=f.a=g,h++,g=\",\n+    L\"g.a;c.b=f;c.u=h;return c}function Xb(c,d){d=new Vb(d);d.a=c.a;c.b?c.a.\",\n+    L\"b=d:c.a=c.b=d;c.a=d;c.u++}\\nF.prototype.add=function(c){c=new Vb(c);c.\",\n+    L\"b=this.b;this.a?this.b.a=c:this.a=this.b=c;this.b=c;this.u++};function\",\n+    L\" Yb(c){return(c=c.a)?c.f:null}function Zb(c){return(c=Yb(c))?E(c):\\\"\\\"\",\n+    L\"}function $b(c,d){return new ac(c,!!d)}function ac(c,d){this.f=c;this.\",\n+    L\"b=(this.B=d)?c.b:c.a;this.a=null}function J(c){var d=c.b;if(null==d)re\",\n+    L\"turn null;var e=c.a=d;c.b=c.B?d.b:d.a;return e.f};function K(c){this.l\",\n+    L\"=c;this.b=this.j=!1;this.f=null}function L(c){return\\\"\\\\n  \\\"+c.toStri\",\n+    L\"ng().split(\\\"\\\\n\\\").join(\\\"\\\\n  \\\")}function cc(c,d){c.j=d}function dc\",\n+    L\"(c,d){c.b=d}function M(c,d){c=c.a(d);return c instanceof F?+Zb(c):+c}f\",\n+    L\"unction N(c,d){c=c.a(d);return c instanceof F?Zb(c):\\\"\\\"+c}function ec\",\n+    L\"(c,d){c=c.a(d);return c instanceof F?!!c.u:!!c};function fc(c,d,e){K.c\",\n+    L\"all(this,c.l);this.c=c;this.h=d;this.o=e;this.j=d.j||e.j;this.b=d.b||e\",\n+    L\".b;this.c==gc&&(e.b||e.j||4==e.l||0==e.l||!d.f?d.b||d.j||4==d.l||0==d.\",\n+    L\"l||!e.f||(this.f={name:e.f.name,C:d}):this.f={name:d.f.name,C:e})}t(fc\",\n+    L\",K);\\nfunction hc(c,d,e,f,g){d=d.a(f);e=e.a(f);var h;if(d instanceof F\",\n+    L\"&&e instanceof F){d=$b(d);for(f=J(d);f;f=J(d))for(g=$b(e),h=J(g);h;h=J\",\n+    L\"(g))if(c(E(f),E(h)))return!0;return!1}if(d instanceof F||e instanceof \",\n+    L\"F){d instanceof F?(g=d,f=e):(g=e,f=d);h=$b(g);for(var k=typeof f,m=J(h\",\n+    L\");m;m=J(h)){switch(k){case \\\"number\\\":m=+E(m);break;case \\\"boolean\\\":m\",\n+    L\"=!!E(m);break;case \\\"string\\\":m=E(m);break;default:throw Error(\\\"Illeg\",\n+    L\"al primitive type for comparison.\\\");}if(g==d&&c(m,f)||g==e&&c(f,m))re\",\n+    L\"turn!0}return!1}return g?\\n\\\"boolean\\\"==typeof d||\\\"boolean\\\"==typeof \",\n+    L\"e?c(!!d,!!e):\\\"number\\\"==typeof d||\\\"number\\\"==typeof e?c(+d,+e):c(d,e\",\n+    L\"):c(+d,+e)}fc.prototype.a=function(c){return this.c.v(this.h,this.o,c)\",\n+    L\"};fc.prototype.toString=function(){var c=\\\"Binary Expression: \\\"+this.\",\n+    L\"c;c+=L(this.h);return c+=L(this.o)};function ic(c,d,e,f){this.O=c;this\",\n+    L\".K=d;this.l=e;this.v=f}ic.prototype.toString=function(){return this.O}\",\n+    L\";var jc={};\\nfunction O(c,d,e,f){if(jc.hasOwnProperty(c))throw Error(\",\n+    L\"\\\"Binary operator already created: \\\"+c);c=new ic(c,d,e,f);return jc[c\",\n+    L\".toString()]=c}O(\\\"div\\\",6,1,function(c,d,e){return M(c,e)/M(d,e)});O(\",\n+    L\"\\\"mod\\\",6,1,function(c,d,e){return M(c,e)%M(d,e)});O(\\\"*\\\",6,1,functio\",\n+    L\"n(c,d,e){return M(c,e)*M(d,e)});O(\\\"+\\\",5,1,function(c,d,e){return M(c\",\n+    L\",e)+M(d,e)});O(\\\"-\\\",5,1,function(c,d,e){return M(c,e)-M(d,e)});O(\\\"<\",\n+    L\"\\\",4,2,function(c,d,e){return hc(function(c,d){return c<d},c,d,e)});\\n\",\n+    L\"O(\\\">\\\",4,2,function(c,d,e){return hc(function(c,d){return c>d},c,d,e)\",\n+    L\"});O(\\\"<=\\\",4,2,function(c,d,e){return hc(function(c,d){return c<=d},c\",\n+    L\",d,e)});O(\\\">=\\\",4,2,function(c,d,e){return hc(function(c,d){return c>\",\n+    L\"=d},c,d,e)});var gc=O(\\\"=\\\",3,2,function(c,d,e){return hc(function(c,d\",\n+    L\"){return c==d},c,d,e,!0)});O(\\\"!=\\\",3,2,function(c,d,e){return hc(func\",\n+    L\"tion(c,d){return c!=d},c,d,e,!0)});O(\\\"and\\\",2,2,function(c,d,e){retur\",\n+    L\"n ec(c,e)&&ec(d,e)});O(\\\"or\\\",1,2,function(c,d,e){return ec(c,e)||ec(d\",\n+    L\",e)});function kc(c,d){if(d.a.length&&4!=c.l)throw Error(\\\"Primary exp\",\n+    L\"ression must evaluate to nodeset if filter has predicate(s).\\\");K.call\",\n+    L\"(this,c.l);this.c=c;this.h=d;this.j=c.j;this.b=c.b}t(kc,K);kc.prototyp\",\n+    L\"e.a=function(c){c=this.c.a(c);return lc(this.h,c)};kc.prototype.toStri\",\n+    L\"ng=function(){var c=\\\"Filter:\\\"+L(this.c);return c+=L(this.h)};functio\",\n+    L\"n mc(c,d){if(d.length<c.J)throw Error(\\\"Function \\\"+c.s+\\\" expects at \",\n+    L\"least\\\"+c.J+\\\" arguments, \\\"+d.length+\\\" given\\\");if(null!==c.F&&d.len\",\n+    L\"gth>c.F)throw Error(\\\"Function \\\"+c.s+\\\" expects at most \\\"+c.F+\\\" arg\",\n+    L\"uments, \\\"+d.length+\\\" given\\\");c.N&&w(d,function(d,f){if(4!=d.l)throw\",\n+    L\" Error(\\\"Argument \\\"+f+\\\" to function \\\"+c.s+\\\" is not of type Nodeset\",\n+    L\": \\\"+d);});K.call(this,c.l);this.D=c;this.c=d;cc(this,c.j||wa(d,functi\",\n+    L\"on(c){return c.j}));dc(this,c.M&&!d.length||c.L&&!!d.length||wa(d,func\",\n+    L\"tion(c){return c.b}))}\\nt(mc,K);mc.prototype.a=function(c){return this\",\n+    L\".D.v.apply(null,za(c,this.c))};mc.prototype.toString=function(){var c=\",\n+    L\"\\\"Function: \\\"+this.D;if(this.c.length){var d=va(this.c,function(c,d){\",\n+    L\"return c+L(d)},\\\"Arguments:\\\");c+=L(d)}return c};function nc(c,d,e,f,g\",\n+    L\",h,k,m){this.s=c;this.l=d;this.j=e;this.M=f;this.L=!1;this.v=g;this.J=\",\n+    L\"h;this.F=n(k)?k:h;this.N=!!m}nc.prototype.toString=function(){return t\",\n+    L\"his.s};var oc={};\\nfunction P(c,d,e,f,g,h,k,m){if(oc.hasOwnProperty(c)\",\n+    L\")throw Error(\\\"Function already created: \\\"+c+\\\".\\\");oc[c]=new nc(c,d,\",\n+    L\"e,f,g,h,k,m)}P(\\\"boolean\\\",2,!1,!1,function(c,d){return ec(d,c)},1);P(\",\n+    L\"\\\"ceiling\\\",1,!1,!1,function(c,d){return Math.ceil(M(d,c))},1);P(\\\"con\",\n+    L\"cat\\\",3,!1,!1,function(c,d){return va(Aa(arguments,1),function(d,f){re\",\n+    L\"turn d+N(f,c)},\\\"\\\")},2,null);P(\\\"contains\\\",2,!1,!1,function(c,d,e){d\",\n+    L\"=N(d,c);c=N(e,c);return-1!=d.indexOf(c)},2);P(\\\"count\\\",1,!1,!1,functi\",\n+    L\"on(c,d){return d.a(c).u},1,1,!0);\\nP(\\\"false\\\",2,!1,!1,function(){retu\",\n+    L\"rn!1},0);P(\\\"floor\\\",1,!1,!1,function(c,d){return Math.floor(M(d,c))},\",\n+    L\"1);P(\\\"id\\\",4,!1,!1,function(c,d){function e(c){if(Cb){var d=g.all[c];\",\n+    L\"if(d){if(d.nodeType&&c==d.id)return d;if(d.length)return ya(d,function\",\n+    L\"(d){return c==d.id})}return null}return g.getElementById(c)}var f=c.a,\",\n+    L\"g=9==f.nodeType?f:f.ownerDocument;c=N(d,c).split(/\\\\s+/);var h=[];w(c,\",\n+    L\"function(c){c=e(c);!c||0<=ta(h,c)||h.push(c)});h.sort(lb);var k=new F;\",\n+    L\"w(h,function(c){k.add(c)});return k},1);\\nP(\\\"lang\\\",2,!1,!1,function(\",\n+    L\"){return!1},1);P(\\\"last\\\",1,!0,!1,function(c){if(1!=arguments.length)t\",\n+    L\"hrow Error(\\\"Function last expects ()\\\");return c.f},0);P(\\\"local-name\",\n+    L\"\\\",3,!1,!0,function(c,d){return(c=d?Yb(d.a(c)):c.a)?c.localName||c.nod\",\n+    L\"eName.toLowerCase():\\\"\\\"},0,1,!0);P(\\\"name\\\",3,!1,!0,function(c,d){ret\",\n+    L\"urn(c=d?Yb(d.a(c)):c.a)?c.nodeName.toLowerCase():\\\"\\\"},0,1,!0);P(\\\"nam\",\n+    L\"espace-uri\\\",3,!0,!1,function(){return\\\"\\\"},0,1,!0);\\nP(\\\"normalize-sp\",\n+    L\"ace\\\",3,!1,!0,function(c,d){return(d?N(d,c):E(c.a)).replace(/[\\\\s\\\\xa0\",\n+    L\"]+/g,\\\" \\\").replace(/^\\\\s+|\\\\s+$/g,\\\"\\\")},0,1);P(\\\"not\\\",2,!1,!1,funct\",\n+    L\"ion(c,d){return!ec(d,c)},1);P(\\\"number\\\",1,!1,!0,function(c,d){return \",\n+    L\"d?M(d,c):+E(c.a)},0,1);P(\\\"position\\\",1,!0,!1,function(c){return c.b},\",\n+    L\"0);P(\\\"round\\\",1,!1,!1,function(c,d){return Math.round(M(d,c))},1);P(\",\n+    L\"\\\"starts-with\\\",2,!1,!1,function(c,d,e){d=N(d,c);c=N(e,c);return 0==d.\",\n+    L\"lastIndexOf(c,0)},2);P(\\\"string\\\",3,!1,!0,function(c,d){return d?N(d,c\",\n+    L\"):E(c.a)},0,1);\\nP(\\\"string-length\\\",1,!1,!0,function(c,d){return(d?N(\",\n+    L\"d,c):E(c.a)).length},0,1);P(\\\"substring\\\",3,!1,!1,function(c,d,e,f){e=\",\n+    L\"M(e,c);if(isNaN(e)||Infinity==e||-Infinity==e)return\\\"\\\";f=f?M(f,c):In\",\n+    L\"finity;if(isNaN(f)||-Infinity===f)return\\\"\\\";e=Math.round(e)-1;var g=M\",\n+    L\"ath.max(e,0);c=N(d,c);return Infinity==f?c.substring(g):c.substring(g,\",\n+    L\"e+Math.round(f))},2,3);P(\\\"substring-after\\\",3,!1,!1,function(c,d,e){d\",\n+    L\"=N(d,c);c=N(e,c);e=d.indexOf(c);return-1==e?\\\"\\\":d.substring(e+c.lengt\",\n+    L\"h)},2);\\nP(\\\"substring-before\\\",3,!1,!1,function(c,d,e){d=N(d,c);c=N(e\",\n+    L\",c);c=d.indexOf(c);return-1==c?\\\"\\\":d.substring(0,c)},2);P(\\\"sum\\\",1,!\",\n+    L\"1,!1,function(c,d){c=$b(d.a(c));d=0;for(var e=J(c);e;e=J(c))d+=+E(e);r\",\n+    L\"eturn d},1,1,!0);P(\\\"translate\\\",3,!1,!1,function(c,d,e,f){d=N(d,c);e=\",\n+    L\"N(e,c);var g=N(f,c);c={};for(f=0;f<e.length;f++){var h=e.charAt(f);h i\",\n+    L\"n c||(c[h]=g.charAt(f))}e=\\\"\\\";for(f=0;f<d.length;f++)h=d.charAt(f),e+\",\n+    L\"=h in c?c[h]:h;return e},3);P(\\\"true\\\",2,!1,!1,function(){return!0},0)\",\n+    L\";function I(c,d){this.h=c;this.c=n(d)?d:null;this.b=null;switch(c){cas\",\n+    L\"e \\\"comment\\\":this.b=8;break;case \\\"text\\\":this.b=3;break;case \\\"proce\",\n+    L\"ssing-instruction\\\":this.b=7;break;case \\\"node\\\":break;default:throw E\",\n+    L\"rror(\\\"Unexpected argument\\\");}}function pc(c){return\\\"comment\\\"==c||\",\n+    L\"\\\"text\\\"==c||\\\"processing-instruction\\\"==c||\\\"node\\\"==c}I.prototype.a=\",\n+    L\"function(c){return null===this.b||this.b==c.nodeType};I.prototype.f=fu\",\n+    L\"nction(){return this.h};\\nI.prototype.toString=function(){var c=\\\"Kind\",\n+    L\" Test: \\\"+this.h;null===this.c||(c+=L(this.c));return c};function qc(c\",\n+    L\"){K.call(this,3);this.c=c.substring(1,c.length-1)}t(qc,K);qc.prototype\",\n+    L\".a=function(){return this.c};qc.prototype.toString=function(){return\\\"\",\n+    L\"Literal: \\\"+this.c};function Pb(c,d){this.s=c.toLowerCase();c=\\\"*\\\"==t\",\n+    L\"his.s?\\\"*\\\":\\\"http://www.w3.org/1999/xhtml\\\";this.c=d?d.toLowerCase():\",\n+    L\"c}Pb.prototype.a=function(c){var d=c.nodeType;if(1!=d&&2!=d)return!1;d\",\n+    L\"=n(c.localName)?c.localName:c.nodeName;return\\\"*\\\"!=this.s&&this.s!=d.\",\n+    L\"toLowerCase()?!1:\\\"*\\\"==this.c?!0:this.c==(c.namespaceURI?c.namespaceU\",\n+    L\"RI.toLowerCase():\\\"http://www.w3.org/1999/xhtml\\\")};Pb.prototype.f=fun\",\n+    L\"ction(){return this.s};\\nPb.prototype.toString=function(){return\\\"Name\",\n+    L\" Test: \\\"+(\\\"http://www.w3.org/1999/xhtml\\\"==this.c?\\\"\\\":this.c+\\\":\\\")\",\n+    L\"+this.s};function rc(c){K.call(this,1);this.c=c}t(rc,K);rc.prototype.a\",\n+    L\"=function(){return this.c};rc.prototype.toString=function(){return\\\"Nu\",\n+    L\"mber: \\\"+this.c};function sc(c,d){K.call(this,c.l);this.h=c;this.c=d;t\",\n+    L\"his.j=c.j;this.b=c.b;1==this.c.length&&(c=this.c[0],c.w||c.c!=tc||(c=c\",\n+    L\".o,\\\"*\\\"!=c.f()&&(this.f={name:c.f(),C:null})))}t(sc,K);function uc(){\",\n+    L\"K.call(this,4)}t(uc,K);uc.prototype.a=function(c){var d=new F;c=c.a;9=\",\n+    L\"=c.nodeType?d.add(c):d.add(c.ownerDocument);return d};uc.prototype.toS\",\n+    L\"tring=function(){return\\\"Root Helper Expression\\\"};function vc(){K.cal\",\n+    L\"l(this,4)}t(vc,K);vc.prototype.a=function(c){var d=new F;d.add(c.a);re\",\n+    L\"turn d};vc.prototype.toString=function(){return\\\"Context Helper Expres\",\n+    L\"sion\\\"};\\nfunction wc(c){return\\\"/\\\"==c||\\\"//\\\"==c}sc.prototype.a=func\",\n+    L\"tion(c){var d=this.h.a(c);if(!(d instanceof F))throw Error(\\\"Filter ex\",\n+    L\"pression must evaluate to nodeset.\\\");c=this.c;for(var e=0,f=c.length;\",\n+    L\"e<f&&d.u;e++){var g=c[e],h=$b(d,g.c.B);if(g.j||g.c!=xc)if(g.j||g.c!=yc\",\n+    L\"){var k=J(h);for(d=g.a(new Bb(k));null!=(k=J(h));)k=g.a(new Bb(k)),d=W\",\n+    L\"b(d,k)}else k=J(h),d=g.a(new Bb(k));else{for(k=J(h);(d=J(h))&&(!k.cont\",\n+    L\"ains||k.contains(d))&&d.compareDocumentPosition(k)&8;k=d);d=g.a(new Bb\",\n+    L\"(k))}}return d};\\nsc.prototype.toString=function(){var c=\\\"Path Expres\",\n+    L\"sion:\\\"+L(this.h);if(this.c.length){var d=va(this.c,function(c,d){retu\",\n+    L\"rn c+L(d)},\\\"Steps:\\\");c+=L(d)}return c};function zc(c,d){this.a=c;thi\",\n+    L\"s.B=!!d}\\nfunction lc(c,d,e){for(e=e||0;e<c.a.length;e++)for(var f=c.a\",\n+    L\"[e],g=$b(d),h=d.u,k,m=0;k=J(g);m++){var u=c.B?h-m:m+1;k=f.a(new Bb(k,u\",\n+    L\",h));if(\\\"number\\\"==typeof k)u=u==k;else if(\\\"string\\\"==typeof k||\\\"bo\",\n+    L\"olean\\\"==typeof k)u=!!k;else if(k instanceof F)u=0<k.u;else throw Erro\",\n+    L\"r(\\\"Predicate.evaluate returned an unexpected type.\\\");if(!u){u=g;k=u.\",\n+    L\"f;var r=u.a;if(!r)throw Error(\\\"Next must be called at least once befo\",\n+    L\"re remove.\\\");var p=r.b;r=r.a;p?p.a=r:k.a=r;r?r.b=p:k.b=p;k.u--;u.a=nu\",\n+    L\"ll}}return d}\\nzc.prototype.toString=function(){return va(this.a,funct\",\n+    L\"ion(c,d){return c+L(d)},\\\"Predicates:\\\")};function Ac(c,d,e,f){K.call(\",\n+    L\"this,4);this.c=c;this.o=d;this.h=e||new zc([]);this.w=!!f;d=this.h;d=0\",\n+    L\"<d.a.length?d.a[0].f:null;c.R&&d&&(c=d.name,c=Cb?c.toLowerCase():c,thi\",\n+    L\"s.f={name:c,C:d.C});a:{c=this.h;for(d=0;d<c.a.length;d++)if(e=c.a[d],e\",\n+    L\".j||1==e.l||0==e.l){c=!0;break a}c=!1}this.j=c}t(Ac,K);\\nAc.prototype.\",\n+    L\"a=function(c){var d=c.a,e=this.f,f=null,g=null,h=0;e&&(f=e.name,g=e.C?\",\n+    L\"N(e.C,c):null,h=1);if(this.w)if(this.j||this.c!=Bc)if(d=$b((new Ac(Cc,\",\n+    L\"new I(\\\"node\\\"))).a(c)),e=J(d))for(c=this.v(e,f,g,h);null!=(e=J(d));)c\",\n+    L\"=Wb(c,this.v(e,f,g,h));else c=new F;else c=Mb(this.o,d,f,g),c=lc(this.\",\n+    L\"h,c,h);else c=this.v(c.a,f,g,h);return c};Ac.prototype.v=function(c,d,\",\n+    L\"e,f){c=this.c.D(this.o,c,d,e);return c=lc(this.h,c,f)};\\nAc.prototype.\",\n+    L\"toString=function(){var c=\\\"Step:\\\"+L(\\\"Operator: \\\"+(this.w?\\\"//\\\":\\\"\",\n+    L\"/\\\"));this.c.s&&(c+=L(\\\"Axis: \\\"+this.c));c+=L(this.o);if(this.h.a.len\",\n+    L\"gth){var d=va(this.h.a,function(c,d){return c+L(d)},\\\"Predicates:\\\");c\",\n+    L\"+=L(d)}return c};function Dc(c,d,e,f){this.s=c;this.D=d;this.B=e;this.\",\n+    L\"R=f}Dc.prototype.toString=function(){return this.s};var Ec={};function\",\n+    L\" Q(c,d,e,f){if(Ec.hasOwnProperty(c))throw Error(\\\"Axis already created\",\n+    L\": \\\"+c);d=new Dc(c,d,e,!!f);return Ec[c]=d}\\nQ(\\\"ancestor\\\",function(c\",\n+    L\",d){for(var e=new F;d=d.parentNode;)c.a(d)&&Xb(e,d);return e},!0);Q(\\\"\",\n+    L\"ancestor-or-self\\\",function(c,d){var e=new F;do c.a(d)&&Xb(e,d);while(\",\n+    L\"d=d.parentNode);return e},!0);\\nvar tc=Q(\\\"attribute\\\",function(c,d){v\",\n+    L\"ar e=new F,f=c.f();if(\\\"style\\\"==f&&Cb&&d.style)return e.add(new Eb(d.\",\n+    L\"style,d,\\\"style\\\",d.style.cssText)),e;var g=d.attributes;if(g)if(c ins\",\n+    L\"tanceof I&&null===c.b||\\\"*\\\"==f)for(c=0;f=g[c];c++)Cb?f.nodeValue&&e.a\",\n+    L\"dd(Fb(d,f)):e.add(f);else(f=g.getNamedItem(f))&&(Cb?f.nodeValue&&e.add\",\n+    L\"(Fb(d,f)):e.add(f));return e},!1),Bc=Q(\\\"child\\\",function(c,d,e,f,g){r\",\n+    L\"eturn(Cb?Sb:Tb).call(null,c,d,q(e)?e:null,q(f)?f:null,g||new F)},!1,!0\",\n+    L\");Q(\\\"descendant\\\",Mb,!1,!0);\\nvar Cc=Q(\\\"descendant-or-self\\\",functio\",\n+    L\"n(c,d,e,f){var g=new F;Lb(d,e,f)&&c.a(d)&&g.add(d);return Mb(c,d,e,f,g\",\n+    L\")},!1,!0),xc=Q(\\\"following\\\",function(c,d,e,f){var g=new F;do for(var \",\n+    L\"h=d;h=h.nextSibling;)Lb(h,e,f)&&c.a(h)&&g.add(h),g=Mb(c,h,e,f,g);while\",\n+    L\"(d=d.parentNode);return g},!1,!0);Q(\\\"following-sibling\\\",function(c,d\",\n+    L\"){for(var e=new F;d=d.nextSibling;)c.a(d)&&e.add(d);return e},!1);Q(\\\"\",\n+    L\"namespace\\\",function(){return new F},!1);\\nvar Fc=Q(\\\"parent\\\",functio\",\n+    L\"n(c,d){var e=new F;if(9==d.nodeType)return e;if(2==d.nodeType)return e\",\n+    L\".add(d.ownerElement),e;d=d.parentNode;c.a(d)&&e.add(d);return e},!1),y\",\n+    L\"c=Q(\\\"preceding\\\",function(c,d,e,f){var g=new F,h=[];do h.unshift(d);w\",\n+    L\"hile(d=d.parentNode);for(var k=1,m=h.length;k<m;k++){var u=[];for(d=h[\",\n+    L\"k];d=d.previousSibling;)u.unshift(d);for(var r=0,p=u.length;r<p;r++)d=\",\n+    L\"u[r],Lb(d,e,f)&&c.a(d)&&g.add(d),g=Mb(c,d,e,f,g)}return g},!0,!0);\\nQ(\",\n+    L\"\\\"preceding-sibling\\\",function(c,d){for(var e=new F;d=d.previousSiblin\",\n+    L\"g;)c.a(d)&&Xb(e,d);return e},!0);var Gc=Q(\\\"self\\\",function(c,d){var e\",\n+    L\"=new F;c.a(d)&&e.add(d);return e},!1);function Hc(c){K.call(this,1);th\",\n+    L\"is.c=c;this.j=c.j;this.b=c.b}t(Hc,K);Hc.prototype.a=function(c){return\",\n+    L\"-M(this.c,c)};Hc.prototype.toString=function(){return\\\"Unary Expressio\",\n+    L\"n: -\\\"+L(this.c)};function Ic(c){K.call(this,4);this.c=c;cc(this,wa(th\",\n+    L\"is.c,function(c){return c.j}));dc(this,wa(this.c,function(c){return c.\",\n+    L\"b}))}t(Ic,K);Ic.prototype.a=function(c){var d=new F;w(this.c,function(\",\n+    L\"e){e=e.a(c);if(!(e instanceof F))throw Error(\\\"Path expression must ev\",\n+    L\"aluate to NodeSet.\\\");d=Wb(d,e)});return d};Ic.prototype.toString=func\",\n+    L\"tion(){return va(this.c,function(c,d){return c+L(d)},\\\"Union Expressio\",\n+    L\"n:\\\")};function Jc(c,d){this.a=c;this.b=d}function Kc(c){for(var d,e=[\",\n+    L\"];;){R(c,\\\"Missing right hand side of binary expression.\\\");d=Lc(c);va\",\n+    L\"r f=D(c.a);if(!f)break;var g=(f=jc[f]||null)&&f.K;if(!g){c.a.a--;break\",\n+    L\"}for(;e.length&&g<=e[e.length-1].K;)d=new fc(e.pop(),e.pop(),d);e.push\",\n+    L\"(d,f)}for(;e.length;)d=new fc(e.pop(),e.pop(),d);return d}function R(c\",\n+    L\",d){if(Kb(c.a))throw Error(d);}function Mc(c,d){c=D(c.a);if(c!=d)throw\",\n+    L\" Error(\\\"Bad token, expected: \\\"+d+\\\" got: \\\"+c);}\\nfunction Nc(c){c=D\",\n+    L\"(c.a);if(\\\")\\\"!=c)throw Error(\\\"Bad token: \\\"+c);}function Oc(c){c=D(c\",\n+    L\".a);if(2>c.length)throw Error(\\\"Unclosed literal string\\\");return new \",\n+    L\"qc(c)}\\nfunction Pc(c){var d=[];if(wc(C(c.a))){var e=D(c.a);var f=C(c.\",\n+    L\"a);if(\\\"/\\\"==e&&(Kb(c.a)||\\\".\\\"!=f&&\\\"..\\\"!=f&&\\\"@\\\"!=f&&\\\"*\\\"!=f&&!/(\",\n+    L\"?![0-9])[\\\\w]/.test(f)))return new uc;f=new uc;R(c,\\\"Missing next loca\",\n+    L\"tion step.\\\");e=Qc(c,e);d.push(e)}else{a:{e=C(c.a);f=e.charAt(0);switc\",\n+    L\"h(f){case \\\"$\\\":throw Error(\\\"Variable reference not allowed in HTML X\",\n+    L\"Path\\\");case \\\"(\\\":D(c.a);e=Kc(c);R(c,'unclosed \\\"(\\\"');Mc(c,\\\")\\\");br\",\n+    L\"eak;case '\\\"':case \\\"'\\\":e=Oc(c);break;default:if(isNaN(+e))if(!pc(e)&\",\n+    L\"&/(?![0-9])[\\\\w]/.test(f)&&\\\"(\\\"==C(c.a,1)){e=D(c.a);\\ne=oc[e]||null;D\",\n+    L\"(c.a);for(f=[];\\\")\\\"!=C(c.a);){R(c,\\\"Missing function argument list.\\\"\",\n+    L\");f.push(Kc(c));if(\\\",\\\"!=C(c.a))break;D(c.a)}R(c,\\\"Unclosed function \",\n+    L\"argument list.\\\");Nc(c);e=new mc(e,f)}else{e=null;break a}else e=new r\",\n+    L\"c(+D(c.a))}\\\"[\\\"==C(c.a)&&(f=new zc(Rc(c)),e=new kc(e,f))}if(e)if(wc(C\",\n+    L\"(c.a)))f=e;else return e;else e=Qc(c,\\\"/\\\"),f=new vc,d.push(e)}for(;wc\",\n+    L\"(C(c.a));)e=D(c.a),R(c,\\\"Missing next location step.\\\"),e=Qc(c,e),d.pu\",\n+    L\"sh(e);return new sc(f,d)}\\nfunction Qc(c,d){if(\\\"/\\\"!=d&&\\\"//\\\"!=d)thr\",\n+    L\"ow Error('Step op should be \\\"/\\\" or \\\"//\\\"');if(\\\".\\\"==C(c.a)){var e=\",\n+    L\"new Ac(Gc,new I(\\\"node\\\"));D(c.a);return e}if(\\\"..\\\"==C(c.a))return e=\",\n+    L\"new Ac(Fc,new I(\\\"node\\\")),D(c.a),e;if(\\\"@\\\"==C(c.a)){var f=tc;D(c.a);\",\n+    L\"R(c,\\\"Missing attribute name\\\")}else if(\\\"::\\\"==C(c.a,1)){if(!/(?![0-9\",\n+    L\"])[\\\\w]/.test(C(c.a).charAt(0)))throw Error(\\\"Bad token: \\\"+D(c.a));va\",\n+    L\"r g=D(c.a);f=Ec[g]||null;if(!f)throw Error(\\\"No axis with name: \\\"+g);\",\n+    L\"D(c.a);R(c,\\\"Missing node name\\\")}else f=Bc;g=C(c.a);if(/(?![0-9])[\\\\w\",\n+    L\"\\\\*]/.test(g.charAt(0)))if(\\\"(\\\"==\\nC(c.a,1)){if(!pc(g))throw Error(\\\"\",\n+    L\"Invalid node type: \\\"+g);g=D(c.a);if(!pc(g))throw Error(\\\"Invalid type\",\n+    L\" name: \\\"+g);Mc(c,\\\"(\\\");R(c,\\\"Bad nodetype\\\");var h=C(c.a).charAt(0),\",\n+    L\"k=null;if('\\\"'==h||\\\"'\\\"==h)k=Oc(c);R(c,\\\"Bad nodetype\\\");Nc(c);g=new \",\n+    L\"I(g,k)}else if(g=D(c.a),h=g.indexOf(\\\":\\\"),-1==h)g=new Pb(g);else{k=g.\",\n+    L\"substring(0,h);if(\\\"*\\\"==k)var m=\\\"*\\\";else if(m=c.b(k),!m)throw Error\",\n+    L\"(\\\"Namespace prefix not declared: \\\"+k);g=g.substr(h+1);g=new Pb(g,m)}\",\n+    L\"else throw Error(\\\"Bad token: \\\"+D(c.a));c=new zc(Rc(c),f.B);return e|\",\n+    L\"|\\nnew Ac(f,g,c,\\\"//\\\"==d)}function Rc(c){for(var d=[];\\\"[\\\"==C(c.a);)\",\n+    L\"{D(c.a);R(c,\\\"Missing predicate expression.\\\");var e=Kc(c);d.push(e);R\",\n+    L\"(c,\\\"Unclosed predicate expression.\\\");Mc(c,\\\"]\\\")}return d}function L\",\n+    L\"c(c){if(\\\"-\\\"==C(c.a))return D(c.a),new Hc(Lc(c));var d=Pc(c);if(\\\"|\\\"\",\n+    L\"!=C(c.a))c=d;else{for(d=[d];\\\"|\\\"==D(c.a);)R(c,\\\"Missing next union lo\",\n+    L\"cation path.\\\"),d.push(Pc(c));c.a.a--;c=new Ic(d)}return c};function S\",\n+    L\"c(c){switch(c.nodeType){case 1:return la(Tc,c);case 9:return Sc(c.docu\",\n+    L\"mentElement);case 11:case 10:case 6:case 12:return Uc;default:return c\",\n+    L\".parentNode?Sc(c.parentNode):Uc}}function Uc(){return null}function Tc\",\n+    L\"(c,d){if(c.prefix==d)return c.namespaceURI||\\\"http://www.w3.org/1999/x\",\n+    L\"html\\\";var e=c.getAttributeNode(\\\"xmlns:\\\"+d);return e&&e.specified?e.\",\n+    L\"value||null:c.parentNode&&9!=c.parentNode.nodeType?Tc(c.parentNode,d):\",\n+    L\"null};function Vc(c,d){if(!c.length)throw Error(\\\"Empty XPath expressi\",\n+    L\"on.\\\");c=Hb(c);if(Kb(c))throw Error(\\\"Invalid XPath expression.\\\");d?f\",\n+    L\"a(d)||(d=ka(d.lookupNamespaceURI,d)):d=function(){return null};var e=K\",\n+    L\"c(new Jc(c,d));if(!Kb(c))throw Error(\\\"Bad token: \\\"+D(c));this.evalua\",\n+    L\"te=function(c,d){c=e.a(new Bb(c));return new S(c,d)}}\\nfunction S(c,d)\",\n+    L\"{if(0==d)if(c instanceof F)d=4;else if(\\\"string\\\"==typeof c)d=2;else i\",\n+    L\"f(\\\"number\\\"==typeof c)d=1;else if(\\\"boolean\\\"==typeof c)d=3;else thro\",\n+    L\"w Error(\\\"Unexpected evaluation result.\\\");if(2!=d&&1!=d&&3!=d&&!(c in\",\n+    L\"stanceof F))throw Error(\\\"value could not be converted to the specifie\",\n+    L\"d type\\\");this.resultType=d;switch(d){case 2:this.stringValue=c instan\",\n+    L\"ceof F?Zb(c):\\\"\\\"+c;break;case 1:this.numberValue=c instanceof F?+Zb(c\",\n+    L\"):+c;break;case 3:this.booleanValue=c instanceof F?0<c.u:!!c;break;cas\",\n+    L\"e 4:case 5:case 6:case 7:var e=\\n$b(c);var f=[];for(var g=J(e);g;g=J(e\",\n+    L\"))f.push(g instanceof Eb?g.a:g);this.snapshotLength=c.u;this.invalidIt\",\n+    L\"eratorState=!1;break;case 8:case 9:c=Yb(c);this.singleNodeValue=c inst\",\n+    L\"anceof Eb?c.a:c;break;default:throw Error(\\\"Unknown XPathResult type.\",\n+    L\"\\\");}var h=0;this.iterateNext=function(){if(4!=d&&5!=d)throw Error(\\\"i\",\n+    L\"terateNext called with wrong result type\\\");return h>=f.length?null:f[\",\n+    L\"h++]};this.snapshotItem=function(c){if(6!=d&&7!=d)throw Error(\\\"snapsh\",\n+    L\"otItem called with wrong result type\\\");return c>=f.length||\\n0>c?null\",\n+    L\":f[c]}}S.ANY_TYPE=0;S.NUMBER_TYPE=1;S.STRING_TYPE=2;S.BOOLEAN_TYPE=3;S\",\n+    L\".UNORDERED_NODE_ITERATOR_TYPE=4;S.ORDERED_NODE_ITERATOR_TYPE=5;S.UNORD\",\n+    L\"ERED_NODE_SNAPSHOT_TYPE=6;S.ORDERED_NODE_SNAPSHOT_TYPE=7;S.ANY_UNORDER\",\n+    L\"ED_NODE_TYPE=8;S.FIRST_ORDERED_NODE_TYPE=9;function Wc(c){this.lookupN\",\n+    L\"amespaceURI=Sc(c)}\\nfunction Xc(c,d){c=c||ba;var e=c.Document&&c.Docum\",\n+    L\"ent.prototype||c.document;if(!e.evaluate||d)c.XPathResult=S,e.evaluate\",\n+    L\"=function(c,d,e,k){return(new Vc(c,e)).evaluate(d,k)},e.createExpressi\",\n+    L\"on=function(c,d){return new Vc(c,d)},e.createNSResolver=function(c){re\",\n+    L\"turn new Wc(c)}}da(\\\"wgxpath.install\\\",Xc);var T={};T.G=function(){var\",\n+    L\" c={V:\\\"http://www.w3.org/2000/svg\\\"};return function(d){return c[d]||\",\n+    L\"null}}();\\nT.v=function(c,d,e){var f=A(c);if(!f.documentElement)return\",\n+    L\" null;Xc(ib(f));try{var g=f.createNSResolver?f.createNSResolver(f.docu\",\n+    L\"mentElement):T.G;if(!Va(7))return f.evaluate.call(f,d,c,g,e,null);if(z\",\n+    L\"(9)){for(var h={},k=f.getElementsByTagName(\\\"*\\\"),m=0;m<k.length;++m){\",\n+    L\"var u=k[m],r=u.namespaceURI;if(r&&!h[r]){var p=u.lookupPrefix(r);if(!p\",\n+    L\"){var v=r.match(\\\".*/(\\\\\\\\w+)/?$\\\");p=v?v[1]:\\\"xhtml\\\"}h[r]=p}}var G={\",\n+    L\"},H;for(H in h)G[h[H]]=H;g=function(c){return G[c]||null}}try{return f\",\n+    L\".evaluate(d,c,g,e,null)}catch(Ba){if(\\\"TypeError\\\"===\\nBa.name)return \",\n+    L\"g=f.createNSResolver?f.createNSResolver(f.documentElement):T.G,f.evalu\",\n+    L\"ate(d,c,g,e,null);throw Ba;}}catch(Ba){throw new x(32,\\\"Unable to loca\",\n+    L\"te an element with the xpath expression \\\"+d+\\\" because of the followi\",\n+    L\"ng error:\\\\n\\\"+Ba);}};T.H=function(c,d){if(!c||1!=c.nodeType)throw new\",\n+    L\" x(32,'The result of the xpath expression \\\"'+d+'\\\" is: '+c+\\\". It sho\",\n+    L\"uld be an element.\\\");};\\nT.P=function(c,d){var e=function(){var e=T.v\",\n+    L\"(d,c,9);return e?e.singleNodeValue||null:d.selectSingleNode?(e=A(d),e.\",\n+    L\"setProperty&&e.setProperty(\\\"SelectionLanguage\\\",\\\"XPath\\\"),d.selectSi\",\n+    L\"ngleNode(c)):null}();null===e||T.H(e,c);return e};\\nT.T=function(c,d){\",\n+    L\"var e=function(){var e=T.v(d,c,7);if(e){for(var g=e.snapshotLength,h=[\",\n+    L\"],k=0;k<g;++k)h.push(e.snapshotItem(k));return h}return d.selectNodes?\",\n+    L\"(e=A(d),e.setProperty&&e.setProperty(\\\"SelectionLanguage\\\",\\\"XPath\\\"),\",\n+    L\"d.selectNodes(c)):[]}();w(e,function(d){T.H(d,c)});return e};function \",\n+    L\"Zc(c,d,e,f){this.top=c;this.right=d;this.bottom=e;this.left=f}l=Zc.pro\",\n+    L\"totype;l.toString=function(){return\\\"(\\\"+this.top+\\\"t, \\\"+this.right+\",\n+    L\"\\\"r, \\\"+this.bottom+\\\"b, \\\"+this.left+\\\"l)\\\"};l.ceil=function(){this.t\",\n+    L\"op=Math.ceil(this.top);this.right=Math.ceil(this.right);this.bottom=Ma\",\n+    L\"th.ceil(this.bottom);this.left=Math.ceil(this.left);return this};l.flo\",\n+    L\"or=function(){this.top=Math.floor(this.top);this.right=Math.floor(this\",\n+    L\".right);this.bottom=Math.floor(this.bottom);this.left=Math.floor(this.\",\n+    L\"left);return this};\\nl.round=function(){this.top=Math.round(this.top);\",\n+    L\"this.right=Math.round(this.right);this.bottom=Math.round(this.bottom);\",\n+    L\"this.left=Math.round(this.left);return this};l.scale=function(c,d){d=c\",\n+    L\"a(d)?d:c;this.left*=c;this.right*=c;this.top*=d;this.bottom*=d;return \",\n+    L\"this};function U(c,d,e,f){this.left=c;this.top=d;this.width=e;this.hei\",\n+    L\"ght=f}l=U.prototype;l.toString=function(){return\\\"(\\\"+this.left+\\\", \\\"\",\n+    L\"+this.top+\\\" - \\\"+this.width+\\\"w x \\\"+this.height+\\\"h)\\\"};l.ceil=funct\",\n+    L\"ion(){this.left=Math.ceil(this.left);this.top=Math.ceil(this.top);this\",\n+    L\".width=Math.ceil(this.width);this.height=Math.ceil(this.height);return\",\n+    L\" this};l.floor=function(){this.left=Math.floor(this.left);this.top=Mat\",\n+    L\"h.floor(this.top);this.width=Math.floor(this.width);this.height=Math.f\",\n+    L\"loor(this.height);return this};\\nl.round=function(){this.left=Math.rou\",\n+    L\"nd(this.left);this.top=Math.round(this.top);this.width=Math.round(this\",\n+    L\".width);this.height=Math.round(this.height);return this};l.scale=funct\",\n+    L\"ion(c,d){d=ca(d)?d:c;this.left*=c;this.width*=c;this.top*=d;this.heigh\",\n+    L\"t*=d;return this};function $c(c,d){var e=A(c);return e.defaultView&&e.\",\n+    L\"defaultView.getComputedStyle&&(c=e.defaultView.getComputedStyle(c,null\",\n+    L\"))?c[d]||c.getPropertyValue(d)||\\\"\\\":\\\"\\\"}function ad(c){c=c?A(c):docu\",\n+    L\"ment;return z(9)||\\\"CSS1Compat\\\"==(c?new tb(A(c)):na||(na=new tb)).a.c\",\n+    L\"ompatMode?c.documentElement:c.body}\\nfunction bd(c){var d=c.offsetWidt\",\n+    L\"h,e=c.offsetHeight;if(!n(d)&&c.getBoundingClientRect){a:{try{var f=c.g\",\n+    L\"etBoundingClientRect()}catch(g){f={left:0,top:0,right:0,bottom:0};brea\",\n+    L\"k a}c.ownerDocument.body&&(c=c.ownerDocument,f.left-=c.documentElement\",\n+    L\".clientLeft+c.body.clientLeft,f.top-=c.documentElement.clientTop+c.bod\",\n+    L\"y.clientTop)}return new gb(f.right-f.left,f.bottom-f.top)}return new g\",\n+    L\"b(d,e)}var cd={thin:2,medium:4,thick:6};\\nfunction dd(c,d){if(\\\"none\\\"\",\n+    L\"==(c.currentStyle?c.currentStyle[d+\\\"Style\\\"]:null))return 0;var e=c.c\",\n+    L\"urrentStyle?c.currentStyle[d+\\\"Width\\\"]:null;if(e in cd)c=cd[e];else i\",\n+    L\"f(/^\\\\d+px?$/.test(e))c=parseInt(e,10);else{d=c.style.left;var f=c.run\",\n+    L\"timeStyle.left;c.runtimeStyle.left=c.currentStyle.left;c.style.left=e;\",\n+    L\"e=c.style.pixelLeft;c.style.left=d;c.runtimeStyle.left=f;c=+e}return c\",\n+    L\"};var ed=\\\"function\\\"===typeof ShadowRoot;function fd(c){a:{c=A(c);try\",\n+    L\"{var d=c&&c.activeElement;break a}catch(e){}d=null}return d&&\\\"undefin\",\n+    L\"ed\\\"===typeof d.nodeType?null:d}function gd(c){return hd(c)&&id(c)&&!0\",\n+    L\"}var jd=\\\"A AREA BUTTON INPUT LABEL SELECT TEXTAREA\\\".split(\\\" \\\");\\nf\",\n+    L\"unction kd(c){return wa(jd,function(d){return B(c,d)})||null!=vb(c,\\\"t\",\n+    L\"abindex\\\")&&0<=Number(yb(c,\\\"tabIndex\\\"))||((B(c,\\\"TEXTAREA\\\")?!0:B(c,\",\n+    L\"\\\"INPUT\\\")?0<=ta(md,c.type.toLowerCase()):nd(c)?!0:!1)||(B(c,\\\"INPUT\\\"\",\n+    L\")?\\\"file\\\"==c.type.toLowerCase():!1)||od(c,\\\"range\\\")||od(c,\\\"date\\\")|\",\n+    L\"|od(c,\\\"month\\\")||od(c,\\\"week\\\")||od(c,\\\"time\\\")||od(c,\\\"datetime-loca\",\n+    L\"l\\\")||od(c,\\\"color\\\"))&&!yb(c,\\\"readOnly\\\")}var pd=\\\"BUTTON INPUT OPTG\",\n+    L\"ROUP OPTION SELECT TEXTAREA\\\".split(\\\" \\\");\\nfunction id(c){return wa(\",\n+    L\"pd,function(d){return B(c,d)})?yb(c,\\\"disabled\\\")?!1:c.parentNode&&1==\",\n+    L\"c.parentNode.nodeType&&B(c,\\\"OPTGROUP\\\")||B(c,\\\"OPTION\\\")?id(c.parentN\",\n+    L\"ode):!sb(c,function(c){var d=c.parentNode;if(d&&B(d,\\\"FIELDSET\\\")&&yb(\",\n+    L\"d,\\\"disabled\\\")){if(!B(c,\\\"LEGEND\\\"))return!0;for(;c=n(c.previousEleme\",\n+    L\"ntSibling)?c.previousElementSibling:jb(c.previousSibling);)if(B(c,\\\"LE\",\n+    L\"GEND\\\"))return!0}return!1},!0):!0}var md=\\\"text search tel url email p\",\n+    L\"assword number\\\".split(\\\" \\\");\\nfunction od(c,d){return B(c,\\\"INPUT\\\")\",\n+    L\"?c.type.toLowerCase()==d:!1}function nd(c){function d(c){return\\\"inher\",\n+    L\"it\\\"==c.contentEditable?(c=qd(c))?d(c):!1:\\\"true\\\"==c.contentEditable}\",\n+    L\"return n(c.contentEditable)?d(c):!1}function qd(c){for(c=c.parentNode;\",\n+    L\"c&&1!=c.nodeType&&9!=c.nodeType&&11!=c.nodeType;)c=c.parentNode;return\",\n+    L\" B(c)?c:null}\\nfunction V(c,d){d=ra(d);if(\\\"float\\\"==d||\\\"cssFloat\\\"==\",\n+    L\"d||\\\"styleFloat\\\"==d)d=cb?\\\"styleFloat\\\":\\\"cssFloat\\\";c=$c(c,d)||rd(c,\",\n+    L\"d);if(null===c)c=null;else if(0<=ta(Da,d)){b:{var e=c.match(Ga);if(e){\",\n+    L\"d=Number(e[1]);var f=Number(e[2]),g=Number(e[3]);e=Number(e[4]);if(0<=\",\n+    L\"d&&255>=d&&0<=f&&255>=f&&0<=g&&255>=g&&0<=e&&1>=e){d=[d,f,g,e];break b\",\n+    L\"}}d=null}if(!d)b:{if(g=c.match(Ha))if(d=Number(g[1]),f=Number(g[2]),g=\",\n+    L\"Number(g[3]),0<=d&&255>=d&&0<=f&&255>=f&&0<=g&&255>=g){d=[d,f,g,1];bre\",\n+    L\"ak b}d=null}if(!d)b:{d=c.toLowerCase();\\nf=Ca[d.toLowerCase()];if(!f&&\",\n+    L\"(f=\\\"#\\\"==d.charAt(0)?d:\\\"#\\\"+d,4==f.length&&(f=f.replace(Ea,\\\"#$1$1$2\",\n+    L\"$2$3$3\\\")),!Fa.test(f))){d=null;break b}d=[parseInt(f.substr(1,2),16),\",\n+    L\"parseInt(f.substr(3,2),16),parseInt(f.substr(5,2),16),1]}c=d?\\\"rgba(\\\"\",\n+    L\"+d.join(\\\", \\\")+\\\")\\\":c}return c}function rd(c,d){var e=c.currentStyle\",\n+    L\"||c.style,f=e[d];!n(f)&&fa(e.getPropertyValue)&&(f=e.getPropertyValue(\",\n+    L\"d));return\\\"inherit\\\"!=f?n(f)?f:null:(c=qd(c))?rd(c,d):null}\\nfunction\",\n+    L\" sd(c,d,e){function f(c){var d=td(c);return 0<d.height&&0<d.width?!0:B\",\n+    L\"(c,\\\"PATH\\\")&&(0<d.height||0<d.width)?(c=V(c,\\\"stroke-width\\\"),!!c&&0<\",\n+    L\"parseInt(c,10)):\\\"hidden\\\"!=V(c,\\\"overflow\\\")&&wa(c.childNodes,functio\",\n+    L\"n(c){return 3==c.nodeType||B(c)&&f(c)})}function g(c){return ud(c)==W&\",\n+    L\"&xa(c.childNodes,function(c){return!B(c)||g(c)||!f(c)})}if(!B(c))throw\",\n+    L\" Error(\\\"Argument to isShown must be of type Element\\\");if(B(c,\\\"BODY\",\n+    L\"\\\"))return!0;var h=qd(c);if(h&&B(h,\\\"DETAILS\\\")&&!h.open&&!B(c,\\\"SUMMA\",\n+    L\"RY\\\"))return!1;if(B(c,\\n\\\"OPTION\\\")||B(c,\\\"OPTGROUP\\\"))return c=sb(c,f\",\n+    L\"unction(c){return B(c,\\\"SELECT\\\")}),!!c&&sd(c,!0,e);if(h=vd(c))return!\",\n+    L\"!h.I&&0<h.rect.width&&0<h.rect.height&&sd(h.I,d,e);if(B(c,\\\"INPUT\\\")&&\",\n+    L\"\\\"hidden\\\"==c.type.toLowerCase()||B(c,\\\"NOSCRIPT\\\"))return!1;h=V(c,\\\"v\",\n+    L\"isibility\\\");return\\\"collapse\\\"!=h&&\\\"hidden\\\"!=h&&e(c)&&(d||0!=wd(c))\",\n+    L\"&&f(c)?!g(c):!1}\\nfunction hd(c){function d(c){if(B(c)&&\\\"none\\\"==V(c,\",\n+    L\"\\\"display\\\"))return!1;var e;(e=c.parentNode)&&e.shadowRoot&&void 0!==c\",\n+    L\".assignedSlot?e=c.assignedSlot?c.assignedSlot.parentNode:null:c.getDes\",\n+    L\"tinationInsertionPoints&&(c=c.getDestinationInsertionPoints(),0<c.leng\",\n+    L\"th&&(e=c[c.length-1]));if(ed&&e instanceof ShadowRoot){if(e.host.shado\",\n+    L\"wRoot!==e)return!1;e=e.host}return!e||9!=e.nodeType&&11!=e.nodeType?e&\",\n+    L\"&d(e):!0}return sd(c,!0,d)}var W=\\\"hidden\\\";\\nfunction ud(c,d){functio\",\n+    L\"n e(c){function d(c){if(c==k)return!0;var d=V(c,\\\"display\\\");return 0=\",\n+    L\"=d.lastIndexOf(\\\"inline\\\",0)||\\\"contents\\\"==d||\\\"absolute\\\"==e&&\\\"stat\",\n+    L\"ic\\\"==V(c,\\\"position\\\")?!1:!0}var e=V(c,\\\"position\\\");if(\\\"fixed\\\"==e)\",\n+    L\"return r=!0,c==k?null:k;for(c=qd(c);c&&!d(c);)c=qd(c);return c}functio\",\n+    L\"n f(c){var d=c;if(\\\"visible\\\"==u)if(c==k&&m)d=m;else if(c==m)return{x:\",\n+    L\"\\\"visible\\\",y:\\\"visible\\\"};d={x:V(d,\\\"overflow-x\\\"),y:V(d,\\\"overflow-y\",\n+    L\"\\\")};c==k&&(d.x=\\\"visible\\\"==d.x?\\\"auto\\\":d.x,d.y=\\\"visible\\\"==d.y?\\\"a\",\n+    L\"uto\\\":d.y);return d}function g(c){if(c==\\nk){var d=(new tb(h)).a;c=hb(\",\n+    L\"d);d=d.parentWindow||d.defaultView;c=Va(\\\"10\\\")&&d.pageYOffset!=c.scro\",\n+    L\"llTop?new fb(c.scrollLeft,c.scrollTop):new fb(d.pageXOffset||c.scrollL\",\n+    L\"eft,d.pageYOffset||c.scrollTop)}else c=new fb(c.scrollLeft,c.scrollTop\",\n+    L\");return c}d=xd(c,d);var h=A(c),k=h.documentElement,m=h.body,u=V(k,\\\"o\",\n+    L\"verflow\\\"),r;for(c=e(c);c;c=e(c)){var p=f(c);if(\\\"visible\\\"!=p.x||\\\"vi\",\n+    L\"sible\\\"!=p.y){var v=td(c);if(0==v.width||0==v.height)return W;var G=sa\",\n+    L\"(V(c,\\\"width\\\")),H=sa(V(c,\\\"height\\\"));if(G!=v.width||H!=v.height)v=\\n\",\n+    L\"new U(v.left,v.top,G,H);G=d.right<v.left;H=d.bottom<v.top;if(G&&\\\"hidd\",\n+    L\"en\\\"==p.x||H&&\\\"hidden\\\"==p.y)return W;if(G&&\\\"visible\\\"!=p.x||H&&\\\"vi\",\n+    L\"sible\\\"!=p.y){G=g(c);H=d.bottom<v.top-G.y;if(d.right<v.left-G.x&&\\\"vis\",\n+    L\"ible\\\"!=p.x||H&&\\\"visible\\\"!=p.x)return W;d=ud(c);return d==W?W:\\\"scro\",\n+    L\"ll\\\"}G=d.left>=v.left+v.width;v=d.top>=v.top+v.height;if(G&&\\\"hidden\\\"\",\n+    L\"==p.x||v&&\\\"hidden\\\"==p.y)return W;if(G&&\\\"visible\\\"!=p.x||v&&\\\"visibl\",\n+    L\"e\\\"!=p.y){if(r&&(p=g(c),d.left>=k.scrollWidth-p.x||d.right>=k.scrollHe\",\n+    L\"ight-p.y))return W;d=ud(c);return d==\\nW?W:\\\"scroll\\\"}}}return\\\"none\\\"\",\n+    L\"}\\nfunction td(c){var d=vd(c);if(d)return d.rect;if(B(c,\\\"HTML\\\"))retu\",\n+    L\"rn c=A(c),c=(ib(c)||window).document,c=\\\"CSS1Compat\\\"==c.compatMode?c.\",\n+    L\"documentElement:c.body,c=new gb(c.clientWidth,c.clientHeight),new U(0,\",\n+    L\"0,c.width,c.height);try{var e=c.getBoundingClientRect()}catch(f){retur\",\n+    L\"n new U(0,0,0,0)}d=new U(e.left,e.top,e.right-e.left,e.bottom-e.top);c\",\n+    L\".ownerDocument.body&&(c=A(c),d.left-=c.documentElement.clientLeft+c.bo\",\n+    L\"dy.clientLeft,d.top-=c.documentElement.clientTop+c.body.clientTop);ret\",\n+    L\"urn d}\\nfunction vd(c){var d=B(c,\\\"MAP\\\");if(!d&&!B(c,\\\"AREA\\\"))return\",\n+    L\" null;var e=d?c:B(c.parentNode,\\\"MAP\\\")?c.parentNode:null,f=null,g=nul\",\n+    L\"l;e&&e.name&&(f=T.P('/descendant::*[@usemap = \\\"#'+e.name+'\\\"]',A(e)))\",\n+    L\"&&(g=td(f),d||\\\"default\\\"==c.shape.toLowerCase()||(c=yd(c),d=Math.min(\",\n+    L\"Math.max(c.left,0),g.width),e=Math.min(Math.max(c.top,0),g.height),g=n\",\n+    L\"ew U(d+g.left,e+g.top,Math.min(c.width,g.width-d),Math.min(c.height,g.\",\n+    L\"height-e))));return{I:f,rect:g||new U(0,0,0,0)}}\\nfunction yd(c){var d\",\n+    L\"=c.shape.toLowerCase();c=c.coords.split(\\\",\\\");if(\\\"rect\\\"==d&&4==c.le\",\n+    L\"ngth){d=c[0];var e=c[1];return new U(d,e,c[2]-d,c[3]-e)}if(\\\"circle\\\"=\",\n+    L\"=d&&3==c.length)return d=c[2],new U(c[0]-d,c[1]-d,2*d,2*d);if(\\\"poly\\\"\",\n+    L\"==d&&2<c.length){d=c[0];e=c[1];for(var f=d,g=e,h=2;h+1<c.length;h+=2)d\",\n+    L\"=Math.min(d,c[h]),f=Math.max(f,c[h]),e=Math.min(e,c[h+1]),g=Math.max(g\",\n+    L\",c[h+1]);return new U(d,e,f-d,g-e)}return new U(0,0,0,0)}\\nfunction xd\",\n+    L\"(c,d){c=td(c);c=new Zc(c.top,c.left+c.width,c.top+c.height,c.left);d&&\",\n+    L\"(d=d instanceof U?d:new U(d.x,d.y,1,1),c.left=Math.min(Math.max(c.left\",\n+    L\"+d.left,c.left),c.right),c.top=Math.min(Math.max(c.top+d.top,c.top),c.\",\n+    L\"bottom),c.right=Math.min(Math.max(c.left+d.width,c.left),c.right),c.bo\",\n+    L\"ttom=Math.min(Math.max(c.top+d.height,c.top),c.bottom));return c}\\nfun\",\n+    L\"ction wd(c){if(cb){if(\\\"relative\\\"==V(c,\\\"position\\\"))return 1;c=V(c,\",\n+    L\"\\\"filter\\\");return(c=c.match(/^alpha\\\\(opacity=(\\\\d*)\\\\)/)||c.match(/^\",\n+    L\"progid:DXImageTransform.Microsoft.Alpha\\\\(Opacity=(\\\\d*)\\\\)/))?Number(\",\n+    L\"c[1])/100:1}return zd(c)}function zd(c){var d=1,e=V(c,\\\"opacity\\\");e&&\",\n+    L\"(d=Number(e));(c=qd(c))&&(d*=zd(c));return d};var Ad=ma.navigator.msPo\",\n+    L\"interEnabled;function Bd(c,d,e){this.a=c;this.b=d;this.f=e}Bd.prototyp\",\n+    L\"e.create=function(c){c=A(c);cb&&c.createEventObject?c=c.createEventObj\",\n+    L\"ect():(c=c.createEvent(\\\"HTMLEvents\\\"),c.initEvent(this.a,this.b,this.\",\n+    L\"f));return c};Bd.prototype.toString=function(){return this.a};function\",\n+    L\" X(c,d,e){Bd.call(this,c,d,e)}t(X,Bd);\\nX.prototype.create=function(c,\",\n+    L\"d){if(this==Cd)throw new x(9,\\\"Browser does not support a mouse pixel \",\n+    L\"scroll event.\\\");var e=A(c);if(cb){var f=e.createEventObject();f.altKe\",\n+    L\"y=d.altKey;f.ctrlKey=d.ctrlKey;f.metaKey=d.metaKey;f.shiftKey=d.shiftK\",\n+    L\"ey;f.button=d.button;f.clientX=d.clientX;f.clientY=d.clientY;e=functio\",\n+    L\"n(c,d){Object.defineProperty(f,c,{get:function(){return d}})};if(this=\",\n+    L\"=Dd||this==Ed)if(Object.defineProperty){var g=this==Dd;e(\\\"fromElement\",\n+    L\"\\\",g?c:d.relatedTarget);e(\\\"toElement\\\",g?d.relatedTarget:\\nc)}else f.\",\n+    L\"relatedTarget=d.relatedTarget;this==Fd&&(Object.defineProperty?e(\\\"whe\",\n+    L\"elDelta\\\",d.wheelDelta):f.detail=d.wheelDelta)}else if(g=ib(e),f=e.cre\",\n+    L\"ateEvent(\\\"MouseEvents\\\"),this==Fd&&(f.wheelDelta=d.wheelDelta),f.init\",\n+    L\"MouseEvent(this.a,this.b,this.f,g,1,d.clientX,d.clientY,d.clientX,d.cl\",\n+    L\"ientY,d.ctrlKey,d.altKey,d.shiftKey,d.metaKey,d.button,d.relatedTarget\",\n+    L\"),0===f.pageX&&0===f.pageY&&Object.defineProperty){c=hb((c?new tb(A(c)\",\n+    L\"):na||(na=new tb)).a);e=ad(e);var h=d.clientX+c.scrollLeft-e.clientLef\",\n+    L\"t,k=d.clientY+\\nc.scrollTop-e.clientTop;Object.defineProperty(f,\\\"page\",\n+    L\"X\\\",{get:function(){return h}});Object.defineProperty(f,\\\"pageY\\\",{get\",\n+    L\":function(){return k}})}return f};function Gd(c,d,e){Bd.call(this,c,d,\",\n+    L\"e)}t(Gd,Bd);\\nGd.prototype.create=function(c,d){if(!Ad)throw new x(9,\",\n+    L\"\\\"Browser does not support MSPointer events.\\\");var e=A(c);c=ib(e);e=e\",\n+    L\".createEvent(\\\"MSPointerEvent\\\");e.initPointerEvent(this.a,this.b,this\",\n+    L\".f,c,0,0,0,d.clientX,d.clientY,d.ctrlKey,d.altKey,d.shiftKey,d.metaKey\",\n+    L\",d.button,d.relatedTarget,0,0,d.width,d.height,d.pressure,d.rotation,d\",\n+    L\".tiltX,d.tiltY,d.pointerId,d.pointerType,0,d.isPrimary);return e};\\nva\",\n+    L\"r Hd=new Bd(\\\"change\\\",!0,!1),Id=new X(\\\"click\\\",!0,!0),Jd=new X(\\\"con\",\n+    L\"textmenu\\\",!0,!0),Kd=new X(\\\"dblclick\\\",!0,!0),Ld=new X(\\\"mousedown\\\",\",\n+    L\"!0,!0),Md=new X(\\\"mousemove\\\",!0,!1),Dd=new X(\\\"mouseout\\\",!0,!0),Ed=n\",\n+    L\"ew X(\\\"mouseover\\\",!0,!0),Nd=new X(\\\"mouseup\\\",!0,!0),Fd=new X(\\\"mouse\",\n+    L\"wheel\\\",!0,!0),Cd=new X(\\\"MozMousePixelScroll\\\",!0,!0),Od=new Gd(\\\"MSG\",\n+    L\"otPointerCapture\\\",!0,!1),Pd=new Gd(\\\"MSLostPointerCapture\\\",!0,!1),Qd\",\n+    L\"=new Gd(\\\"MSPointerDown\\\",!0,!0),Rd=new Gd(\\\"MSPointerMove\\\",!0,!0),Sd\",\n+    L\"=new Gd(\\\"MSPointerOver\\\",!0,!0),Td=new Gd(\\\"MSPointerOut\\\",\\n!0,!0),U\",\n+    L\"d=new Gd(\\\"MSPointerUp\\\",!0,!0);function Vd(c,d,e){e=d.create(c,e);\\\"i\",\n+    L\"sTrusted\\\"in e||(e.isTrusted=!1);return cb&&c.fireEvent?c.fireEvent(\\\"\",\n+    L\"on\\\"+d.a,e):c.dispatchEvent(e)};function",
    "Announce folder status changes when syncing gets updated unread count . .": "diff --git a/src/com/fsck/k9/MessagingController.java b/src/com/fsck/k9/MessagingController.java\nindex 462835bd0..374a91c99 100644\n--- a/src/com/fsck/k9/MessagingController.java\n+++ b/src/com/fsck/k9/MessagingController.java\n@@ -794,10 +794,7 @@ public class MessagingController implements Runnable\n             return;\n         }\n \n-        if (K9.DEBUG)\n-        {\n-            Log.i(K9.LOG_TAG, \"Synchronizing folder \" + account.getDescription() + \":\" + folder);\n-        }\n+\tLog.i(K9.LOG_TAG, \"Synchronizing folder \" + account.getDescription() + \":\" + folder);\n \n         for (MessagingListener l : getListeners())\n         {\n@@ -919,7 +916,10 @@ public class MessagingController implements Runnable\n \n             if (Account.EXPUNGE_ON_POLL.equals(account.getExpungePolicy()))\n             {\n-                Log.i(K9.LOG_TAG, \"SYNC: Expunging folder \" + account.getDescription() + \":\" + folder);\n+\t\tif (K9.DEBUG)\n+\t\t{\n+\t\t    Log.d(K9.LOG_TAG, \"SYNC: Expunging folder \" + account.getDescription() + \":\" + folder);\n+\t\t}\n                 remoteFolder.expunge();\n             }\n \n@@ -999,8 +999,12 @@ public class MessagingController implements Runnable\n              */\n             int newMessages = downloadMessages(account, remoteFolder, localFolder, remoteMessages, false);\n \n-            setLocalUnreadCountToRemote(localFolder, remoteFolder,  newMessages);\n+            int unreadMessageCount = setLocalUnreadCountToRemote(localFolder, remoteFolder,  newMessages);\n \n+\t    for (MessagingListener l : getListeners())\n+\t    {\n+\t\tl.folderStatusChanged(account, folder, unreadMessageCount);\n+\t    }\n \n             /*\n              * Notify listeners that we're finally done.\n@@ -1044,6 +1048,7 @@ public class MessagingController implements Runnable\n                 }\n             }\n \n+\t    Log.i(K9.LOG_TAG, \"Done synchronizing folder \" + account.getDescription() + \":\" + folder);\n \n         }\n         catch (Exception e)\n@@ -1193,7 +1198,10 @@ public class MessagingController implements Runnable\n             l.synchronizeMailboxProgress(account, folder, progress.get(), todo);\n         }\n \n-        Log.i(K9.LOG_TAG, \"SYNC: Have \" + unsyncedMessages.size() + \" unsynced messages\");\n+\tif (K9.DEBUG)\n+\t{\n+\t    Log.d(K9.LOG_TAG, \"SYNC: Have \" + unsyncedMessages.size() + \" unsynced messages\");\n+\t}\n \n         messages.clear();\n         final ArrayList<Message> largeMessages = new ArrayList<Message>();\n@@ -1311,16 +1319,21 @@ public class MessagingController implements Runnable\n                     localFolder.setPushState(newPushState);\n                 }\n             }\n-            Log.i(K9.LOG_TAG, \"SYNC: Synced unsynced messages for folder \" + folder);\n+\t    if (K9.DEBUG)\n+\t    {\n+\t\tLog.d(K9.LOG_TAG, \"SYNC: Synced unsynced messages for folder \" + folder);\n+\t    }\n \n \n         }\n \n-\n-        Log.i(K9.LOG_TAG, \"SYNC: Have \"\n-              + largeMessages.size() + \" large messages and \"\n-              + smallMessages.size() + \" small messages out of \"\n-              + unsyncedMessages.size() + \" unsynced messages\");\n+\tif (K9.DEBUG)\n+\t{\n+\t    Log.d(K9.LOG_TAG, \"SYNC: Have \"\n+\t\t  + largeMessages.size() + \" large messages and \"\n+\t\t  + smallMessages.size() + \" small messages out of \"\n+\t\t  + unsyncedMessages.size() + \" unsynced messages\");\n+\t}\n \n         unsyncedMessages.clear();\n \n@@ -1334,7 +1347,10 @@ public class MessagingController implements Runnable\n         //        fp.add(FetchProfile.Item.FLAGS);\n         //        fp.add(FetchProfile.Item.ENVELOPE);\n \n-        Log.i(K9.LOG_TAG, \"SYNC: Fetching small messages for folder \" + folder);\n+\tif (K9.DEBUG)\n+\t{\n+\t    Log.d(K9.LOG_TAG, \"SYNC: Fetching small messages for folder \" + folder);\n+\t}\n \n         remoteFolder.fetch(smallMessages.toArray(new Message[smallMessages.size()]),\n                            fp, new MessageRetrievalListener()\n@@ -1383,7 +1399,10 @@ public class MessagingController implements Runnable\n             public void messagesFinished(int total) {}\n         });\n \n-        Log.i(K9.LOG_TAG, \"SYNC: Done fetching small messages for folder \" + folder);\n+\tif (K9.DEBUG)\n+\t{\n+\t    Log.d(K9.LOG_TAG, \"SYNC: Done fetching small messages for folder \" + folder);\n+\t}\n         smallMessages.clear();\n \n         /*\n@@ -1392,7 +1411,10 @@ public class MessagingController implements Runnable\n         fp.clear();\n         fp.add(FetchProfile.Item.STRUCTURE);\n \n-        Log.i(K9.LOG_TAG, \"SYNC: Fetching large messages for folder \" + folder);\n+\tif (K9.DEBUG)\n+\t{\n+\t    Log.d(K9.LOG_TAG, \"SYNC: Fetching large messages for folder \" + folder);\n+\t}\n \n         remoteFolder.fetch(largeMessages.toArray(new Message[largeMessages.size()]), fp, null);\n         for (Message message : largeMessages)\n@@ -1487,7 +1509,10 @@ public class MessagingController implements Runnable\n                 }\n             }\n         }//for large messsages\n-        Log.i(K9.LOG_TAG, \"SYNC: Done fetching large messages for folder \" + folder);\n+\tif (K9.DEBUG)\n+\t{\n+\t    Log.d(K9.LOG_TAG, \"SYNC: Done fetching large messages for folder \" + folder);\n+\t}\n \n         largeMessages.clear();\n \n@@ -1499,8 +1524,11 @@ public class MessagingController implements Runnable\n         {\n \n \n-            Log.i(K9.LOG_TAG, \"SYNC: About to sync flags for \"\n-                  + syncFlagMessages.size() + \" remote messages for folder \" + folder);\n+\t    if (K9.DEBUG)\n+\t    {\n+\t\tLog.d(K9.LOG_TAG, \"SYNC: About to sync flags for \"\n+\t\t      + syncFlagMessages.size() + \" remote messages for folder \" + folder);\n+\t    }\n \n \n             fp.clear();\n@@ -1534,8 +1562,10 @@ public class MessagingController implements Runnable\n                 }\n             }\n         }\n-        Log.i(K9.LOG_TAG, \"SYNC: Synced remote messages for folder \" + folder + \", \" + newMessages.get() + \" new messages\");\n-\n+\tif (K9.DEBUG)\n+\t{\n+\t    Log.d(K9.LOG_TAG, \"SYNC: Synced remote messages for folder \" + folder + \", \" + newMessages.get() + \" new messages\");\n+\t}\n         localFolder.purgeToVisibleLimit(new MessageRemovalListener()\n         {\n             public void messageRemoved(Message message)",
    "Remove static variables from JvmTypeGen & JvmTerminatorGen .": "diff --git a/compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/bir/codegen/CodeGenerator.java b/compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/bir/codegen/CodeGenerator.java\nindex f6d94c6f3c9..e34208a681c 100644\n--- a/compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/bir/codegen/CodeGenerator.java\n+++ b/compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/bir/codegen/CodeGenerator.java\n@@ -58,11 +58,9 @@ public class CodeGenerator {\n \n     private static final CompilerContext.Key<CodeGenerator> CODE_GEN = new CompilerContext.Key<>();\n \n-    public static BLangDiagnosticLogHelper dlog;\n-\n-    //TODO: remove static\n-    static SymbolTable symbolTable;\n-    public static PackageCache packageCache;\n+    private BLangDiagnosticLogHelper dlog;\n+    private SymbolTable symbolTable;\n+    private PackageCache packageCache;\n \n     private Map<String, BIRNode.BIRPackage> compiledPkgCache = new HashMap<>();\n \n@@ -90,7 +88,7 @@ public class CodeGenerator {\n             return;\n         }\n \n-        intiPackageGen();\n+        intiPackageGen(dlog, packageCache);\n         JvmPackageGen.symbolTable = symbolTable;\n         JvmMethodGen.errorOrNilType = BUnionType.create(null, symbolTable.errorType, symbolTable.nilType);\n         compiledPkgCache.put(entryMod.org.value + entryMod.name.value, entryMod);\ndiff --git a/compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/bir/codegen/JvmCastGen.java b/compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/bir/codegen/JvmCastGen.java\nindex 8612cc56d32..36ee6382763 100644\n--- a/compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/bir/codegen/JvmCastGen.java\n+++ b/compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/bir/codegen/JvmCastGen.java\n@@ -84,8 +84,8 @@ import static org.wso2.ballerinalang.compiler.bir.codegen.JvmConstants.TYPEDESC_\n import static org.wso2.ballerinalang.compiler.bir.codegen.JvmConstants.TYPE_CHECKER;\n import static org.wso2.ballerinalang.compiler.bir.codegen.JvmConstants.TYPE_CONVERTER;\n import static org.wso2.ballerinalang.compiler.bir.codegen.JvmConstants.XML_VALUE;\n-import static org.wso2.ballerinalang.compiler.bir.codegen.JvmInstructionGen.B_STRING_VALUE;\n-import static org.wso2.ballerinalang.compiler.bir.codegen.JvmInstructionGen.I_STRING_VALUE;\n+import static org.wso2.ballerinalang.compiler.bir.codegen.JvmConstants.B_STRING_VALUE;\n+import static org.wso2.ballerinalang.compiler.bir.codegen.JvmConstants.I_STRING_VALUE;\n import static org.wso2.ballerinalang.compiler.bir.codegen.JvmInstructionGen.addBoxInsn;\n import static org.wso2.ballerinalang.compiler.bir.codegen.JvmInstructionGen.isBString;\n \ndiff --git a/compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/bir/codegen/JvmConstants.java b/compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/bir/codegen/JvmConstants.java\nindex 30a7ca45304..78eff403153 100644\n--- a/compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/bir/codegen/JvmConstants.java\n+++ b/compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/bir/codegen/JvmConstants.java\n@@ -204,4 +204,7 @@ public class JvmConstants {\n     public static final String CLASS_TOO_LARGE = \"ClassTooLarge\";\n \n     public static final String GLOBAL_LOCK_NAME = \"lock\";\n+    public static final String I_STRING_VALUE = \"org/ballerinalang/jvm/values/StringValue\";\n+    public static final String B_STRING_VALUE = \"org/ballerinalang/jvm/values/api/BString\";\n+    public static final String NON_BMP_STRING_VALUE = \"org/ballerinalang/jvm/values/NonBmpStringValue\";\n }\ndiff --git a/compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/bir/codegen/JvmInstructionGen.java b/compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/bir/codegen/JvmInstructionGen.java\nindex 399d373eba2..98f5ffd9b6b 100644\n--- a/compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/bir/codegen/JvmInstructionGen.java\n+++ b/compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/bir/codegen/JvmInstructionGen.java\n@@ -24,7 +24,6 @@ import org.objectweb.asm.Label;\n import org.objectweb.asm.MethodVisitor;\n import org.objectweb.asm.Opcodes;\n import org.objectweb.asm.Type;\n-import org.wso2.ballerinalang.compiler.bir.codegen.JvmPackageGen;\n import org.wso2.ballerinalang.compiler.bir.codegen.internal.BIRVarToJVMIndexMap;\n import org.wso2.ballerinalang.compiler.bir.codegen.interop.JCast;\n import org.wso2.ballerinalang.compiler.bir.codegen.interop.JInsKind;\n@@ -177,9 +176,6 @@ import static org.wso2.ballerinalang.compiler.bir.codegen.JvmTerminatorGen.toNam\n  */\n public class JvmInstructionGen {\n \n-    public static final String I_STRING_VALUE = \"org/ballerinalang/jvm/values/StringValue\";\n-    public static final String B_STRING_VALUE = \"org/ballerinalang/jvm/values/api/BString\";\n-    public static final String NON_BMP_STRING_VALUE = \"org/ballerinalang/jvm/values/NonBmpStringValue\";\n     public static boolean isBString = false;\n     private MethodVisitor mv;\n     private BIRVarToJVMIndexMap indexMap;\n@@ -454,7 +450,7 @@ public class JvmInstructionGen {\n             if (isBString) {\n                 int[] highSurrogates = listHighSurrogates(val);\n \n-                mv.visitTypeInsn(NEW, NON_BMP_STRING_VALUE);\n+                mv.visitTypeInsn(NEW, JvmConstants.NON_BMP_STRING_VALUE);\n                 mv.visitInsn(DUP);\n                 mv.visitLdcInsn(val);\n                 mv.visitIntInsn(BIPUSH, highSurrogates.length);\n@@ -468,7 +464,7 @@ public class JvmInstructionGen {\n                     i = i + 1;\n                     mv.visitInsn(IASTORE);\n                 }\n-                mv.visitMethodInsn(INVOKESPECIAL, NON_BMP_STRING_VALUE, \"<init>\",\n+                mv.visitMethodInsn(INVOKESPECIAL, JvmConstants.NON_BMP_STRING_VALUE, \"<init>\",\n                         String.format(\"(L%s;[I)V\", STRING_VALUE), false);\n             } else {\n                 mv.visitLdcInsn(val);\n@@ -879,7 +875,7 @@ public class JvmInstructionGen {\n         this.loadVar(binaryIns.rhsOp1.variableDcl);\n         this.loadVar(binaryIns.rhsOp2.variableDcl);\n         this.mv.visitMethodInsn(INVOKESTATIC, TYPE_CHECKER, \"getAnnotValue\",\n-                String.format(\"(L%s;L%s;)L%s;\", TYPEDESC_VALUE, isBString ? B_STRING_VALUE : STRING_VALUE,\n+                String.format(\"(L%s;L%s;)L%s;\", TYPEDESC_VALUE, isBString ? JvmConstants.B_STRING_VALUE : STRING_VALUE,\n                         OBJECT), false);\n \n         BType targetType = binaryIns.lhsOp.variableDcl.type;\n@@ -897,8 +893,8 @@ public class JvmInstructionGen {\n             this.mv.visitInsn(IADD);\n         } else if (TypeTags.isStringTypeTag(bType.tag)) {\n             if (isBString) {\n-                this.mv.visitMethodInsn(INVOKEINTERFACE, B_STRING_VALUE, \"concat\",\n-                                        String.format(\"(L%s;)L%s;\", B_STRING_VALUE, B_STRING_VALUE), true);\n+                this.mv.visitMethodInsn(INVOKEINTERFACE, JvmConstants.B_STRING_VALUE, \"concat\",\n+                                        String.format(\"(L%s;)L%s;\", JvmConstants.B_STRING_VALUE, JvmConstants.B_STRING_VALUE), true);\n             } else {\n                 this.mv.visitMethodInsn(INVOKEVIRTUAL, \"java/lang/String\", \"concat\",\n                         String.format(\"(L%s;)L%s;\", STRING_VALUE, STRING_VALUE), false);\n@@ -1201,11 +1197,11 @@ public class JvmInstructionGen {\n \n         if (varRefType.tag == TypeTags.JSON) {\n             this.mv.visitMethodInsn(INVOKESTATIC, JSON_UTILS, \"setElement\",\n-                    String.format(\"(L%s;L%s;L%s;)V\", OBJECT, isBString ? B_STRING_VALUE : STRING_VALUE, OBJECT),\n+                    String.format(\"(L%s;L%s;L%s;)V\", OBJECT, isBString ? JvmConstants.B_STRING_VALUE : STRING_VALUE, OBJECT),\n                     false);\n         } else {\n             String signature = String.format(\"(L%s;L%s;L%s;Z)V\",\n-                    MAP_VALUE, isBString ? B_STRING_VALUE : STRING_VALUE, OBJECT);\n+                    MAP_VALUE, isBString ? JvmConstants.B_STRING_VALUE : STRING_VALUE, OBJECT);\n \n             if (mapStoreIns.isStoreOnCreation) {\n                 this.mv.visitInsn(ICONST_1);\n@@ -1229,14 +1225,14 @@ public class JvmInstructionGen {\n         if (varRefType.tag == TypeTags.JSON) {\n \n             if (mapLoadIns.optionalFieldAccess) {\n-                this.mv.visitTypeInsn(CHECKCAST, isBString ? B_STRING_VALUE : STRING_VALUE);\n+                this.mv.visitTypeInsn(CHECKCAST, isBString ? JvmConstants.B_STRING_VALUE : STRING_VALUE);\n                 this.mv.visitMethodInsn(INVOKESTATIC, JSON_UTILS, \"getElementOrNil\",\n-                        String.format(\"(L%s;L%s;)L%s;\", OBJECT, isBString ? B_STRING_VALUE : STRING_VALUE, OBJECT),\n+                        String.format(\"(L%s;L%s;)L%s;\", OBJECT, isBString ? JvmConstants.B_STRING_VALUE : STRING_VALUE, OBJECT),\n                         false);\n             } else {\n-                this.mv.visitTypeInsn(CHECKCAST, isBString ? B_STRING_VALUE : STRING_VALUE);\n+                this.mv.visitTypeInsn(CHECKCAST, isBString ? JvmConstants.B_STRING_VALUE : STRING_VALUE);\n                 this.mv.visitMethodInsn(INVOKESTATIC, JSON_UTILS, \"getElement\",\n-                        String.format(\"(L%s;L%s;)L%s;\", OBJECT, isBString ? B_STRING_VALUE : STRING_VALUE, OBJECT),\n+                        String.format(\"(L%s;L%s;)L%s;\", OBJECT, isBString ? JvmConstants.B_STRING_VALUE : STRING_VALUE, OBJECT),\n                         false);\n             }\n         } else {\n@@ -1264,7 +1260,7 @@ public class JvmInstructionGen {\n \n         // invoke get() method, and unbox if needed\n         this.mv.visitMethodInsn(INVOKEINTERFACE, OBJECT_VALUE, \"get\",\n-                String.format(\"(L%s;)L%s;\", isBString ? B_STRING_VALUE : STRING_VALUE, OBJECT), true);\n+                String.format(\"(L%s;)L%s;\", isBString ? JvmConstants.B_STRING_VALUE : STRING_VALUE, OBJECT), true);\n         BType targetType = objectLoadIns.lhsOp.variableDcl.type;\n         addUnboxInsn(this.mv, targetType);\n \n@@ -1286,7 +1282,7 @@ public class JvmInstructionGen {\n \n         // invoke set() method\n         this.mv.visitMethodInsn(INVOKEINTERFACE, OBJECT_VALUE, \"set\",\n-                                String.format(\"(L%s;L%s;)V\", isBString ? B_STRING_VALUE : STRING_VALUE, OBJECT),\n+                                String.format(\"(L%s;L%s;)V\", isBString ? JvmConstants.B_STRING_VALUE : STRING_VALUE, OBJECT),\n                                 true);\n     }\n \n@@ -1297,7 +1293,7 @@ public class JvmInstructionGen {\n         // visit the key expr\n         this.loadVar(stringLoadIns.keyOp.variableDcl);\n \n-        String consVal = isBString ? B_STRING_VALUE : STRING_VALUE;\n+        String consVal = isBString ? JvmConstants.B_STRING_VALUE : STRING_VALUE;\n         // invoke the `getStringAt()` method\n         this.mv.visitMethodInsn(INVOKESTATIC, STRING_UTILS, \"getStringAt\",\n                                 String.format(\"(L%s;J)L%s;\", consVal, consVal), false);\n@@ -1349,7 +1345,7 @@ public class JvmInstructionGen {\n             this.mv.visitMethodInsn(INVOKEINTERFACE, ARRAY_VALUE, \"add\", \"(JD)V\", true);\n         } else if (TypeTags.isStringTypeTag(valueType.tag)) {\n             this.mv.visitMethodInsn(INVOKEINTERFACE, ARRAY_VALUE, \"add\",\n-                                    String.format(\"(JL%s;)V\", isBString ? B_STRING_VALUE : STRING_VALUE), true);\n+                                    String.format(\"(JL%s;)V\", isBString ? JvmConstants.B_STRING_VALUE : STRING_VALUE), true);\n         } else if (valueType.tag == TypeTags.BOOLEAN) {\n             this.mv.visitMethodInsn(INVOKEINTERFACE, ARRAY_VALUE, \"add\", \"(JZ)V\", true);\n         } else if (valueType.tag == TypeTags.BYTE) {\n@@ -1382,7 +1378,7 @@ public class JvmInstructionGen {\n         } else if (TypeTags.isStringTypeTag(bType.tag)) {\n             if (isBString) {\n                 this.mv.visitMethodInsn(INVOKEINTERFACE, ARRAY_VALUE, \"getBString\",\n-                                        String.format(\"(J)L%s;\", B_STRING_VALUE), true);\n+                                        String.format(\"(J)L%s;\", JvmConstants.B_STRING_VALUE), true);\n             } else {\n                 this.mv.visitMethodInsn(INVOKEINTERFACE, ARRAY_VALUE, \"getString\",\n                                         String.format(\"(J)L%s;\", STRING_VALUE), true);\n@@ -1422,7 +1418,7 @@ public class JvmInstructionGen {\n         this.loadVar(newErrorIns.detailOp.variableDcl);\n         this.mv.visitMethodInsn(INVOKESPECIAL, ERROR_VALUE, \"<init>\",\n                                 String.format(\"(L%s;L%s;L%s;)V\", BTYPE,\n-                                              isBString ? B_STRING_VALUE : STRING_VALUE, OBJECT), false);\n+                                              isBString ? JvmConstants.B_STRING_VALUE : STRING_VALUE, OBJECT), false);\n         this.storeToVar(newErrorIns.lhsOp.variableDcl);\n     }\n \n@@ -1560,7 +1556,7 @@ public class JvmInstructionGen {\n         this.loadVar(newXMLElement.defaultNsURIOp.variableDcl);\n         this.mv.visitMethodInsn(INVOKESTATIC, XML_FACTORY, \"createXMLElement\",\n                                 String.format(\"(L%s;L%s;)L%s;\", XML_QNAME,\n-                                              isBString ? B_STRING_VALUE : STRING_VALUE, XML_VALUE), false);\n+                                              isBString ? JvmConstants.B_STRING_VALUE : STRING_VALUE, XML_VALUE), false);\n         this.storeToVar(newXMLElement.lhsOp.variableDcl);\n     }\n \n@@ -1571,7 +1567,7 @@ public class JvmInstructionGen {\n         this.loadVar(newXMLQName.localnameOp.variableDcl);\n         this.loadVar(newXMLQName.nsURIOp.variableDcl);\n         this.loadVar(newXMLQName.prefixOp.variableDcl);\n-        String consVal = isBString ? B_STRING_VALUE : STRING_VALUE;\n+        String consVal = isBString ? JvmConstants.B_STRING_VALUE : STRING_VALUE;\n         this.mv.visitMethodInsn(INVOKESPECIAL, XML_QNAME, \"<init>\",\n                                 String.format(\"(L%s;L%s;L%s;)V\", consVal, consVal, consVal), false);\n         this.storeToVar(newXMLQName.lhsOp.variableDcl);\n@@ -1591,7 +1587,7 @@ public class JvmInstructionGen {\n \n         this.loadVar(newXMLText.textOp.variableDcl);\n         this.mv.visitMethodInsn(INVOKESTATIC, XML_FACTORY, \"createXMLText\",\n-                                String.format(\"(L%s;)L%s;\", isBString ? B_STRING_VALUE : STRING_VALUE, XML_VALUE),\n+                                String.format(\"(L%s;)L%s;\", isBString ? JvmConstants.B_STRING_VALUE : STRING_VALUE, XML_VALUE),\n                                 false);\n         this.storeToVar(newXMLText.lhsOp.variableDcl);\n     }\n@@ -1600,7 +1596,7 @@ public class JvmInstructionGen {\n \n         this.loadVar(newXMLComment.textOp.variableDcl);\n         this.mv.visitMethodInsn(INVOKESTATIC, XML_FACTORY, \"createXMLComment\",\n-                                String.format(\"(L%s;)L%s;\", isBString ? B_STRING_VALUE : STRING_VALUE, XML_VALUE),\n+                                String.format(\"(L%s;)L%s;\", isBString ? JvmConstants.B_STRING_VALUE : STRING_VALUE, XML_VALUE),\n                                 false);\n         this.storeToVar(newXMLComment.lhsOp.variableDcl);\n     }\n@@ -1609,7 +1605,7 @@ public class JvmInstructionGen {\n \n         this.loadVar(newXMLPI.targetOp.variableDcl);\n         this.loadVar(newXMLPI.dataOp.variableDcl);\n-        String consVal = isBString ? B_STRING_VALUE : STRING_VALUE;\n+        String consVal = isBString ? JvmConstants.B_STRING_VALUE : STRING_VALUE;\n         this.mv.visitMethodInsn(INVOKESTATIC, XML_FACTORY, \"createXMLProcessingInstruction\",\n                                 String.format(\"(L%s;L%s;)L%s;\", consVal, consVal, XML_VALUE), false);\n         this.storeToVar(newXMLPI.lhsOp.variableDcl);\n@@ -1660,7 +1656,7 @@ public class JvmInstructionGen {\n         this.loadVar(xmlAttrStoreIns.rhsOp.variableDcl);\n \n         // invoke setAttribute() method\n-        String signature = String.format(\"(L%s;L%s;)V\", BXML_QNAME, isBString ? B_STRING_VALUE : STRING_VALUE);\n+        String signature = String.format(\"(L%s;L%s;)V\", BXML_QNAME, isBString ? JvmConstants.B_STRING_VALUE : STRING_VALUE);\n         this.mv.visitMethodInsn(INVOKEVIRTUAL, XML_VALUE, \"setAttribute\", signature, false);\n     }\n \ndiff --git a/compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/bir/codegen/JvmMethodGen.java b/compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/bir/codegen/JvmMethodGen.java\nindex ae560c1d80a..6af6ff57fbd 100644\n--- a/compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/bir/codegen/JvmMethodGen.java\n+++ b/compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/bir/codegen/JvmMethodGen.java\n@@ -23,6 +23,7 @@ import org.objectweb.asm.ClassWriter;\n import org.objectweb.asm.FieldVisitor;\n import org.objectweb.asm.Label;\n import org.objectweb.asm.MethodVisitor;\n+import org.wso2.ballerinalang.compiler.PackageCache;\n import org.wso2.ballerinalang.compiler.bir.codegen.internal.FunctionParamComparator;\n import org.wso2.ballerinalang.compiler.bir.codegen.internal.BIRVarToJVMIndexMap;\n import org.wso2.ballerinalang.compiler.bir.codegen.internal.LabelGenerator;\n@@ -165,7 +166,7 @@ import static org.wso2.ballerinalang.compiler.bir.codegen.JvmConstants.TYPEDESC_\n import static org.wso2.ballerinalang.compiler.bir.codegen.JvmConstants.VALUE_CREATOR;\n import static org.wso2.ballerinalang.compiler.bir.codegen.JvmConstants.WINDOWS_PATH_SEPERATOR;\n import static org.wso2.ballerinalang.compiler.bir.codegen.JvmConstants.XML_VALUE;\n-import static org.wso2.ballerinalang.compiler.bir.codegen.JvmInstructionGen.B_STRING_VALUE;\n+import static org.wso2.ballerinalang.compiler.bir.codegen.JvmConstants.B_STRING_VALUE;\n import static org.wso2.ballerinalang.compiler.bir.codegen.JvmInstructionGen.visitInvokeDyn;\n import static org.wso2.ballerinalang.compiler.bir.codegen.JvmInstructionGen.addBoxInsn;\n import static org.wso2.ballerinalang.compiler.bir.codegen.JvmInstructionGen.addUnboxInsn;\n@@ -236,14 +237,15 @@ public class JvmMethodGen {\n     public static void generateMethod(BIRFunction birFunc,\n                                       ClassWriter cw,\n                                       BIRPackage birModule,\n-                                      BType attachedType /* = () */,\n-                                      boolean isService /* = false */,\n-                                      String serviceName /* = \"\" */) {\n+                                      BType attachedType,\n+                                      boolean isService,\n+                                      String serviceName,\n+                                      PackageCache packageCache) {\n \n         if (isExternFunc(birFunc)) {\n-            genJMethodForBExternalFunc(birFunc, cw, birModule, attachedType);\n+            genJMethodForBExternalFunc(birFunc, cw, birModule, attachedType, packageCache);\n         } else {\n-            genJMethodForBFunc(birFunc, cw, birModule, isService, serviceName, attachedType);\n+            genJMethodForBFunc(birFunc, cw, birModule, isService, serviceName, attachedType, packageCache);\n         }\n     }\n \n@@ -252,7 +254,8 @@ public class JvmMethodGen {\n                                           BIRPackage module,\n                                           boolean isService,\n                                           String serviceName,\n-                                          BType attachedType /* = () */) {\n+                                          BType attachedType,\n+                                          PackageCache packageCache) {\n \n         String currentPackageName = getPackageName(module.org.value, module.name.value);\n         BIRVarToJVMIndexMap indexMap = new BIRVarToJVMIndexMap();\n@@ -376,7 +379,7 @@ public class JvmMethodGen {\n             i = i + 1;\n         }\n \n-        JvmTerminatorGen termGen = new JvmTerminatorGen(mv, indexMap, labelGen, errorGen, module);\n+        JvmTerminatorGen termGen = new JvmTerminatorGen(mv, indexMap, labelGen, errorGen, module, packageCache);\n \n         // uncomment to test yield\n         // mv.visitFieldInsn(GETSTATIC, className, \"i\", \"I\");\n@@ -1073,7 +1076,8 @@ public class JvmMethodGen {\n         mv.visitJumpInsn(GOTO, gotoLabel);\n     }\n \n-    public static void generateLambdaMethod(BIRInstruction ins, ClassWriter cw, String lambdaName) {\n+    public static void generateLambdaMethod(BIRInstruction ins, ClassWriter cw, String lambdaName,\n+                                            PackageCache packageCache) {\n \n         BType lhsType;\n         String orgName;\n@@ -1236,7 +1240,7 @@ public class JvmMethodGen {\n             if (functionWrapper != null) {\n                 jvmClass = functionWrapper.fullQualifiedClassName;\n             } else {\n-                BPackageSymbol symbol = CodeGenerator.packageCache.getSymbol(orgName + \"/\" + moduleName);\n+                BPackageSymbol symbol =",
    "Remove unused Maven plugins": "diff --git a/pom.xml b/pom.xml\nindex 163581b9997..8a1485b976a 100644\n--- a/pom.xml\n+++ b/pom.xml\n@@ -106,11 +106,6 @@\n           <artifactId>frontend-maven-plugin</artifactId>\n           <version>1.3</version>\n         </plugin>\n-        <plugin>\n-          <groupId>org.apache.maven.plugins</groupId>\n-          <artifactId>maven-antrun-plugin</artifactId>\n-          <version>1.7</version>\n-        </plugin>\n         <plugin>\n           <groupId>org.apache.maven.plugins</groupId>\n           <artifactId>maven-assembly-plugin</artifactId>\n@@ -141,11 +136,6 @@\n           <artifactId>maven-enforcer-plugin</artifactId>\n           <version>1.4</version>\n         </plugin>\n-        <plugin>\n-          <groupId>org.apache.maven.plugins</groupId>\n-          <artifactId>maven-failsafe-plugin</artifactId>\n-          <version>2.18.1</version>\n-        </plugin>\n         <plugin>\n           <groupId>org.apache.maven.plugins</groupId>\n           <artifactId>maven-gpg-plugin</artifactId>\n@@ -179,11 +169,6 @@\n           <artifactId>maven-jxr-plugin</artifactId>\n           <version>2.5</version>\n         </plugin>\n-        <plugin>\n-          <groupId>org.apache.maven.plugins</groupId>\n-          <artifactId>maven-plugin-plugin</artifactId>\n-          <version>3.3</version>\n-        </plugin>\n         <plugin>\n           <groupId>org.apache.maven.plugins</groupId>\n           <artifactId>maven-release-plugin</artifactId>\n@@ -199,11 +184,6 @@\n           <artifactId>maven-shade-plugin</artifactId>\n           <version>2.3</version>\n         </plugin>\n-        <plugin>\n-          <groupId>org.apache.maven.plugins</groupId>\n-          <artifactId>maven-site-plugin</artifactId>\n-          <version>3.4</version>\n-        </plugin>\n         <plugin>\n           <groupId>org.apache.maven.plugins</groupId>\n           <artifactId>maven-source-plugin</artifactId>",
    "Add kdocs for our annotations .": "diff --git a/compose/r4a-runtime/src/com/google/r4a/Attribute.kt b/compose/r4a-runtime/src/com/google/r4a/Attribute.kt\ndeleted file mode 100644\nindex 554b7be5e10..00000000000\n--- a/compose/r4a-runtime/src/com/google/r4a/Attribute.kt\n+++ /dev/null\n@@ -1,6 +0,0 @@\n-package com.google.r4a\n-\n-/**\n- * Created by jsproch on 5/27/17.\n- */\n-annotation class Attribute\n\\ No newline at end of file\ndiff --git a/compose/r4a-runtime/src/com/google/r4a/Children.kt b/compose/r4a-runtime/src/com/google/r4a/Children.kt\nindex 149670864bb..c37505fffa7 100644\n--- a/compose/r4a-runtime/src/com/google/r4a/Children.kt\n+++ b/compose/r4a-runtime/src/com/google/r4a/Children.kt\n@@ -1,5 +1,13 @@\n package com.google.r4a\n \n+/**\n+ * @Children can be applied to one parameter of a composable function, to indicate that this\n+ * parameter represents the composable's children.  The @Children parameter is generally used\n+ * to describe the composable's sub-nodes within the composable's view hierarchy.  The type\n+ * of the @Children parameter is assumed to be @Composable unless otherwise specified.\n+ * To learn more, see the \"children\" section of the r4a-composable documentation available\n+ * here: https://goto.google.com/r4a-composable\n+ */\n @Target(\n     AnnotationTarget.VALUE_PARAMETER,\n     AnnotationTarget.PROPERTY,\ndiff --git a/compose/r4a-runtime/src/com/google/r4a/Composable.kt b/compose/r4a-runtime/src/com/google/r4a/Composable.kt\nindex 3c1e40bbe2d..0868cb26eb4 100644\n--- a/compose/r4a-runtime/src/com/google/r4a/Composable.kt\n+++ b/compose/r4a-runtime/src/com/google/r4a/Composable.kt\n@@ -1,5 +1,11 @@\n package com.google.r4a\n \n+/**\n+ * @Composable can be applied to a function or lambda to indicate that the function/lambda can be\n+ * used as part of an R4A composition to describe a transformation from application data into a\n+ * widget hierarchy.\n+ * To learn more, see https://goto.google.com/r4a-composable\n+ */\n @MustBeDocumented\n @Retention(AnnotationRetention.BINARY)\n @Target(AnnotationTarget.CLASS, AnnotationTarget.FUNCTION, AnnotationTarget.TYPE, AnnotationTarget.TYPE_PARAMETER)\ndiff --git a/compose/r4a-runtime/src/com/google/r4a/Emittable.kt b/compose/r4a-runtime/src/com/google/r4a/Emittable.kt\nindex a9f72c43876..dae4a0e3ceb 100644\n--- a/compose/r4a-runtime/src/com/google/r4a/Emittable.kt\n+++ b/compose/r4a-runtime/src/com/google/r4a/Emittable.kt\n@@ -1,5 +1,13 @@\n package com.google.r4a\n \n+/**\n+ * The Emittable interface tells R4A that the implementing class represents a\n+ * primitive node/type in the view hierarchy produced as a result of composition.\n+ * Conceptually similar to a RenderObject in flutter.  The result of composition is\n+ * an updated tree of Emittables, which R4A will maintain/mutate over time as\n+ * subsequent reconciliations are calculated.\n+ * To learn more: https://goto.google.com/r4a-emittable\n+ */\n interface Emittable {\n     fun emitInsertAt(index: Int, instance: Emittable)\n     fun emitRemoveAt(index: Int, count: Int)\ndiff --git a/compose/r4a-runtime/src/com/google/r4a/Model.kt b/compose/r4a-runtime/src/com/google/r4a/Model.kt\nindex 7a818578a96..3737796e532 100644\n--- a/compose/r4a-runtime/src/com/google/r4a/Model.kt\n+++ b/compose/r4a-runtime/src/com/google/r4a/Model.kt\n@@ -1,5 +1,11 @@\n package com.google.r4a\n \n+/**\n+ * @Model can be applied to a class which represents your application's data model, and will cause\n+ * the data model class to become observable, such that any composable functions which read from the\n+ * model will be recomposed when the model is changed.  @Model also adds the a MVCC transaction system\n+ * to ensure data consistency across threads.  To learn more, see https://goto.google.com/r4a-model\n+ */\n @MustBeDocumented\n @Target(AnnotationTarget.CLASS )\n @Retention(AnnotationRetention.BINARY)\ndiff --git a/compose/r4a-runtime/src/com/google/r4a/Pivotal.kt b/compose/r4a-runtime/src/com/google/r4a/Pivotal.kt\nindex 823271b9a54..6a42cae98cb 100644\n--- a/compose/r4a-runtime/src/com/google/r4a/Pivotal.kt\n+++ b/compose/r4a-runtime/src/com/google/r4a/Pivotal.kt\n@@ -1,5 +1,13 @@\n package com.google.r4a\n \n+/**\n+ * @Pivotal can be applied to the parameters of a composable to indicate that\n+ * the parameter contributes to the \"identity\" of the composable.  Pivotal\n+ * parameters are used when calculating the composable's `key`, and the\n+ * composable's key is used to determine if/when private state of the\n+ * composable (and/or of the composable's children) should be reused.\n+ * To learn more: https://goto.google.com/r4a-keys\n+ */\n @Target(\n     AnnotationTarget.VALUE_PARAMETER,\n     AnnotationTarget.PROPERTY,\ndiff --git a/compose/r4a-runtime/src/com/google/r4a/UnionType.kt b/compose/r4a-runtime/src/com/google/r4a/UnionType.kt\nindex 71d11019dea..18d42072909 100644\n--- a/compose/r4a-runtime/src/com/google/r4a/UnionType.kt\n+++ b/compose/r4a-runtime/src/com/google/r4a/UnionType.kt\n@@ -1,12 +1,17 @@\n-/*\n- * Copyright 2010-2018 JetBrains s.r.o. Use of this source code is governed by the Apache 2.0 license\n- * that can be found in the license/LICENSE.txt file.\n- */\n-\n package com.google.r4a\n \n import kotlin.reflect.KClass\n \n+/**\n+ * @UnionType can be used when an attribute can be one of several different types.\n+ * The annotation indicates that the Kotlin type has been expanded to a common\n+ * subtype (often Any) for the purpose of accepting one of a multiplicity of\n+ * subtypes.  The @UnionType must specify the intended subtypes, which can then be enforced\n+ * by the compiler.  @UnionType is particularly useful when a composable function\n+ * is wrapping a native View because it allows a composable to accept the multiplicity\n+ * of types corresponding to the overloaded setters for that attribute.\n+ * Learn more at: https://goto.google.com/r4a-uniontype\n+ */\n @MustBeDocumented\n @Retention(AnnotationRetention.BINARY)\n @Target(AnnotationTarget.TYPE, AnnotationTarget.TYPE_PARAMETER)",
    "Add Chinese localization for scheduler": "diff --git a/core/src/main/resources/hudson/scheduler/Messages_zh_CN.properties b/core/src/main/resources/hudson/scheduler/Messages_zh_CN.properties\nnew file mode 100644\nindex 0000000000..56ab74da14\n--- /dev/null\n+++ b/core/src/main/resources/hudson/scheduler/Messages_zh_CN.properties\n@@ -0,0 +1,29 @@\n+# The MIT License\n+# \n+# Copyright (c) 2018, linuxsuren\n+# \n+# Permission is hereby granted, free of charge, to any person obtaining a copy\n+# of this software and associated documentation files (the \"Software\"), to deal\n+# in the Software without restriction, including without limitation the rights\n+# to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n+# copies of the Software, and to permit persons to whom the Software is\n+# furnished to do so, subject to the following conditions:\n+# \n+# The above copyright notice and this permission notice shall be included in\n+# all copies or substantial portions of the Software.\n+# \n+# THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n+# IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n+# FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n+# AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n+# LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n+# OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n+# THE SOFTWARE.\n+\n+BaseParser.StartEndReversed=\\u60A8\\u7684\\u610F\\u601D\\u662F\\u4ECE {0} \\u5230 {1}\\uFF1F\n+BaseParser.MustBePositive=\\u95F4\\u9694\\u503C\\u5FC5\\u987B\\u4E3A\\u6B63\\u6574\\u6570\\uFF0C\\u800C\\u4E0D\\u662F {0}\n+BaseParser.OutOfRange={0} \\u662F\\u4E00\\u4E2A\\u975E\\u6CD5\\u503C\\u3002\\u5FC5\\u987B\\u5728 {1} \\u548C {2} \\u4E4B\\u95F4\n+CronTab.do_you_really_mean_every_minute_when_you=\\u5F53\\u60A8\\u8F93\\u5165 \"{0}\" \\u65F6\\uFF0C\\u610F\\u601D\\u4E3A\"\\u6BCF\\u5206\\u949F\"\\uFF1F\\u4E5F\\u8BB8\\u60A8\\u5E0C\\u671B \"{1}\" \\u6BCF\\u5C0F\\u65F6\\u8F6E\\u8BE2\n+CronTab.short_cycles_in_the_day_of_month_field_w=\\u4EE5\\u6708\\u4E3A\\u5468\\u671F\\u7684\\u77ED\\u5FAA\\u73AF\\u5B57\\u6BB5\\u5728\\u6708\\u672B\\u65F6\\u53EF\\u80FD\\u4F1A\\u6709\\u5947\\u602A\\u7684\\u884C\\u4E3A\n+CronTab.spread_load_evenly_by_using_rather_than_=\\u5206\\u6563\\u8D1F\\u8F7D\\u5E94\\u8BE5\\u7528 \\u2018{0}\\u2019 \\u800C\\u4E0D\\u662F \\u2018{1}\\u2019\n+CronTabList.InvalidInput=\\u975E\\u6CD5\\u8F93\\u5165\\uFF1A\"{0}\": {1}",
    "Add new sendFile methods which take a result handler": "diff --git a/vertx-core/src/main/java/org/vertx/java/core/http/HttpServerResponse.java b/vertx-core/src/main/java/org/vertx/java/core/http/HttpServerResponse.java\nindex 6360ee785..3a89fbd32 100644\n--- a/vertx-core/src/main/java/org/vertx/java/core/http/HttpServerResponse.java\n+++ b/vertx-core/src/main/java/org/vertx/java/core/http/HttpServerResponse.java\n@@ -16,6 +16,7 @@\n \n package org.vertx.java.core.http;\n \n+import org.vertx.java.core.AsyncResult;\n import org.vertx.java.core.Handler;\n import org.vertx.java.core.MultiMap;\n import org.vertx.java.core.buffer.Buffer;\n@@ -189,6 +190,18 @@ public interface HttpServerResponse extends WriteStream<HttpServerResponse> {\n    */\n   HttpServerResponse sendFile(String filename, String notFoundFile);\n \n+  /**\n+   * Same as {@link #sendFile(String)} but also takes a handler that will be called when the send has completed or\n+   * a failure has occurred\n+   */\n+  HttpServerResponse sendFile(String filename, Handler<AsyncResult<Void>> resultHandler);\n+\n+  /**\n+   * Same as {@link #sendFile(String, String)} but also takes a handler that will be called when the send has completed or\n+   * a failure has occurred\n+   */\n+  HttpServerResponse sendFile(String filename, String notFoundFile, Handler<AsyncResult<Void>> resultHandler);\n+\n   /**\n    * Close the underlying TCP connection\n    */\ndiff --git a/vertx-core/src/main/java/org/vertx/java/core/http/impl/DefaultHttpServerResponse.java b/vertx-core/src/main/java/org/vertx/java/core/http/impl/DefaultHttpServerResponse.java\nindex 8977906dc..10d52ab4a 100644\n--- a/vertx-core/src/main/java/org/vertx/java/core/http/impl/DefaultHttpServerResponse.java\n+++ b/vertx-core/src/main/java/org/vertx/java/core/http/impl/DefaultHttpServerResponse.java\n@@ -27,6 +27,7 @@ import org.vertx.java.core.MultiMap;\n import org.vertx.java.core.buffer.Buffer;\n import org.vertx.java.core.file.impl.PathAdjuster;\n import org.vertx.java.core.http.HttpServerResponse;\n+import org.vertx.java.core.impl.DefaultFutureResult;\n import org.vertx.java.core.impl.VertxInternal;\n \n import java.io.File;\n@@ -281,11 +282,27 @@ public class DefaultHttpServerResponse implements HttpServerResponse {\n   }\n   @Override\n   public DefaultHttpServerResponse sendFile(String filename) {\n-    return sendFile(filename, null);\n+    return sendFile(filename, (String)null);\n   }\n \n   @Override\n   public DefaultHttpServerResponse sendFile(String filename, String notFoundResource) {\n+    doSendFile(filename, notFoundResource, null);\n+    return this;\n+  }\n+\n+  @Override\n+  public HttpServerResponse sendFile(String filename, Handler<AsyncResult<Void>> resultHandler) {\n+    return sendFile(filename, null, resultHandler);\n+  }\n+\n+  @Override\n+  public HttpServerResponse sendFile(String filename, String notFoundFile, Handler<AsyncResult<Void>> resultHandler) {\n+    doSendFile(filename, notFoundFile, resultHandler);\n+    return this;\n+  }\n+\n+  private void doSendFile(String filename, String notFoundResource, final Handler<AsyncResult<Void>> resultHandler) {\n     if (headWritten) {\n       throw new IllegalStateException(\"Head already written\");\n     }\n@@ -294,7 +311,7 @@ public class DefaultHttpServerResponse implements HttpServerResponse {\n     if (!file.exists()) {\n       if (notFoundResource != null) {\n         statusCode = HttpResponseStatus.NOT_FOUND.code();\n-        sendFile(notFoundResource, null);\n+        sendFile(notFoundResource, (String)null, resultHandler);\n       } else {\n         sendNotFound();\n       }\n@@ -320,14 +337,33 @@ public class DefaultHttpServerResponse implements HttpServerResponse {\n       channelFuture = conn.write(LastHttpContent.EMPTY_LAST_CONTENT);\n       headWritten = written = true;\n \n+      if (resultHandler != null) {\n+        channelFuture.addListener(new ChannelFutureListener() {\n+          public void operationComplete(ChannelFuture future) throws Exception {\n+            final AsyncResult<Void> res;\n+            if (future.isSuccess()) {\n+              res = new DefaultFutureResult<>((Void)null);\n+            } else {\n+              res = new DefaultFutureResult<>(future.cause());\n+            }\n+            vertx.runOnContext(new Handler<Void>() {\n+              @Override\n+              public void handle(Void v) {\n+                resultHandler.handle(res);\n+              }\n+            });\n+          }\n+        });\n+      }\n+\n       if (!keepAlive) {\n         closeConnAfterWrite();\n       }\n       conn.responseComplete();\n     }\n-    return this;\n   }\n \n+\n   private boolean contentLengthSet() {\n     if (headers == null) {\n       return false;\ndiff --git a/vertx-testsuite/src/test/java/org/vertx/java/tests/core/http/JavaHttpTest.java b/vertx-testsuite/src/test/java/org/vertx/java/tests/core/http/JavaHttpTest.java\nindex 391ef5b4a..c30dd96db 100644\n--- a/vertx-testsuite/src/test/java/org/vertx/java/tests/core/http/JavaHttpTest.java\n+++ b/vertx-testsuite/src/test/java/org/vertx/java/tests/core/http/JavaHttpTest.java\n@@ -415,6 +415,14 @@ public class JavaHttpTest extends TestBase {\n     startTest(getMethodName());\n   }\n \n+  public void testSendFileWithHandler() {\n+    startTest(getMethodName());\n+  }\n+\n+  public void testSendFileNotFoundWith404PageAndHandler() {\n+    startTest(getMethodName());\n+  }\n+\n   public void test100ContinueHandled() {\n     startTest(getMethodName());\n   }\ndiff --git a/vertx-testsuite/src/test/java/vertx/tests/core/http/HttpTestClient.java b/vertx-testsuite/src/test/java/vertx/tests/core/http/HttpTestClient.java\nindex a6a357c8e..78c23d496 100644\n--- a/vertx-testsuite/src/test/java/vertx/tests/core/http/HttpTestClient.java\n+++ b/vertx-testsuite/src/test/java/vertx/tests/core/http/HttpTestClient.java\n@@ -2104,6 +2104,43 @@ public class HttpTestClient extends TestClientBase {\n     }, handler);\n   }\n \n+  public void testSendFileWithHandler() throws Exception {\n+    final String content = TestUtils.randomUnicodeString(10000);\n+    final File file = setupFile(\"test-send-file.html\", content);\n+\n+    AsyncResultHandler<HttpServer> handler = new AsyncResultHandler<HttpServer>() {\n+      @Override\n+      public void handle(AsyncResult<HttpServer> ar) {\n+        tu.azzert(ar.succeeded());\n+        client.getNow(\"some-uri\", new Handler<HttpClientResponse>() {\n+          public void handle(final HttpClientResponse response) {\n+            tu.azzert(response.statusCode() == 200);\n+            tu.azzert(file.length() == Long.valueOf(response.headers().get(\"content-length\")));\n+            tu.azzert(\"text/html\".equals(response.headers().get(\"content-type\")));\n+            response.bodyHandler(new Handler<Buffer>() {\n+              public void handle(Buffer buff) {\n+                tu.azzert(content.equals(buff.toString()));\n+                file.delete();\n+              }\n+            });\n+          }\n+        });\n+      }\n+    };\n+\n+    startServer(new Handler<HttpServerRequest>() {\n+      public void handle(HttpServerRequest req) {\n+        req.response().sendFile(file.getAbsolutePath(), new Handler<AsyncResult<Void>>() {\n+          @Override\n+          public void handle(AsyncResult<Void> res) {\n+            tu.azzert(res.succeeded());\n+            tu.testComplete();\n+          }\n+        });\n+      }\n+    }, handler);\n+  }\n+\n   public void testSendFileNotFound() throws Exception {\n     AsyncResultHandler<HttpServer> handler = new AsyncResultHandler<HttpServer>() {\n       @Override\n@@ -2131,6 +2168,8 @@ public class HttpTestClient extends TestClientBase {\n     }, handler);\n   }\n \n+\n+\n   public void testSendFileNotFoundWith404Page() throws Exception {\n     final String content = \"<html><body>This is my 404 page</body></html>\";\n     final File file = setupFile(\"my-404-page.html\", content);\n@@ -2160,6 +2199,40 @@ public class HttpTestClient extends TestClientBase {\n     }, handler);\n   }\n \n+  public void testSendFileNotFoundWith404PageAndHandler() throws Exception {\n+    final String content = \"<html><body>This is my 404 page</body></html>\";\n+    final File file = setupFile(\"my-404-page.html\", content);\n+    AsyncResultHandler<HttpServer> handler = new AsyncResultHandler<HttpServer>() {\n+      @Override\n+      public void handle(AsyncResult<HttpServer> ar) {\n+        tu.azzert(ar.succeeded());\n+        client.getNow(\"some-uri\", new Handler<HttpClientResponse>() {\n+          public void handle(final HttpClientResponse response) {\n+            tu.azzert(response.statusCode() == 404);\n+            tu.azzert(\"text/html\".equals(response.headers().get(\"content-type\")));\n+            response.bodyHandler(new Handler<Buffer>() {\n+              public void handle(Buffer buff) {\n+                tu.azzert(content.equals(buff.toString()));\n+              }\n+            });\n+          }\n+        });\n+      }\n+    };\n+\n+    startServer(new Handler<HttpServerRequest>() {\n+      public void handle(HttpServerRequest req) {\n+        req.response().sendFile(\"doesnotexist.html\", file.getAbsolutePath(), new Handler<AsyncResult<Void>>() {\n+          @Override\n+          public void handle(AsyncResult<Void> res) {\n+            tu.azzert(res.succeeded());\n+            tu.testComplete();\n+          }\n+        });\n+      }\n+    }, handler);\n+  }\n+\n   public void testSendFileOverrideHeaders() throws Exception {\n     final String content = TestUtils.randomUnicodeString(10000);\n     final File file = setupFile(\"test-send-file.html\", content);",
    "Add link to roadmap doc": "diff --git a/README.md b/README.md\nindex d4143218ceb..2efcb911461 100644\n--- a/README.md\n+++ b/README.md\n@@ -48,5 +48,4 @@ See [Releases](https://github.com/linkedin/datahub/releases) page for more detai\n We welcome contributions from the community. Please refer to [the guidelines](CONTRIBUTING.md) for more details. We also have a [contrib](contrib) directory for incubation. \n \n ## Roadmap\n-1. [Kubernetes](https://kubernetes.io/) for container orchestration\n-2. Deploy DataHub to [Azure Cloud](https://azure.microsoft.com/en-us/)\n+Check DataHub's [roadmap](docs/roadmap.md).",
    "Allow injection of custom FormatEvaluators .": "diff --git a/demo/src/main/java/com/google/android/exoplayer2/demo/PlayerActivity.java b/demo/src/main/java/com/google/android/exoplayer2/demo/PlayerActivity.java\nindex 57febd1aae..cdde3337b3 100644\n--- a/demo/src/main/java/com/google/android/exoplayer2/demo/PlayerActivity.java\n+++ b/demo/src/main/java/com/google/android/exoplayer2/demo/PlayerActivity.java\n@@ -37,6 +37,8 @@ import com.google.android.exoplayer2.source.ConcatenatingMediaSource;\n import com.google.android.exoplayer2.source.ExtractorMediaSource;\n import com.google.android.exoplayer2.source.MediaSource;\n import com.google.android.exoplayer2.source.TrackGroupArray;\n+import com.google.android.exoplayer2.source.chunk.FormatEvaluator;\n+import com.google.android.exoplayer2.source.chunk.FormatEvaluator.AdaptiveEvaluator;\n import com.google.android.exoplayer2.source.dash.DashMediaSource;\n import com.google.android.exoplayer2.source.hls.HlsMediaSource;\n import com.google.android.exoplayer2.source.smoothstreaming.SmoothStreamingMediaSource;\n@@ -47,12 +49,12 @@ import com.google.android.exoplayer2.trackselection.DefaultTrackSelector;\n import com.google.android.exoplayer2.trackselection.MappingTrackSelector;\n import com.google.android.exoplayer2.trackselection.MappingTrackSelector.TrackInfo;\n import com.google.android.exoplayer2.ui.AspectRatioFrameLayout;\n+import com.google.android.exoplayer2.ui.DebugTextViewHelper;\n import com.google.android.exoplayer2.ui.PlayerControl;\n import com.google.android.exoplayer2.upstream.BandwidthMeter;\n-import com.google.android.exoplayer2.upstream.DataSourceFactory;\n+import com.google.android.exoplayer2.upstream.DataSource;\n import com.google.android.exoplayer2.upstream.DefaultBandwidthMeter;\n import com.google.android.exoplayer2.upstream.DefaultDataSourceFactory;\n-import com.google.android.exoplayer2.ui.DebugTextViewHelper;\n import com.google.android.exoplayer2.util.Util;\n \n import android.Manifest.permission;\n@@ -129,12 +131,12 @@ public class PlayerActivity extends Activity implements SurfaceHolder.Callback,\n   private SubtitleLayout subtitleLayout;\n   private Button retryButton;\n \n-  private DataSourceFactory dataSourceFactory;\n+  private DataSource.Factory dataSourceFactory;\n+  private FormatEvaluator.Factory formatEvaluatorFactory;\n   private SimpleExoPlayer player;\n   private MappingTrackSelector trackSelector;\n   private TrackSelectionHelper trackSelectionHelper;\n   private DebugTextViewHelper debugViewHelper;\n-  private BandwidthMeter bandwidthMeter;\n   private boolean playerNeedsSource;\n \n   private int playerPeriodIndex;\n@@ -146,10 +148,11 @@ public class PlayerActivity extends Activity implements SurfaceHolder.Callback,\n   public void onCreate(Bundle savedInstanceState) {\n     super.onCreate(savedInstanceState);\n     String userAgent = Util.getUserAgent(this, \"ExoPlayerDemo\");\n-    dataSourceFactory = new DefaultDataSourceFactory(this, userAgent);\n-    bandwidthMeter = new DefaultBandwidthMeter();\n-    mainHandler = new Handler();\n+    BandwidthMeter bandwidthMeter = new DefaultBandwidthMeter();\n+    dataSourceFactory = new DefaultDataSourceFactory(this, userAgent, bandwidthMeter);\n+    formatEvaluatorFactory = new AdaptiveEvaluator.Factory(bandwidthMeter);\n \n+    mainHandler = new Handler();\n     setContentView(R.layout.player_activity);\n     rootView = findViewById(R.id.root);\n     rootView.setOnTouchListener(new OnTouchListener() {\n@@ -340,16 +343,17 @@ public class PlayerActivity extends Activity implements SurfaceHolder.Callback,\n     int type = Util.inferContentType(lastPathSegment);\n     switch (type) {\n       case Util.TYPE_SS:\n-        return new SmoothStreamingMediaSource(uri, dataSourceFactory, bandwidthMeter, mainHandler,\n-            eventLogger);\n+        return new SmoothStreamingMediaSource(uri, dataSourceFactory, formatEvaluatorFactory,\n+            mainHandler, eventLogger);\n       case Util.TYPE_DASH:\n-        return new DashMediaSource(uri, dataSourceFactory, bandwidthMeter, mainHandler,\n+        return new DashMediaSource(uri, dataSourceFactory, formatEvaluatorFactory, mainHandler,\n             eventLogger);\n       case Util.TYPE_HLS:\n-        return new HlsMediaSource(uri, dataSourceFactory, bandwidthMeter, mainHandler, eventLogger);\n+        return new HlsMediaSource(uri, dataSourceFactory, formatEvaluatorFactory, mainHandler,\n+            eventLogger);\n       case Util.TYPE_OTHER:\n-        return new ExtractorMediaSource(uri, dataSourceFactory, bandwidthMeter,\n-            new DefaultExtractorsFactory(), mainHandler, eventLogger);\n+        return new ExtractorMediaSource(uri, dataSourceFactory, new DefaultExtractorsFactory(),\n+            mainHandler, eventLogger);\n       default:\n         throw new IllegalStateException(\"Unsupported type: \" + type);\n     }\ndiff --git a/extensions/flac/src/androidTest/java/com/google/android/exoplayer2/ext/flac/FlacPlaybackTest.java b/extensions/flac/src/androidTest/java/com/google/android/exoplayer2/ext/flac/FlacPlaybackTest.java\nindex f0c1488262..8c99d1b895 100644\n--- a/extensions/flac/src/androidTest/java/com/google/android/exoplayer2/ext/flac/FlacPlaybackTest.java\n+++ b/extensions/flac/src/androidTest/java/com/google/android/exoplayer2/ext/flac/FlacPlaybackTest.java\n@@ -77,7 +77,6 @@ public class FlacPlaybackTest extends InstrumentationTestCase {\n       ExtractorMediaSource mediaSource = new ExtractorMediaSource(\n           uri,\n           new DefaultDataSourceFactory(context, \"ExoPlayerExtFlacTest\"),\n-          null,\n           MatroskaExtractor.FACTORY,\n           null,\n           null);\ndiff --git a/extensions/okhttp/src/main/java/com/google/android/exoplayer2/ext/okhttp/DefaultOkHttpDataSourceFactory.java b/extensions/okhttp/src/main/java/com/google/android/exoplayer2/ext/okhttp/DefaultOkHttpDataSourceFactory.java\nindex 394dbf35df..6a1d1e5a12 100644\n--- a/extensions/okhttp/src/main/java/com/google/android/exoplayer2/ext/okhttp/DefaultOkHttpDataSourceFactory.java\n+++ b/extensions/okhttp/src/main/java/com/google/android/exoplayer2/ext/okhttp/DefaultOkHttpDataSourceFactory.java\n@@ -15,51 +15,46 @@\n  */\n package com.google.android.exoplayer2.ext.okhttp;\n \n-import com.google.android.exoplayer2.upstream.DataSourceFactory;\n+import com.google.android.exoplayer2.upstream.DataSource;\n+import com.google.android.exoplayer2.upstream.DataSource.Factory;\n import com.google.android.exoplayer2.upstream.DefaultDataSource;\n import com.google.android.exoplayer2.upstream.TransferListener;\n-import com.google.android.exoplayer2.util.Predicate;\n \n import android.content.Context;\n-\n import okhttp3.CacheControl;\n import okhttp3.OkHttpClient;\n \n /**\n- * A {@link DataSourceFactory} that produces {@link DefaultDataSource} instances that delegate to\n+ * A {@link Factory} that produces {@link DefaultDataSource} instances that delegate to\n  * {@link OkHttpDataSource}s for non-file/asset/content URIs.\n  */\n-public final class DefaultOkHttpDataSourceFactory implements DataSourceFactory {\n+public final class DefaultOkHttpDataSourceFactory implements Factory {\n \n   private final Context context;\n   private final OkHttpClient client;\n   private final String userAgent;\n-  private final Predicate<String> contentTypePredicate;\n+  private final TransferListener transferListener;\n   private final CacheControl cacheControl;\n \n   public DefaultOkHttpDataSourceFactory(Context context, OkHttpClient client, String userAgent,\n-      Predicate<String> contentTypePredicate) {\n-    this(context, client, userAgent, contentTypePredicate, null);\n+      TransferListener transferListener) {\n+    this(context, client, userAgent, transferListener, null);\n   }\n \n   public DefaultOkHttpDataSourceFactory(Context context, OkHttpClient client, String userAgent,\n-      Predicate<String> contentTypePredicate, CacheControl cacheControl) {\n+      TransferListener transferListener, CacheControl cacheControl) {\n     this.context = context.getApplicationContext();\n     this.client = client;\n     this.userAgent = userAgent;\n-    this.contentTypePredicate = contentTypePredicate;\n+    this.transferListener = transferListener;\n     this.cacheControl = cacheControl;\n   }\n \n   @Override\n   public DefaultDataSource createDataSource() {\n-    return createDataSource(null);\n-  }\n-\n-  @Override\n-  public DefaultDataSource createDataSource(TransferListener listener) {\n-    return new DefaultDataSource(context, listener,\n-        new OkHttpDataSource(client, userAgent, contentTypePredicate, listener, cacheControl));\n+    DataSource httpDataSource = new OkHttpDataSource(client, userAgent, null, transferListener,\n+        cacheControl);\n+    return new DefaultDataSource(context, transferListener, httpDataSource);\n   }\n \n }\ndiff --git a/extensions/opus/src/androidTest/java/com/google/android/exoplayer2/ext/opus/OpusPlaybackTest.java b/extensions/opus/src/androidTest/java/com/google/android/exoplayer2/ext/opus/OpusPlaybackTest.java\nindex e34d3d0a9e..2b7c49ab20 100644\n--- a/extensions/opus/src/androidTest/java/com/google/android/exoplayer2/ext/opus/OpusPlaybackTest.java\n+++ b/extensions/opus/src/androidTest/java/com/google/android/exoplayer2/ext/opus/OpusPlaybackTest.java\n@@ -77,7 +77,6 @@ public class OpusPlaybackTest extends InstrumentationTestCase {\n       ExtractorMediaSource mediaSource = new ExtractorMediaSource(\n           uri,\n           new DefaultDataSourceFactory(context, \"ExoPlayerExtOpusTest\"),\n-          null,\n           MatroskaExtractor.FACTORY,\n           null,\n           null);\ndiff --git a/extensions/vp9/src/androidTest/java/com/google/android/exoplayer2/ext/vp9/VpxPlaybackTest.java b/extensions/vp9/src/androidTest/java/com/google/android/exoplayer2/ext/vp9/VpxPlaybackTest.java\nindex 5a89733ec1..e0928b1253 100644\n--- a/extensions/vp9/src/androidTest/java/com/google/android/exoplayer2/ext/vp9/VpxPlaybackTest.java\n+++ b/extensions/vp9/src/androidTest/java/com/google/android/exoplayer2/ext/vp9/VpxPlaybackTest.java\n@@ -93,7 +93,6 @@ public class VpxPlaybackTest extends InstrumentationTestCase {\n       ExtractorMediaSource mediaSource = new ExtractorMediaSource(\n           uri,\n           new DefaultDataSourceFactory(context, \"ExoPlayerExtVp9Test\"),\n-          null,\n           MatroskaExtractor.FACTORY,\n           null,\n           null);\ndiff --git a/library/src/main/java/com/google/android/exoplayer2/source/ExtractorMediaSource.java b/library/src/main/java/com/google/android/exoplayer2/source/ExtractorMediaSource.java\nindex bf3ee0f055..738671efb0 100644\n--- a/library/src/main/java/com/google/android/exoplayer2/source/ExtractorMediaSource.java\n+++ b/library/src/main/java/com/google/android/exoplayer2/source/ExtractorMediaSource.java\n@@ -33,9 +33,7 @@ import com.google.android.exoplayer2.extractor.SeekMap;\n import com.google.android.exoplayer2.extractor.TrackOutput;\n import com.google.android.exoplayer2.trackselection.TrackSelection;\n import com.google.android.exoplayer2.upstream.Allocator;\n-import com.google.android.exoplayer2.upstream.BandwidthMeter;\n import com.google.android.exoplayer2.upstream.DataSource;\n-import com.google.android.exoplayer2.upstream.DataSourceFactory;\n import com.google.android.exoplayer2.upstream.DataSpec;\n import com.google.android.exoplayer2.upstream.Loader;\n import com.google.android.exoplayer2.upstream.Loader.Loadable;\n@@ -112,8 +110,7 @@ public final class ExtractorMediaSource implements MediaPeriod, MediaSource,\n   private static final long DEFAULT_LAST_SAMPLE_DURATION_US = 10000;\n \n   private final Uri uri;\n-  private final DataSourceFactory dataSourceFactory;\n-  private final BandwidthMeter bandwidthMeter;\n+  private final DataSource.Factory dataSourceFactory;\n   private final ExtractorsFactory extractorsFactory;\n   private final int minLoadableRetryCount;\n   private final Handler eventHandler;\n@@ -148,23 +145,20 @@ public final class ExtractorMediaSource implements MediaPeriod, MediaSource,\n   /**\n    * @param uri The {@link Uri} of the media stream.\n    * @param dataSourceFactory A factory for {@link DataSource}s to read the media.\n-   * @param bandwidthMeter A {@link BandwidthMeter} to notify of loads performed by the source.\n    * @param extractorsFactory Factory for {@link Extractor}s to process the media stream. If the\n    *     possible formats are known, pass a factory that instantiates extractors for those formats.\n    *     Otherwise, pass a {@link DefaultExtractorsFactory} to use default extractors.\n    * @param eventListener A listener of events. May be null if delivery of events is not required.\n    */\n-  public ExtractorMediaSource(Uri uri, DataSourceFactory dataSourceFactory,\n-      BandwidthMeter bandwidthMeter, ExtractorsFactory extractorsFactory, Handler eventHandler,\n-      EventListener eventListener) {\n-    this(uri, dataSourceFactory, bandwidthMeter, extractorsFactory,\n-        MIN_RETRY_COUNT_DEFAULT_FOR_MEDIA, eventHandler, eventListener);\n+  public ExtractorMediaSource(Uri uri, DataSource.Factory dataSourceFactory,\n+      ExtractorsFactory extractorsFactory, Handler eventHandler, EventListener eventListener) {\n+    this(uri, dataSourceFactory, extractorsFactory, MIN_RETRY_COUNT_DEFAULT_FOR_MEDIA, eventHandler,\n+        eventListener);\n   }\n \n   /**\n    * @param uri The {@link Uri} of the media stream.\n    * @param dataSourceFactory A factory for {@link DataSource}s to read the media.\n-   * @param bandwidthMeter A {@link BandwidthMeter} to notify of loads performed by the source.\n    * @param extractorsFactory Factory for {@link Extractor}s to process the media stream. If the\n    *     possible formats are known, pass a factory that instantiates extractors for those formats.\n    *     Otherwise, pass a {@link DefaultExtractorsFactory} to use default extractors.\n@@ -172,12 +166,11 @@ public final class ExtractorMediaSource implements MediaPeriod, MediaSource,\n    *     if a loading error occurs.\n    * @param eventListener A listener of events. May be null if delivery of events is not required.\n    */\n-  public ExtractorMediaSource(Uri uri, DataSourceFactory dataSourceFactory,\n-      BandwidthMeter bandwidthMeter, ExtractorsFactory extractorsFactory, int minLoadableRetryCount,\n-      Handler eventHandler, EventListener eventListener) {\n+  public ExtractorMediaSource(Uri uri, DataSource.Factory dataSourceFactory,\n+      ExtractorsFactory extractorsFactory, int minLoadableRetryCount, Handler eventHandler,\n+      EventListener eventListener) {\n     this.uri = uri;\n     this.dataSourceFactory = dataSourceFactory;\n-    this.bandwidthMeter = bandwidthMeter;\n     this.extractorsFactory = extractorsFactory;\n     this.minLoadableRetryCount = minLoadableRetryCount;\n     this.eventHandler = eventHandler;\n@@ -214,7 +207,7 @@ public final class ExtractorMediaSource implements MediaPeriod, MediaSource,\n     this.callback = callback;\n     this.allocator = allocator;\n \n-    dataSource = dataSourceFactory.createDataSource(bandwidthMeter);\n+    dataSource = dataSourceFactory.createDataSource();\n     loader = new Loader(\"Loader:ExtractorMediaSource\");\n     extractorHolder = new ExtractorHolder(extractorsFactory.createExtractors(), this);\n     loadCondition = new ConditionVariable();\ndiff --git a/library/src/main/java/com/google/android/exoplayer2/source/SingleSampleMediaSource.java b/library/src/main/java/com/google/android/exoplayer2/source/SingleSampleMediaSource.java\nindex 85f099c790..beca9dc831 100644\n--- a/library/src/main/java/com/google/android/exoplayer2/source/SingleSampleMediaSource.java\n+++ b/library/src/main/java/com/google/android/exoplayer2/source/SingleSampleMediaSource.java\n@@ -22,7 +22,6 @@ import com.google.android.exoplayer2.decoder.DecoderInputBuffer;\n import com.google.android.exoplayer2.trackselection.TrackSelection;\n import com.google.android.exoplayer2.upstream.Allocator;\n import com.google.android.exoplayer2.upstream.DataSource;\n-import com.google.android.exoplayer2.upstream.DataSourceFactory;\n import com.google.android.exoplayer2.upstream.DataSpec;\n import com.google.android.exoplayer2.upstream.Loader;\n import com.google.android.exoplayer2.upstream.Loader.Loadable;\n@@ -71,7 +70,7 @@ public final class SingleSampleMediaSource implements MediaPeriod, MediaSource,\n   private static final int STREAM_STATE_END_OF_STREAM = 2;\n \n   private final Uri uri;\n-  private final DataSourceFactory dataSourceFactory;\n+  private final DataSource.Factory dataSourceFactory;\n   private final Format format;\n   private final long durationUs;\n   private final int minLoadableRetryCount;\n@@ -87,17 +86,17 @@ public final class SingleSampleMediaSource implements MediaPeriod, MediaSource,\n   private byte[] sampleData;\n   private int sampleSize;\n \n-  public SingleSampleMediaSource(Uri uri, DataSourceFactory dataSourceFactory, Format format,\n+  public SingleSampleMediaSource(Uri uri, DataSource.Factory dataSourceFactory, Format format,\n       long durationUs) {\n     this(uri, dataSourceFactory, format, durationUs, DEFAULT_MIN_LOADABLE_RETRY_COUNT);\n   }\n \n-  public SingleSampleMediaSource(Uri uri, DataSourceFactory dataSourceFactory, Format format,\n+  public SingleSampleMediaSource(Uri uri, DataSource.Factory dataSourceFactory, Format format,\n       long durationUs, int minLoadableRetryCount) {\n     this(uri, dataSourceFactory, format, durationUs, minLoadableRetryCount, null, null, 0);\n   }\n \n-  public SingleSampleMediaSource(Uri uri, DataSourceFactory dataSourceFactory, Format format,\n+  public SingleSampleMediaSource(Uri uri, DataSource.Factory dataSourceFactory, Format format,\n       long durationUs, int minLoadableRetryCount, Handler eventHandler, EventListener eventListener,\n       int eventSourceId) {\n     this.uri = uri;\ndiff --git a/library/src/main/java/com/google/android/exoplayer2/source/chunk/FormatEvaluator.java b/library/src/main/java/com/google/android/exoplayer2/source/chunk/FormatEvaluator.java\nindex 9e4f2497c4..f737ff2cdb 100644\n--- a/library/src/main/java/com/google/android/exoplayer2/source/chunk/FormatEvaluator.java\n+++ b/library/src/main/java/com/google/android/exoplayer2/source/chunk/FormatEvaluator.java\n@@ -25,6 +25,18 @@ import java.util.Random;\n  * Selects from a number of available formats during playback.\n  */\n public interface FormatEvaluator {\n+\n+  /**\n+   * A factory for {@link FormatEvaluator} instances.\n+   */\n+  interface Factory {\n+\n+    /**\n+     * Creates a {@link FormatEvaluator} instance.\n+     */\n+    FormatEvaluator createFormatEvaluator();\n+\n+  }\n   \n   /**\n    * A trigger for a load whose reason is unknown or unspecified.\n@@ -124,6 +136,28 @@ public interface FormatEvaluator {\n    */\n   final class RandomEvaluator implements FormatEvaluator {\n \n+    public static class Factory implements FormatEvaluator.Factory {\n+\n+      private final int seed;\n+      private final boolean seedIsSet;\n+\n+      public Factory() {\n+        seed = 0;\n+        seedIsSet = false;\n+      }\n+\n+      public Factory(int seed) {\n+        this.seed = seed;\n+        seedIsSet = true;\n+      }\n+\n+      @Override\n+      public FormatEvaluator createFormatEvaluator() {\n+        return seedIsSet ? new RandomEvaluator(seed) : new RandomEvaluator();\n+      }\n+\n+    }\n+\n     private final Random random;\n \n     private Format[] formats;\n@@ -196,6 +230,21 @@ public interface FormatEvaluator {\n    */\n   final class AdaptiveEvaluator implements FormatEvaluator {\n \n+    public static class Factory implements FormatEvaluator.Factory {\n+\n+      private final BandwidthMeter bandwidthMeter;\n+\n+      public Factory(BandwidthMeter bandwidthMeter) {\n+        this.bandwidthMeter = bandwidthMeter;\n+      }\n+\n+      @Override\n+      public FormatEvaluator createFormatEvaluator() {\n+        return new AdaptiveEvaluator(bandwidthMeter);\n+      }\n+\n+    }\n+\n     private static final int DEFAULT_MAX_INITIAL_BITRATE = 800000;\n \n     private static final int DEFAULT_MIN_DURATION_FOR_QUALITY_INCREASE_MS = 10000;\ndiff --git a/library/src/main/java/com/google/android/exoplayer2/source/dash/DashMediaPeriod.java b/library/src/main/java/com/google/android/exoplayer2/source/dash/DashMediaPeriod.java\nindex 90f7e43046..4abda3bda9 100644\n--- a/library/src/main/java/com/google/android/exoplayer2/source/dash/DashMediaPeriod.java\n+++ b/library/src/main/java/com/google/android/exoplayer2/source/dash/DashMediaPeriod.java\n@@ -32,9 +32,7 @@ import com.google.android.exoplayer2.source.dash.mpd.Period;\n import com.google.android.exoplayer2.source.dash.mpd.Representation;\n import com.google.android.exoplayer2.trackselection.TrackSelection;\n import com.google.android.exoplayer2.upstream.Allocator;\n-import com.google.android.exoplayer2.upstream.BandwidthMeter;\n import com.google.android.exoplayer2.upstream.DataSource;\n-import com.google.android.exoplayer2.upstream.DataSourceFactory;\n import com.google.android.exoplayer2.upstream.Loader;\n \n import android.util.Pair;\n@@ -49,8 +47,8 @@ import java.util.List;\n /* package */ final class DashMediaPeriod implements MediaPeriod,\n     SequenceableLoader.Callback<ChunkSampleStream<DashChunkSource>> {\n \n-  private final DataSourceFactory dataSourceFactory;\n-  private final BandwidthMeter bandwidthMeter;\n+  private final DataSource.Factory dataSourceFactory;\n+  private final FormatEvaluator.Factory formatEvaluatorFactory;\n   private final int minLoadableRetryCount;\n   private final EventDispatcher eventDispatcher;\n   private final long elapsedRealtimeOffset;\n@@ -68,13 +66,13 @@ import java.util.List;\n   private Period period;\n \n   public DashMediaPeriod(MediaPresentationDescription manifest, int index,\n-      DataSourceFactory dataSourceFactory, BandwidthMeter bandwidthMeter,\n+      DataSource.Factory dataSourceFactory, FormatEvaluator.Factory formatEvaluatorFactory,\n       int minLoadableRetryCount, EventDispatcher eventDispatcher, long elapsedRealtimeOffset,\n       Loader loader) {\n     this.manifest = manifest;\n     this.index = index;\n     this.dataSourceFactory = dataSourceFactory;\n-    this.bandwidthMeter = bandwidthMeter;\n+    this.formatEvaluatorFactory = formatEvaluatorFactory;\n     this.minLoadableRetryCount = minLoadableRetryCount;\n     this.eventDispatcher = eventDispatcher;\n     this.elapsedRealtimeOffset = elapsedRealtimeOffset;\n@@ -245,11 +243,11 @@ import java.util.List;\n       long positionUs) {\n     int[] selectedTracks = selection.getTracks();\n     FormatEvaluator adaptiveEvaluator = selectedTracks.length > 1\n-        ? new FormatEvaluator.AdaptiveEvaluator(bandwidthMeter) : null;\n+        ? formatEvaluatorFactory.createFormatEvaluator() : null;\n     int adaptationSetIndex = trackGroupAdaptationSetIndices[selection.group];\n     AdaptationSet adaptationSet = period.adaptationSets.get(adaptationSetIndex);\n     int adaptationSetType = adaptationSet.type;\n-    DataSource dataSource = dataSourceFactory.createDataSource(bandwidthMeter);\n+    DataSource dataSource = dataSourceFactory.createDataSource();\n     DashChunkSource chunkSource = new DashChunkSource(loader, manifest, index, adaptationSetIndex,\n         trackGroups.get(selection.group), selectedTracks, dataSource, adaptiveEvaluator,\n         elapsedRealtimeOffset);\ndiff --git a/library/src/main/java/com/google/android/exoplayer2/source/dash/DashMediaSource.java b/library/src/main/java/com/google/android/exoplayer2/source/dash/DashMediaSource.java\nindex 3b9654ae51..5ea33925f1 100644\n--- a/library/src/main/java/com/google/android/exoplayer2/source/dash/DashMediaSource.java\n+++ b/library/src/main/java/com/google/android/exoplayer2/source/dash/DashMediaSource.java\n@@ -21,12 +21,11 @@ import com.google.android.exoplayer2.source.AdaptiveMediaSourceEventListener;\n import com.google.android.exoplayer2.source.AdaptiveMediaSourceEventListener.EventDispatcher;\n import com.google.android.exoplayer2.source.MediaPeriod;\n import com.google.android.exoplayer2.source.MediaSource;\n+import com.google.android.exoplayer2.source.chunk.FormatEvaluator;\n import com.google.android.exoplayer2.source.dash.mpd.MediaPresentationDescription;\n import com.google.android.exoplayer2.source.dash.mpd.MediaPresentationDescriptionParser;\n import com.google.android.exoplayer2.source.dash.mpd.UtcTimingElement;\n-import com.google.android.exoplayer2.upstream.BandwidthMeter;\n import com.google.android.exoplayer2.upstream.DataSource;\n-import com.google.android.exoplayer2.upstream.DataSourceFactory;\n import com.google.android.exoplayer2.upstream.Loader;\n import com.google.android.exoplayer2.upstream.ParsingLoadable;\n import com.google.android.exoplayer2.util.Util;\n@@ -57,8 +56,8 @@ public final class DashMediaSource implements MediaSource {\n \n   private static final String TAG = \"DashMediaSource\";\n \n-  private final DataSourceFactory dataSourceFactory;\n-  private final BandwidthMeter bandwidthMeter;\n+  private final DataSource.Factory dataSourceFactory;\n+  private final FormatEvaluator.Factory formatEvaluatorFactory;\n   private final int minLoadableRetryCount;\n   private final EventDispatcher eventDispatcher;\n   private final MediaPresentationDescriptionParser manifestParser;\n@@ -75,19 +74,19 @@ public final class DashMediaSource implements MediaSource {\n   private DashMediaPeriod[] periods;\n   private long elapsedRealtimeOffset;\n \n-  public DashMediaSource(Uri manifestUri, DataSourceFactory dataSourceFactory,\n-      BandwidthMeter bandwidthMeter, Handler eventHandler,\n+  public DashMediaSource(Uri manifestUri, DataSource.Factory dataSourceFactory,\n+      FormatEvaluator.Factory formatEvaluatorFactory, Handler eventHandler,\n       AdaptiveMediaSourceEventListener eventListener) {\n-    this(manifestUri, dataSourceFactory, bandwidthMeter, DEFAULT_MIN_LOADABLE_RETRY_COUNT,\n+    this(manifestUri, dataSourceFactory, formatEvaluatorFactory, DEFAULT_MIN_LOADABLE_RETRY_COUNT,\n         eventHandler, eventListener);\n   }\n \n-  public DashMediaSource(Uri manifestUri, DataSourceFactory dataSourceFactory,\n-      BandwidthMeter bandwidthMeter, int minLoadableRetryCount, Handler eventHandler,\n-      AdaptiveMediaSourceEventListener eventListener) {\n+  public DashMediaSource(Uri manifestUri, DataSource.Factory dataSourceFactory,\n+      FormatEvaluator.Factory formatEvaluatorFactory, int minLoadableRetryCount,\n+      Handler eventHandler, AdaptiveMediaSourceEventListener eventListener) {\n     this.manifestUri = manifestUri;\n     this.dataSourceFactory = dataSourceFactory;\n-    this.bandwidthMeter = bandwidthMeter;\n+    this.formatEvaluatorFactory = formatEvaluatorFactory;\n     this.minLoadableRetryCount = minLoadableRetryCount;\n     eventDispatcher = new EventDispatcher(eventHandler, eventListener);\n     manifestParser = new MediaPresentationDescriptionParser();\n@@ -245,7 +244,7 @@ public final class DashMediaSource implements MediaSource {\n     int periodCount = manifest.getPeriodCount();\n     periods = new DashMediaPeriod[periodCount];\n     for (int i = 0; i < periodCount; i++) {\n-      periods[i] = new DashMediaPeriod(manifest, i, dataSourceFactory, bandwidthMeter,\n+      periods[i] = new DashMediaPeriod(manifest, i, dataSourceFactory, formatEvaluatorFactory,\n           minLoadableRetryCount, eventDispatcher, elapsedRealtimeOffset, loader);\n     }\n     scheduleManifestRefresh();\ndiff --git a/library/src/main/java/com/google/android/exoplayer2/source/hls/HlsMediaSource.java b/library/src/main/java/com/google/android/exoplayer2/source/hls/HlsMediaSource.java\nindex f5a0c23a8b..d1a0d2f79a 100644\n--- a/library/src/main/java/com/google/android/exoplayer2/source/hls/HlsMediaSource.java\n+++ b/library/src/main/java/com/google/android/exoplayer2/source/hls/HlsMediaSource.java\n@@ -34,9 +34,7 @@ import com.google.android.exoplayer2.source.hls.playlist.HlsPlaylistParser;\n import com.google.android.exoplayer2.source.hls.playlist.Variant;\n import com.google.android.exoplayer2.trackselection.TrackSelection;\n import com.google.android.exoplayer2.upstream.Allocator;\n-import com.google.android.exoplayer2.upstream.BandwidthMeter;\n import com.google.android.exoplayer2.upstream.DataSource;\n-import com.google.android.exoplayer2.upstream.DataSourceFactory;\n import com.google.android.exoplayer2.upstream.Loader;\n import com.google.android.exoplayer2.upstream.ParsingLoadable;\n import com.google.android.exoplayer2.util.Assertions;\n@@ -64,8 +62,8 @@ public final class HlsMediaSource implements MediaPeriod, MediaSource,\n   public static final int DEFAULT_MIN_LOADABLE_RETRY_COUNT = 3;\n \n   private final Uri manifestUri;\n-  private final DataSourceFactory dataSourceFactory;\n-  private final BandwidthMeter bandwidthMeter;\n+  private final DataSource.Factory dataSourceFactory;\n+  private final FormatEvaluator.Factory formatEvaluatorFactory;\n   private final int minLoadableRetryCount;\n   private final EventDispatcher eventDispatcher;\n   private final IdentityHashMap<SampleStream, HlsSampleStreamWrapper> sampleStreamSources;\n@@ -89,19 +87,19 @@ public final class HlsMediaSource implements MediaPeriod, MediaSource,\n   private HlsSampleStreamWrapper[] enabledSampleStreamWrappers;\n   private CompositeSequenceableLoader sequenceableLoader;\n \n-  public HlsMediaSource(Uri manifestUri, DataSourceFactory dataSourceFactory,\n-      BandwidthMeter bandwidthMeter, Handler eventHandler,\n+  public HlsMediaSource(Uri manifestUri, DataSource.Factory dataSourceFactory,\n+      FormatEvaluator.Factory formatEvaluatorFactory, Handler eventHandler,\n       AdaptiveMediaSourceEventListener eventListener) {\n-    this(manifestUri, dataSourceFactory, bandwidthMeter, DEFAULT_MIN_LOADABLE_RETRY_COUNT,\n+    this(manifestUri, dataSourceFactory, formatEvaluatorFactory, DEFAULT_MIN_LOADABLE_RETRY_COUNT,\n         eventHandler, eventListener);\n   }\n \n-  public HlsMediaSource(Uri manifestUri, DataSourceFactory dataSourceFactory,\n-      BandwidthMeter bandwidthMeter, int minLoadableRetryCount, Handler eventHandler,\n-      AdaptiveMediaSourceEventListener eventListener) {\n+  public HlsMediaSource(Uri manifestUri, DataSource.Factory dataSourceFactory,\n+      FormatEvaluator.Factory formatEvaluatorFactory, int minLoadableRetryCount,\n+      Handler eventHandler, AdaptiveMediaSourceEventListener eventListener) {\n     this.manifestUri = manifestUri;\n     this.dataSourceFactory = dataSourceFactory;\n-    this.bandwidthMeter = bandwidthMeter;\n+    this.formatEvaluatorFactory = formatEvaluatorFactory;\n     this.minLoadableRetryCount = minLoadableRetryCount;\n     eventDispatcher = new EventDispatcher(eventHandler, eventListener);\n \n@@ -347,7 +345,7 @@ public final class HlsMediaSource implements MediaPeriod, MediaSource,\n           Format.NO_VALUE);\n       Variant[] variants = new Variant[] {new Variant(playlist.baseUri, format, null)};\n       sampleStreamWrappers.add(buildSampleStreamWrapper(C.TRACK_TYPE_DEFAULT, baseUri, variants,\n-          new FormatEvaluator.AdaptiveEvaluator(bandwidthMeter), null, null));\n+          formatEvaluatorFactory.createFormatEvaluator(), null, null));\n       return sampleStreamWrappers;\n     }\n \n@@ -381,7 +379,7 @@ public final class HlsMediaSource implements MediaPeriod, MediaSource,\n       Variant[] variants = new Variant[selectedVariants.size()];\n       selectedVariants.toArray(variants);\n       sampleStreamWrappers.add(buildSampleStreamWrapper(C.TRACK_TYPE_DEFAULT, baseUri, variants,\n-          new FormatEvaluator.AdaptiveEvaluator(bandwidthMeter), masterPlaylist.muxedAudioFormat,\n+          formatEvaluatorFactory.createFormatEvaluator(), masterPlaylist.muxedAudioFormat,\n           masterPlaylist.muxedCaptionFormat));\n     }\n \n@@ -409,7 +407,7 @@ public final class HlsMediaSource implements MediaPeriod, MediaSource,\n   private HlsSampleStreamWrapper buildSampleStreamWrapper(int trackType, String baseUri,\n       Variant[] variants, FormatEvaluator formatEvaluator, Format muxedAudioFormat,\n       Format muxedCaptionFormat) {\n-    DataSource dataSource = dataSourceFactory.createDataSource(bandwidthMeter);\n+    DataSource dataSource = dataSourceFactory.createDataSource();\n     HlsChunkSource defaultChunkSource = new HlsChunkSource(baseUri, variants, dataSource,\n         timestampAdjusterProvider, formatEvaluator);\n     return new HlsSampleStreamWrapper(trackType, this, defaultChunkSource, allocator,\ndiff --git a/library/src/main/java/com/google/android/exoplayer2/source/smoothstreaming/SmoothStreamingMediaSource.java b/library/src/main/java/com/google/android/exoplayer2/source/smoothstreaming/SmoothStreamingMediaSource.java\nindex 4a5694c3ff..4c7a962409 100644\n--- a/library/src/main/java/com/google/android/exoplayer2/source/smoothstreaming/SmoothStreamingMediaSource.java\n+++ b/library/src/main/java/com/google/android/exoplayer2/source/smoothstreaming/SmoothStreamingMediaSource.java\n@@ -30,14 +30,11 @@ import com.google.android.exoplayer2.source.TrackGroup;\n import com.google.android.exoplayer2.source.TrackGroupArray;\n import com.google.android.exoplayer2.source.chunk.ChunkSampleStream;\n import com.google.android.exoplayer2.source.chunk.FormatEvaluator;\n-import com.google.android.exoplayer2.source.chunk.FormatEvaluator.AdaptiveEvaluator;\n import com.google.android.exoplayer2.source.smoothstreaming.SmoothStreamingManifest.ProtectionElement;\n import com.google.android.exoplayer2.source.smoothstreaming.SmoothStreamingManifest.StreamElement;\n import com.google.android.exoplayer2.trackselection.TrackSelection;\n import com.google.android.exoplayer2.upstream.Allocator;\n-import com.google.android.exoplayer2.upstream.BandwidthMeter;\n import com.google.android.exoplayer2.upstream.DataSource;\n-import com.google.android.exoplayer2.upstream.DataSourceFactory;\n import com.google.android.exoplayer2.upstream.Loader;\n import com.google.android.exoplayer2.upstream.ParsingLoadable;\n import com.google.android.exoplayer2.util.Assertions;\n@@ -68,8 +65,8 @@ public final class SmoothStreamingMediaSource implements MediaPeriod, MediaSourc\n   private static final int INITIALIZATION_VECTOR_SIZE = 8;\n \n   private final Uri manifestUri;\n-  private final DataSourceFactory dataSourceFactory;\n-  private final BandwidthMeter bandwidthMeter;\n+  private final DataSource.Factory dataSourceFactory;\n+  private final FormatEvaluator.Factory formatEvaluatorFactory;\n   private final int minLoadableRetryCount;\n   private final EventDispatcher eventDispatcher;\n   private final SmoothStreamingManifestParser manifestParser;\n@@ -91,20 +88,20 @@ public final class SmoothStreamingMediaSource implements MediaPeriod, MediaSourc\n   private TrackGroupArray trackGroups;\n   private int[] trackGroupElementIndices;\n \n-  public SmoothStreamingMediaSource(Uri manifestUri, DataSourceFactory dataSourceFactory,\n-      BandwidthMeter bandwidthMeter, Handler eventHandler,\n+  public SmoothStreamingMediaSource(Uri manifestUri, DataSource.Factory dataSourceFactory,\n+      FormatEvaluator.Factory formatEvaluatorFactory, Handler eventHandler,\n       AdaptiveMediaSourceEventListener eventListener) {\n-    this(manifestUri, dataSourceFactory, bandwidthMeter, DEFAULT_MIN_LOADABLE_RETRY_COUNT,\n+    this(manifestUri, dataSourceFactory, formatEvaluatorFactory, DEFAULT_MIN_LOADABLE_RETRY_COUNT,\n         eventHandler, eventListener);\n   }\n \n-  public SmoothStreamingMediaSource(Uri manifestUri, DataSourceFactory dataSourceFactory,\n-      BandwidthMeter bandwidthMeter, int minLoadableRetryCount, Handler eventHandler,\n-      AdaptiveMediaSourceEventListener eventListener) {\n+  public SmoothStreamingMediaSource(Uri manifestUri, DataSource.Factory dataSourceFactory,\n+      FormatEvaluator.Factory formatEvaluatorFactory, int minLoadableRetryCount,\n+      Handler eventHandler, AdaptiveMediaSourceEventListener eventListener) {\n     this.manifestUri = Util.toLowerInvariant(manifestUri.getLastPathSegment()).equals(\"manifest\")\n         ? manifestUri : Uri.withAppendedPath(manifestUri, \"Manifest\");\n     this.dataSourceFactory = dataSourceFactory;\n-    this.bandwidthMeter = bandwidthMeter;\n+    this.formatEvaluatorFactory = formatEvaluatorFactory;\n     this.minLoadableRetryCount = minLoadableRetryCount;\n     this.eventDispatcher = new EventDispatcher(eventHandler, eventListener);\n     manifestParser = new SmoothStreamingManifestParser();\n@@ -358,11 +355,11 @@ public final class SmoothStreamingMediaSource implements MediaPeriod, MediaSourc\n       long positionUs) {\n     int[] selectedTracks = selection.getTracks();\n     FormatEvaluator adaptiveEvaluator = selectedTracks.length > 1\n-        ? new AdaptiveEvaluator(bandwidthMeter) : null;\n+        ? formatEvaluatorFactory.createFormatEvaluator() : null;\n     int streamElementIndex = trackGroupElementIndices[selection.group];\n     StreamElement streamElement = manifest.streamElements[streamElementIndex];\n     int streamElementType = streamElement.type;\n-    DataSource dataSource = dataSourceFactory.createDataSource(bandwidthMeter);\n+    DataSource dataSource = dataSourceFactory.createDataSource();\n     SmoothStreamingChunkSource chunkSource = new SmoothStreamingChunkSource(manifestLoader,\n         manifest, streamElementIndex, trackGroups.get(selection.group), selectedTracks, dataSource,\n         adaptiveEvaluator, trackEncryptionBoxes);\ndiff --git a/library/src/main/java/com/google/android/exoplayer2/upstream/DataSource.java b/library/src/main/java/com/google/android/exoplayer2/upstream/DataSource.java\nindex 47ebd75e5d..44cb574115 100644\n--- a/library/src/main/java/com/google/android/exoplayer2/upstream/DataSource.java\n+++ b/library/src/main/java/com/google/android/exoplayer2/upstream/DataSource.java\n@@ -26,6 +26,18 @@ import java.io.IOException;\n  */\n public interface DataSource {\n \n+  /**\n+   * A factory for {@link DataSource} instances.\n+   */\n+  interface Factory {\n+\n+    /**\n+     * Creates a {@link DataSource} instance.\n+     */\n+    DataSource createDataSource();\n+\n+  }\n+\n   /**\n    * Opens the {@link DataSource} to read the specified data.\n    * <p>\ndiff --git a/library/src/main/java/com/google/android/exoplayer2/upstream/DataSourceFactory.java b/library/src/main/java/com/google/android/exoplayer2/upstream/DataSourceFactory.java\ndeleted file mode 100644\nindex e79c1e9cca..0000000000\n--- a/library/src/main/java/com/google/android/exoplayer2/upstream/DataSourceFactory.java\n+++ /dev/null\n@@ -1,35 +0,0 @@\n-/*\n- * Copyright (C) 2016 The Android Open Source Project\n- *\n- * Licensed under the Apache License, Version 2.0 (the \"License\");\n- * you may not use this file except in compliance with the License.\n- * You may obtain a copy of the License at\n- *\n- *      http://www.apache.org/licenses/LICENSE-2.0\n- *\n- * Unless required by applicable law or agreed to in writing, software\n- * distributed under the License is distributed on an \"AS IS\" BASIS,\n- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n- * See the License for the specific language governing permissions and\n- * limitations under the License.\n- */\n-package com.google.android.exoplayer2.upstream;\n-\n-/**\n- * A factory for {@link DataSource} instances.\n- */\n-public interface DataSourceFactory {\n-\n-  /**\n-   * Creates a {@link DataSource} instance.\n-   */\n-  DataSource createDataSource();\n-\n-  /**\n-   * Creates a {@link DataSource} instance.\n-   *\n-   * @param listener A {@link TransferListener} to receive events from the instance.\n-   */\n-  DataSource createDataSource(TransferListener listener);\n-\n-}\ndiff --git a/library/src/main/java/com/google/android/exoplayer2/upstream/DefaultDataSourceFactory.java b/library/src/main/java/com/google/android/exoplayer2/upstream/DefaultDataSourceFactory.java\nindex 98e5411002..3a0d95bbec 100644\n--- a/library/src/main/java/com/google/android/exoplayer2/upstream/DefaultDataSourceFactory.java\n+++ b/library/src/main/java/com/google/android/exoplayer2/upstream/DefaultDataSourceFactory.java\n@@ -15,37 +15,41 @@\n  */\n package com.google.android.exoplayer2.upstream;\n \n+import com.google.android.exoplayer2.upstream.DataSource.Factory;\n+\n import android.content.Context;\n \n /**\n- * A {@link DataSourceFactory} that produces {@link DefaultDataSource} instances that delegate to\n+ * A {@link Factory} that produces {@link DefaultDataSource} instances that delegate to\n  * {@link DefaultHttpDataSource}s for non-file/asset/content URIs.\n  */\n-public final class DefaultDataSourceFactory implements DataSourceFactory {\n+public final class DefaultDataSourceFactory implements Factory {\n \n   private final Context context;\n   private final String userAgent;\n+  private final TransferListener transferListener;\n   private final boolean allowCrossProtocolRedirects;\n \n   public DefaultDataSourceFactory(Context context, String userAgent) {\n-    this(context, userAgent, false);\n+    this(context, userAgent, null);\n+  }\n+\n+  public DefaultDataSourceFactory(Context context, String userAgent,\n+      TransferListener transferListener) {\n+    this(context, userAgent, transferListener, false);\n   }\n \n   public DefaultDataSourceFactory(Context context, String userAgent,\n-      boolean allowCrossProtocolRedirects) {\n+      TransferListener transferListener, boolean allowCrossProtocolRedirects) {\n     this.context = context.getApplicationContext();\n     this.userAgent = userAgent;\n+    this.transferListener = transferListener;\n     this.allowCrossProtocolRedirects = allowCrossProtocolRedirects;\n   }\n \n   @Override\n   public DefaultDataSource createDataSource() {\n-    return createDataSource(null);\n-  }\n-\n-  @Override\n-  public DefaultDataSource createDataSource(TransferListener listener) {\n-    return new DefaultDataSource(context, listener, userAgent, allowCrossProtocolRedirects);\n+    return new DefaultDataSource(context, transferListener, userAgent, allowCrossProtocolRedirects);\n   }\n \n }\ndiff --git a/playbacktests/src/main/java/com/google/android/exoplayer2/playbacktests/gts/DashTest.java b/playbacktests/src/main/java/com/google/android/exoplayer2/playbacktests/gts/DashTest.java\nindex 14d06aec73..9253a6249c 100644\n--- a/playbacktests/src/main/java/com/google/android/exoplayer2/playbacktests/gts/DashTest.java\n+++ b/playbacktests/src/main/java/com/google/android/exoplayer2/playbacktests/gts/DashTest.java\n@@ -31,11 +31,15 @@ import com.google.android.exoplayer2.playbacktests.util.MetricsLogger;\n import com.google.android.exoplayer2.source.MediaSource;\n import com.google.android.exoplayer2.source.TrackGroup;\n import com.google.android.exoplayer2.source.TrackGroupArray;\n+import com.google.android.exoplayer2.source.chunk.FormatEvaluator;\n+import com.google.android.exoplayer2.source.chunk.FormatEvaluator.AdaptiveEvaluator;\n import com.google.android.exoplayer2.source.dash.DashMediaSource;\n import com.google.android.exoplayer2.trackselection.MappingTrackSelector;\n import com.google.android.exoplayer2.trackselection.TrackSelection;\n import com.google.android.exoplayer2.upstream.BandwidthMeter;\n-import com.google.android.exoplayer2.upstream.DataSourceFactory;\n+import com.google.android.exoplayer2.upstream.DataSource;\n+import com.google.android.exoplayer2.upstream.DefaultBandwidthMeter;\n+import com.google.android.exoplayer2.upstream.DefaultDataSourceFactory;\n import com.google.android.exoplayer2.util.Assertions;\n import com.google.android.exoplayer2.util.MimeTypes;\n import com.google.android.exoplayer2.util.Util;\n@@ -418,9 +422,13 @@ public final class DashTest extends ActivityInstrumentationTestCase2<HostActivit\n   ",
    "Removed files moved to thymeleaf - docs .": "diff --git a/src/site/documentation.html b/src/site/documentation.html\nindex e7a90f310..763d51c08 100755\n--- a/src/site/documentation.html\n+++ b/src/site/documentation.html\n@@ -83,10 +83,10 @@ <h2>Tutorials and Guides</h2>\n     <ul>\n       <li>\n         <b>Using Thymeleaf</b> (13 May 2014)\n-          [<a target=\"_blank\" href=\"doc/html/Using-Thymeleaf.html\">Read online</a>]\n-          [<a target=\"_blank\" href=\"doc/pdf/Using-Thymeleaf.pdf\">PDF</a>]\n-          [<a target=\"_blank\" href=\"doc/ebook/Using-Thymeleaf.epub\">EPUB</a>]\n-          [<a target=\"_blank\" href=\"doc/ebook/Using-Thymeleaf.mobi\">MOBI</a>]\n+          [<a target=\"_blank\" href=\"doc/usingthymeleaf.html\">Read online</a>]\n+          [<a target=\"_blank\" href=\"doc/usingthymeleaf.pdf\">PDF</a>]\n+          [<a target=\"_blank\" href=\"doc/usingthymeleaf.epub\">EPUB</a>]\n+          [<a target=\"_blank\" href=\"doc/usingthymeleaf.mobi\">MOBI</a>]\n         <ul>\n           <li>\n \t\t      Example Application: Good Thymes Virtual Grocery (13 May 2014)\n@@ -96,10 +96,10 @@ <h2>Tutorials and Guides</h2>\n       </li>\n       <li>\n         <b>Thymeleaf + Spring 3</b> (13 May 2014)\n-          [<a target=\"_blank\" href=\"doc/html/Thymeleaf-Spring3.html\">Read online</a>]\n-          [<a target=\"_blank\" href=\"doc/pdf/Thymeleaf-Spring3.pdf\">PDF</a>]\n-          [<a target=\"_blank\" href=\"doc/ebook/Thymeleaf-Spring3.epub\">EPUB</a>]\n-          [<a target=\"_blank\" href=\"doc/ebook/Thymeleaf-Spring3.mobi\">MOBI</a>]\n+          [<a target=\"_blank\" href=\"doc/thymeleafspring.html\">Read online</a>]\n+          [<a target=\"_blank\" href=\"doc/thymeleafspring.pdf\">PDF</a>]\n+          [<a target=\"_blank\" href=\"doc/thymeleafspring.epub\">EPUB</a>]\n+          [<a target=\"_blank\" href=\"doc/thymeleafspring.mobi\">MOBI</a>]\n         <ul>\n           <li>\n \t\t    Example Application: Spring Thyme Seed Starter Manager (13 May 2014)\n@@ -109,10 +109,10 @@ <h2>Tutorials and Guides</h2>\n       </li>\n       <li>\n         <b>Extending Thymeleaf</b> (13 May 2014)\n-          [<a target=\"_blank\" href=\"doc/html/Extending-Thymeleaf.html\">Read online</a>]\n-          [<a target=\"_blank\" href=\"doc/pdf/Extending-Thymeleaf.pdf\">PDF</a>]\n-          [<a target=\"_blank\" href=\"doc/ebook/Extending-Thymeleaf.epub\">EPUB</a>]\n-          [<a target=\"_blank\" href=\"doc/ebook/Extending-Thymeleaf.mobi\">MOBI</a>]\n+          [<a target=\"_blank\" href=\"doc/extendingthymeleaf.html\">Read online</a>]\n+          [<a target=\"_blank\" href=\"doc/extendingthymeleaf.pdf\">PDF</a>]\n+          [<a target=\"_blank\" href=\"doc/extendingthymeleaf.epub\">EPUB</a>]\n+          [<a target=\"_blank\" href=\"doc/extendingthymeleaf.mobi\">MOBI</a>]\n         <ul>\n           <li>\n \t\t    Example Application: Extrathyme - Thymeland's football website (13 May 2014)\n@@ -134,15 +134,15 @@ <h2>Basic Articles</h2>\n         \n     <ul>\n       <li>\n-        <b>Getting started with the Standard dialects in 5 minutes</b> (04 November 2013) [<a href=\"standarddialect5minutes.html\">Read online</a>]\n+        <b>Getting started with the Standard dialects in 5 minutes</b> (04 November 2013) [<a href=\"/doc/standarddialect5minutes.html\">Read online</a>]\n       </li>\n       <li>\n         <b>Standard URL Syntax</b> (13 May 2014)\n-\t\t[<a href=\"standardurlsyntax.html\">Read online</a>]\n+\t\t[<a href=\"/doc/standardurlsyntax.html\">Read online</a>]\n       </li>\n       <li>\n         <b>Spring MVC + Thymeleaf: how to access data from templates</b> (01 May 2014)\n-        [<a href=\"springmvcaccessdata.html\">Read online</a>]\n+        [<a href=\"/doc/springmvcaccessdata.html\">Read online</a>]\n       </li>\n     </ul>\n     \n@@ -151,9 +151,9 @@ <h2>Basic Articles</h2>\n     <h2>More Articles</h2>\n     \n     <ul>\n-      <li><b>From HTML to HTML (via HTML)</b> [<a href=\"fromhtmltohtmlviahtml.html\">Read online</a>]</li>\n+      <li><b>From HTML to HTML (via HTML)</b> [<a href=\"/doc/fromhtmltohtmlviahtml.html\">Read online</a>]</li>\n       <li>\n-        <b>Spring MVC view layer: Thymeleaf vs. JSP</b> [<a href=\"thvsjsp.html\">Read online</a>]\n+        <b>Spring MVC view layer: Thymeleaf vs. JSP</b> [<a href=\"/doc/thvsjsp.html\">Read online</a>]\n         <ul>\n           <li>\n \t\t    Example Application: Thymeleaf vs JSP (13 May 2014)\n@@ -162,7 +162,7 @@ <h2>More Articles</h2>\n         </ul>\n       </li>\n       <li>\n-        <b>Say Hello! Extending Thymeleaf in 5 minutes</b> [<a href=\"sayhelloextendingthymeleaf5minutes.html\">Read online</a>]\n+        <b>Say Hello! Extending Thymeleaf in 5 minutes</b> [<a href=\"/doc/sayhelloextendingthymeleaf5minutes.html\">Read online</a>]\n         <ul>\n           <li>\n \t\t    Example Application: Say Hello! (13 May 2014)\n@@ -171,7 +171,7 @@ <h2>More Articles</h2>\n         </ul>\n       </li>\n       <li>\n-        <b>Say Hello Again! Extending Thymeleaf even more in another 5 minutes</b> [<a href=\"sayhelloagainextendingthymeleafevenmore5minutes.html\">Read online</a>]\n+        <b>Say Hello Again! Extending Thymeleaf even more in another 5 minutes</b> [<a href=\"/doc/sayhelloagainextendingthymeleafevenmore5minutes.html\">Read online</a>]\n         <ul>\n           <li>\n \t\t    Example Application: Say Hello! (13 May 2014)\n@@ -180,7 +180,7 @@ <h2>More Articles</h2>\n         </ul>\n       </li>\n       <li>\n-        <b>Thymeleaf + Spring Security integration basics</b> [<a href=\"springsecurity.html\">Read online</a>]\n+        <b>Thymeleaf + Spring Security integration basics</b> [<a href=\"/doc/springsecurity.html\">Read online</a>]\n         <ul>\n           <li>\n \t\t    Example Application: Thymeleaf-SpringSecurity (13 May 2014)\n@@ -189,7 +189,7 @@ <h2>More Articles</h2>\n         </ul>\n       </li>\n       <li>\n-        <b>Rich HTML email in Spring with Thymeleaf</b> [<a href=\"springmail.html\">Read online</a>]\n+        <b>Rich HTML email in Spring with Thymeleaf</b> [<a href=\"/doc/springmail.html\">Read online</a>]\n         <ul>\n           <li>\n \t\t    Example Application: Thymeleaf-SpringMail (13 May 2014)\n@@ -198,7 +198,7 @@ <h2>More Articles</h2>\n         </ul>\n       </li>\n       <li>\n-        <b>Bringing Thymeleaf and Natural Templates to the Spring PetClinic</b> [<a href=\"petclinic.html\">Read online</a>]\n+        <b>Bringing Thymeleaf and Natural Templates to the Spring PetClinic</b> [<a href=\"/doc/petclinic.html\">Read online</a>]\n         <ul>\n           <li>\n \t\t    Example Application: Thymeleaf-PetClinic (13 May 2014)\n@@ -207,7 +207,7 @@ <h2>More Articles</h2>\n         </ul>\n       </li>\n       <li>\n-          <b>Thymeleaf Page Layouts</b> [<a href=\"layouts.html\">Read online</a>]\n+          <b>Thymeleaf Page Layouts</b> [<a href=\"/doc/layouts.html\">Read online</a>]\n           <ul>\n               <li>\n                   Example Application: Thymeleaf Layouts (13 May 2014)\ndiff --git a/src/site/extendingthymeleaf.html b/src/site/extendingthymeleaf.html\ndeleted file mode 100755\nindex 5fd888b0b..000000000\n--- a/src/site/extendingthymeleaf.html\n+++ /dev/null\n@@ -1,98 +0,0 @@\n-<!DOCTYPE html>\n-<html>\n-\n-  <head>\n-    <meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" />\n-    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\" />\n-    <title>Extending Thymeleaf - Thymeleaf: java XML/XHTML/HTML5 template engine</title>\n-    <link rel=\"stylesheet\" type=\"text/css\" media=\"all\" href=\"css/thymeleaf.css\" />\n-    <link rel=\"shortcut icon\" href=\"http://www.thymeleaf.org/favicon.ico\" />\n-    <script type=\"text/javascript\" src=\"https://apis.google.com/js/plusone.js\">\n-      {lang:'en', parsetags:'explicit'}\n-    </script>\n-    <script type=\"text/javascript\">\n-      var _gaq = _gaq || [];\n-      _gaq.push(['_setAccount', 'UA-1276954-9']);\n-      _gaq.push(['_trackPageview']);\n-\n-      (function() {\n-        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;\n-        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';\n-        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);\n-      })();\n-    </script>\n-    <script type=\"text/javascript\" src=\"sh/scripts/shCore.js\"></script>\n-    <script type=\"text/javascript\" src=\"sh/scripts/shBrushXml.js\"></script>\n-    <script type=\"text/javascript\" src=\"sh/scripts/shBrushJava.js\"></script>\n-    <link href=\"sh/styles/shCore.css\" rel=\"stylesheet\" type=\"text/css\" />\n-    <link href=\"sh/styles/shThemeThymeleaf.css\" rel=\"stylesheet\" type=\"text/css\" />\n-  </head>\n-\n-\n-  <body lang=\"en\" dir=\"ltr\">\n-\n-  <div id=\"page\">\n-\n-  \n-   <div id=\"menu\">\n-     <ul>\n-       <li><a href=\"index.html\" title=\"Home\">Home</a></li>\n-       <li><a href=\"features.html\" title=\"Features\">Features</a></li>\n-       <li><a href=\"download.html\" title=\"Download\">Download</a></li>\n-       <li><a href=\"documentation.html\" title=\"Documentation\">Documentation</a></li>\n-       <li><a href=\"ecosystem.html\" title=\"Ecosystem\">Ecosystem</a></li>\n-       <li><a href=\"http://forum.thymeleaf.org\" title=\"User Forum\">User Forum</a></li>\n-       <li><a href=\"issuetracking.html\" title=\"Issue Tracking\">Issue Tracking</a></li>\n-     </ul>\n-   </div>\n-\n-   <div id=\"header\">\n-     <a href=\"index.html\" title=\"Thymeleaf home\"><img src=\"images/thymeleaflogonameverysmall.png\" class=\"logo\" alt=\"Thymeleaf Template Engine\"/></a>\n-   </div>\n-\n-   <div id=\"breadcrumb\">\n-      <a href=\"index.html\">thymeleaf</a>\n-      ::\n-      <a href=\"documentation.html\">documentation</a> \n-      :: \n-      tutorials and guides\n-      ::\n-      <span class=\"current\">extending thymeleaf</span>\n-   </div>\n-\n-\n-   <div id=\"content\">\n-\n-    <h1>Extending Thymeleaf</h1>\n-\n-    <p>\n-      This tutorial has changed location. Please visit the <a href=\"documentation.html\">documentation page</a> in\n-      order to access it.\n-    </p>\n-    \n-   </div>\n-   \n-   <div id=\"footer\">\n-     <div id=\"googleplus\">\n-       <div id=\"plusone-div\" class=\"plusone\"></div>\n-       <script type=\"text/javascript\">\n-           gapi.plusone.render('plusone-div',{\"size\": \"small\", \"count\": \"true\", \"href\": \"http://www.thymeleaf.org\"});\n-       </script>\n-     </div>\n-     <div id=\"twitter\">\n-       <a href=\"http://twitter.com/thymeleaf\" class=\"twitter-follow-button\" data-show-count=\"false\">Follow @thymeleaf</a>\n-       <script src=\"http://platform.twitter.com/widgets.js\" type=\"text/javascript\"></script>\n-     </div>\n-     <div id=\"copy\">\n-       Copyright &copy; The <a href=\"team.html\">THYMELEAF Team</a>. See <a href=\"documentation.html\">applicable licenses</a>.\n-     </div>\n-   </div>\n-   \n-  </div>\n-\n-  <script type=\"text/javascript\">\n-      SyntaxHighlighter.all();\n-  </script>\n-\n-  </body>\n-</html>\ndiff --git a/src/site/faq.html b/src/site/faq.html\nindex 27aee827c..c953d913f 100755\n--- a/src/site/faq.html\n+++ b/src/site/faq.html\n@@ -254,7 +254,7 @@ <h3><a id=\"substitute-jsp\">Can Thymeleaf be used as a complete substitute for JS\n     \n     <p>\n       <b>Absolutely</b>. Not only it can, but we strongly encourage you to do so. Have a look \n-      at our <a href=\"thvsjsp.html\">Thymeleaf vs. JSP</a> article if you want to learn\n+      at our <a href=\"/doc/thvsjsp.html\">Thymeleaf vs. JSP</a> article if you want to learn\n       how these two technologies compare.\n     </p>\n     \n@@ -316,7 +316,7 @@ <h3><a id=\"can-use-HTML5-XML\">How can I use Thymeleaf for HTML5 if it is an XML-\n     </p>\n     <p>\n       If you want to know more about this topic, read our article \n-      <a href=\"fromhtmltohtmlviahtml.html\">From HTML to HTML (via HTML)</a>.\n+      <a href=\"/doc/fromhtmltohtmlviahtml.html\">From HTML to HTML (via HTML)</a>.\n     </p>\n \n \ndiff --git a/src/site/fromhtmltohtmlviahtml.html b/src/site/fromhtmltohtmlviahtml.html\ndeleted file mode 100755\nindex daa7bceff..000000000\n--- a/src/site/fromhtmltohtmlviahtml.html\n+++ /dev/null\n@@ -1,606 +0,0 @@\n-<!DOCTYPE html>\n-<html>\n-\n-  <head>\n-    <meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" />\n-    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\" />\n-    <title>From HTML to HTML (via HTML) - Thymeleaf: java XML/XHTML/HTML5 template engine</title>\n-    <link rel=\"stylesheet\" type=\"text/css\" media=\"all\" href=\"css/thymeleaf.css\" />\n-    <link rel=\"shortcut icon\" href=\"http://www.thymeleaf.org/favicon.ico\" />\n-    <script type=\"text/javascript\" src=\"https://apis.google.com/js/plusone.js\">\n-      {lang:'en', parsetags:'explicit'}\n-    </script>\n-    <script type=\"text/javascript\">\n-      var _gaq = _gaq || [];\n-      _gaq.push(['_setAccount', 'UA-1276954-9']);\n-      _gaq.push(['_trackPageview']);\n-\n-      (function() {\n-        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;\n-        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';\n-        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);\n-      })();\n-    </script>\n-    <script type=\"text/javascript\" src=\"sh/scripts/shCore.js\"></script>\n-    <script type=\"text/javascript\" src=\"sh/scripts/shBrushXml.js\"></script>\n-    <script type=\"text/javascript\" src=\"sh/scripts/shBrushJava.js\"></script>\n-    <script type=\"text/javascript\" src=\"sh/scripts/shBrushPlain.js\"></script>\n-    <link href=\"sh/styles/shCore.css\" rel=\"stylesheet\" type=\"text/css\" />\n-    <link href=\"sh/styles/shThemeThymeleaf.css\" rel=\"stylesheet\" type=\"text/css\" />\n-  </head>\n-\n-\n-  <body lang=\"en\" dir=\"ltr\">\n-\n-  <div id=\"page\">\n-\n-  \n-   <div id=\"menu\">\n-     <ul>\n-       <li><a href=\"index.html\" title=\"Home\">Home</a></li>\n-       <li><a href=\"features.html\" title=\"Features\">Features</a></li>\n-       <li><a href=\"download.html\" title=\"Download\">Download</a></li>\n-       <li><a href=\"documentation.html\" title=\"Documentation\">Documentation</a></li>\n-       <li><a href=\"ecosystem.html\" title=\"Ecosystem\">Ecosystem</a></li>\n-       <li><a href=\"http://forum.thymeleaf.org\" title=\"User Forum\">User Forum</a></li>\n-       <li><a href=\"issuetracking.html\" title=\"Issue Tracking\">Issue Tracking</a></li>\n-     </ul>\n-   </div>\n-\n-   <div id=\"header\">\n-     <a href=\"index.html\" title=\"Thymeleaf home\"><img src=\"images/thymeleaflogonameverysmall.png\" class=\"logo\" alt=\"Thymeleaf Template Engine\"/></a>\n-   </div>\n-\n-   <div id=\"breadcrumb\">\n-      <a href=\"index.html\">thymeleaf</a>\n-      ::\n-      <a href=\"documentation.html\">documentation</a> \n-      :: \n-      articles\n-      ::\n-      <span class=\"current\">from HTML to HTML (via HTML)</span>\n-   </div>\n-\n-\n-   <div id=\"content\">\n-\n-    <h1>From HTML to HTML (via HTML)</h1>\n-\n-    <p>\n-      Knowing the internals of the HTML family of web standards is quite important \n-      when you are using software such as Thymeleaf. At least if you want to understand\n-      what you are doing.\n-    </p>\n-    <p>\n-      The problem is that many people know the technologies they are\n-      using for creating webs, but don't really know where these technologies\n-      come from. It has been a long way since the inception of the first web\n-      interfaces, and since then every new technology has been changing the way\n-      we developed for the web by deprecating a good amount of our work and,\n-      especially, our knowledge.\n-    </p>\n-    <p>\n-      And now, with the arrival of HTML5, things have become even more complicated.\n-      <em>What's it?</em> <em>Why is it HTML instead of XHTML?</em> <em>Wasn't the \n-      HTML tag soup considered harmful?</em>  \n-    </p>\n-    <p>\n-      So let's take a step back, and see how we arrived where we are now, and why.\n-    </p>\n-\n-    <h2>Back in the 90s, there was HTML...</h2>\n-\n-    <p>\n-      ...and HTML was a standard (or more correctly, a\n-      <em>recommendation</em>) maintained by the <em>World Wide Web Consortium</em>\n-      (a.k.a. W3C). Extending from a language called SGML, HTML defined a\n-      tag-based markup language for writing rich hyper-text documents,\n-      highly coupled to the protocol that was used for serving them and\n-      their related resources across the network: the <em>Hyper-Text\n-      Transfer Protocol</em> (HTTP).\n-    </p>\n-    <p>\n-      HTTP used text <em>headers</em> for defining what\n-      was being served to clients and how, one of which was extremely\n-      important: the <kbd>Content-Type</kbd>\n-      header. This header explained to browsers what type of content was\n-      being served to them in a language called <em>MIME (Multipurpose\n-      Internet Mail Extensions)</em>. And the MIME type used for serving\n-      HTML documents was <kbd>text/html</kbd>:\n-    </p>\n-    <script type=\"syntaxhighlighter\" class=\"brush:plain;gutter:false\"><![CDATA[\n-        Content-Type: text/html\n-    ]]></script>\n-    <p>\n-      HTML also defined a way to check whether a\n-      document was <em>valid</em>. Being valid basically meant that the\n-      document was written according to the HTML rules that dictated what\n-      attributes a tag could have, where a tag could appear in the\n-      document, etc.\n-    </p>\n-    <p>\n-      These validity rules were specified using a\n-      language for defining the structure of SGML documents called <em>Document\n-      Type Definition</em> or DTD. A Standard DTD was created for each\n-      version of HTML, and HTML documents had to declare the DTD (and\n-      therefore the version of HTML) they conformed to by means of a clause\n-      that should appear as their first line, the <em>Document Type\n-      Declaration</em> or <kbd>DOCTYPE</kbd> clause:\n-    </p>\n-    <script type=\"syntaxhighlighter\" class=\"brush:html;gutter:false\"><![CDATA[\n-        <!DOCTYPE HTML PUBLIC \"-//W3C//DTD HTML 4.01 Transitional//EN\" \"http://www.w3.org/TR/html4/loose.dtd\">\n-    ]]></script>\n-\n-    <h2>The Document Object Model and the tag soup</h2>\n-   \n-    <p>\n-      HTML was meant for displaying documents in\n-      browsers, and back in the late 90s browsers were made by fiercely\n-      competing companies that wanted to offer the maximum amount of cool\n-      features to their users. Given that HTML only defined rules for\n-      document formatting, many other features were left to the browser\n-      developers' imagination.\n-    </p>\n-    <p>\n-      And one of the most interesting ideas that\n-      appeared in browsers was <em>client-side interactivity</em>. This\n-      interactivity was achieved by executing <em>scripts</em> &mdash; in\n-      languages such as JavaScript &mdash; inside the browser itself, and\n-      giving these scripts the ability to handle, modify and even execute\n-      events on parts of the document being displayed. For this, browsers\n-      had to model HTML documents as in-memory trees of objects, each of\n-      them with state and events, and thus the <em>Document Object Model</em>\n-      (DOM) was born.\n-    </p>\n-    <p>\n-      The problem was that HTML rules for\n-      well-formedness were quite loose whereas DOM trees were strictly\n-      hierarchical structures, and this meant that different\n-      interpretations of HTML tag positions and sequences could lead to\n-      different DOM object trees in different browsers. Add to this the\n-      fact that these different browsers modelled the API of DOM nodes in\n-      different ways (different names, events, etc) and you will start to\n-      get the idea of how difficult it was to create cross-browser\n-      interactivity back then.\n-    </p>\n-    <p>\n-      What's more: while all this was happening,\n-      browsers had been growing quite forgiving with HTML authors, allowing\n-      them to write HTML documents that were not well formed (<em>tag soups</em>)\n-      by automagically correcting their errors. This lead HTML authors to\n-      create even worse formed documents, and then browsers to allow even\n-      more errors in format, adding to a quite destructive cycle. And guess\n-      what: each browser was correcting all these errors in a different\n-      way. Hooray.\n-    </p>\n-    <p>\n-      The W3C finally standardized the DOM API and a\n-      language for scripting in web browsers: JavaScript (although for some\n-      complex reasons they insisted on calling it ECMAScript). But the\n-      damage done by the world of tag soups coupled with the slow adoption\n-      of these standards in full by browser makers &mdash; in many cases\n-      fearing they would damage backwards compatibility &mdash; produced\n-      effects that are still influencing the way we create web applications\n-      today.\n-    </p>\n-\n-    <h2>Enter XML</h2>\n-\n-    <p>\n-      Some time after HTML became a widely spread\n-      language, the W3C developed a new specification called XML\n-      (<em>eXtensible Markup Language</em>), aimed at the representation of\n-      general-purpose data (not only web) in the form of hierarchical\n-      markup text.\n-    </p>\n-    <p>\n-      XML was extensible in that it allowed the\n-      definition of purpose-specific languages (tags and their attributes)\n-      to fit the needs of specific scenarios. But HTML documents were not\n-      well formed from the XML perspective, XML and HTML remained in fact\n-      incompatible languages. It was not possible to express HTML as an XML\n-      <em>application</em>.\n-    </p>\n-    <p>\n-      Being strictly hierarchical and removing the\n-      structural ambiguities of HTML, XML documents were more directly\n-      translatable to standardized DOM trees (a process known as <em>XML\n-      Parsing</em>). Also given the fact that XML was a text-based language,\n-      and that text is a sort of technology-agnostic format (as opposed to\n-      binary), XML became especially suited for the cross-platform\n-      interchange of data across the internet. In fact, it led to the birth\n-      of the now-ubiquitous <em>Web Services</em> technologies.\n-    </p>\n-\n-    <h2>HTML + XML = XHTML</h2>\n-\n-    <p>\n-      At some point, driven by the obvious usefulness of\n-      XML and the fact that it could make web documents more extensible and\n-      interoperable (like, for example, producing more predictable DOMs\n-      across browsers), the W3C decided to reformulate HTML as an XML\n-      dialect (or <em>application</em>) instead of an SGML one, and so XHTML\n-      was born.\n-    </p>\n-    <p>\n-      XHTML required web authors to write their\n-      documents as well-formed XML, which introduced some formatting rules\n-      that didn't exist in HTML before: tags should always be closed,\n-      attributes should always be escaped and surrounded by quotes, etc.\n-    </p>\n-    <p>\n-      The introduction of XHTML and the transformation\n-      of web documents into well formed XML was generally perceived as a\n-      step forward, because it would allow higher levels of standardization\n-      across browsers, less space for authoring errors that had to be\n-      corrected in browser-specific ways, and easier parsing and automated\n-      processing of web pages.\n-    </p>\n-    <p>\n-      As a part of this, XHTML introduced a\n-      controversial concept coming directly from XML and known as <em>Draconian\n-      Error Handling</em>, which meant that any interpreter of XML &mdash;\n-      including now a browser &mdash; should fail immediately should any\n-      kind of format error be found in the XML document being processed. In\n-      practice, this meant that XHTML authors would have to create\n-      perfectly well-formed documents or accept the fact that browsers\n-      would never be able (in fact,",
    "Implemented support for RFC 8441 \\' s SETTING_ENABLE_CONNECT_PROTOCOL . . Signed - off - by : Simone Bordet < simone . bordet @ gmail . com >": "diff --git a/jetty-http2/http2-common/src/main/java/org/eclipse/jetty/http2/HTTP2Session.java b/jetty-http2/http2-common/src/main/java/org/eclipse/jetty/http2/HTTP2Session.java\nindex d385acbdff..89cadfa5ed 100644\n--- a/jetty-http2/http2-common/src/main/java/org/eclipse/jetty/http2/HTTP2Session.java\n+++ b/jetty-http2/http2-common/src/main/java/org/eclipse/jetty/http2/HTTP2Session.java\n@@ -97,6 +97,7 @@ public abstract class HTTP2Session extends ContainerLifeCycle implements ISessio\n     private int initialSessionRecvWindow;\n     private int writeThreshold;\n     private boolean pushEnabled;\n+    private boolean connectProtocolEnabled;\n     private long idleTime;\n     private GoAwayFrame closeFrame;\n \n@@ -370,6 +371,14 @@ public abstract class HTTP2Session extends ContainerLifeCycle implements ISessio\n                     generator.setMaxHeaderListSize(value);\n                     break;\n                 }\n+                case SettingsFrame.ENABLE_CONNECT_PROTOCOL:\n+                {\n+                    boolean enabled = value == 1;\n+                    if (LOG.isDebugEnabled())\n+                        LOG.debug(\"{} CONNECT protocol for {}\", enabled ? \"Enabling\" : \"Disabling\", this);\n+                    connectProtocolEnabled = enabled;\n+                    break;\n+                }\n                 default:\n                 {\n                     if (LOG.isDebugEnabled())\n@@ -906,6 +915,17 @@ public abstract class HTTP2Session extends ContainerLifeCycle implements ISessio\n         return pushEnabled;\n     }\n \n+    @ManagedAttribute(value = \"Whether CONNECT requests supports a protocol\", readonly = true)\n+    public boolean isConnectProtocolEnabled()\n+    {\n+        return connectProtocolEnabled;\n+    }\n+\n+    public void setConnectProtocolEnabled(boolean connectProtocolEnabled)\n+    {\n+        this.connectProtocolEnabled = connectProtocolEnabled;\n+    }\n+\n     /**\n      * A typical close by a remote peer involves a GO_AWAY frame followed by TCP FIN.\n      * This method is invoked when the TCP FIN is received, or when an exception is\ndiff --git a/jetty-http2/http2-common/src/main/java/org/eclipse/jetty/http2/frames/SettingsFrame.java b/jetty-http2/http2-common/src/main/java/org/eclipse/jetty/http2/frames/SettingsFrame.java\nindex 4a4e2d4247..e030491ca1 100644\n--- a/jetty-http2/http2-common/src/main/java/org/eclipse/jetty/http2/frames/SettingsFrame.java\n+++ b/jetty-http2/http2-common/src/main/java/org/eclipse/jetty/http2/frames/SettingsFrame.java\n@@ -30,6 +30,7 @@ public class SettingsFrame extends Frame\n     public static final int INITIAL_WINDOW_SIZE = 4;\n     public static final int MAX_FRAME_SIZE = 5;\n     public static final int MAX_HEADER_LIST_SIZE = 6;\n+    public static final int ENABLE_CONNECT_PROTOCOL = 8;\n \n     private final Map<Integer, Integer> settings;\n     private final boolean reply;\ndiff --git a/jetty-http2/http2-server/src/main/java/org/eclipse/jetty/http2/server/AbstractHTTP2ServerConnectionFactory.java b/jetty-http2/http2-server/src/main/java/org/eclipse/jetty/http2/server/AbstractHTTP2ServerConnectionFactory.java\nindex 7f55001654..62401bbb7a 100644\n--- a/jetty-http2/http2-server/src/main/java/org/eclipse/jetty/http2/server/AbstractHTTP2ServerConnectionFactory.java\n+++ b/jetty-http2/http2-server/src/main/java/org/eclipse/jetty/http2/server/AbstractHTTP2ServerConnectionFactory.java\n@@ -60,6 +60,7 @@ public abstract class AbstractHTTP2ServerConnectionFactory extends AbstractConne\n     private int maxHeaderBlockFragment = 0;\n     private int maxFrameLength = Frame.DEFAULT_MAX_LENGTH;\n     private int maxSettingsKeys = SettingsFrame.DEFAULT_MAX_KEYS;\n+    private boolean connectProtocolEnabled = true;\n     private RateControl.Factory rateControlFactory = new WindowRateControl.Factory(20);\n     private FlowControlStrategy.Factory flowControlStrategyFactory = () -> new BufferingFlowControlStrategy(0.5F);\n     private long streamIdleTimeout;\n@@ -185,6 +186,17 @@ public abstract class AbstractHTTP2ServerConnectionFactory extends AbstractConne\n         this.maxSettingsKeys = maxSettingsKeys;\n     }\n \n+    @ManagedAttribute(\"Whether CONNECT requests supports a protocol\")\n+    public boolean isConnectProtocolEnabled()\n+    {\n+        return connectProtocolEnabled;\n+    }\n+\n+    public void setConnectProtocolEnabled(boolean connectProtocolEnabled)\n+    {\n+        this.connectProtocolEnabled = connectProtocolEnabled;\n+    }\n+\n     /**\n      * @return the factory that creates RateControl objects\n      */\n@@ -237,6 +249,7 @@ public abstract class AbstractHTTP2ServerConnectionFactory extends AbstractConne\n         if (maxConcurrentStreams >= 0)\n             settings.put(SettingsFrame.MAX_CONCURRENT_STREAMS, maxConcurrentStreams);\n         settings.put(SettingsFrame.MAX_HEADER_LIST_SIZE, getHttpConfiguration().getRequestHeaderSize());\n+        settings.put(SettingsFrame.ENABLE_CONNECT_PROTOCOL, isConnectProtocolEnabled() ? 1 : 0);\n         return settings;\n     }\n \n@@ -259,6 +272,7 @@ public abstract class AbstractHTTP2ServerConnectionFactory extends AbstractConne\n             session.setStreamIdleTimeout(streamIdleTimeout);\n         session.setInitialSessionRecvWindow(getInitialSessionRecvWindow());\n         session.setWriteThreshold(getHttpConfiguration().getOutputBufferSize());\n+        session.setConnectProtocolEnabled(isConnectProtocolEnabled());\n \n         ServerParser parser = newServerParser(connector, session, getRateControlFactory().newRateControl(endPoint));\n         parser.setMaxFrameLength(getMaxFrameLength());\ndiff --git a/jetty-http2/http2-server/src/main/java/org/eclipse/jetty/http2/server/HTTP2ServerSession.java b/jetty-http2/http2-server/src/main/java/org/eclipse/jetty/http2/server/HTTP2ServerSession.java\nindex b5ee20f146..8b728dd984 100644\n--- a/jetty-http2/http2-server/src/main/java/org/eclipse/jetty/http2/server/HTTP2ServerSession.java\n+++ b/jetty-http2/http2-server/src/main/java/org/eclipse/jetty/http2/server/HTTP2ServerSession.java\n@@ -108,6 +108,16 @@ public class HTTP2ServerSession extends HTTP2Session implements ServerParser.Lis\n                     if (stream != null)\n                     {\n                         onStreamOpened(stream);\n+\n+                        if (metaData instanceof MetaData.ConnectRequest)\n+                        {\n+                            if (!isConnectProtocolEnabled() && ((MetaData.ConnectRequest)metaData).getProtocol() != null)\n+                            {\n+                                stream.reset(new ResetFrame(streamId, ErrorCode.PROTOCOL_ERROR.code), Callback.NOOP);\n+                                return;\n+                            }\n+                        }\n+\n                         stream.process(frame, Callback.NOOP);\n                         Stream.Listener listener = notifyNewStream(stream, frame);\n                         stream.setListener(listener);\ndiff --git a/jetty-server/src/main/java/org/eclipse/jetty/server/session/Session.java b/jetty-server/src/main/java/org/eclipse/jetty/server/session/Session.java\nindex 50656e17f4..6fe973e6ff 100644\n--- a/jetty-server/src/main/java/org/eclipse/jetty/server/session/Session.java\n+++ b/jetty-server/src/main/java/org/eclipse/jetty/server/session/Session.java\n@@ -378,7 +378,7 @@ public class Session implements SessionHandler.SessionIf\n         try \n         {\n             HttpSessionEvent event = new HttpSessionEvent(this);\n-        for (String name : _sessionData.getKeys())\n+            for (String name : _sessionData.getKeys())\n             {\n                 Object value = _sessionData.getAttribute(name);\n                 if (value instanceof HttpSessionActivationListener)\ndiff --git a/jetty-websocket/jetty-websocket-tests/pom.xml b/jetty-websocket/jetty-websocket-tests/pom.xml\nindex 371005bd23..99eca30543 100644\n--- a/jetty-websocket/jetty-websocket-tests/pom.xml\n+++ b/jetty-websocket/jetty-websocket-tests/pom.xml\n@@ -45,6 +45,18 @@\n       <version>${project.version}</version>\n       <scope>test</scope>\n     </dependency>\n+    <dependency>\n+      <groupId>org.eclipse.jetty</groupId>\n+      <artifactId>jetty-alpn-server</artifactId>\n+      <version>${project.version}</version>\n+      <scope>test</scope>\n+    </dependency>\n+    <dependency>\n+      <groupId>org.eclipse.jetty</groupId>\n+      <artifactId>jetty-alpn-java-server</artifactId>\n+      <version>${project.version}</version>\n+      <scope>test</scope>\n+    </dependency>\n     <dependency>\n       <groupId>org.eclipse.jetty.http2</groupId>\n       <artifactId>http2-http-client-transport</artifactId>\ndiff --git a/jetty-websocket/jetty-websocket-tests/src/test/java/org/eclipse/jetty/websocket/tests/WebSocketOverHTTP2Test.java b/jetty-websocket/jetty-websocket-tests/src/test/java/org/eclipse/jetty/websocket/tests/WebSocketOverHTTP2Test.java\nindex 492b7c3afc..84ae11d94d 100644\n--- a/jetty-websocket/jetty-websocket-tests/src/test/java/org/eclipse/jetty/websocket/tests/WebSocketOverHTTP2Test.java\n+++ b/jetty-websocket/jetty-websocket-tests/src/test/java/org/eclipse/jetty/websocket/tests/WebSocketOverHTTP2Test.java\n@@ -19,23 +19,32 @@\n package org.eclipse.jetty.websocket.tests;\n \n import java.net.URI;\n+import java.util.concurrent.ExecutionException;\n import java.util.concurrent.TimeUnit;\n import java.util.function.Function;\n \n+import org.eclipse.jetty.alpn.server.ALPNServerConnectionFactory;\n import org.eclipse.jetty.client.HttpClient;\n import org.eclipse.jetty.client.dynamic.HttpClientTransportDynamic;\n import org.eclipse.jetty.client.http.HttpClientConnectionFactory;\n+import org.eclipse.jetty.http2.ErrorCode;\n+import org.eclipse.jetty.http2.HTTP2Cipher;\n import org.eclipse.jetty.http2.client.HTTP2Client;\n import org.eclipse.jetty.http2.client.http.ClientConnectionFactoryOverHTTP2;\n+import org.eclipse.jetty.http2.server.AbstractHTTP2ServerConnectionFactory;\n import org.eclipse.jetty.http2.server.HTTP2CServerConnectionFactory;\n+import org.eclipse.jetty.http2.server.HTTP2ServerConnectionFactory;\n import org.eclipse.jetty.io.ClientConnectionFactory;\n import org.eclipse.jetty.io.ClientConnector;\n import org.eclipse.jetty.server.HttpConfiguration;\n import org.eclipse.jetty.server.HttpConnectionFactory;\n+import org.eclipse.jetty.server.SecureRequestCustomizer;\n import org.eclipse.jetty.server.Server;\n import org.eclipse.jetty.server.ServerConnector;\n+import org.eclipse.jetty.server.SslConnectionFactory;\n import org.eclipse.jetty.servlet.ServletContextHandler;\n import org.eclipse.jetty.servlet.ServletHolder;\n+import org.eclipse.jetty.util.ssl.SslContextFactory;\n import org.eclipse.jetty.util.thread.QueuedThreadPool;\n import org.eclipse.jetty.websocket.api.Session;\n import org.eclipse.jetty.websocket.api.StatusCode;\n@@ -44,9 +53,12 @@ import org.eclipse.jetty.websocket.server.JettyWebSocketServlet;\n import org.eclipse.jetty.websocket.server.JettyWebSocketServletFactory;\n import org.eclipse.jetty.websocket.server.config.JettyWebSocketServletContainerInitializer;\n import org.junit.jupiter.api.AfterEach;\n+import org.junit.jupiter.api.Assertions;\n import org.junit.jupiter.api.BeforeEach;\n import org.junit.jupiter.api.Test;\n \n+import static org.hamcrest.MatcherAssert.assertThat;\n+import static org.hamcrest.Matchers.containsStringIgnoringCase;\n import static org.junit.jupiter.api.Assertions.assertEquals;\n import static org.junit.jupiter.api.Assertions.assertNotNull;\n import static org.junit.jupiter.api.Assertions.assertNull;\n@@ -56,6 +68,7 @@ public class WebSocketOverHTTP2Test\n {\n     private Server server;\n     private ServerConnector connector;\n+    private ServerConnector tlsConnector;\n \n     @BeforeEach\n     public void startServer() throws Exception\n@@ -63,12 +76,27 @@ public class WebSocketOverHTTP2Test\n         QueuedThreadPool serverThreads = new QueuedThreadPool();\n         serverThreads.setName(\"server\");\n         server = new Server(serverThreads);\n-        HttpConfiguration httpConfiguration = new HttpConfiguration();\n-        HttpConnectionFactory h1 = new HttpConnectionFactory(httpConfiguration);\n-        HTTP2CServerConnectionFactory h2c = new HTTP2CServerConnectionFactory(httpConfiguration);\n-        connector = new ServerConnector(server, 1, 1, h1, h2c);\n+        HttpConfiguration httpConfig = new HttpConfiguration();\n+        HttpConnectionFactory h1c = new HttpConnectionFactory(httpConfig);\n+        HTTP2CServerConnectionFactory h2c = new HTTP2CServerConnectionFactory(httpConfig);\n+        connector = new ServerConnector(server, 1, 1, h1c, h2c);\n         server.addConnector(connector);\n \n+        SslContextFactory.Server sslContextFactory = new SslContextFactory.Server();\n+        sslContextFactory.setKeyStorePath(\"src/test/resources/keystore.p12\");\n+        sslContextFactory.setKeyStorePassword(\"storepwd\");\n+        sslContextFactory.setCipherComparator(HTTP2Cipher.COMPARATOR);\n+\n+        HttpConfiguration httpsConfig = new HttpConfiguration(httpConfig);\n+        httpsConfig.addCustomizer(new SecureRequestCustomizer());\n+        HttpConnectionFactory h1s = new HttpConnectionFactory(httpsConfig);\n+        HTTP2ServerConnectionFactory h2s = new HTTP2ServerConnectionFactory(httpsConfig);\n+        ALPNServerConnectionFactory alpn = new ALPNServerConnectionFactory();\n+        alpn.setDefaultProtocol(h1c.getProtocol());\n+        SslConnectionFactory ssl = new SslConnectionFactory(sslContextFactory, alpn.getProtocol());\n+        tlsConnector = new ServerConnector(server, 1, 1, ssl, alpn, h2s, h1s);\n+        server.addConnector(tlsConnector);\n+\n         ServletContextHandler context = new ServletContextHandler(server, \"/\");\n         context.addServlet(new ServletHolder(new JettyWebSocketServlet()\n         {\n@@ -128,4 +156,30 @@ public class WebSocketOverHTTP2Test\n         assertEquals(StatusCode.NORMAL, wsEndPoint.statusCode);\n         assertNull(wsEndPoint.error);\n     }\n+\n+    @Test\n+    public void testConnectProtocolDisabled() throws Exception\n+    {\n+        AbstractHTTP2ServerConnectionFactory h2c = connector.getBean(AbstractHTTP2ServerConnectionFactory.class);\n+        h2c.setConnectProtocolEnabled(false);\n+\n+        ClientConnector clientConnector = new ClientConnector();\n+        QueuedThreadPool clientThreads = new QueuedThreadPool();\n+        clientThreads.setName(\"client\");\n+        clientConnector.setExecutor(clientThreads);\n+        HTTP2Client http2Client = new HTTP2Client(clientConnector);\n+        HttpClient httpClient = new HttpClient(new HttpClientTransportDynamic(clientConnector, new ClientConnectionFactoryOverHTTP2.H2C(http2Client)));\n+\n+        WebSocketClient wsClient = new WebSocketClient(httpClient);\n+        wsClient.start();\n+\n+        EventSocket wsEndPoint = new EventSocket();\n+        URI uri = URI.create(\"ws://localhost:\" + connector.getLocalPort() + \"/ws/echo\");\n+\n+        ExecutionException failure = Assertions.assertThrows(ExecutionException.class, () ->\n+            wsClient.connect(wsEndPoint, uri).get(5, TimeUnit.SECONDS));\n+\n+        Throwable cause = failure.getCause();\n+        assertThat(cause.getMessage(), containsStringIgnoringCase(ErrorCode.PROTOCOL_ERROR.name()));\n+    }\n }\ndiff --git a/jetty-websocket/jetty-websocket-tests/src/test/resources/keystore.p12 b/jetty-websocket/jetty-websocket-tests/src/test/resources/keystore.p12\nnew file mode 100644\nindex 0000000000..b51c835024\nBinary files /dev/null and b/jetty-websocket/jetty-websocket-tests/src/test/resources/keystore.p12 differ\ndiff --git a/jetty-websocket/websocket-core/src/main/java/org/eclipse/jetty/websocket/core/server/internal/AbstractHandshaker.java b/jetty-websocket/websocket-core/src/main/java/org/eclipse/jetty/websocket/core/server/internal/AbstractHandshaker.java\nindex b11080af73..fc8f1dbfe8 100644\n--- a/jetty-websocket/websocket-core/src/main/java/org/eclipse/jetty/websocket/core/server/internal/AbstractHandshaker.java\n+++ b/jetty-websocket/websocket-core/src/main/java/org/eclipse/jetty/websocket/core/server/internal/AbstractHandshaker.java\n@@ -53,7 +53,7 @@ import org.eclipse.jetty.websocket.core.server.WebSocketNegotiator;\n \n public abstract class AbstractHandshaker implements Handshaker\n {\n-    protected static final Logger LOG = Log.getLogger(RFC8441Handshaker.class);\n+    protected static final Logger LOG = Log.getLogger(AbstractHandshaker.class);\n     private static final HttpField SERVER_VERSION = new PreEncodedHttpField(HttpHeader.SERVER, HttpConfiguration.SERVER_VERSION);\n \n     @Override\n@@ -98,7 +98,6 @@ public abstract class AbstractHandshaker implements Handshaker\n             return false;\n         }\n \n-\n         // Validate negotiated protocol\n         String protocol = negotiation.getSubprotocol();\n         List<String> offeredProtocols = negotiation.getOfferedSubprotocols();\ndiff --git a/jetty-websocket/websocket-core/src/main/java/org/eclipse/jetty/websocket/core/server/internal/RFC6455Handshaker.java b/jetty-websocket/websocket-core/src/main/java/org/eclipse/jetty/websocket/core/server/internal/RFC6455Handshaker.java\nindex f5398e0e49..7053def75d 100644\n--- a/jetty-websocket/websocket-core/src/main/java/org/eclipse/jetty/websocket/core/server/internal/RFC6455Handshaker.java\n+++ b/jetty-websocket/websocket-core/src/main/java/org/eclipse/jetty/websocket/core/server/internal/RFC6455Handshaker.java\n@@ -66,7 +66,7 @@ public final class RFC6455Handshaker extends AbstractHandshaker\n     @Override\n     protected Negotiation newNegotiation(HttpServletRequest request, HttpServletResponse response, WebSocketComponents webSocketComponents)\n     {\n-        return new RFC6544Negotiation(Request.getBaseRequest(request), request, response, webSocketComponents);\n+        return new RFC6455Negotiation(Request.getBaseRequest(request), request, response, webSocketComponents);\n     }\n \n     @Override\n@@ -75,7 +75,7 @@ public final class RFC6455Handshaker extends AbstractHandshaker\n         boolean result = super.validateNegotiation(negotiation);\n         if (!result)\n             return false;\n-        if (((RFC6544Negotiation)negotiation).getKey() == null)\n+        if (((RFC6455Negotiation)negotiation).getKey() == null)\n             throw new BadMessageException(\"Missing request header 'Sec-WebSocket-Key'\");\n         return true;\n     }\n@@ -95,6 +95,6 @@ public final class RFC6455Handshaker extends AbstractHandshaker\n         HttpFields responseFields = response.getHttpFields();\n         responseFields.put(UPGRADE_WEBSOCKET);\n         responseFields.put(CONNECTION_UPGRADE);\n-        responseFields.put(HttpHeader.SEC_WEBSOCKET_ACCEPT, WebSocketCore.hashKey(((RFC6544Negotiation)negotiation).getKey()));\n+        responseFields.put(HttpHeader.SEC_WEBSOCKET_ACCEPT, WebSocketCore.hashKey(((RFC6455Negotiation)negotiation).getKey()));\n     }\n }\ndiff --git a/jetty-websocket/websocket-core/src/main/java/org/eclipse/jetty/websocket/core/server/internal/RFC6544Negotiation.java b/jetty-websocket/websocket-core/src/main/java/org/eclipse/jetty/websocket/core/server/internal/RFC6455Negotiation.java\nsimilarity index 96%\nrename from jetty-websocket/websocket-core/src/main/java/org/eclipse/jetty/websocket/core/server/internal/RFC6544Negotiation.java\nrename to jetty-websocket/websocket-core/src/main/java/org/eclipse/jetty/websocket/core/server/internal/RFC6455Negotiation.java\nindex f836c9b798..1703787ab7 100644\n--- a/jetty-websocket/websocket-core/src/main/java/org/eclipse/jetty/websocket/core/server/internal/RFC6544Negotiation.java\n+++ b/jetty-websocket/websocket-core/src/main/java/org/eclipse/jetty/websocket/core/server/internal/RFC6455Negotiation.java\n@@ -29,12 +29,12 @@ import org.eclipse.jetty.server.Request;\n import org.eclipse.jetty.websocket.core.WebSocketComponents;\n import org.eclipse.jetty.websocket.core.server.Negotiation;\n \n-public class RFC6544Negotiation extends Negotiation\n+public class RFC6455Negotiation extends Negotiation\n {\n     private boolean successful;\n     private String key;\n \n-    public RFC6544Negotiation(Request baseRequest, HttpServletRequest request, HttpServletResponse response, WebSocketComponents components) throws BadMessageException\n+    public RFC6455Negotiation(Request baseRequest, HttpServletRequest request, HttpServletResponse response, WebSocketComponents components) throws BadMessageException\n     {\n         super(baseRequest, request, response, components);\n     }",
    "add support for group by query on information schema": "diff --git a/CHANGES.txt b/CHANGES.txt\nindex f5f5304e05..9b37d783ac 100644\n--- a/CHANGES.txt\n+++ b/CHANGES.txt\n@@ -5,6 +5,9 @@ Changes for Crate\n Unreleased\n ==========\n \n+ - the `group by` clause now also works if information_schema tables are\n+   queried.\n+\n 2013/11/22 0.19.6\n =================\n \ndiff --git a/docs/sql/information_schema.txt b/docs/sql/information_schema.txt\nindex eb447b997e..e5586877d5 100644\n--- a/docs/sql/information_schema.txt\n+++ b/docs/sql/information_schema.txt\n@@ -14,8 +14,7 @@ cluster.\n \n     Currently unsupported are:\n \n-        - select count(*)\n-        - group by\n+        - using aggregate functions without group by.\n \n Tables\n ======\ndiff --git a/sql/src/main/java/org/cratedb/action/ESDocLookup.java b/sql/src/main/java/org/cratedb/action/ESDocLookup.java\nindex 66f4f1313f..d22c4b13db 100644\n--- a/sql/src/main/java/org/cratedb/action/ESDocLookup.java\n+++ b/sql/src/main/java/org/cratedb/action/ESDocLookup.java\n@@ -3,10 +3,8 @@ package org.cratedb.action;\n import org.apache.lucene.index.AtomicReaderContext;\n import org.cratedb.sql.GroupByOnArrayUnsupportedException;\n import org.elasticsearch.common.inject.Inject;\n-import org.elasticsearch.index.fielddata.AtomicFieldData;\n import org.elasticsearch.index.fielddata.ScriptDocValues;\n import org.elasticsearch.search.lookup.DocLookup;\n-import org.elasticsearch.search.lookup.FieldLookup;\n import org.elasticsearch.search.lookup.SearchLookup;\n \n import java.util.List;\ndiff --git a/sql/src/main/java/org/cratedb/action/GroupByFieldLookup.java b/sql/src/main/java/org/cratedb/action/GroupByFieldLookup.java\nindex e7f8419ba5..89dd489624 100644\n--- a/sql/src/main/java/org/cratedb/action/GroupByFieldLookup.java\n+++ b/sql/src/main/java/org/cratedb/action/GroupByFieldLookup.java\n@@ -3,6 +3,8 @@ package org.cratedb.action;\n import org.apache.lucene.index.AtomicReaderContext;\n import org.cratedb.sql.GroupByOnArrayUnsupportedException;\n \n+import java.io.IOException;\n+\n /**\n  * Used to lookup fields by the {@link org.cratedb.action.groupby.SQLGroupingCollector}\n  */\n@@ -10,5 +12,5 @@ public interface GroupByFieldLookup {\n \n     public void setNextDocId(int doc);\n     public void setNextReader(AtomicReaderContext context);\n-    public Object lookupField(String columnName) throws GroupByOnArrayUnsupportedException;\n+    public Object lookupField(final String columnName) throws IOException, GroupByOnArrayUnsupportedException;\n }\ndiff --git a/sql/src/main/java/org/cratedb/action/SQLReduceJobStatus.java b/sql/src/main/java/org/cratedb/action/SQLReduceJobStatus.java\nindex c8bff93d64..7e8af68332 100644\n--- a/sql/src/main/java/org/cratedb/action/SQLReduceJobStatus.java\n+++ b/sql/src/main/java/org/cratedb/action/SQLReduceJobStatus.java\n@@ -1,6 +1,7 @@\n package org.cratedb.action;\n \n import com.google.common.collect.MinMaxPriorityQueue;\n+import org.cratedb.action.groupby.GroupByHelper;\n import org.cratedb.action.groupby.GroupByRow;\n import org.cratedb.action.groupby.GroupByRowComparator;\n import org.cratedb.action.groupby.aggregate.AggExpr;\n@@ -36,20 +37,7 @@ public class SQLReduceJobStatus {\n \n     public Collection<GroupByRow> sortGroupByResult(SQLGroupByResult groupByResult)\n     {\n-        MinMaxPriorityQueue.Builder<GroupByRow> rowBuilder = MinMaxPriorityQueue.orderedBy(this.comparator);\n-        if (parsedStatement.limit != null) {\n-            int limit = parsedStatement.limit;\n-            if (parsedStatement.offset != null) {\n-                limit += parsedStatement.offset;\n-            }\n-            rowBuilder.maximumSize(limit);\n-        }\n-\n-        MinMaxPriorityQueue<GroupByRow> q = rowBuilder.create();\n-        for (GroupByRow groupByRow : groupByResult.result) {\n-            q.add(groupByRow);\n-        }\n-\n-        return q;\n+        return GroupByHelper.sortRows(\n+            groupByResult.result, comparator, parsedStatement.limit, parsedStatement.offset);\n     }\n }\ndiff --git a/sql/src/main/java/org/cratedb/action/TransportDistributedSQLAction.java b/sql/src/main/java/org/cratedb/action/TransportDistributedSQLAction.java\nindex 4c916a91d7..db3d7e076b 100644\n--- a/sql/src/main/java/org/cratedb/action/TransportDistributedSQLAction.java\n+++ b/sql/src/main/java/org/cratedb/action/TransportDistributedSQLAction.java\n@@ -1,6 +1,7 @@\n package org.cratedb.action;\n \n import com.google.common.collect.MinMaxPriorityQueue;\n+import org.cratedb.action.groupby.GroupByHelper;\n import org.cratedb.action.groupby.GroupByKey;\n import org.cratedb.action.groupby.GroupByRow;\n import org.cratedb.action.groupby.GroupByRowComparator;\n@@ -286,7 +287,7 @@ public class TransportDistributedSQLAction extends TransportAction<DistributedSQ\n             try {\n                 listener.onResponse(\n                     new SQLResponse(parsedStatement.cols(),\n-                        groupbyResultToRows(parsedStatement, groupByResult),\n+                        GroupByHelper.sortedRowsToObjectArray(groupByResult, parsedStatement, offset),\n                         rowCount,\n                         sqlRequest.creationTime()\n                     )\n@@ -296,29 +297,6 @@ public class TransportDistributedSQLAction extends TransportAction<DistributedSQ\n             }\n         }\n \n-        private Object[][] groupbyResultToRows(ParsedStatement parsedStatement,\n-                                               MinMaxPriorityQueue<GroupByRow> groupByResult) {\n-            Object[][] rows = new Object[groupByResult.size() - offset][parsedStatement.outputFields().size()];\n-\n-            GroupByRow row;\n-            int currentRow = -1;\n-            int remainingOffset = offset;\n-            while ( (row = groupByResult.pollFirst()) != null) {\n-                if (remainingOffset > 0) {\n-                    remainingOffset -= 1;\n-                    continue;\n-                }\n-\n-                currentRow++;\n-\n-                for (int c = 0; c < parsedStatement.outputFields().size(); c++) {\n-                    rows[currentRow][c] = row.get(parsedStatement.idxMap[c]);\n-                }\n-            }\n-\n-            return rows;\n-        }\n-\n         private String[] extractNodes(GroupShardsIterator shardsIts) {\n             Set<String> nodes = newHashSet();\n \ndiff --git a/sql/src/main/java/org/cratedb/action/groupby/GroupByHelper.java b/sql/src/main/java/org/cratedb/action/groupby/GroupByHelper.java\nnew file mode 100644\nindex 0000000000..338df3d2c9\n--- /dev/null\n+++ b/sql/src/main/java/org/cratedb/action/groupby/GroupByHelper.java\n@@ -0,0 +1,54 @@\n+package org.cratedb.action.groupby;\n+\n+import com.google.common.collect.MinMaxPriorityQueue;\n+import org.cratedb.action.sql.ParsedStatement;\n+import org.cratedb.service.SQLParseService;\n+\n+import java.util.Collection;\n+import java.util.Comparator;\n+\n+public class GroupByHelper {\n+\n+    public static MinMaxPriorityQueue<GroupByRow> sortRows(Collection<GroupByRow> rows,\n+                                                  Comparator<GroupByRow> comparator,\n+                                                  Integer limit,\n+                                                  Integer offset) {\n+\n+        MinMaxPriorityQueue.Builder<GroupByRow> rowBuilder = MinMaxPriorityQueue.orderedBy(comparator);\n+        int nonNullOffset = (offset != null) ? offset : 0;\n+\n+        if (limit != null) {\n+            rowBuilder.maximumSize(limit + nonNullOffset);\n+        } else {\n+            rowBuilder.maximumSize(SQLParseService.DEFAULT_SELECT_LIMIT + nonNullOffset);\n+        }\n+\n+        MinMaxPriorityQueue<GroupByRow> q = rowBuilder.create();\n+        q.addAll(rows);\n+\n+        return q;\n+    }\n+\n+    public static Object[][] sortedRowsToObjectArray(MinMaxPriorityQueue<GroupByRow> rows,\n+                                                     ParsedStatement parsedStatement,\n+                                                     int offset) {\n+        Object[][] result = new Object[rows.size() - offset][parsedStatement.outputFields().size()];\n+        int currentRow = -1;\n+        int remainingOffset = offset;\n+\n+        GroupByRow row;\n+        while ((row = rows.pollFirst()) != null) {\n+            if (remainingOffset > 0) {\n+                remainingOffset--;\n+                continue;\n+            }\n+\n+            currentRow++;\n+            for (int i = 0; i < result[currentRow].length; i++) {\n+                result[currentRow][i] = row.get(parsedStatement.idxMap[i]);\n+            }\n+        }\n+\n+        return result;\n+    }\n+}\ndiff --git a/sql/src/main/java/org/cratedb/action/groupby/SQLGroupingCollector.java b/sql/src/main/java/org/cratedb/action/groupby/SQLGroupingCollector.java\nindex 1f4ebaba58..8e1e3ffb1c 100644\n--- a/sql/src/main/java/org/cratedb/action/groupby/SQLGroupingCollector.java\n+++ b/sql/src/main/java/org/cratedb/action/groupby/SQLGroupingCollector.java\n@@ -11,6 +11,7 @@ import org.cratedb.action.parser.ColumnReferenceDescription;\n import org.cratedb.action.sql.ParsedStatement;\n \n import java.io.IOException;\n+import java.util.Collection;\n import java.util.Map;\n import java.util.TreeMap;\n \ndiff --git a/sql/src/main/java/org/cratedb/information_schema/AbstractInformationSchemaTable.java b/sql/src/main/java/org/cratedb/information_schema/AbstractInformationSchemaTable.java\nindex 299dda4a3a..1863485b8b 100644\n--- a/sql/src/main/java/org/cratedb/information_schema/AbstractInformationSchemaTable.java\n+++ b/sql/src/main/java/org/cratedb/information_schema/AbstractInformationSchemaTable.java\n@@ -1,5 +1,6 @@\n package org.cratedb.information_schema;\n \n+import com.google.common.collect.MinMaxPriorityQueue;\n import com.google.common.io.Files;\n import org.apache.lucene.codecs.lucene42.Lucene42Codec;\n import org.apache.lucene.document.Document;\n@@ -10,6 +11,11 @@ import org.apache.lucene.search.*;\n import org.apache.lucene.store.Directory;\n import org.apache.lucene.store.MMapDirectory;\n import org.apache.lucene.util.Version;\n+import org.cratedb.action.groupby.GroupByHelper;\n+import org.cratedb.action.groupby.GroupByRow;\n+import org.cratedb.action.groupby.GroupByRowComparator;\n+import org.cratedb.action.groupby.SQLGroupingCollector;\n+import org.cratedb.action.groupby.aggregate.AggFunction;\n import org.cratedb.action.sql.OrderByColumnName;\n import org.cratedb.action.sql.ParsedStatement;\n import org.cratedb.action.sql.SQLResponse;\n@@ -34,6 +40,7 @@ import java.util.concurrent.atomic.AtomicInteger;\n public abstract class AbstractInformationSchemaTable implements InformationSchemaTable {\n \n     protected final IndexWriterConfig indexWriterConfig;\n+    private final Map<String, AggFunction> aggFunctionMap;\n     protected IndexWriter indexWriter = null;\n \n     protected final Object indexLock = new Object();\n@@ -43,10 +50,11 @@ public abstract class AbstractInformationSchemaTable implements InformationSchem\n     protected AtomicInteger activeSearches = new AtomicInteger(0);\n     protected Directory indexDirectory;\n \n-    public AbstractInformationSchemaTable() {\n+    public AbstractInformationSchemaTable(Map<String, AggFunction> aggFunctionMap) {\n         this.searcherFactory = new SearcherFactory();\n         this.indexWriterConfig = new IndexWriterConfig(Version.LUCENE_44, null);\n         this.indexWriterConfig.setCodec(new Lucene42Codec());\n+        this.aggFunctionMap = aggFunctionMap;\n     }\n \n     @Override\n@@ -97,6 +105,14 @@ public abstract class AbstractInformationSchemaTable implements InformationSchem\n         limit += offset;\n \n         TopDocs docs;\n+        if (stmt.hasGroupBy()) {\n+            SQLResponse response = doGroupByQuery(stmt, requestStartedTime);\n+            activeSearches.decrementAndGet();\n+            listener.onResponse(response);\n+            return;\n+        }\n+\n+\n         if (sort != null) {\n             docs = indexSearcher.search(stmt.query, null, limit, sort);\n         } else {\n@@ -108,6 +124,47 @@ public abstract class AbstractInformationSchemaTable implements InformationSchem\n         listener.onResponse(response);\n     }\n \n+    protected SQLResponse doGroupByQuery(ParsedStatement stmt, long requestStartedTime) throws IOException {\n+        assert stmt.hasGroupBy();\n+\n+        // the regular group-by workflow involves reducers.\n+        // the GroupingCollector will partition the results by reducer to then do a distributed reduce.\n+        // here DUMMY is used as a pseudo reducer because information-schema group by doesn't involve reducers..\n+        SQLGroupingCollector collector = new SQLGroupingCollector(\n+            stmt,\n+            new InformationSchemaFieldLookup(fieldMapper()),\n+            aggFunctionMap,\n+            new String[] { \"DUMMY\" }\n+        );\n+\n+        indexSearcher.search(stmt.query, collector);\n+\n+        return groupByRowsToSQLResponse(\n+            stmt,\n+            collector.partitionedResult.get(\"DUMMY\").values(),\n+            requestStartedTime\n+        );\n+    }\n+\n+    private SQLResponse groupByRowsToSQLResponse(ParsedStatement stmt,\n+                                                 Collection<GroupByRow> rows,\n+                                                 long requestStartedTime) {\n+        GroupByRowComparator comparator = new GroupByRowComparator(stmt.idxMap, stmt.orderByIndices());\n+\n+        int offset = (stmt.offset != null ? stmt.offset : 0);\n+        return new SQLResponse(\n+            stmt.cols(),\n+            GroupByHelper.sortedRowsToObjectArray(\n+                GroupByHelper.sortRows(rows, comparator, stmt.limit, stmt.offset),\n+                stmt,\n+                offset\n+            ),\n+            rows.size() - offset,\n+            requestStartedTime\n+        );\n+    }\n+\n+\n     @Override\n     public void index(ClusterState clusterState) {\n         synchronized (indexLock) {\ndiff --git a/sql/src/main/java/org/cratedb/information_schema/ColumnsTable.java b/sql/src/main/java/org/cratedb/information_schema/ColumnsTable.java\nindex 2b73460a32..742c2474e1 100644\n--- a/sql/src/main/java/org/cratedb/information_schema/ColumnsTable.java\n+++ b/sql/src/main/java/org/cratedb/information_schema/ColumnsTable.java\n@@ -5,10 +5,12 @@ import org.apache.lucene.document.Document;\n import org.apache.lucene.document.Field;\n import org.apache.lucene.document.IntField;\n import org.apache.lucene.document.StringField;\n+import org.cratedb.action.groupby.aggregate.AggFunction;\n import org.cratedb.index.ColumnDefinition;\n import org.cratedb.index.IndexMetaDataExtractor;\n import org.elasticsearch.cluster.ClusterState;\n import org.elasticsearch.cluster.metadata.IndexMetaData;\n+import org.elasticsearch.common.inject.Inject;\n \n import java.io.IOException;\n import java.util.LinkedHashMap;\n@@ -35,7 +37,9 @@ public class ColumnsTable extends AbstractInformationSchemaTable {\n     IntField ordinalPositionField = new IntField(Columns.ORDINAL_POSITION, 0, Field.Store.YES);\n     StringField dataTypeField = new StringField(Columns.DATA_TYPE, \"\", Field.Store.YES);\n \n-    public ColumnsTable() {\n+    @Inject\n+    public ColumnsTable(Map<String, AggFunction> aggFunctionMap) {\n+        super(aggFunctionMap);\n         fieldMapper.put(\n                 Columns.TABLE_NAME,\n                 new InformationSchemaStringColumn(Columns.TABLE_NAME)\ndiff --git a/sql/src/main/java/org/cratedb/information_schema/IndicesTable.java b/sql/src/main/java/org/cratedb/information_schema/IndicesTable.java\nindex 0839253c1d..f56c11208d 100644\n--- a/sql/src/main/java/org/cratedb/information_schema/IndicesTable.java\n+++ b/sql/src/main/java/org/cratedb/information_schema/IndicesTable.java\n@@ -5,9 +5,11 @@ import org.apache.lucene.document.Document;\n import org.apache.lucene.document.Field;\n import org.apache.lucene.document.StringField;\n import org.apache.lucene.index.Term;\n+import org.cratedb.action.groupby.aggregate.AggFunction;\n import org.cratedb.index.IndexMetaDataExtractor;\n import org.elasticsearch.cluster.ClusterState;\n import org.elasticsearch.cluster.metadata.IndexMetaData;\n+import org.elasticsearch.common.inject.Inject;\n \n import java.io.IOException;\n import java.util.LinkedHashMap;\n@@ -40,7 +42,10 @@ public class IndicesTable extends AbstractInformationSchemaTable {\n     // only internal used\n     StringField uidField = new StringField(\"uid\", \"\", Field.Store.YES);\n \n-    public IndicesTable() {\n+\n+    @Inject\n+    public IndicesTable(Map<String, AggFunction> aggFunctionMap) {\n+        super(aggFunctionMap);\n         fieldMapper.put(\n                 Columns.TABLE_NAME,\n                 new InformationSchemaStringColumn(Columns.TABLE_NAME)\ndiff --git a/sql/src/main/java/org/cratedb/information_schema/InformationSchemaFieldLookup.java b/sql/src/main/java/org/cratedb/information_schema/InformationSchemaFieldLookup.java\nnew file mode 100644\nindex 0000000000..9191bc96d1\n--- /dev/null\n+++ b/sql/src/main/java/org/cratedb/information_schema/InformationSchemaFieldLookup.java\n@@ -0,0 +1,48 @@\n+package org.cratedb.information_schema;\n+\n+import org.apache.lucene.index.AtomicReader;\n+import org.apache.lucene.index.AtomicReaderContext;\n+import org.apache.lucene.index.IndexableField;\n+import org.cratedb.action.GroupByFieldLookup;\n+import org.cratedb.sql.GroupByOnArrayUnsupportedException;\n+\n+import java.io.IOException;\n+import java.util.HashSet;\n+import java.util.Map;\n+import java.util.Set;\n+\n+public class InformationSchemaFieldLookup implements GroupByFieldLookup {\n+\n+    private final Map<String, InformationSchemaColumn> fieldMapper;\n+    int docId;\n+    private AtomicReader reader;\n+\n+    public InformationSchemaFieldLookup(Map<String, InformationSchemaColumn> fieldMapper) {\n+        this.fieldMapper = fieldMapper;\n+    }\n+\n+    @Override\n+    public void setNextDocId(int doc) {\n+        this.docId = doc;\n+    }\n+\n+    @Override\n+    public void setNextReader(AtomicReaderContext context) {\n+        this.reader = context.reader();\n+    }\n+\n+    @Override\n+    public Object lookupField(final String columnName)\n+        throws IOException, GroupByOnArrayUnsupportedException\n+    {\n+        Set<String> fieldsToLoad = new HashSet<>();\n+        fieldsToLoad.add(columnName);\n+\n+        IndexableField[] fields = reader.document(docId, fieldsToLoad).getFields(columnName);\n+        if (fields.length > 1) {\n+            throw new GroupByOnArrayUnsupportedException(columnName);\n+        }\n+\n+        return fieldMapper.get(columnName).getValue(fields[0]);\n+    }\n+}\ndiff --git a/sql/src/main/java/org/cratedb/information_schema/InformationSchemaTableExecutionContext.java b/sql/src/main/java/org/cratedb/information_schema/InformationSchemaTableExecutionContext.java\nindex 42c49e4577..209c98b29a 100644\n--- a/sql/src/main/java/org/cratedb/information_schema/InformationSchemaTableExecutionContext.java\n+++ b/sql/src/main/java/org/cratedb/information_schema/InformationSchemaTableExecutionContext.java\n@@ -75,7 +75,6 @@ public class InformationSchemaTableExecutionContext implements ITableExecutionCo\n \n     @Override\n     public boolean isMultiValued(String columnName) {\n-        // TODO: implement correctly once group by on information_schema is implemented\n-        throw new UnsupportedOperationException(\"This info is currently not available\");\n+        return fieldMapper().get(columnName).allowMultipleValues;\n     }\n }\n\\ No newline at end of file\ndiff --git a/sql/src/main/java/org/cratedb/information_schema/RoutinesTable.java b/sql/src/main/java/org/cratedb/information_schema/RoutinesTable.java\nindex e155a353f3..2af8401d63 100644\n--- a/sql/src/main/java/org/cratedb/information_schema/RoutinesTable.java\n+++ b/sql/src/main/java/org/cratedb/information_schema/RoutinesTable.java\n@@ -5,6 +5,7 @@ import com.google.common.collect.ImmutableMap;\n import org.apache.lucene.document.Document;\n import org.apache.lucene.document.Field;\n import org.apache.lucene.document.StringField;\n+import org.cratedb.action.groupby.aggregate.AggFunction;\n import org.cratedb.action.sql.analyzer.AnalyzerService;\n import org.elasticsearch.cluster.ClusterState;\n import org.elasticsearch.common.inject.Inject;\n@@ -51,8 +52,8 @@ public class RoutinesTable extends AbstractInformationSchemaTable {\n             Field.Store.YES);\n \n     @Inject\n-    public RoutinesTable(AnalyzerService analyzerService) {\n-        super();\n+    public RoutinesTable(Map<String, AggFunction> aggFunctionMap, AnalyzerService analyzerService) {\n+        super(aggFunctionMap);\n         this.analyzerService = analyzerService;\n     }\n \ndiff --git a/sql/src/main/java/org/cratedb/information_schema/TableConstraintsTable.java b/sql/src/main/java/org/cratedb/information_schema/TableConstraintsTable.java\nindex 66b08c8d00..4b0737d808 100644\n--- a/sql/src/main/java/org/cratedb/information_schema/TableConstraintsTable.java\n+++ b/sql/src/main/java/org/cratedb/information_schema/TableConstraintsTable.java\n@@ -4,9 +4,11 @@ import com.google.common.collect.ImmutableMap;\n import org.apache.lucene.document.Document;\n import org.apache.lucene.document.Field;\n import org.apache.lucene.document.StringField;\n+import org.cratedb.action.groupby.aggregate.AggFunction;\n import org.cratedb.index.IndexMetaDataExtractor;\n import org.elasticsearch.cluster.ClusterState;\n import org.elasticsearch.cluster.metadata.IndexMetaData;\n+import org.elasticsearch.common.inject.Inject;\n \n import java.io.IOException;\n import java.util.LinkedHashMap;\n@@ -33,7 +35,10 @@ public class TableConstraintsTable extends AbstractInformationSchemaTable {\n         // UNIQUE, CHECK, FOREIGN KEY etc.\n     }\n \n-    public TableConstraintsTable() {\n+    @Inject\n+    public TableConstraintsTable(Map<String, AggFunction> aggFunctionMap) {\n+        super(aggFunctionMap);\n+\n         fieldMapper.put(\n                 Columns.TABLE_NAME,\n                 new InformationSchemaStringColumn(Columns.TABLE_NAME)\ndiff --git a/sql/src/main/java/org/cratedb/information_schema/TablesTable.java b/sql/src/main/java/org/cratedb/information_schema/TablesTable.java\nindex b627db6618..cec3076aa1 100644\n--- a/sql/src/main/java/org/cratedb/information_schema/TablesTable.java\n+++ b/sql/src/main/java/org/cratedb/information_schema/TablesTable.java\n@@ -5,11 +5,14 @@ import org.apache.lucene.document.Document;\n import org.apache.lucene.document.Field;\n import org.apache.lucene.document.IntField;\n import org.apache.lucene.document.StringField;\n+import org.cratedb.action.groupby.aggregate.AggFunction;\n import org.cratedb.index.IndexMetaDataExtractor;\n import org.elasticsearch.cluster.ClusterState;\n import org.elasticsearch.cluster.metadata.IndexMetaData;\n+import org.elasticsearch.common.inject.Inject;\n \n import java.io.IOException;\n+import java.util.Map;\n \n public class TablesTable extends AbstractInformationSchemaTable {\n \n@@ -23,6 +26,11 @@ public class TablesTable extends AbstractInformationSchemaTable {\n \n     public static final String NAME = \"tables\";\n \n+    @Inject\n+    public TablesTable(Map<String, AggFunction> aggFunctionMap) {\n+        super(aggFunctionMap);\n+    }\n+\n     public class Columns {\n         public static final String TABLE_NAME = \"table_name\";\n         public static final String NUMBER_OF_SHARDS = \"number_of_shards\";\ndiff --git a/sql/src/test/java/org/cratedb/action/SQLGroupingCollectorTest.java b/sql/src/test/java/org/cratedb/action/SQLGroupingCollectorTest.java\nindex 61243fcc0b..77d1a46d19 100644\n--- a/sql/src/test/java/org/cratedb/action/SQLGroupingCollectorTest.java\n+++ b/sql/src/test/java/org/cratedb/action/SQLGroupingCollectorTest.java\n@@ -1,13 +1,11 @@\n package org.cratedb.action;\n \n-import com.google.common.collect.ImmutableMap;\n import junit.framework.TestCase;\n import org.apache.lucene.index.AtomicReaderContext;\n import org.cratedb.action.groupby.*;\n import org.cratedb.action.groupby.aggregate.AggExpr;\n import org.cratedb.action.groupby.aggregate.AggFunction;\n import org.cratedb.action.groupby.aggregate.count.CountAggFunction;\n-import org.cratedb.action.groupby.aggregate.count.CountAggState;\n import org.cratedb.action.parser.ColumnReferenceDescription;\n import org.cratedb.action.sql.ParsedStatement;\n import org.junit.After;\ndiff --git a/sql/src/test/java/org/cratedb/action/parser/LuceneQueryVisitorTest.java b/sql/src/test/java/org/cratedb/action/parser/LuceneQueryVisitorTest.java\nindex 3bfc3bbff1..32db31f4aa 100644\n--- a/sql/src/test/java/org/cratedb/action/parser/LuceneQueryVisitorTest.java\n+++ b/sql/src/test/java/org/cratedb/action/parser/LuceneQueryVisitorTest.java\n@@ -2,6 +2,7 @@ package org.cratedb.action.parser;\n \n import org.apache.lucene.index.Term;\n import org.apache.lucene.search.*;\n+import org.cratedb.action.groupby.aggregate.AggFunction;\n import org.cratedb.action.parser.visitors.QueryVisitor;\n import org.cratedb.action.sql.ITableExecutionContext;\n import org.cratedb.action.sql.NodeExecutionContext;\n@@ -16,6 +17,7 @@ import org.junit.Before;\n import org.junit.Test;\n \n import java.util.HashMap;\n+import java.util.Map;\n \n import static org.junit.Assert.assertEquals;\n import static org.junit.Assert.assertTrue;\n@@ -225,12 +227,13 @@ public class LuceneQueryVisitorTest {\n     }\n \n     private ParsedStatement parse(String statement) throws StandardException {\n+        final Map<String, AggFunction> aggFunctionMap = new HashMap<>();\n         ParsedStatement stmt = new ParsedStatement(statement);\n         QueryPlanner queryPlanner = mock(QueryPlanner.class);\n         NodeExecutionContext context = mock(NodeExecutionContext.class);\n         ITableExecutionContext tableContext = new InformationSchemaTableExecutionContext\n                 (new HashMap<String, InformationSchemaTable>(){{\n-                    put(\"tables\", new TablesTable());\n+                    put(\"tables\", new TablesTable(aggFunctionMap));\n                 }}, \"tables\");\n         when(context.queryPlanner()).thenReturn(queryPlanner);\n         when(context.tableContext(anyString(), anyString())).thenReturn(tableContext);\ndiff --git a/sql/src/test/java/org/cratedb/module/sql/test/InformationSchemaTableTest.java b/sql/src/test/java/org/cratedb/module/sql/test/InformationSchemaTableTest.java\nindex d1a02e6061..8baf75366b 100644\n--- a/sql/src/test/java/org/cratedb/module/sql/test/InformationSchemaTableTest.java\n+++ b/sql/src/test/java/org/cratedb/module/sql/test/InformationSchemaTableTest.java\n@@ -6,6 +6,7 @@ import org.apache.lucene.document.Document;\n import org.apache.lucene.document.Field;\n import org.apache.lucene.document.StringField;\n import org.apache.lucene.search.MatchAllDocsQuery;\n+import org.cratedb.action.groupby.aggregate.AggFunction;\n import org.cratedb.action.sql.ParsedStatement;\n import org.cratedb.action.sql.SQLAction;\n import org.cratedb.action.sql.SQLRequest;\n@@ -23,9 +24,7 @@ import org.junit.*;\n import org.junit.rules.ExpectedException;\n \n import java.io.IOException;\n-import java.util.ArrayList;\n-import java.util.Arrays;\n-import java.util.List;\n+import java.util.*;\n \n import static org.hamcrest.Matchers.arrayContainingInAnyOrder;\n \n@@ -34,14 +33,19 @@ public class InformationSchemaTableTest extends AbstractCrateNodesTests {\n     @Rule\n     public ExpectedException expectedException = ExpectedException.none();\n \n+    Map<String, AggFunction> aggFunctionMap = new HashMap<>();\n+\n     static {\n         ClassLoader.getSystemClassLoader().setDefaultAssertionStatus(true);\n     }\n \n-    public static class TestInformationSchemaTable extends\n-            AbstractInformationSchemaTable {\n+    public static class TestInformationSchemaTable extends AbstractInformationSchemaTable {\n         public static final String NAME = \"nodes\";\n \n+        public TestInformationSchemaTable(Map<String, AggFunction> aggFunctionMap) {\n+            super(aggFunctionMap);\n+        }\n+\n         @Override\n         public void doIndex(ClusterState clusterState) throws IOException {\n             for (DiscoveryNode node : clusterState.nodes()) {\n@@ -113,7 +117,7 @@ public class InformationSchemaTableTest extends AbstractCrateNodesTests {\n \n     @Test\n     public void initTestTable() {\n-        testTable = new TestInformationSchemaTable();\n+        testTable = new TestInformationSchemaTable(aggFunctionMap);\n         assertFalse(testTable.initialized());\n         testTable.init();\n         assertTrue(testTable.initialized());\n@@ -121,7 +125,7 @@ public class InformationSchemaTableTest extends AbstractCrateNodesTests {\n \n     @Test\n     public void lazyInitializeOnIndex() {\n-        testTable = new TestInformationSchemaTable();\n+        testTable = new TestInformationSchemaTable(aggFunctionMap);\n         ClusterState state = client().admin().cluster().prepareState().execute().actionGet()\n                 .getState();\n         assertFalse(testTable.initialized());\n@@ -131,7 +135,7 @@ public class InformationSchemaTableTest extends AbstractCrateNodesTests {\n \n     @Test\n     public void indexThenQuery() {\n-        testTable = new TestInformationSchemaTable();\n+        testTable = new TestInformationSchemaTable(aggFunctionMap);\n         ClusterState state = client().admin().cluster().prepareState().execute().actionGet()\n                 .getState();\n         testTable.index(state);\n@@ -165,7 +169,7 @@ public class InformationSchemaTableTest extends AbstractCrateNodesTests {\n \n     @Test\n     public void emptyQuery() {\n-        testTable = new TestInformationSchemaTable();\n+        testTable = new TestInformationSchemaTable(aggFunctionMap);\n         testTable.init();\n         assertEquals(0L, testTable.count());\n \ndiff --git a/sql/src/test/java/org/cratedb/service/InformationSchemaQueryTest.java b/sql/src/test/java/org/cratedb/service/InformationSchemaQueryTest.java\nindex 6a08d3c0af..0e03cfb478 100644\n--- a/sql/src/test/java/org/cratedb/service/InformationSchemaQueryTest.java\n+++ b/sql/src/test/java/org/cratedb/service/InformationSchemaQueryTest.java\n@@ -82,6 +82,8 @@ public class InformationSchemaQueryTest extends AbstractCrateNodesTests {\n         }\n     }\n \n+\n+\n     private void exec(String statement) throws Exception {\n         exec(statement, new Object[0]);\n     }\n@@ -91,6 +93,16 @@ public class InformationSchemaQueryTest extends AbstractCrateNodesTests {\n         response = informationSchemaService.execute(stmt, System.currentTimeMillis()).actionGet();\n     }\n \n+    @Test\n+    public void testGroupByOnInformationSchema() throws Exception {\n+        exec(\"select count(*) from information_schema.columns group by table_name order by count(*) desc\");\n+        assertEquals(3L, response.rowCount());\n+\n+        exec(\"select count(*) from information_schema.columns group by column_name order by count(*) desc\");\n+        assertEquals(2L, response.rowCount());\n+        assertEquals(3L, response.rows()[0][0]);\n+    }\n+\n     @Test\n     public void testSelectStar() throws Exception {\n         exec(\"select * from information_schema.tables\");",
    "adding plugin examples .": "diff --git a/advanced/pom.xml b/advanced/pom.xml\nindex cc150f0e0a4..72469273080 100644\n--- a/advanced/pom.xml\n+++ b/advanced/pom.xml\n@@ -45,6 +45,11 @@\n       <version>0.1-SNAPSHOT</version>\n       <classifier>neo4j</classifier>\n     </dependency>\n+    <dependency>\n+      <groupId>org.neo4j.app</groupId>\n+      <artifactId>neo4j-server</artifactId>\n+      <version>0.5-SNAPSHOT</version>\n+    </dependency>\n     <dependency>\n       <groupId>junit</groupId>\n       <artifactId>junit-dep</artifactId>\n@@ -116,13 +121,8 @@\n               <mainClass>org.neo4j.shell.StartClient</mainClass>\n               <name>neo4j-shell</name>\n             </program>\n-            <!--\n-              Disabled since there's no longer such a main class. It'd be nice\n-              to have something which runs the tests instead though\n-            -->\n-            <!--\n-              program> <mainClass> org.neo4j.examples.socnet.Main </mainClass>\n-              <name>social-network-application</name> </program -->\n+            <!-- Disabled since there's no longer such a main class. It'd be nice to have something which runs the tests instead though -->\n+            <!-- program> <mainClass> org.neo4j.examples.socnet.Main </mainClass> <name>social-network-application</name> </program -->\n             <program>\n               <mainClass>org.neo4j.examples.CalculateShortestPath</mainClass>\n               <name>calculate-shortest-path</name>\n@@ -321,7 +321,12 @@\n       </plugin>\n     </plugins>\n   </build>\n-\n+  <repositories>\n+    <repository>\n+      <id>java.net</id>\n+      <url>http://download.java.net/maven/2/</url>\n+    </repository>\n+  </repositories>\n   <reporting>\n     <plugins>\n       <plugin>\ndiff --git a/advanced/src/main/java/org/neo4j/examples/server/plugins/DepthTwo.java b/advanced/src/main/java/org/neo4j/examples/server/plugins/DepthTwo.java\nnew file mode 100644\nindex 00000000000..fc7fe22bfc6\n--- /dev/null\n+++ b/advanced/src/main/java/org/neo4j/examples/server/plugins/DepthTwo.java\n@@ -0,0 +1,77 @@\n+/**\n+ * Licensed to Neo Technology under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  Neo Technology licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.neo4j.examples.server.plugins;\n+\n+import org.neo4j.graphdb.Node;\n+import org.neo4j.graphdb.Path;\n+import org.neo4j.graphdb.Relationship;\n+import org.neo4j.graphdb.traversal.PruneEvaluator;\n+import org.neo4j.graphdb.traversal.TraversalDescription;\n+import org.neo4j.helpers.Predicate;\n+import org.neo4j.kernel.Traversal;\n+import org.neo4j.kernel.Uniqueness;\n+import org.neo4j.server.plugins.Description;\n+import org.neo4j.server.plugins.PluginTarget;\n+import org.neo4j.server.plugins.ServerPlugin;\n+import org.neo4j.server.plugins.Source;\n+\n+\n+/**\n+* An extension performaing a predefined graph traversal\n+*/\n+@Description( \"Performs a depth two traversal along all relationship types.\" )\n+public class DepthTwo extends ServerPlugin\n+{\n+    @Description( \"Traverse depth two and return the end nodes\" )\n+    @PluginTarget( Node.class )\n+    public Iterable<Node> nodesOnDepthTwo( @Source Node node )\n+    {\n+        return traversal.traverse( node ).nodes();\n+    }\n+\n+    @Description( \"Traverse depth two and return the last relationships\" )\n+    @PluginTarget( Node.class )\n+    public Iterable<Relationship> relationshipsOnDepthTwo( @Source Node node )\n+    {\n+        return traversal.traverse( node ).relationships();\n+    }\n+\n+    @Description( \"Traverse depth two and return the paths\" )\n+    @PluginTarget( Node.class )\n+    public Iterable<Path> pathsOnDepthTwo( @Source Node node )\n+    {\n+        return traversal.traverse( node );\n+    }\n+\n+    private static final TraversalDescription traversal = Traversal.description().uniqueness(\n+            Uniqueness.RELATIONSHIP_PATH ).prune( new PruneEvaluator()\n+    {\n+        public boolean pruneAfter( Path position )\n+        {\n+            return position.length() >= 2;\n+        }\n+    } ).filter( new Predicate<Path>()\n+    {\n+        public boolean accept( Path item )\n+        {\n+            return item.length() == 2;\n+        }\n+    } );\n+}\ndiff --git a/advanced/src/main/java/org/neo4j/examples/server/plugins/GetAll.java b/advanced/src/main/java/org/neo4j/examples/server/plugins/GetAll.java\nnew file mode 100644\nindex 00000000000..5e253e7660e\n--- /dev/null\n+++ b/advanced/src/main/java/org/neo4j/examples/server/plugins/GetAll.java\n@@ -0,0 +1,61 @@\n+/**\n+ * Licensed to Neo Technology under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  Neo Technology licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.neo4j.examples.server.plugins;\n+\n+import java.util.Iterator;\n+\n+import org.neo4j.graphdb.Direction;\n+import org.neo4j.graphdb.GraphDatabaseService;\n+import org.neo4j.graphdb.Node;\n+import org.neo4j.graphdb.Relationship;\n+import org.neo4j.helpers.collection.NestingIterable;\n+import org.neo4j.server.plugins.Description;\n+import org.neo4j.server.plugins.Name;\n+import org.neo4j.server.plugins.PluginTarget;\n+import org.neo4j.server.plugins.ServerPlugin;\n+import org.neo4j.server.plugins.Source;\n+// START SNIPPET: GetAll\n+\n+@Description( \"An extension to the Neo4j Server for getting all nodes or relationships\" )\n+public class GetAll extends ServerPlugin\n+{\n+    @Name( \"get_all_nodes\" )\n+    @Description( \"Get all nodes from the Neo4j graph database\" )\n+    @PluginTarget( GraphDatabaseService.class )\n+    public Iterable<Node> getAllNodes( @Source GraphDatabaseService graphDb )\n+    {\n+        return graphDb.getAllNodes();\n+    }\n+\n+    @Description( \"Get all relationships from the Neo4j graph database\" )\n+    @PluginTarget( GraphDatabaseService.class )\n+    public Iterable<Relationship> getAllRelationships( @Source GraphDatabaseService graphDb )\n+    {\n+        return new NestingIterable<Relationship, Node>( graphDb.getAllNodes() )\n+        {\n+            @Override\n+            protected Iterator<Relationship> createNestedIterator( Node item )\n+            {\n+                return item.getRelationships( Direction.OUTGOING ).iterator();\n+            }\n+        };\n+    }\n+}\n+//END SNIPPET: GetAll\ndiff --git a/advanced/src/main/java/org/neo4j/examples/server/plugins/ShortestPath.java b/advanced/src/main/java/org/neo4j/examples/server/plugins/ShortestPath.java\nnew file mode 100644\nindex 00000000000..f180da73940\n--- /dev/null\n+++ b/advanced/src/main/java/org/neo4j/examples/server/plugins/ShortestPath.java\n@@ -0,0 +1,62 @@\n+/**\n+ * Licensed to Neo Technology under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  Neo Technology licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.neo4j.examples.server.plugins;\n+\n+import org.neo4j.graphalgo.GraphAlgoFactory;\n+import org.neo4j.graphalgo.PathFinder;\n+import org.neo4j.graphdb.DynamicRelationshipType;\n+import org.neo4j.graphdb.Expander;\n+import org.neo4j.graphdb.Node;\n+import org.neo4j.graphdb.Path;\n+import org.neo4j.kernel.Traversal;\n+import org.neo4j.server.plugins.Description;\n+import org.neo4j.server.plugins.Parameter;\n+import org.neo4j.server.plugins.PluginTarget;\n+import org.neo4j.server.plugins.ServerPlugin;\n+import org.neo4j.server.plugins.Source;\n+\n+public class ShortestPath extends ServerPlugin\n+{\n+    @Description( \"Find the shortest path between two nodes.\" )\n+    @PluginTarget( Node.class )\n+    public Iterable<Path> shortestPath(\n+            @Source Node source,\n+            @Description( \"The node to find the shortest path to.\" ) @Parameter( name = \"target\" ) Node target,\n+            @Description( \"The relationship types to follow when searching for the shortest path(s). Order is insignificant, if omitted all types are followed.\" ) @Parameter( name = \"types\", optional = true ) String[] types,\n+            @Description( \"The maximum path length to search for, default value (if omitted) is 4.\" ) @Parameter( name = \"depth\", optional = true ) Integer depth )\n+    {\n+        Expander expander;\n+        if ( types == null )\n+        {\n+            expander = Traversal.expanderForAllTypes();\n+        }\n+        else\n+        {\n+            expander = Traversal.emptyExpander();\n+            for ( int i = 0; i < types.length; i++ )\n+            {\n+                expander = expander.add( DynamicRelationshipType.withName( types[i] ) );\n+            }\n+        }\n+        PathFinder<Path> shortestPath = GraphAlgoFactory.shortestPath( expander, depth == null ? 4\n+                : depth.intValue() );\n+        return shortestPath.findAllPaths( source, target );\n+    }\n+}\ndiff --git a/advanced/src/site/apt/index.apt b/advanced/src/site/apt/index.apt\nindex a95eed84776..d71ef951160 100644\n--- a/advanced/src/site/apt/index.apt\n+++ b/advanced/src/site/apt/index.apt\n@@ -2,6 +2,9 @@ Neo4j Server\n \n     * {{{./server-rest-api.html}Programming in Java against the Neo4j Server REST API}}\n \n+    * {{{./server-plugins.html}Extending the Neo4j Server REST API with custom functionality}}\n+\n+\n Neo4j Embedded\n \n     Neo4j examples contains code examples using the different components\ndiff --git a/advanced/src/site/apt/server-plugins.apt b/advanced/src/site/apt/server-plugins.apt\nnew file mode 100644\nindex 00000000000..4ed930278db\n--- /dev/null\n+++ b/advanced/src/site/apt/server-plugins.apt\n@@ -0,0 +1,35 @@\n+Server-Plugins\n+\n+    Server-plugins are an easy way to extend the Neo4j REST API with your own functionality.\n+    In order to compile your plugin, you should include the neo4j-server-xx.jar in your classpath,\n+    e.g. via pom.xml:\n+    \n+---\n+<dependency>\n+  <groupId>org.neo4j.app</groupId>\n+  <artifactId>neo4j-server</artifactId>\n+  <version>0.5-SNAPSHOT</version>\n+</dependency>\n+----\n+    \n+    from the neo4j repository at http://m2.neo4j.org/org/neo4j/app/neo4j-server/ or in the system/lib\n+    directory of the Neo4j Server distribution.\n+    \n+    \n+%{source-code|snippet=GetAll|file=src/main/java/org/neo4j/examples/server/plugins/GetAll.java}\n+\n+  In order to let the Neo4j Server find your extension, you need to add the file /META-INF/services/org.neo4j.server.plugins.ServerPlugin\n+  to the resulting .jar file, containing the classname of your plugin as a single line per plugin:\n+  \n+---\n+org.neo4j.examples.server.plugins.GetAll\n+---\n+  \n+  Now, place the myextension.jar (and any custom dependencies) into the $NEO$J_SERVER_HOME/plugins directory, start the server check out the\n+  database representation for the listing of your extension:\n+  \n+---\n+curl -v htto://localhost:7474/db/data\n+---\n+  \n+  Full source code: {{{./xref/org/neo4j/examples/server/plugins/GetAll.html}GetAll.java}}\n\\ No newline at end of file",
    "Removed some redundant nonsense in GroovyPagesSpec .": "diff --git a/spock-grails/src/groovy/grails/plugin/spock/GroovyPagesSpec.groovy b/spock-grails/src/groovy/grails/plugin/spock/GroovyPagesSpec.groovy\nindex fc83c34d..d49dd612 100644\n--- a/spock-grails/src/groovy/grails/plugin/spock/GroovyPagesSpec.groovy\n+++ b/spock-grails/src/groovy/grails/plugin/spock/GroovyPagesSpec.groovy\n@@ -24,7 +24,6 @@ class GroovyPagesSpec extends IntegrationSpec {\n   \n   String template = ''\n   Map params = [:]\n-  Closure transform = { it.toString() }\n   \n   def getRequest() {\n     RequestContextHolder.currentRequestAttributes()\n@@ -46,7 +45,6 @@ def getOutput() {\n     def out = new GrailsPrintWriter(sw)\n     webRequest.out = out\n     w.writeTo(out)\n-    \n-    transform(sw)\n+    sw.toString()\n   }\n }\n\\ No newline at end of file",
    "Updates tab has the line": "diff --git a/app/src/processing/app/contrib/ContributionManagerDialog.java b/app/src/processing/app/contrib/ContributionManagerDialog.java\nindex c0a2b1b69..edc022378 100644\n--- a/app/src/processing/app/contrib/ContributionManagerDialog.java\n+++ b/app/src/processing/app/contrib/ContributionManagerDialog.java\n@@ -261,7 +261,7 @@ public class ContributionManagerDialog {\n         @Override\n         protected void paintComponent(Graphics g) {\n           g.setClip(Toolkit.createRoundRect(0, 0,\n-                                          getWidth(), getHeight()- 2,\n+                                          getWidth(), getHeight(),\n                                           temp == 0 ? 6 : 0,\n                                           temp == 3 ? 6 : 0,\n                                           0, 0));\n@@ -283,7 +283,7 @@ public class ContributionManagerDialog {\n       @Override\n       protected void paintComponent(Graphics g) {\n         g.setClip(Toolkit.createRoundRect(0, 0,\n-                                        getWidth(), getHeight() - 2,\n+                                        getWidth(), getHeight(),\n                                         6,\n                                         6,\n                ",
    "Added generateDefault ( ) method , as an attempt to define a generic .": "diff --git a/findbugs/src/tools/edu/umd/cs/findbugs/tools/patcomp/CodeGen.java b/findbugs/src/tools/edu/umd/cs/findbugs/tools/patcomp/CodeGen.java\nindex fd73bfb45..2edd7c53f 100644\n--- a/findbugs/src/tools/edu/umd/cs/findbugs/tools/patcomp/CodeGen.java\n+++ b/findbugs/src/tools/edu/umd/cs/findbugs/tools/patcomp/CodeGen.java\n@@ -27,26 +27,72 @@ import java.io.PrintStream;\n  *\n  * @author David Hovemeyer\n  */\n-public class CodeGen {\n+public class CodeGen implements PatternCompilerTreeConstants {\n+\tprivate PrintStream out;\n+\n \tpublic CodeGen() {\n \t}\n \n \tpublic void generate(SimpleNode root, PrintStream out) {\n+\t\tthis.out = out;\n \t\tvisit(root);\n \t}\n \n \tprivate void visit(SimpleNode node) {\n \t\tswitch (node.getId()) {\n-\t\tcase PatternCompilerTreeConstants.JJTOPT_PRESCREEN:\n+\t\tcase JJTPRESCREEN:\n \t\t\tgeneratePrescreen(node);\n \t\t\tbreak;\n \t\tdefault:\n-\t\t\tfor (int i = 0; i < node.jjtGetNumChildren(); ++i)\n-\t\t\t\tvisit((SimpleNode) node.jjtGetChild(i));\n+\t\t\tgenerateDefault(node);\n \t\t\tbreak;\n \t\t}\n \t}\n \n+\tpublic void generateDefault(SimpleNode node) {\n+\t\tint numChildren = node.jjtGetNumChildren();\n+\t\tint numTokens = node.getNumTokens();\n+\t\tif (numChildren == 0 && numTokens == 0)\n+\t\t\treturn;\n+\n+\t\t// If there are no child nodes, just emit all of\n+\t\t// the tokens.\n+\t\tif (numChildren == 0) {\n+\t\t\tToken t = node.getFirstToken();\n+\t\t\twhile (t != node.getLastToken()) {\n+\t\t\t\tout.println(t.image);\n+\t\t\t\tt = t.next;\n+\t\t\t}\n+\t\t\treturn;\n+\t\t}\n+\n+\t\t// For each child, emit tokens preceeding that\n+\t\t// child not covered by previous children,\n+\t\t// then visit the child.\n+\t\tToken t = node.getFirstToken();\n+\t\tint childNum = 0;\n+\t\tdo {\n+\t\t\tSimpleNode child = (SimpleNode) node.jjtGetChild(childNum);\n+\t\t\twhile (t != null && t != child.getFirstToken()) {\n+\t\t\t\tout.println(t.image);\n+\t\t\t\tt = t.next;\n+\t\t\t}\n+\n+\t\t\tvisit(child);\n+\n+\t\t\tif (child.getNumTokens() > 0)\n+\t\t\t\tt = child.getLastToken().next;\n+\n+\t\t\t++childNum;\n+\t\t} while (childNum < numChildren);\n+\n+\t\t// Emit rest of tokens\n+\t\twhile (t != null && t != node.getLastToken()) {\n+\t\t\tout.println(t.image);\n+\t\t\tt = t.next;\n+\t\t}\n+\t}\n+\n \tpublic void generatePrescreen(SimpleNode node) {\n \t\tSystem.out.println(\"Generating prescreen code\");\n \t}",
    "Remove snapshot - topic ref ( <issue_id> ) .": "diff --git a/conf/functions_worker.yml b/conf/functions_worker.yml\nindex 70ae311819..444b7fb9f6 100644\n--- a/conf/functions_worker.yml\n+++ b/conf/functions_worker.yml\n@@ -25,7 +25,6 @@ workerPortTls: 6751\n connectorsDirectory: ./connectors\n \n functionMetadataTopicName: metadata\n-functionMetadataSnapshotsTopicPath: snapshots\n clusterCoordinationTopicName: coordinate\n pulsarFunctionsNamespace: public/functions\n pulsarFunctionsCluster: standalone\ndiff --git a/pulsar-functions/worker/src/main/java/org/apache/pulsar/functions/worker/WorkerConfig.java b/pulsar-functions/worker/src/main/java/org/apache/pulsar/functions/worker/WorkerConfig.java\nindex 83a20bf9ce..35d3e18307 100644\n--- a/pulsar-functions/worker/src/main/java/org/apache/pulsar/functions/worker/WorkerConfig.java\n+++ b/pulsar-functions/worker/src/main/java/org/apache/pulsar/functions/worker/WorkerConfig.java\n@@ -59,7 +59,6 @@ public class WorkerConfig implements Serializable, PulsarConfiguration {\n     private String pulsarServiceUrl;\n     private String pulsarWebServiceUrl;\n     private String clusterCoordinationTopicName;\n-    private String functionMetadataSnapshotsTopicPath;\n     private String pulsarFunctionsNamespace;\n     private String pulsarFunctionsCluster;\n     private int numFunctionPackageReplicas;",
    "remove type constraint from variable type": "diff --git a/modules/web/js/ballerina/ast/statements/variable-definition-statement.js b/modules/web/js/ballerina/ast/statements/variable-definition-statement.js\nindex 0aba6c038a3..d594d192264 100644\n--- a/modules/web/js/ballerina/ast/statements/variable-definition-statement.js\n+++ b/modules/web/js/ballerina/ast/statements/variable-definition-statement.js\n@@ -99,12 +99,6 @@ class VariableDefinitionStatement extends Statement {\n                 variableType += '[]';\n             }\n         }\n-        if (this.getVariableDef().getTypeConstraint()) {\n-            const constraint = this.getVariableDef().getTypeConstraint();\n-            const constraintStr = ('<' + ((constraint.pkgName) ? constraint.pkgName + ':' : '')\n-                                  + constraint.type + '>');\n-        ",
    "Remove directories field from MavenServerFunction . . - - .": "diff --git a/src/main/java/com/google/devtools/build/lib/bazel/BazelRepositoryModule.java b/src/main/java/com/google/devtools/build/lib/bazel/BazelRepositoryModule.java\nindex 503e24fdc8..5c517641ce 100644\n--- a/src/main/java/com/google/devtools/build/lib/bazel/BazelRepositoryModule.java\n+++ b/src/main/java/com/google/devtools/build/lib/bazel/BazelRepositoryModule.java\n@@ -171,7 +171,7 @@ public class BazelRepositoryModule extends BlazeModule {\n         SkyFunctions.REPOSITORY_DIRECTORY,\n         new RepositoryDelegatorFunction(\n             repositoryHandlers, skylarkRepositoryFunction, isFetch));\n-    builder.put(MavenServerFunction.NAME, new MavenServerFunction(directories));\n+    builder.put(MavenServerFunction.NAME, new MavenServerFunction());\n     return builder.build();\n   }\n \ndiff --git a/src/main/java/com/google/devtools/build/lib/bazel/repository/MavenServerFunction.java b/src/main/java/com/google/devtools/build/lib/bazel/repository/MavenServerFunction.java\nindex b2280fa447..73bfe2682c 100644\n--- a/src/main/java/com/google/devtools/build/lib/bazel/repository/MavenServerFunction.java\n+++ b/src/main/java/com/google/devtools/build/lib/bazel/repository/MavenServerFunction.java\n@@ -24,6 +24,7 @@ import com.google.devtools.build.lib.rules.repository.RepositoryFunction;\n import com.google.devtools.build.lib.rules.repository.RepositoryFunction.RepositoryFunctionException;\n import com.google.devtools.build.lib.rules.repository.RepositoryFunction.RepositoryNotFoundException;\n import com.google.devtools.build.lib.skyframe.FileValue;\n+import com.google.devtools.build.lib.skyframe.PrecomputedValue;\n import com.google.devtools.build.lib.syntax.Type;\n import com.google.devtools.build.lib.util.Fingerprint;\n import com.google.devtools.build.lib.vfs.Path;\n@@ -59,10 +60,7 @@ public class MavenServerFunction implements SkyFunction {\n   private static final String USER_KEY = \"user\";\n   private static final String SYSTEM_KEY = \"system\";\n \n-  private final BlazeDirectories directories;\n-\n-  public MavenServerFunction(BlazeDirectories directories) {\n-    this.directories = directories;\n+  public MavenServerFunction() {\n   }\n \n   @Nullable\n@@ -70,14 +68,15 @@ public class MavenServerFunction implements SkyFunction {\n   public SkyValue compute(SkyKey skyKey, Environment env)\n       throws SkyFunctionException {\n     String repository = (String) skyKey.argument();\n-    Rule repositoryRule;\n+    Rule repositoryRule = null;\n     try {\n-       repositoryRule = RepositoryFunction.getRule(repository, env);\n-       if (repositoryRule == null) {\n-         return null;\n-       }\n+      repositoryRule = RepositoryFunction.getRule(repository, env);\n     } catch (RepositoryNotFoundException ex) {\n-      repositoryRule = null;\n+      // Ignored. We throw a new one below.\n+    }\n+    BlazeDirectories directories = PrecomputedValue.BLAZE_DIRECTORIES.get(env);\n+    if (env.valuesMissing()) {\n+      return null;\n     }\n     String serverName;\n     String url;\n@@ -86,7 +85,7 @@ public class MavenServerFunction implements SkyFunction {\n         && repositoryRule.getRuleClass().equals(MavenServerRule.NAME);\n     if (!foundRepoRule) {\n       if (repository.equals(MavenServerValue.DEFAULT_ID)) {\n-        settingsFiles = getDefaultSettingsFile(env);\n+        settingsFiles = getDefaultSettingsFile(directories, env);\n         serverName = MavenServerValue.DEFAULT_ID;\n         url = MavenConnector.getMavenCentralRemote().getUrl();\n       } else {\n@@ -100,7 +99,7 @@ public class MavenServerFunction implements SkyFunction {\n       url = mapper.get(\"url\", Type.STRING);\n       if (!mapper.has(\"settings_file\", Type.STRING)\n           || mapper.get(\"settings_file\", Type.STRING).isEmpty()) {\n-        settingsFiles = getDefaultSettingsFile(env);\n+        settingsFiles = getDefaultSettingsFile(directories, env);\n       } else {\n         PathFragment settingsFilePath = new PathFragment(mapper.get(\"settings_file\", Type.STRING));\n         RootedPath settingsPath = RootedPath.toRootedPath(\n@@ -175,7 +174,8 @@ public class MavenServerFunction implements SkyFunction {\n     return new MavenServerValue(serverName, url, server, fingerprintBytes);\n   }\n \n-  private Map<String, FileValue> getDefaultSettingsFile(Environment env) {\n+  private Map<String, FileValue> getDefaultSettingsFile(\n+      BlazeDirectories directories, Environment env) {\n     // The system settings file is at $M2_HOME/conf/settings.xml.\n     String m2Home = System.getenv(\"M2_HOME\");\n     ImmutableList.Builder<SkyKey> settingsFilesBuilder = ImmutableList.builder();\n@@ -199,11 +199,11 @@ public class MavenServerFunction implements SkyFunction {\n       settingsFilesBuilder.add(userKey);\n     }\n \n-    ImmutableList settingsFiles = settingsFilesBuilder.build();\n+    ImmutableList<SkyKey> settingsFiles = settingsFilesBuilder.build();\n     if (settingsFiles.isEmpty()) {\n       return ImmutableMap.of();\n     }\n-    Map<SkyKey, SkyValue> values = env.getValues(settingsFilesBuilder.build());\n+    Map<SkyKey, SkyValue> values = env.getValues(settingsFiles);\n     ImmutableMap.Builder<String, FileValue> settingsBuilder = ImmutableMap.builder();\n     for (Map.Entry<SkyKey, SkyValue> entry : values.entrySet()) {\n       if (entry.getValue() == null) {",
    "Get halide target string from rule flavor .": "diff --git a/src/com/facebook/buck/apple/ProjectGenerator.java b/src/com/facebook/buck/apple/ProjectGenerator.java\nindex b3815d13d3..db171e9fb3 100644\n--- a/src/com/facebook/buck/apple/ProjectGenerator.java\n+++ b/src/com/facebook/buck/apple/ProjectGenerator.java\n@@ -693,7 +693,7 @@ public class ProjectGenerator {\n     template.add(\"repo_root\", projectFilesystem.getRootPath());\n     template.add(\"path_to_compiler\", compilerPath);\n     template.add(\"output_dir\", outputPath);\n-    template.add(\"output_prefix\", buildTarget.getShortName());\n+    template.add(\"func_name\", buildTarget.getShortName());\n     scriptPhase.setShellScript(template.render());\n \n     NewNativeTargetProjectMutator mutator = new NewNativeTargetProjectMutator(\ndiff --git a/src/com/facebook/buck/apple/halide-compiler.st b/src/com/facebook/buck/apple/halide-compiler.st\nindex 192f4b6155..007316f8f9 100644\n--- a/src/com/facebook/buck/apple/halide-compiler.st\n+++ b/src/com/facebook/buck/apple/halide-compiler.st\n@@ -9,7 +9,8 @@ set -e\n REPO_ROOT=<repo_root>\n PATH_TO_COMPILER=<path_to_compiler>\n PATH_TO_OUTPUT=<output_dir>\n-OUTPUT_PREFIX=<output_prefix>\n+FUNC_NAME=<func_name>\n+OBJECTS=''\n \n cd $REPO_ROOT\n mkdir -p $PATH_TO_OUTPUT\n@@ -40,11 +41,13 @@ do\n             echo \"Unrecognized architecture: $ARCH\"\n             exit 1\n     esac\n-    $PATH_TO_COMPILER -t \"$TARGET\" -o $PATH_TO_OUTPUT $OUTPUT_PREFIX\n+    mkdir -p $PATH_TO_OUTPUT/$ARCH\n+    $PATH_TO_COMPILER -t \"$TARGET\" -o $PATH_TO_OUTPUT/$ARCH $FUNC_NAME\n+    OBJECTS+=\" $PATH_TO_OUTPUT/$ARCH/$FUNC_NAME.o\"\n done\n \n-# TODO: lipo the object files into a \"universal\" library here\n-lipo $PATH_TO_OUTPUT/*.o -create -output $PATH_TO_OUTPUT/$OUTPUT_PREFIX.a\n+# Use lipo to create a \"universal\" library from the object files.\n+lipo $OBJECTS -create -output $PATH_TO_OUTPUT/$FUNC_NAME.a\n \n # Now generate the header.\n-$PATH_TO_COMPILER -o $PATH_TO_OUTPUT --header-only $OUTPUT_PREFIX\n+$PATH_TO_COMPILER -o $PATH_TO_OUTPUT --header-only $FUNC_NAME\ndiff --git a/src/com/facebook/buck/cli/BUCK b/src/com/facebook/buck/cli/BUCK\nindex ba21e1dbca..0f5795bd0f 100644\n--- a/src/com/facebook/buck/cli/BUCK\n+++ b/src/com/facebook/buck/cli/BUCK\n@@ -72,6 +72,7 @@ java_library(\n     '//src/com/facebook/buck/cxx:rules',\n     '//src/com/facebook/buck/d:d',\n     '//src/com/facebook/buck/go:go',\n+    '//src/com/facebook/buck/halide:rules',\n     '//src/com/facebook/buck/file:downloader',\n     '//src/com/facebook/buck/jvm/java:autodeps',\n     '//src/com/facebook/buck/jvm/java:config',\ndiff --git a/src/com/facebook/buck/halide/BUCK b/src/com/facebook/buck/halide/BUCK\nindex 5bb716fb12..14e5161a33 100644\n--- a/src/com/facebook/buck/halide/BUCK\n+++ b/src/com/facebook/buck/halide/BUCK\n@@ -5,6 +5,7 @@ java_library(\n     '//test/com/facebook/buck/halide:halide',\n   ],\n   deps = [\n+    '//src/com/facebook/buck/cli:config',\n     '//src/com/facebook/buck/cxx:platform',\n     '//src/com/facebook/buck/cxx:rules',\n     '//src/com/facebook/buck/io:io',\ndiff --git a/src/com/facebook/buck/halide/HalideBuckConfig.java b/src/com/facebook/buck/halide/HalideBuckConfig.java\nnew file mode 100644\nindex 0000000000..4eaac09772\n--- /dev/null\n+++ b/src/com/facebook/buck/halide/HalideBuckConfig.java\n@@ -0,0 +1,57 @@\n+/*\n+ * Copyright 2014-present Facebook, Inc.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may\n+ * not use this file except in compliance with the License. You may obtain\n+ * a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n+ * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n+ * License for the specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package com.facebook.buck.halide;\n+\n+import com.facebook.buck.cli.BuckConfig;\n+import com.facebook.buck.cxx.CxxPlatform;\n+import com.google.common.base.Optional;\n+import com.google.common.collect.ImmutableMap;\n+import java.util.Map;\n+\n+/**\n+ * A Halide-specific \"view\" of BuckConfig.\n+ */\n+public class HalideBuckConfig {\n+  private final BuckConfig delegate;\n+\n+  public HalideBuckConfig(BuckConfig delegate) {\n+    this.delegate = delegate;\n+  }\n+\n+  public Optional<String> getHalideTargetForPlatform(Optional<CxxPlatform> cxxPlatform) {\n+    Optional<String> target = Optional.absent();\n+    if (cxxPlatform.isPresent()) {\n+      String flavorName = cxxPlatform.get().getFlavor().toString();\n+      ImmutableMap<String, String> targetMap = getHalideTargetMap();\n+      if (targetMap.containsKey(flavorName)) {\n+        target = Optional.of(targetMap.get(flavorName));\n+      }\n+    }\n+    return target;\n+  }\n+\n+  public ImmutableMap<String, String> getHalideTargetMap() {\n+    ImmutableMap<String, String> allEntries = delegate.getEntriesForSection(\"halide\");\n+    ImmutableMap.Builder<String, String> targets = ImmutableMap.builder();\n+    for (Map.Entry<String, String> entry : allEntries.entrySet()) {\n+      if (entry.getKey().startsWith(\"target-\")) {\n+        targets.put(entry.getKey().substring(\"target-\".length()), entry.getValue());\n+      }\n+    }\n+    return targets.build();\n+  }\n+}\ndiff --git a/src/com/facebook/buck/halide/HalideCompilerStep.java b/src/com/facebook/buck/halide/HalideCompilerStep.java\nindex c04d25348a..ca76e3d882 100644\n--- a/src/com/facebook/buck/halide/HalideCompilerStep.java\n+++ b/src/com/facebook/buck/halide/HalideCompilerStep.java\n@@ -18,32 +18,59 @@ package com.facebook.buck.halide;\n \n import com.facebook.buck.shell.ShellStep;\n import com.facebook.buck.step.ExecutionContext;\n+import com.google.common.base.Optional;\n import com.google.common.collect.ImmutableList;\n import java.nio.file.Path;\n \n public class HalideCompilerStep extends ShellStep {\n+  // The list of arguments needed to run our generated compiler.\n   private final ImmutableList<String> compilerPrefix;\n+\n+  // The output directory in which to write the generated shader code.\n   private final Path outputDir;\n-  private final String outputName;\n+\n+  // The name of the function (or pipeline) to compile.\n+  private final String funcName;\n+\n+  // The Halide target string for the target architecture, e.g. \"x86-64-osx\".\n+  // May be empty; if so, we assume that we should generate code for the host\n+  // architecture.\n+  private final Optional<String> halideTarget;\n+\n+  // If true, only generate the header file for the compiled shader.\n+  private final boolean headerOnly;\n \n   public HalideCompilerStep(\n       Path workingDirectory,\n       ImmutableList<String> compilerPrefix,\n       Path outputDir,\n-      String outputName) {\n+      String funcName,\n+      Optional<String> halideTarget,\n+      boolean headerOnly) {\n     super(workingDirectory);\n     this.compilerPrefix = compilerPrefix;\n     this.outputDir = outputDir;\n-    this.outputName = outputName;\n+    this.funcName = funcName;\n+    this.halideTarget = halideTarget;\n+    this.headerOnly = headerOnly;\n   }\n \n   @Override\n   protected ImmutableList<String> getShellCommandInternal(ExecutionContext context) {\n-    return ImmutableList.<String>builder()\n-      .addAll(compilerPrefix)\n-      .add(\"-o\", outputDir.toString())\n-      .add(outputName)\n-      .build();\n+    ImmutableList.Builder<String> builder = ImmutableList.builder();\n+    builder.addAll(compilerPrefix);\n+    builder.add(\"-o\", outputDir.toString());\n+\n+    if (halideTarget.isPresent() && !halideTarget.get().isEmpty()) {\n+      builder.add(\"-t\", halideTarget.get());\n+    }\n+\n+    if (headerOnly) {\n+      builder.add(\"--header-only\");\n+    }\n+\n+    builder.add(funcName);\n+    return builder.build();\n   }\n \n   @Override\ndiff --git a/src/com/facebook/buck/halide/HalideLibrary.java b/src/com/facebook/buck/halide/HalideLibrary.java\nindex 6dbb2f209f..a1118fdd1a 100644\n--- a/src/com/facebook/buck/halide/HalideLibrary.java\n+++ b/src/com/facebook/buck/halide/HalideLibrary.java\n@@ -26,11 +26,13 @@ import com.facebook.buck.cxx.NativeLinkable;\n import com.facebook.buck.cxx.NativeLinkableInput;\n import com.facebook.buck.cxx.Linker;\n import com.facebook.buck.model.BuildTarget;\n+import com.facebook.buck.model.BuildTargets;\n import com.facebook.buck.model.Flavor;\n import com.facebook.buck.model.Pair;\n import com.facebook.buck.rules.AbstractBuildRule;\n import com.facebook.buck.rules.AddToRuleKey;\n import com.facebook.buck.rules.BuildContext;\n+import com.facebook.buck.rules.BuildRule;\n import com.facebook.buck.rules.BuildRuleParams;\n import com.facebook.buck.rules.BuildRuleResolver;\n import com.facebook.buck.rules.BuildTargetSourcePath;\n@@ -44,6 +46,7 @@ import com.facebook.buck.rules.coercer.FrameworkPath;\n import com.facebook.buck.rules.coercer.SourceWithFlags;\n import com.facebook.buck.step.Step;\n import com.facebook.buck.step.fs.MakeCleanDirectoryStep;\n+import com.google.common.base.Optional;\n import com.google.common.collect.FluentIterable;\n import com.google.common.collect.ImmutableList;\n import com.google.common.collect.ImmutableMap;\n@@ -70,7 +73,8 @@ public class HalideLibrary\n   private final ImmutableSortedSet<SourceWithFlags> srcs;\n \n   private final Tool halideCompiler;\n-  private final Path outputDir;\n+  private final Optional<CxxPlatform> cxxPlatform;\n+  private final HalideBuckConfig halideBuckConfig;\n \n   protected HalideLibrary(\n       BuildRuleParams params,\n@@ -78,22 +82,32 @@ public class HalideLibrary\n       SourcePathResolver pathResolver,\n       ImmutableSortedSet<SourceWithFlags> srcs,\n       Tool halideCompiler,\n-      Path outputDir) {\n+      Optional<CxxPlatform> cxxPlatform,\n+      HalideBuckConfig halideBuckConfig) {\n     super(params, pathResolver);\n     this.params = params;\n     this.ruleResolver = ruleResolver;\n     this.srcs = srcs;\n     this.halideCompiler = halideCompiler;\n-    this.outputDir = outputDir;\n+    this.cxxPlatform = cxxPlatform;\n+    this.halideBuckConfig = halideBuckConfig;\n   }\n \n   @Override\n   public ImmutableList<Step> getBuildSteps(\n       BuildContext context,\n       BuildableContext buildableContext) {\n+    Path outputDir = getPathToOutput();\n     String shortName = getBuildTarget().getShortName();\n-    buildableContext.recordArtifact(outputDir.resolve(shortName + \".h\"));\n-    buildableContext.recordArtifact(outputDir.resolve(shortName + \".o\"));\n+\n+    // The unflavored target generates the header, which is the same for all\n+    // platforms; our various flavored variants generate the object file for\n+    // each platform.\n+    if (cxxPlatform.isPresent()) {\n+      buildableContext.recordArtifact(outputDir.resolve(getLibraryName()));\n+    } else {\n+      buildableContext.recordArtifact(outputDir.resolve(shortName + \".h\"));\n+    }\n \n     ImmutableList.Builder<Step> commands = ImmutableList.builder();\n     commands.add(new MakeCleanDirectoryStep(getProjectFilesystem(), outputDir));\n@@ -102,13 +116,15 @@ public class HalideLibrary\n         getProjectFilesystem().getRootPath(),\n         halideCompiler.getCommandPrefix(getResolver()),\n         outputDir,\n-        shortName));\n+        shortName,\n+        halideBuckConfig.getHalideTargetForPlatform(cxxPlatform),\n+        /* header-only */ !cxxPlatform.isPresent()));\n     return commands.build();\n   }\n \n   @Override\n   public Path getPathToOutput() {\n-    return outputDir;\n+    return BuildTargets.getGenPath(getBuildTarget(), \"%s\");\n   }\n \n   @Override\n@@ -175,11 +191,16 @@ public class HalideLibrary\n       TargetGraph targetGraph,\n       CxxPlatform cxxPlatform,\n       Linker.LinkableDepType type) {\n-    Path libPath = outputDir.resolve(getBuildTarget().getShortName() + \".o\");\n+    // Create a new flavored HalideLibrary rule object for the given platform.\n+    HalideLibrary rule = (HalideLibrary) requireBuildRule(cxxPlatform);\n+    Path libPath = BuildTargets.getGenPath(rule.getBuildTarget(), \"%s\")\n+      .resolve(rule.getLibraryName());\n     return NativeLinkableInput.of(\n-        SourcePathArg.from(getResolver(), new BuildTargetSourcePath(getBuildTarget(), libPath)),\n-        ImmutableSet.<FrameworkPath>of(),\n-        ImmutableSet.<FrameworkPath>of());\n+            SourcePathArg.from(\n+                    getResolver(),\n+                    new BuildTargetSourcePath(rule.getBuildTarget(), libPath)),\n+            ImmutableSet.<FrameworkPath>of(),\n+            ImmutableSet.<FrameworkPath>of());\n   }\n \n   @Override\n@@ -193,4 +214,37 @@ public class HalideLibrary\n       CxxPlatform cxxPlatform) {\n     return ImmutableMap.<String, SourcePath>of();\n   }\n+\n+  private String getLibraryName() {\n+    return getBuildTarget().getShortName() + \".o\";\n+  }\n+\n+  /**\n+   * Get the HalideLibrary rule used to generate code for @a cxxPlatform.\n+   *\n+   * @param cxxPlatform The CxxPlatform for which to generate code.\n+   *\n+   * @return The HalideLibrary rule for the given platform.\n+   */\n+  private BuildRule requireBuildRule(CxxPlatform cxxPlatform) {\n+    BuildTarget target = BuildTarget.builder(params.getBuildTarget())\n+      .addFlavors(cxxPlatform.getFlavor())\n+      .build();\n+    Optional<BuildRule> rule = ruleResolver.getRuleOptional(target);\n+    if (!rule.isPresent()) {\n+      rule = Optional.of((BuildRule) new HalideLibrary(\n+        params.copyWithChanges(\n+          target,\n+          params.getDeclaredDeps(),\n+          params.getExtraDeps()),\n+        ruleResolver,\n+        getResolver(),\n+        srcs,\n+        halideCompiler,\n+        Optional.of(cxxPlatform),\n+        halideBuckConfig));\n+      ruleResolver.addToIndex(rule.get());\n+    }\n+    return rule.get();\n+  }\n }\ndiff --git a/src/com/facebook/buck/halide/HalideLibraryDescription.java b/src/com/facebook/buck/halide/HalideLibraryDescription.java\nindex ee210cb386..42f55ce680 100644\n--- a/src/com/facebook/buck/halide/HalideLibraryDescription.java\n+++ b/src/com/facebook/buck/halide/HalideLibraryDescription.java\n@@ -89,12 +89,15 @@ public class HalideLibraryDescription implements\n \n   private final FlavorDomain<CxxPlatform> cxxPlatforms;\n   private final CxxPreprocessMode preprocessMode;\n+  private final HalideBuckConfig halideBuckConfig;\n \n   public HalideLibraryDescription(\n     FlavorDomain<CxxPlatform> cxxPlatforms,\n-    CxxPreprocessMode preprocessMode) {\n+    CxxPreprocessMode preprocessMode,\n+    HalideBuckConfig halideBuckConfig) {\n     this.cxxPlatforms = cxxPlatforms;\n     this.preprocessMode = preprocessMode;\n+    this.halideBuckConfig = halideBuckConfig;\n   }\n \n   public static boolean isHalideCompilerTarget(BuildTarget target) {\n@@ -240,12 +243,10 @@ public class HalideLibraryDescription implements\n           .builder(target.getUnflavoredBuildTarget())\n           .build();\n         String headerName = unflavoredTarget.getShortName() + \".h\";\n-        Path outputPath = BuildTargets.getGenPath(\n-          unflavoredTarget,\n-          \"%s/\" + headerName);\n+        Path outputPath = BuildTargets.getGenPath(unflavoredTarget, \"%s\");\n         headersBuilder.put(\n           Paths.get(headerName),\n-          new BuildTargetSourcePath(unflavoredTarget, outputPath));\n+          new BuildTargetSourcePath(unflavoredTarget, outputPath.resolve(headerName)));\n         return CxxDescriptionEnhancer.createHeaderSymlinkTree(\n           params,\n           new SourcePathResolver(resolver),\n@@ -294,14 +295,13 @@ public class HalideLibraryDescription implements\n     Preconditions.checkState(rule.isPresent());\n     CxxBinary halideCompiler = (CxxBinary) rule.get();\n     return new HalideLibrary(\n-      // params.copyWithExtraDeps(\n-      //   Suppliers.ofInstance(ImmutableSortedSet.<BuildRule>of(halideCompiler))),\n       params,\n       resolver,\n       pathResolver,\n       args.srcs.get(),\n       halideCompiler.getExecutableCommand(),\n-      /* outputDir */ BuildTargets.getGenPath(params.getBuildTarget(), \"%s\"));\n+      Optional.<CxxPlatform>absent(),\n+      halideBuckConfig);\n   }\n \n   @SuppressFieldNotInitialized\ndiff --git a/src/com/facebook/buck/rules/KnownBuildRuleTypes.java b/src/com/facebook/buck/rules/KnownBuildRuleTypes.java\nindex 7290d2af24..98421784b2 100644\n--- a/src/com/facebook/buck/rules/KnownBuildRuleTypes.java\n+++ b/src/com/facebook/buck/rules/KnownBuildRuleTypes.java\n@@ -85,6 +85,7 @@ import com.facebook.buck.go.GoBuckConfig;\n import com.facebook.buck.go.GoLibraryDescription;\n import com.facebook.buck.go.GoTestDescription;\n import com.facebook.buck.gwt.GwtBinaryDescription;\n+import com.facebook.buck.halide.HalideBuckConfig;\n import com.facebook.buck.halide.HalideLibraryDescription;\n import com.facebook.buck.io.ExecutableFinder;\n import com.facebook.buck.io.ProjectFilesystem;\n@@ -379,6 +380,8 @@ public class KnownBuildRuleTypes {\n \n     GoBuckConfig goBuckConfig = new GoBuckConfig(config, processExecutor);\n \n+    HalideBuckConfig halideBuckConfig = new HalideBuckConfig(config);\n+\n     ProGuardConfig proGuardConfig = new ProGuardConfig(config);\n \n     PythonBuckConfig pyConfig = new PythonBuckConfig(config, new ExecutableFinder());\n@@ -527,7 +530,8 @@ public class KnownBuildRuleTypes {\n     builder.register(\n       new HalideLibraryDescription(\n         cxxPlatforms,\n-        cxxBuckConfig.getPreprocessMode()));\n+        cxxBuckConfig.getPreprocessMode(),\n+        halideBuckConfig));\n     builder.register(new IosReactNativeLibraryDescription(reactNativeBuckConfig));\n     builder.register(new JavaBinaryDescription(defaultJavacOptions, defaultCxxPlatform));\n     builder.register(new JavaLibraryDescription(defaultJavacOptions));\ndiff --git a/test/com/facebook/buck/halide/BUCK b/test/com/facebook/buck/halide/BUCK\nindex aad4fdb3bb..a467164dfb 100644\n--- a/test/com/facebook/buck/halide/BUCK\n+++ b/test/com/facebook/buck/halide/BUCK\n@@ -2,11 +2,13 @@ java_library(\n   name = 'testutil',\n   srcs = glob(['*.java'], excludes=['*Test.java']),\n   deps = [\n+    '//src/com/facebook/buck/cli:config',\n     '//src/com/facebook/buck/cxx:platform',\n     '//src/com/facebook/buck/cxx:rules',\n     '//src/com/facebook/buck/halide:rules',\n     '//src/com/facebook/buck/model:model',\n     '//src/com/facebook/buck/rules:build_rule',\n+    '//test/com/facebook/buck/cli:FakeBuckConfig',\n     '//test/com/facebook/buck/cxx:testutil',\n     '//test/com/facebook/buck/rules:testutil',\n     '//third-party/java/guava:guava',\ndiff --git a/test/com/facebook/buck/halide/HalideLibraryBuilder.java b/test/com/facebook/buck/halide/HalideLibraryBuilder.java\nindex a09eb59d97..26609a90d7 100644\n--- a/test/com/facebook/buck/halide/HalideLibraryBuilder.java\n+++ b/test/com/facebook/buck/halide/HalideLibraryBuilder.java\n@@ -16,6 +16,8 @@\n \n package com.facebook.buck.halide;\n \n+import com.facebook.buck.cli.BuckConfig;\n+import com.facebook.buck.cli.FakeBuckConfig;\n import com.facebook.buck.cxx.AbstractCxxSourceBuilder;\n import com.facebook.buck.cxx.CxxPlatform;\n import com.facebook.buck.cxx.CxxPlatformUtils;\n@@ -29,16 +31,23 @@ import com.google.common.collect.ImmutableMap;\n public class HalideLibraryBuilder extends AbstractCxxSourceBuilder<HalideLibraryDescription.Arg> {\n   public HalideLibraryBuilder(\n     BuildTarget target,\n+    HalideBuckConfig halideBuckConfig,\n     FlavorDomain<CxxPlatform> cxxPlatforms) {\n     super(\n       new HalideLibraryDescription(\n         cxxPlatforms,\n-        CxxPreprocessMode.SEPARATE),\n+        CxxPreprocessMode.SEPARATE,\n+        halideBuckConfig),\n       target);\n   }\n \n   public HalideLibraryBuilder(BuildTarget target) {\n-    this(target, createDefaultPlatforms());\n+    this(target, createDefaultHalideConfig(), createDefaultPlatforms());\n+  }\n+\n+  public static HalideBuckConfig createDefaultHalideConfig() {\n+    BuckConfig buckConfig = FakeBuckConfig.builder().build();\n+    return new HalideBuckConfig(buckConfig);\n   }\n \n   // The #halide-compiler version of the HalideLibrary rule expects to be able",
    "add FriendUpdate and IgnoreUpdate .": "diff --git a/runelite-client/src/main/scripts/FriendUpdate.hash b/runelite-client/src/main/scripts/FriendUpdate.hash\nnew file mode 100644\nindex 000000000..78f935d1b\n--- /dev/null\n+++ b/runelite-client/src/main/scripts/FriendUpdate.hash\n@@ -0,0 +1 @@\n+6DC2945220E60445B7857ECFB97908E0B28FF0E96E533BB8DC8293DC68A986C2\n\\ No newline at end of file\ndiff --git a/runelite-client/src/main/scripts/FriendUpdate.rs2asm b/runelite-client/src/main/scripts/FriendUpdate.rs2asm\nnew file mode 100644\nindex 000000000..e2d838bd6\n--- /dev/null\n+++ b/runelite-client/src/main/scripts/FriendUpdate.rs2asm\n@@ -0,0 +1,561 @@\n+.id                 125\n+.int_stack_count    9\n+.string_stack_count 0\n+.int_var_count      16\n+.string_var_count   2\n+   iload                  1\n+   iconst                 2\n+   iconst                 3\n+   iconst                 2\n+   sconst                 \"Sort by name\"\n+   iload                  0\n+   iload                  1\n+   iload                  2\n+   iload                  3\n+   iload                  4\n+   iload                  5\n+   iload                  6\n+   iload                  7\n+   iload                  8\n+   invoke                 1669\n+   iload                  2\n+   iconst                 8\n+   iconst                 9\n+   iconst                 9\n+   sconst                 \"Sort by last world change\"\n+   iload                  0\n+   iload                  1\n+   iload                  2\n+   iload                  3\n+   iload                  4\n+   iload                  5\n+   iload                  6\n+   iload                  7\n+   iload                  8\n+   invoke                 1669\n+   iload                  3\n+   iconst                 4\n+   iconst                 5\n+   iconst                 4\n+   sconst                 \"Sort by world\"\n+   iload                  0\n+   iload                  1\n+   iload                  2\n+   iload                  3\n+   iload                  4\n+   iload                  5\n+   iload                  6\n+   iload                  7\n+   iload                  8\n+   invoke                 1669\n+   iload                  4\n+   iconst                 0\n+   iconst                 1\n+   iconst                 0\n+   sconst                 \"Legacy sort\"\n+   iload                  0\n+   iload                  1\n+   iload                  2\n+   iload                  3\n+   iload                  4\n+   iload                  5\n+   iload                  6\n+   iload                  7\n+   iload                  8\n+   invoke                 1669\n+   iload                  5\n+   cc_deleteall          \n+   iconst                 0\n+   istore                 9\n+   iconst                 0\n+   istore                 10\n+   sconst                 \"\"\n+   sstore                 0\n+   sconst                 \"\"\n+   sstore                 1\n+   iconst                 0\n+   istore                 11\n+   iconst                 0\n+   istore                 12\n+   iconst                 15\n+   istore                 13\n+   iconst                 -1\n+   istore                 14\n+   friend_count          \n+   istore                 15\n+   iload                  15\n+   iconst                 -2\n+   if_icmple              LABEL84\n+   jump                   LABEL105\n+LABEL84:\n+   get_varbit             8119\n+   iconst                 1\n+   if_icmpeq              LABEL88\n+   jump                   LABEL95\n+LABEL88:\n+   sconst                 \"Loading friends list\"\n+   sconst                 \"<br>\"\n+   sconst                 \"Please wait...\"\n+   join_string            3\n+   iload                  7\n+   if_settext            \n+   jump                   LABEL101\n+LABEL95:\n+   sconst                 \"You must set a name\"\n+   sconst                 \"<br>\"\n+   sconst                 \"before using this.\"\n+   join_string            3\n+   iload                  7\n+   if_settext            \n+LABEL101:\n+   iconst                 1\n+   iload                  0\n+   if_sethide            \n+   jump                   LABEL468\n+LABEL105:\n+   iload                  15\n+   iconst                 -1\n+   if_icmpeq              LABEL109\n+   jump                   LABEL130\n+LABEL109:\n+   get_varbit             8119\n+   iconst                 1\n+   if_icmpeq              LABEL113\n+   jump                   LABEL120\n+LABEL113:\n+   sconst                 \"Loading friends list\"\n+   sconst                 \"<br>\"\n+   sconst                 \"Please wait...\"\n+   join_string            3\n+   iload                  7\n+   if_settext            \n+   jump                   LABEL126\n+LABEL120:\n+   sconst                 \"You must set a name\"\n+   sconst                 \"<br>\"\n+   sconst                 \"before using this.\"\n+   join_string            3\n+   iload                  7\n+   if_settext            \n+LABEL126:\n+   iconst                 1\n+   iload                  0\n+   if_sethide            \n+   jump                   LABEL468\n+LABEL130:\n+   invoke                 1972\n+   istore                 14\n+   iload                  14\n+   iconst                 1\n+   if_icmpeq              LABEL136\n+   jump                   LABEL141\n+LABEL136:\n+   iconst                 8\n+   iconst                 5\n+   iload                  13\n+   scale                 \n+   istore                 13\n+LABEL141:\n+   sconst                 \"\"\n+   iload                  7\n+   if_settext            \n+   iconst                 0\n+   iload                  0\n+   if_sethide            \n+   3628                  \n+   get_varc_int           183\n+   switch                \n+      1: LABEL151\n+      2: LABEL154\n+      3: LABEL159\n+      4: LABEL174\n+      5: LABEL194\n+      8: LABEL164\n+      9: LABEL169\n+   jump                   LABEL213\n+LABEL151:\n+   iconst                 0\n+   3629                  \n+   jump                   LABEL213\n+LABEL154:\n+   iconst                 1\n+   3633                  \n+   iconst                 1\n+   3630                  \n+   jump                   LABEL213\n+LABEL159:\n+   iconst                 1\n+   3633                  \n+   iconst                 0\n+   3630                  \n+   jump                   LABEL213\n+LABEL164:\n+   iconst                 1\n+   3633                  \n+   iconst                 1\n+   3632                  \n+   jump                   LABEL213\n+LABEL169:\n+   iconst                 1\n+   3633                  \n+   iconst                 0\n+   3632                  \n+   jump                   LABEL213\n+LABEL174:\n+   iconst                 1\n+   3633                  \n+   iconst                 1\n+   3636                  \n+   iconst                 1\n+   3631                  \n+   get_varc_int           205\n+   switch                \n+      3: LABEL185\n+      8: LABEL188\n+      9: LABEL191\n+   iconst       ",
    "Add constructor with size .": "diff --git a/src/main/com/mongodb/BasicDBObject.java b/src/main/com/mongodb/BasicDBObject.java\nindex fdc6087fb..9fca85331 100644\n--- a/src/main/com/mongodb/BasicDBObject.java\n+++ b/src/main/com/mongodb/BasicDBObject.java\n@@ -20,10 +20,10 @@ package com.mongodb;\n \n import java.util.*;\n \n-import com.mongodb.util.*;\n-\n import org.bson.*;\n \n+import com.mongodb.util.*;\n+\n /**\n  * A simple implementation of <code>DBObject</code>.  \n  * A <code>DBObject</code> can be created as follows, using this class:\n@@ -39,6 +39,10 @@ public class BasicDBObject extends BasicBSONObject implements DBObject {\n      */\n     public BasicDBObject(){\n     }\n+    \n+    public BasicDBObject(int size){\n+    \tsuper(size);\n+    }\n \n     /**\n      * Convenience CTOR\ndiff --git a/src/main/org/bson/BasicBSONObject.java b/src/main/org/bson/BasicBSONObject.java\nindex 257285ca5..eca918fca 100644\n--- a/src/main/org/bson/BasicBSONObject.java\n+++ b/src/main/org/bson/BasicBSONObject.java\n@@ -20,8 +20,6 @@ package org.bson;\n \n import java.util.*;\n \n-import org.bson.*;\n-\n /**\n  * A simple implementation of <code>DBObject</code>.  \n  * A <code>DBObject</code> can be created as follows, using this class:\n@@ -38,6 +36,10 @@ public class BasicBSONObject extends LinkedHashMap<String,Object> implements BSO\n     public BasicBSONObject(){\n     }\n \n+    public BasicBSONObject(int size){\n+    \tsuper(size);\n+    }\n+\n     /**\n      * Convenience CTOR\n      * @param key  key under which to store",
    "Add zombie targets turtle egg config ( <issue_id> ) .": "diff --git a/Spigot-Server-Patches/0565-Add-zombie-targets-turtle-egg-config.patch b/Spigot-Server-Patches/0565-Add-zombie-targets-turtle-egg-config.patch\nnew file mode 100644\nindex 000000000..55022c8df\n--- /dev/null\n+++ b/Spigot-Server-Patches/0565-Add-zombie-targets-turtle-egg-config.patch\n@@ -0,0 +1,33 @@\n+From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001\n+From: BillyGalbreath <Blake.Galbreath@GMail.com>\n+Date: Sun, 23 Aug 2020 15:47:34 +0200\n+Subject: [PATCH] Add zombie targets turtle egg config\n+\n+\n+diff --git a/src/main/java/com/destroystokyo/paper/PaperWorldConfig.java b/src/main/java/com/destroystokyo/paper/PaperWorldConfig.java\n+index d5a1ade21749bba420257f3ece7878f32148d6ff..b286928cca6effb7adf07bfd2882cb6c5bbffcf2 100644\n+--- a/src/main/java/com/destroystokyo/paper/PaperWorldConfig.java\n++++ b/src/main/java/com/destroystokyo/paper/PaperWorldConfig.java\n+@@ -654,4 +654,9 @@ public class PaperWorldConfig {\n+             maxLightningFlashDistance = 512; // Vanilla value\n+         }\n+     }\n++\n++    public boolean zombiesTargetTurtleEggs = true;\n++    private void zombiesTargetTurtleEggs() {\n++        zombiesTargetTurtleEggs = getBoolean(\"zombies-target-turtle-eggs\", zombiesTargetTurtleEggs);\n++    }\n+ }\n+diff --git a/src/main/java/net/minecraft/server/EntityZombie.java b/src/main/java/net/minecraft/server/EntityZombie.java\n+index 039c5f4387b5383b15bd8b954eb464089612a303..b55851cad3290a8ba1538203cca4c01e5f31b1b4 100644\n+--- a/src/main/java/net/minecraft/server/EntityZombie.java\n++++ b/src/main/java/net/minecraft/server/EntityZombie.java\n+@@ -46,7 +46,7 @@ public class EntityZombie extends EntityMonster {\n+ \n+     @Override\n+     protected void initPathfinder() {\n+-        this.goalSelector.a(4, new EntityZombie.a(this, 1.0D, 3));\n++        if (world.paperConfig.zombiesTargetTurtleEggs) this.goalSelector.a(4, new EntityZombie.a(this, 1.0D, 3)); // Paper\n+         this.goalSelector.a(8, new PathfinderGoalLookAtPlayer(this, EntityHuman.class, 8.0F));\n+         this.goalSelector.a(8, new PathfinderGoalRandomLookaround(this));\n+         this.m();",
    "added allowEmptyValue": "diff --git a/modules/swagger-core/src/test/java/io/swagger/parameter/ParameterSerializationTest.java b/modules/swagger-core/src/test/java/io/swagger/parameter/ParameterSerializationTest.java\nindex d9b40cfa5..7fd880037 100644\n--- a/modules/swagger-core/src/test/java/io/swagger/parameter/ParameterSerializationTest.java\n+++ b/modules/swagger-core/src/test/java/io/swagger/parameter/ParameterSerializationTest.java\n@@ -256,6 +256,19 @@ public class ParameterSerializationTest {\n         SerializationMatchers.assertEqualsToJson(p, json);\n     }\n \n+    @Test(description = \"it should deserialize a read only parameter\")\n+    public void deserializeReadOnlyParameter() throws IOException {\n+        final String json =\n+                \"{\" +\n+                \"   \\\"in\\\":\\\"path\\\",\" +\n+                \"   \\\"required\\\":false,\" +\n+                \"   \\\"type\\\":\\\"string\\\",\" +\n+                \"   \\\"readOnly\\\":\\\"true\\\"\" +\n+                \"}\";\n+        final Parameter p = m.readValue(json, Parameter.class);\n+        assertTrue(p.isReadOnly());\n+    }\n+\n     @Test(description = \"it should serialize a ref BodyParameter\")\n     public void serializeRefBodyParameter() {\n         final RefModel model = new RefModel(\"Cat\");\ndiff --git a/modules/swagger-models/src/main/java/io/swagger/models/properties/PropertyBuilder.java b/modules/swagger-models/src/main/java/io/swagger/models/properties/PropertyBuilder.java\nindex b52aa16c6..653032a21 100644\n--- a/modules/swagger-models/src/main/java/io/swagger/models/properties/PropertyBuilder.java\n+++ b/modules/swagger-models/src/main/java/io/swagger/models/properties/PropertyBuilder.java\n@@ -97,6 +97,7 @@ public class PropertyBuilder {\n         READ_ONLY(\"readOnly\"),\n         REQUIRED(\"required\"),\n         VENDOR_EXTENSIONS(\"vendorExtensions\"),\n+        ALLOW_EMPTY_VALUE(\"allowEmptyValue\"),\n         MULTIPLE_OF(\"multipleOf\");\n \n         private String propertyName;\n@@ -752,6 +753,10 @@ public class PropertyBuilder {\n                 if (resolved.getFormat() == null) {\n                     resolved.setFormat(PropertyId.FORMAT.<String>findValue(args));\n                 }\n+                if(args.containsKey(PropertyId.ALLOW_EMPTY_VALUE)) {\n+                    final Boolean value = PropertyId.ALLOW_EMPTY_VALUE.findValue(args);\n+                    resolved.setAllowEmptyValue(value);\n+                }\n               ",
    "Added static boolean to toggle between library list and manual library url specification": "diff --git a/app/src/processing/app/LibraryManager.java b/app/src/processing/app/LibraryManager.java\nindex 81b9c0004..147c7ff89 100644\n--- a/app/src/processing/app/LibraryManager.java\n+++ b/app/src/processing/app/LibraryManager.java\n@@ -39,15 +39,30 @@ import javax.swing.event.ChangeListener;\n  * \n  */\n public class LibraryManager {\n-\n+  \n+  /**\n+   * true to use manual URL specification only\n+   * false to use searchable library list\n+   */\n+  static boolean USE_SIMPLE = true;\n+  \n   JFrame dialog;\n \n+  // Simple UI widgets:\n+  JLabel urlLabel;\n+\n+  JTextField libraryUri;\n+\n+  JButton installButton;\n+  \n+  // Non-simple UI widgets:\n   FilterField filterField;\n   \n   LibraryListPanel libraryListPane;\n   \n   JComboBox categoryChooser;\n   \n+  \n   // the calling editor, so updates can be applied\n \n   Editor editor;\n@@ -103,71 +118,124 @@ public class LibraryManager {\n     dialog.setResizable(true);\n \n     Base.setIcon(dialog);\n-\n+    \n     Container pane = dialog.getContentPane();\n     pane.setLayout(new GridBagLayout());\n     \n-    GridBagConstraints c = new GridBagConstraints();\n-    c.gridx = 0;\n-    c.gridy = 0;\n-    c.gridwidth = 2;\n-    c.weightx = 1;\n-    c.fill = GridBagConstraints.HORIZONTAL;\n-    filterField = new FilterField();\n-    pane.add(filterField, c);\n-    \n-    libraryListPane = new LibraryListPanel(fetchLibraryInfo());\n-    \n-    c = new GridBagConstraints();\n-    c.fill = GridBagConstraints.BOTH;\n-    c.gridx = 0;\n-    c.gridy = 1;\n-    c.gridwidth = 2;\n-    c.weighty = 1;\n-    c.weightx = 1;\n+    GridBagConstraints c; \n     \n-    final JScrollPane scrollPane = new JScrollPane();\n-    scrollPane.setPreferredSize(new Dimension(300,300));\n-    scrollPane.setViewportView(libraryListPane);\n-    scrollPane.setVerticalScrollBarPolicy(ScrollPaneConstants.VERTICAL_SCROLLBAR_ALWAYS);\n-    pane.add(scrollPane, c);\n-    scrollPane.setHorizontalScrollBarPolicy(JScrollPane.HORIZONTAL_SCROLLBAR_NEVER);\n-    \n-    scrollPane.getViewport().addChangeListener(new ChangeListener() {\n+    if (USE_SIMPLE) {\n+      urlLabel = new JLabel(\"Library URL:\");\n+      libraryUri = new JTextField();\n+      installButton = new JButton(\"Install\");\n+      \n+      ActionListener installLibAction = new ActionListener() {\n+\n+        public void actionPerformed(ActionEvent arg) {\n+          try {\n+            URL url = new URL(libraryUri.getText());\n+            // System.out.println(\"Installing library: \" + url);\n+            File libFile = downloadLibrary(url);\n+            if (libFile != null) {\n+              installLibrary(libFile);\n+            }\n+          } catch (MalformedURLException e) {\n+            System.err.println(\"Malformed URL\");\n+          }\n+          libraryUri.setText(\"\");\n+        }\n+      };\n+      libraryUri.addActionListener(installLibAction);\n+      installButton.addActionListener(installLibAction);\n+\n+      c = new GridBagConstraints();\n+      c.gridx = 0;\n+      c.gridy = 0;\n+      c.weightx = 1;\n+      c.anchor = GridBagConstraints.WEST;\n+      pane.add(urlLabel, c);\n+      \n+      c = new GridBagConstraints();\n+      c.gridx = 0;\n+      c.gridy = 1;\n+      c.weightx = 1;\n+      c.fill = GridBagConstraints.HORIZONTAL;\n+      pane.add(libraryUri, c);\n+      \n+      c = new GridBagConstraints();\n+      c.gridx = 1;\n+      c.gridy = 1;\n+      c.anchor = GridBagConstraints.EAST;\n+      pane.add(installButton, c);\n       \n-      public void stateChanged(ChangeEvent ce) {\n+      Dimension d = dialog.getSize();\n+      d.width = 320;\n+      dialog.setMinimumSize(d);\n+    } else {\n+      c = new GridBagConstraints();\n+      c.gridx = 0;\n+      c.gridy = 0;\n+      c.gridwidth = 2;\n+      c.weightx = 1;\n+      c.fill = GridBagConstraints.HORIZONTAL;\n+      filterField = new FilterField();\n+      pane.add(filterField, c);\n+      \n+      libraryListPane = new LibraryListPanel(fetchLibraryInfo());\n+      \n+      c = new GridBagConstraints();\n+      c.fill = GridBagConstraints.BOTH;\n+      c.gridx = 0;\n+      c.gridy = 1;\n+      c.gridwidth = 2;\n+      c.weighty = 1;\n+      c.weightx = 1;\n+      \n+      final JScrollPane scrollPane = new JScrollPane();\n+      scrollPane.setPreferredSize(new Dimension(300,300));\n+      scrollPane.setViewportView(libraryListPane);\n+      scrollPane.setVerticalScrollBarPolicy(ScrollPaneConstants.VERTICAL_SCROLLBAR_ALWAYS);\n+      pane.add(scrollPane, c);\n+      scrollPane.setHorizontalScrollBarPolicy(JScrollPane.HORIZONTAL_SCROLLBAR_NEVER);\n+      \n+      scrollPane.getViewport().addChangeListener(new ChangeListener() {\n         \n-        int width = scrollPane.getViewportBorderBounds().width;\n-        libraryListPane.setWidth(width);\n-      }\n-    });\n-    \n-    c = new GridBagConstraints();\n-    c.gridx = 0;\n-    c.gridy = 2;\n-    pane.add(new Label(\"Category:\"), c);\n-    \n-    c = new GridBagConstraints();\n-    c.fill = GridBagConstraints.HORIZONTAL;\n-    c.gridx = 1;\n-    c.gridy = 2;\n-    \n-    String[] categories = {\n-      \"3D\", \"Animation\", \"Compilations\", \"Computer Vision\",\n-      \"Data and Protocols\", \"Geometry\", \"Graphic Interface\",\n-      \"Hardware Interface\", \"Import / Export\", \"Math\", \"Simulation\", \"Sound\",\n-      \"Tools\", \"Typography\", \"Video\" };\n-    categoryChooser = new JComboBox(categories);\n-    pane.add(categoryChooser, c);\n-\n+        public void stateChanged(ChangeEvent ce) {\n+          \n+          int width = scrollPane.getViewportBorderBounds().width;\n+          libraryListPane.setWidth(width);\n+        }\n+      });\n+      \n+      c = new GridBagConstraints();\n+      c.gridx = 0;\n+      c.gridy = 2;\n+      pane.add(new Label(\"Category:\"), c);\n+      \n+      c = new GridBagConstraints();\n+      c.fill = GridBagConstraints.HORIZONTAL;\n+      c.gridx = 1;\n+      c.gridy = 2;\n+      \n+      String[] categories = {\n+        \"3D\", \"Animation\", \"Compilations\", \"Computer Vision\",\n+        \"Data and Protocols\", \"Geometry\", \"Graphic Interface\",\n+        \"Hardware Interface\", \"Import / Export\", \"Math\", \"Simulation\", \"Sound\",\n+        \"Tools\", \"Typography\", \"Video\" };\n+      categoryChooser = new JComboBox(categories);\n+      pane.add(categoryChooser, c);\n+  \n+      dialog.setMinimumSize(new Dimension(400, 400));\n+    }\n     \n-    dialog.setMinimumSize(new Dimension(400, 400));\n     dialog.pack();\n     Dimension screen = Toolkit.getDefaultToolkit().getScreenSize();\n     dialog.setLocation((screen.width - dialog.getWidth()) / 2,\n                        (screen.height - dialog.getHeight()) / 2);\n     \n-    libraryListPane.grabFocus();\n+    if (!USE_SIMPLE) {\n+      libraryListPane.grabFocus();\n+    }\n   }\n   \n   /**",
    "Remove fill viewport behaviour from RecyclerBinder .": "diff --git a/litho-it/src/test/java/com/facebook/litho/widget/RecyclerBinderFillViewportTest.java b/litho-it/src/test/java/com/facebook/litho/widget/RecyclerBinderFillViewportTest.java\ndeleted file mode 100644\nindex e207033148..0000000000\n--- a/litho-it/src/test/java/com/facebook/litho/widget/RecyclerBinderFillViewportTest.java\n+++ /dev/null\n@@ -1,877 +0,0 @@\n-/*\n- * Copyright 2018-present Facebook, Inc.\n- *\n- * Licensed under the Apache License, Version 2.0 (the \"License\");\n- * you may not use this file except in compliance with the License.\n- * You may obtain a copy of the License at\n- *\n- *   http://www.apache.org/licenses/LICENSE-2.0\n- *\n- * Unless required by applicable law or agreed to in writing, software\n- * distributed under the License is distributed on an \"AS IS\" BASIS,\n- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n- * See the License for the specific language governing permissions and\n- * limitations under the License.\n- */\n-package com.facebook.litho.widget;\n-\n-import static com.facebook.litho.SizeSpec.EXACTLY;\n-import static com.facebook.litho.SizeSpec.UNSPECIFIED;\n-import static com.facebook.litho.SizeSpec.makeSizeSpec;\n-import static com.facebook.litho.widget.RecyclerBinderTest.NO_OP_CHANGE_SET_COMPLETE_CALLBACK;\n-import static org.assertj.core.api.Java6Assertions.assertThat;\n-import static org.mockito.Matchers.any;\n-import static org.mockito.Matchers.anyInt;\n-import static org.mockito.Matchers.anyList;\n-import static org.mockito.Mockito.atLeast;\n-import static org.mockito.Mockito.atMost;\n-import static org.mockito.Mockito.doAnswer;\n-import static org.mockito.Mockito.inOrder;\n-import static org.mockito.Mockito.mock;\n-import static org.mockito.Mockito.never;\n-import static org.mockito.Mockito.reset;\n-import static org.mockito.Mockito.spy;\n-import static org.mockito.Mockito.times;\n-import static org.mockito.Mockito.verify;\n-import static org.mockito.Mockito.when;\n-\n-import android.annotation.SuppressLint;\n-import android.content.Context;\n-import android.os.Looper;\n-import android.os.Process;\n-import android.support.v7.widget.LinearLayoutManager;\n-import android.support.v7.widget.OrientationHelper;\n-import android.support.v7.widget.RecyclerView;\n-import android.view.View;\n-import android.view.ViewGroup;\n-import com.facebook.litho.Component;\n-import com.facebook.litho.ComponentContext;\n-import com.facebook.litho.ComponentTree;\n-import com.facebook.litho.EventHandler;\n-import com.facebook.litho.LayoutHandler;\n-import com.facebook.litho.LayoutThreadPoolConfigurationImpl;\n-import com.facebook.litho.LayoutThreadPoolExecutor;\n-import com.facebook.litho.Size;\n-import com.facebook.litho.SizeSpec;\n-import com.facebook.litho.testing.TestDrawableComponent;\n-import com.facebook.litho.testing.testrunner.ComponentsTestRunner;\n-import com.facebook.litho.viewcompat.SimpleViewBinder;\n-import com.facebook.litho.viewcompat.ViewCreator;\n-import java.util.HashMap;\n-import java.util.Map;\n-import java.util.concurrent.Callable;\n-import org.junit.After;\n-import org.junit.Before;\n-import org.junit.Test;\n-import org.junit.runner.RunWith;\n-import org.mockito.InOrder;\n-import org.mockito.invocation.InvocationOnMock;\n-import org.mockito.stubbing.Answer;\n-import org.powermock.reflect.Whitebox;\n-import org.robolectric.RuntimeEnvironment;\n-import org.robolectric.Shadows;\n-import org.robolectric.shadows.ShadowLooper;\n-\n-/** Tests for viewport filling in {@link RecyclerBinder} */\n-@RunWith(ComponentsTestRunner.class)\n-public class RecyclerBinderFillViewportTest {\n-\n-  private static final float RANGE_RATIO = 2.0f;\n-  private static final int RANGE_SIZE = 3;\n-\n-  private final Map<Component, TestComponentTreeHolder> mHoldersForComponents = new HashMap<>();\n-  private RecyclerBinder mRecyclerBinder;\n-  private RecyclerBinder.Builder mRecyclerBinderBuilder;\n-  private LayoutInfo mLayoutInfo;\n-  private LayoutInfo mCircularLayoutInfo;\n-  private ComponentContext mComponentContext;\n-  private ShadowLooper mLayoutThreadShadowLooper;\n-\n-  private static final ViewCreator VIEW_CREATOR_1 =\n-      new ViewCreator() {\n-        @Override\n-        public View createView(Context c, ViewGroup parent) {\n-          return mock(View.class);\n-        }\n-      };\n-\n-  @Before\n-  public void setup() throws Exception {\n-    mHoldersForComponents.clear();\n-\n-    mComponentContext = new ComponentContext(RuntimeEnvironment.application);\n-\n-    final RecyclerBinder.ComponentTreeHolderFactory componentTreeHolderFactory =\n-        new RecyclerBinder.ComponentTreeHolderFactory() {\n-          @Override\n-          public ComponentTreeHolder create(\n-              RenderInfo renderInfo,\n-              LayoutHandler layoutHandler,\n-              boolean canPrefetchDisplayLists,\n-              boolean canCacheDrawingDisplayLists,\n-              boolean useSharedLayoutStateFuture,\n-              ComponentTreeHolder.ComponentTreeMeasureListenerFactory\n-                  componentTreeMeasureListenerFactory,\n-              String splitLayoutTag) {\n-            final TestComponentTreeHolder holder = new TestComponentTreeHolder(renderInfo);\n-            if (renderInfo.rendersComponent()) {\n-              mHoldersForComponents.put(renderInfo.getComponent(), holder);\n-            }\n-\n-            return holder;\n-          }\n-        };\n-\n-    mLayoutInfo = mock(LayoutInfo.class);\n-    mCircularLayoutInfo = mock(LayoutInfo.class);\n-\n-    setupBaseLayoutInfoMock(mLayoutInfo, OrientationHelper.VERTICAL);\n-    setupBaseLayoutInfoMock(mCircularLayoutInfo, OrientationHelper.HORIZONTAL);\n-\n-    mRecyclerBinderBuilder =\n-        new RecyclerBinder.Builder()\n-            .rangeRatio(RANGE_RATIO)\n-            .layoutInfo(mLayoutInfo)\n-            .componentTreeHolderFactory(componentTreeHolderFactory);\n-\n-    mRecyclerBinder = mRecyclerBinderBuilder.build(mComponentContext);\n-\n-    mLayoutThreadShadowLooper =\n-        Shadows.shadowOf(\n-            (Looper) Whitebox.invokeMethod(ComponentTree.class, \"getDefaultLayoutThreadLooper\"));\n-  }\n-\n-  @After\n-  public void tearDown() {\n-    mLayoutThreadShadowLooper.runToEndOfTasks();\n-  }\n-\n-  private void setupBaseLayoutInfoMock(LayoutInfo layoutInfo, int orientation) {\n-    when(layoutInfo.getScrollDirection()).thenReturn(orientation);\n-\n-    when(layoutInfo.getLayoutManager())\n-        .thenReturn(new LinearLayoutManager(mComponentContext, orientation, false));\n-\n-    when(layoutInfo.approximateRangeSize(anyInt(), anyInt(), anyInt(), anyInt()))\n-        .thenReturn(RANGE_SIZE);\n-\n-    when(layoutInfo.getChildHeightSpec(anyInt(), any(RenderInfo.class)))\n-        .thenReturn(SizeSpec.makeSizeSpec(100, SizeSpec.EXACTLY));\n-    when(layoutInfo.getChildWidthSpec(anyInt(), any(RenderInfo.class)))\n-        .thenReturn(SizeSpec.makeSizeSpec(100, SizeSpec.EXACTLY));\n-  }\n-\n-  @Test\n-  public void testDoesNotFillViewportWithConfigurationOff() {\n-    final LayoutInfo layoutInfo = mock(LayoutInfo.class);\n-    setupBaseLayoutInfoMock(layoutInfo, OrientationHelper.VERTICAL);\n-\n-    RecyclerBinder recyclerBinder =\n-        new RecyclerBinder.Builder()\n-            .rangeRatio(RANGE_RATIO)\n-            .layoutInfo(layoutInfo)\n-            .build(mComponentContext);\n-\n-    fillRecyclerBinderWithComponents(recyclerBinder, 100, 100, 10);\n-\n-    recyclerBinder.measure(\n-        new Size(), makeSizeSpec(1000, EXACTLY), makeSizeSpec(1000, EXACTLY), null);\n-\n-    verify(layoutInfo, never()).createViewportFiller(anyInt(), anyInt());\n-  }\n-\n-  @SuppressLint(\"STARVATION\")\n-  @Test\n-  public void testDoesNotFillViewportHScrollOnly() {\n-    final LayoutInfo layoutInfo = mock(LayoutInfo.class);\n-    setupBaseLayoutInfoMock(layoutInfo, OrientationHelper.VERTICAL);\n-\n-    RecyclerBinder recyclerBinder =\n-        new RecyclerBinder.Builder()\n-            .rangeRatio(RANGE_RATIO)\n-            .layoutInfo(layoutInfo)\n-            .fillListViewportHScrollOnly(true)\n-            .build(mComponentContext);\n-\n-    fillRecyclerBinderWithComponents(recyclerBinder, 100, 100, 10);\n-\n-    recyclerBinder.measure(\n-        new Size(), makeSizeSpec(1000, EXACTLY), makeSizeSpec(1000, EXACTLY), null);\n-\n-    verify(layoutInfo, never()).createViewportFiller(anyInt(), anyInt());\n-  }\n-\n-  @SuppressLint(\"STARVATION\")\n-  @Test\n-  public void testFillsViewport() {\n-    final LayoutInfo layoutInfo =\n-        new LinearLayoutInfo(mComponentContext, OrientationHelper.VERTICAL, false);\n-\n-    final RecyclerBinder recyclerBinder =\n-        new RecyclerBinder.Builder()\n-            .rangeRatio(RANGE_RATIO)\n-            .layoutInfo(layoutInfo)\n-            .fillListViewport(true)\n-            .build(mComponentContext);\n-\n-    fillRecyclerBinderWithComponents(recyclerBinder, 100, 100, 10);\n-\n-    recyclerBinder.measure(\n-        new Size(), makeSizeSpec(1000, EXACTLY), makeSizeSpec(250, EXACTLY), null);\n-\n-    final int expectedWidthSpec = makeSizeSpec(1000, EXACTLY);\n-    final int expectedHeightSpec = makeSizeSpec(0, UNSPECIFIED);\n-    assertThat(\n-            recyclerBinder\n-                .getComponentAt(0)\n-                .hasCompatibleLayout(expectedWidthSpec, expectedHeightSpec))\n-        .isTrue();\n-    assertThat(\n-            recyclerBinder\n-                .getComponentAt(1)\n-                .hasCompatibleLayout(expectedWidthSpec, expectedHeightSpec))\n-        .isTrue();\n-    assertThat(\n-            recyclerBinder\n-                .getComponentAt(2)\n-                .hasCompatibleLayout(expectedWidthSpec, expectedHeightSpec))\n-        .isTrue();\n-    assertThat(\n-            recyclerBinder\n-                .getComponentAt(3)\n-                .hasCompatibleLayout(expectedWidthSpec, expectedHeightSpec))\n-        .isFalse();\n-  }\n-\n-  @SuppressLint(\"STARVATION\")\n-  @Test\n-  public void testFillsViewportHScroll() {\n-    final LayoutInfo layoutInfo =\n-        new LinearLayoutInfo(mComponentContext, OrientationHelper.HORIZONTAL, false);\n-\n-    final RecyclerBinder recyclerBinder =\n-        new RecyclerBinder.Builder()\n-            .rangeRatio(RANGE_RATIO)\n-            .layoutInfo(layoutInfo)\n-            .fillListViewportHScrollOnly(true)\n-            .build(mComponentContext);\n-\n-    fillRecyclerBinderWithComponents(recyclerBinder, 100, 100, 10);\n-\n-    recyclerBinder.measure(\n-        new Size(), makeSizeSpec(250, EXACTLY), makeSizeSpec(1000, EXACTLY), null);\n-\n-    final int expectedWidthSpec = makeSizeSpec(0, UNSPECIFIED);\n-    final int expectedHeightSpec = makeSizeSpec(1000, SizeSpec.EXACTLY);\n-    assertThat(\n-            recyclerBinder\n-                .getComponentAt(0)\n-                .hasCompatibleLayout(expectedWidthSpec, expectedHeightSpec))\n-        .isTrue();\n-    assertThat(\n-            recyclerBinder\n-                .getComponentAt(1)\n-                .hasCompatibleLayout(expectedWidthSpec, expectedHeightSpec))\n-        .isTrue();\n-    assertThat(\n-            recyclerBinder\n-                .getComponentAt(2)\n-                .hasCompatibleLayout(expectedWidthSpec, expectedHeightSpec))\n-        .isTrue();\n-    assertThat(\n-            recyclerBinder\n-                .getComponentAt(3)\n-                .hasCompatibleLayout(expectedWidthSpec, expectedHeightSpec))\n-        .isFalse();\n-  }\n-\n-  @SuppressLint(\"STARVATION\")\n-  @Test\n-  public void testFillsViewportWithMeasureBeforeData() {\n-    final LayoutInfo layoutInfo =\n-        new LinearLayoutInfo(mComponentContext, OrientationHelper.VERTICAL, false);\n-\n-    final RecyclerBinder recyclerBinder =\n-        new RecyclerBinder.Builder()\n-            .rangeRatio(RANGE_RATIO)\n-            .layoutInfo(layoutInfo)\n-            .fillListViewport(true)\n-            .build(mComponentContext);\n-\n-    recyclerBinder.measure(\n-        new Size(), makeSizeSpec(1000, EXACTLY), makeSizeSpec(250, EXACTLY), null);\n-\n-    fillRecyclerBinderWithComponents(recyclerBinder, 100, 100, 10);\n-\n-    final int expectedWidthSpec = makeSizeSpec(1000, EXACTLY);\n-    final int expectedHeightSpec = makeSizeSpec(0, UNSPECIFIED);\n-    assertThat(\n-            recyclerBinder\n-                .getComponentAt(0)\n-                .hasCompatibleLayout(expectedWidthSpec, expectedHeightSpec))\n-        .isTrue();\n-    assertThat(\n-            recyclerBinder\n-                .getComponentAt(1)\n-                .hasCompatibleLayout(expectedWidthSpec, expectedHeightSpec))\n-        .isTrue();\n-    assertThat(\n-            recyclerBinder\n-                .getComponentAt(2)\n-                .hasCompatibleLayout(expectedWidthSpec, expectedHeightSpec))\n-        .isTrue();\n-    assertThat(\n-            recyclerBinder\n-                .getComponentAt(3)\n-                .hasCompatibleLayout(expectedWidthSpec, expectedHeightSpec))\n-        .isFalse();\n-  }\n-\n-  @SuppressLint(\"STARVATION\")\n-  @Test\n-  public void testDoesNotFillViewportOnRemeasure() {\n-    final LayoutInfo layoutInfo =\n-        new LinearLayoutInfo(mComponentContext, OrientationHelper.HORIZONTAL, false);\n-\n-    final RecyclerBinder recyclerBinder =\n-        new RecyclerBinder.Builder()\n-            .rangeRatio(RANGE_RATIO)\n-            .layoutInfo(layoutInfo)\n-            .fillListViewport(true)\n-            .build(mComponentContext);\n-\n-    fillRecyclerBinderWithComponents(recyclerBinder, 100, 100, 10);\n-\n-    recyclerBinder.measure(\n-        new Size(), makeSizeSpec(250, EXACTLY), makeSizeSpec(1000, EXACTLY), null);\n-\n-    final int expectedWidthSpec = makeSizeSpec(0, UNSPECIFIED);\n-    final int expectedHeightSpec = makeSizeSpec(1000, SizeSpec.EXACTLY);\n-    assertThat(\n-            recyclerBinder\n-                .getComponentAt(0)\n-                .hasCompatibleLayout(expectedWidthSpec, expectedHeightSpec))\n-        .isTrue();\n-    assertThat(\n-            recyclerBinder\n-                .getComponentAt(1)\n-                .hasCompatibleLayout(expectedWidthSpec, expectedHeightSpec))\n-        .isTrue();\n-    assertThat(\n-            recyclerBinder\n-                .getComponentAt(2)\n-                .hasCompatibleLayout(expectedWidthSpec, expectedHeightSpec))\n-        .isTrue();\n-    assertThat(\n-            recyclerBinder\n-                .getComponentAt(3)\n-                .hasCompatibleLayout(expectedWidthSpec, expectedHeightSpec))\n-        .isFalse();\n-\n-    recyclerBinder.measure(\n-        new Size(), makeSizeSpec(250, EXACTLY), makeSizeSpec(900, EXACTLY), null);\n-\n-    final int newExpectedHeightSpec = makeSizeSpec(900, SizeSpec.EXACTLY);\n-    assertThat(\n-            recyclerBinder\n-                .getComponentAt(0)\n-                .hasCompatibleLayout(expectedWidthSpec, newExpectedHeightSpec))\n-        .isTrue();\n-    assertThat(\n-            recyclerBinder\n-                .getComponentAt(1)\n-                .hasCompatibleLayout(expectedWidthSpec, newExpectedHeightSpec))\n-        .isFalse();\n-  }\n-\n-  @SuppressLint(\"STARVATION\")\n-  @Test\n-  public void testDoesNotFillViewportOnCompatibleMeasure() {\n-    final LayoutInfo layoutInfo = mock(LayoutInfo.class);\n-    setupBaseLayoutInfoMock(layoutInfo, OrientationHelper.HORIZONTAL);\n-\n-    final RecyclerBinder recyclerBinder =\n-        new RecyclerBinder.Builder()\n-            .rangeRatio(RANGE_RATIO)\n-            .layoutInfo(layoutInfo)\n-            .fillListViewport(true)\n-            .build(mComponentContext);\n-\n-    when(layoutInfo.findFirstFullyVisibleItemPosition()).thenReturn(0);\n-\n-    fillRecyclerBinderWithComponents(recyclerBinder, 100, 100, 10);\n-\n-    recyclerBinder.measure(\n-        new Size(), makeSizeSpec(250, EXACTLY), makeSizeSpec(1000, EXACTLY), null);\n-\n-    verify(layoutInfo).createViewportFiller(anyInt(), anyInt());\n-    reset(layoutInfo);\n-\n-    recyclerBinder.measure(\n-        new Size(), makeSizeSpec(250, EXACTLY), makeSizeSpec(1000, EXACTLY), null);\n-\n-    verify(layoutInfo, never()).createViewportFiller(anyInt(), anyInt());\n-  }\n-\n-  @SuppressLint(\"STARVATION\")\n-  @Test\n-  public void testFillsViewportFromFirstVisibleItem() {\n-    final LayoutInfo layoutInfo =\n-        spy(new LinearLayoutInfo(mComponentContext, OrientationHelper.HORIZONTAL, false));\n-\n-    final RecyclerBinder recyclerBinder =\n-        new RecyclerBinder.Builder()\n-            .rangeRatio(RANGE_RATIO)\n-            .layoutInfo(layoutInfo)\n-            .fillListViewport(true)\n-            .build(mComponentContext);\n-\n-    fillRecyclerBinderWithComponents(recyclerBinder, 100, 100, 10);\n-\n-    when(layoutInfo.findFirstVisibleItemPosition()).thenReturn(5);\n-    recyclerBinder.measure(\n-        new Size(), makeSizeSpec(250, EXACTLY), makeSizeSpec(1000, EXACTLY), null);\n-\n-    final int expectedWidthSpec = makeSizeSpec(0, UNSPECIFIED);\n-    final int expectedHeightSpec = makeSizeSpec(1000, SizeSpec.EXACTLY);\n-    assertThat(\n-            recyclerBinder\n-                .getComponentAt(5)\n-                .hasCompatibleLayout(expectedWidthSpec, expectedHeightSpec))\n-        .isTrue();\n-    assertThat(\n-            recyclerBinder\n-                .getComponentAt(6)\n-                .hasCompatibleLayout(expectedWidthSpec, expectedHeightSpec))\n-        .isTrue();\n-    assertThat(\n-            recyclerBinder\n-                .getComponentAt(7)\n-                .hasCompatibleLayout(expectedWidthSpec, expectedHeightSpec))\n-        .isTrue();\n-    assertThat(\n-            recyclerBinder\n-                .getComponentAt(8)\n-                .hasCompatibleLayout(expectedWidthSpec, expectedHeightSpec))\n-        .isFalse();\n-\n-    assertThat(\n-            recyclerBinder\n-                .getComponentAt(1)\n-                .hasCompatibleLayout(expectedWidthSpec, expectedHeightSpec))\n-        .isFalse();\n-    assertThat(\n-            recyclerBinder\n-                .getComponentAt(4)\n-                .hasCompatibleLayout(expectedWidthSpec, expectedHeightSpec))\n-        .isFalse();\n-  }\n-\n-  @SuppressLint(\"STARVATION\")\n-  @Test\n-  public void testFillsViewportWithSomeViews() {\n-    final LayoutInfo layoutInfo =\n-        new LinearLayoutInfo(mComponentContext, OrientationHelper.HORIZONTAL, false);\n-\n-    final RecyclerBinder recyclerBinder =\n-        new RecyclerBinder.Builder()\n-            .rangeRatio(RANGE_RATIO)\n-            .layoutInfo(layoutInfo)\n-            .fillListViewport(true)\n-            .build(mComponentContext);\n-\n-    fillRecyclerBinderWithComponents(recyclerBinder, 100, 100, 3);\n-\n-    recyclerBinder.insertItemAt(\n-        3,\n-        ViewRenderInfo.create()\n-            .viewBinder(new SimpleViewBinder())\n-            .viewCreator(VIEW_CREATOR_1)\n-            .build());\n-\n-    for (int i = 4; i < 7; i++) {\n-      recyclerBinder.insertItemAt(\n-          i,\n-          ComponentRenderInfo.create()\n-              .component(\n-                  TestDrawableComponent.create(mComponentContext)\n-                      .widthPx(100)\n-                      .heightPx(100)\n-                      .build())\n-              .build());\n-    }\n-    mRecyclerBinder.notifyChangeSetComplete(true, NO_OP_CHANGE_SET_COMPLETE_CALLBACK);\n-\n-    recyclerBinder.measure(\n-        new Size(), makeSizeSpec(1000, EXACTLY), makeSizeSpec(1000, EXACTLY), null);\n-\n-    final int expectedWidthSpec = makeSizeSpec(0, UNSPECIFIED);\n-    final int expectedHeightSpec = makeSizeSpec(1000, SizeSpec.EXACTLY);\n-    assertThat(\n-            recyclerBinder\n-                .getComponentAt(0)\n-                .hasCompatibleLayout(expectedWidthSpec, expectedHeightSpec))\n-        .isTrue();\n-    assertThat(\n-            recyclerBinder\n-                .getComponentAt(1)\n-                .hasCompatibleLayout(expectedWidthSpec, expectedHeightSpec))\n-        .isTrue();\n-    assertThat(\n-            recyclerBinder\n-                .getComponentAt(2)\n-                .hasCompatibleLayout(expectedWidthSpec, expectedHeightSpec))\n-        .isTrue();\n-    assertThat(\n-            recyclerBinder\n-                .getComponentAt(4)\n-                .hasCompatibleLayout(expectedWidthSpec, expectedHeightSpec))\n-        .isFalse();\n-    assertThat(\n-            recyclerBinder\n-                .getComponentAt(5)\n-                .hasCompatibleLayout(expectedWidthSpec, expectedHeightSpec))\n-        .isFalse();\n-  }\n-\n-  @SuppressLint(\"STARVATION\")\n-  @Test\n-  public void testFillViewportWithAllViews() {\n-    final LayoutInfo layoutInfo =\n-        new LinearLayoutInfo(mComponentContext, OrientationHelper.HORIZONTAL, false);\n-\n-    final RecyclerBinder recyclerBinder =\n-        new RecyclerBinder.Builder()\n-            .rangeRatio(RANGE_RATIO)\n-            .layoutInfo(layoutInfo)\n-            .fillListViewport(true)\n-            .build(mComponentContext);\n-\n-    recyclerBinder.measure(\n-        new Size(), makeSizeSpec(1000, EXACTLY), makeSizeSpec(1000, EXACTLY), null);\n-\n-    // Just make sure we don't crash\n-  }\n-\n-  @SuppressLint(\"STARVATION\")\n-  @Test\n-  public void testRemeasureAfterInsertFills() {\n-    final LayoutInfo layoutInfo = mock(LayoutInfo.class);\n-    setupBaseLayoutInfoMock(layoutInfo, OrientationHelper.HORIZONTAL);\n-\n-    final RecyclerView recyclerView = mock(RecyclerView.class);\n-\n-    final RecyclerBinder recyclerBinder =\n-        new RecyclerBinder.Builder()\n-            .rangeRatio(RANGE_RATIO)\n-            .layoutInfo(layoutInfo)\n-            .fillListViewport(true)\n-            .build(mComponentContext);\n-\n-    recyclerBinder.mount(recyclerView);\n-\n-    // Simulate the remeasure runnable\n-    doAnswer(\n-            new Answer() {\n-              @Override\n-              public Void answer(InvocationOnMock invocation) throws Throwable {\n-                recyclerBinder.measure(\n-                    new Size(),\n-                    makeSizeSpec(250, EXACTLY),\n-                    makeSizeSpec(0, UNSPECIFIED),\n-                    mock(EventHandler.class));\n-                return null;\n-              }\n-            })\n-        .when(recyclerView)\n-        .postOnAnimation(recyclerBinder.mRemeasureRunnable);\n-\n-    recyclerBinder.measure(\n-        new Size(),\n-        makeSizeSpec(250, EXACTLY),\n-        makeSizeSpec(0, UNSPECIFIED),\n-        mock(EventHandler.class));\n-\n-    verify(layoutInfo, never()).createViewportFiller(anyInt(), anyInt());\n-\n-    fillRecyclerBinderWithComponents(recyclerBinder, 100, 100, 10);\n-\n-    verify(layoutInfo).createViewportFiller(anyInt(), anyInt());\n-  }\n-\n-  @SuppressLint(\"STARVATION\")\n-  @Test\n-  public void testFillsViewportNoInitRange() {\n-    final LayoutInfo layoutInfo =\n-        new LinearLayoutInfo(mComponentContext, OrientationHelper.VERTICAL, false);\n-\n-    final RecyclerBinder recyclerBinder =\n-        spy(\n-            new RecyclerBinder.Builder()\n-                .rangeRatio(RANGE_RATIO)\n-                .layoutInfo(layoutInfo)\n-                .fillListViewport(true)\n-                .build(mComponentContext));\n-\n-    fillRecyclerBinderWithComponents(recyclerBinder, 100, 100, 10);\n-\n-    recyclerBinder.measure(\n-        new Size(), makeSizeSpec(1000, EXACTLY), makeSizeSpec(250, EXACTLY), null);\n-\n-",
    "added pom . artifactId = \\' eventbus \\'": "diff --git a/EventBus/build.gradle b/EventBus/build.gradle\nindex 8b157dc..edfe4de 100644\n--- a/EventBus/build.gradle\n+++ b/EventBus/build.gradle\n@@ -93,6 +93,7 @@ uploadArchives {\n                 println \"Settings sonatypeUsername/sonatypePassword missing/incomplete for ${project.name}\"\n             }\n \n+            pom.artifactId = 'eventbus'\n  ",
    "updated version of realtime segment propagation": "diff --git a/docs/img/segmentPropagation.png b/docs/img/segmentPropagation.png\nnew file mode 100644\nindex 0000000000..010d3de64f\nBinary files /dev/null and b/docs/img/segmentPropagation.png differ",
    "Rename to JAVA_THREAD_INTERRUPTED from WaitResult . INTERRUPTED for clarity .": "diff --git a/substratevm/src/com.oracle.svm.core.posix/src/com/oracle/svm/core/posix/thread/PosixJavaThreads.java b/substratevm/src/com.oracle.svm.core.posix/src/com/oracle/svm/core/posix/thread/PosixJavaThreads.java\nindex aeecef53565..04b05c68717 100644\n--- a/substratevm/src/com.oracle.svm.core.posix/src/com/oracle/svm/core/posix/thread/PosixJavaThreads.java\n+++ b/substratevm/src/com.oracle.svm.core.posix/src/com/oracle/svm/core/posix/thread/PosixJavaThreads.java\n@@ -255,7 +255,7 @@ class PosixParkEvent extends ParkEvent {\n             }\n             while (!event) {\n                 if (Thread.interrupted()) {\n-                    return WaitResult.INTERRUPTED;\n+                    return WaitResult.JAVA_THREAD_INTERRUPTED;\n                 }\n                 int status = Pthread.pthread_cond_wait(cond, mutex);\n                 PosixUtils.checkStatusIs0(status, \"park(): condition variable wait\");\n@@ -280,7 +280,7 @@ class PosixParkEvent extends ParkEvent {\n             }\n             while (!event) {\n                 if (Thread.interrupted()) {\n-                    return WaitResult.INTERRUPTED;\n+                    return WaitResult.JAVA_THREAD_INTERRUPTED;\n                 }\n                 int status = Pthread.pthread_cond_timedwait(cond, mutex, deadlineTimespec);\n                 if (status == Errno.ETIMEDOUT()) {\ndiff --git a/substratevm/src/com.oracle.svm.core.windows/src/com/oracle/svm/core/windows/WindowsJavaThreads.java b/substratevm/src/com.oracle.svm.core.windows/src/com/oracle/svm/core/windows/WindowsJavaThreads.java\nindex 51a33bf9f21..3329a38a447 100644\n--- a/substratevm/src/com.oracle.svm.core.windows/src/com/oracle/svm/core/windows/WindowsJavaThreads.java\n+++ b/substratevm/src/com.oracle.svm.core.windows/src/com/oracle/svm/core/windows/WindowsJavaThreads.java\n@@ -175,7 +175,7 @@ class WindowsParkEvent extends ParkEvent {\n             reset();\n         }\n         if (Thread.interrupted()) {\n-            return WaitResult.INTERRUPTED;\n+            return WaitResult.JAVA_THREAD_INTERRUPTED;\n         }\n         int status = SynchAPI.WaitForSingleObject(eventHandle, SynchAPI.INFINITE());\n         if (status != SynchAPI.WAIT_OBJECT_0()) {\n@@ -195,7 +195,7 @@ class WindowsParkEvent extends ParkEvent {\n         }\n         do { // at least once to consume possible interrupt/unpark\n             if (Thread.interrupted()) {\n-                return WaitResult.INTERRUPTED;\n+                return WaitResult.JAVA_THREAD_INTERRUPTED;\n             }\n             int timeout = (delayMillis < maxTimeout) ? (int) delayMillis : maxTimeout;\n             int status = SynchAPI.WaitForSingleObject(eventHandle, timeout);\ndiff --git a/substratevm/src/com.oracle.svm.core/src/com/oracle/svm/core/thread/ParkEvent.java b/substratevm/src/com.oracle.svm.core/src/com/oracle/svm/core/thread/ParkEvent.java\nindex b7b44f08231..a1b90b2f8b7 100644\n--- a/substratevm/src/com.oracle.svm.core/src/com/oracle/svm/core/thread/ParkEvent.java\n+++ b/substratevm/src/com.oracle.svm.core/src/com/oracle/svm/core/thread/ParkEvent.java\n@@ -74,7 +74,7 @@ public abstract class ParkEvent {\n     public enum WaitResult {\n         UNPARKED,\n         TIMED_OUT,\n-        INTERRUPTED\n+        JAVA_THREAD_INTERRUPTED\n     }\n \n     protected abstract void reset();\ndiff --git a/substratevm/src/com.oracle.svm.core/src/com/oracle/svm/core/thread/Target_java_lang_Thread.java b/substratevm/src/com.oracle.svm.core/src/com/oracle/svm/core/thread/Target_java_lang_Thread.java\nindex fd5ba240a5b..69d342d17aa 100644\n--- a/substratevm/src/com.oracle.svm.core/src/com/oracle/svm/core/thread/Target_java_lang_Thread.java\n+++ b/substratevm/src/com.oracle.svm.core/src/com/oracle/svm/core/thread/Target_java_lang_Thread.java\n@@ -360,7 +360,7 @@ final class Target_java_lang_Thread {\n          */\n         boolean interrupted = Thread.interrupted();\n   ",
    "Add signing of payment requests to PaymentProtocol class .": "diff --git a/core/src/main/java/com/google/bitcoin/protocols/payments/PaymentProtocol.java b/core/src/main/java/com/google/bitcoin/protocols/payments/PaymentProtocol.java\nindex 416b94713..667521c7e 100644\n--- a/core/src/main/java/com/google/bitcoin/protocols/payments/PaymentProtocol.java\n+++ b/core/src/main/java/com/google/bitcoin/protocols/payments/PaymentProtocol.java\n@@ -17,17 +17,20 @@\n \n package com.google.bitcoin.protocols.payments;\n \n+import java.security.GeneralSecurityException;\n import java.security.InvalidAlgorithmParameterException;\n import java.security.InvalidKeyException;\n import java.security.KeyStore;\n import java.security.KeyStoreException;\n import java.security.NoSuchAlgorithmException;\n+import java.security.PrivateKey;\n import java.security.PublicKey;\n import java.security.Signature;\n import java.security.SignatureException;\n import java.security.cert.CertPath;\n import java.security.cert.CertPathValidator;\n import java.security.cert.CertPathValidatorException;\n+import java.security.cert.Certificate;\n import java.security.cert.CertificateException;\n import java.security.cert.CertificateFactory;\n import java.security.cert.CertificateParsingException;\n@@ -48,6 +51,46 @@ import com.google.protobuf.InvalidProtocolBufferException;\n \n public class PaymentProtocol {\n \n+    /**\n+     * Sign the provided payment request.\n+     * \n+     * @param paymentRequest\n+     *            Payment request to sign, in its builder form.\n+     * @param certificateChain\n+     *            Certificate chain to send with the payment request, ordered from client certificate to root\n+     *            certificate. The root certificate itself may be omitted.\n+     * @param privateKey\n+     *            The key to sign with. Must match the public key from the first certificate of the certificate chain.\n+     */\n+    public static void signPaymentRequestPki(Protos.PaymentRequest.Builder paymentRequest,\n+            X509Certificate[] certificateChain, PrivateKey privateKey) {\n+        try {\n+            final Protos.X509Certificates.Builder certificates = Protos.X509Certificates.newBuilder();\n+            for (final Certificate certificate : certificateChain)\n+                certificates.addCertificate(ByteString.copyFrom(certificate.getEncoded()));\n+\n+            paymentRequest.setPkiType(\"x509+sha256\");\n+            paymentRequest.setPkiData(certificates.build().toByteString());\n+            paymentRequest.setSignature(ByteString.EMPTY);\n+            final Protos.PaymentRequest paymentRequestToSign = paymentRequest.build();\n+\n+            final String algorithm;\n+            if (privateKey.getAlgorithm().equalsIgnoreCase(\"RSA\"))\n+                algorithm = \"SHA256withRSA\";\n+            else\n+                throw new IllegalStateException(privateKey.getAlgorithm());\n+\n+            final Signature signature = Signature.getInstance(algorithm);\n+            signature.initSign(privateKey);\n+            signature.update(paymentRequestToSign.toByteArray());\n+\n+            paymentRequest.setSignature(ByteString.copyFrom(signature.sign()));\n+        } catch (final GeneralSecurityException x) {\n+            // Should never happen so don't make users have to think about it.\n+            throw new RuntimeException(x);\n+        }\n+    }\n+\n     /**\n      * Uses the provided PKI method to find the corresponding public key and verify the provided signature.\n      * ",
    "Introduce onCheckCanDrop ( ) method to DraggableItemAdapter .": "diff --git a/example/src/main/java/com/h6ah4i/android/example/advrecyclerview/demo_d_basic/DraggableExampleItemAdapter.java b/example/src/main/java/com/h6ah4i/android/example/advrecyclerview/demo_d_basic/DraggableExampleItemAdapter.java\nindex 3cca2f2..3532ff6 100644\n--- a/example/src/main/java/com/h6ah4i/android/example/advrecyclerview/demo_d_basic/DraggableExampleItemAdapter.java\n+++ b/example/src/main/java/com/h6ah4i/android/example/advrecyclerview/demo_d_basic/DraggableExampleItemAdapter.java\n@@ -146,4 +146,9 @@ class DraggableExampleItemAdapter\n         // no drag-sortable range specified\n         return null;\n     }\n+\n+    @Override\n+    public boolean onCheckCanDrop(int draggingPosition, int dropPosition) {\n+        return true;\n+    }\n }\ndiff --git a/example/src/main/java/com/h6ah4i/android/example/advrecyclerview/demo_d_grid/DraggableGridExampleAdapter.java b/example/src/main/java/com/h6ah4i/android/example/advrecyclerview/demo_d_grid/DraggableGridExampleAdapter.java\nindex a49b3ac..69e8e51 100644\n--- a/example/src/main/java/com/h6ah4i/android/example/advrecyclerview/demo_d_grid/DraggableGridExampleAdapter.java\n+++ b/example/src/main/java/com/h6ah4i/android/example/advrecyclerview/demo_d_grid/DraggableGridExampleAdapter.java\n@@ -137,4 +137,9 @@ class DraggableGridExampleAdapter\n         // no drag-sortable range specified\n         return null;\n     }\n+\n+    @Override\n+    public boolean onCheckCanDrop(int draggingPosition, int dropPosition) {\n+        return true;\n+    }\n }\ndiff --git a/example/src/main/java/com/h6ah4i/android/example/advrecyclerview/demo_d_minimal/MinimalDraggableExampleActivity.java b/example/src/main/java/com/h6ah4i/android/example/advrecyclerview/demo_d_minimal/MinimalDraggableExampleActivity.java\nindex 2830743..c9c1d2b 100644\n--- a/example/src/main/java/com/h6ah4i/android/example/advrecyclerview/demo_d_minimal/MinimalDraggableExampleActivity.java\n+++ b/example/src/main/java/com/h6ah4i/android/example/advrecyclerview/demo_d_minimal/MinimalDraggableExampleActivity.java\n@@ -132,5 +132,10 @@ public class MinimalDraggableExampleActivity extends AppCompatActivity {\n         public ItemDraggableRange onGetItemDraggableRange(MyViewHolder holder, int position) {\n             return null;\n         }\n+\n+        @Override\n+        public boolean onCheckCanDrop(int draggingPosition, int dropPosition) {\n+            return true;\n+        }\n     }\n }\ndiff --git a/example/src/main/java/com/h6ah4i/android/example/advrecyclerview/demo_d_on_longpress/DragOnLongPressExampleAdapter.java b/example/src/main/java/com/h6ah4i/android/example/advrecyclerview/demo_d_on_longpress/DragOnLongPressExampleAdapter.java\nindex 10fe9ca..c283f89 100644\n--- a/example/src/main/java/com/h6ah4i/android/example/advrecyclerview/demo_d_on_longpress/DragOnLongPressExampleAdapter.java\n+++ b/example/src/main/java/com/h6ah4i/android/example/advrecyclerview/demo_d_on_longpress/DragOnLongPressExampleAdapter.java\n@@ -146,4 +146,9 @@ class DragOnLongPressExampleAdapter\n         // no drag-sortable range specified\n         return null;\n     }\n+\n+    @Override\n+    public boolean onCheckCanDrop(int draggingPosition, int dropPosition) {\n+        return true;\n+    }\n }\ndiff --git a/example/src/main/java/com/h6ah4i/android/example/advrecyclerview/demo_d_staggered_grid/DraggableStaggeredGridExampleAdapter.java b/example/src/main/java/com/h6ah4i/android/example/advrecyclerview/demo_d_staggered_grid/DraggableStaggeredGridExampleAdapter.java\nindex d857922..90d8881 100644\n--- a/example/src/main/java/com/h6ah4i/android/example/advrecyclerview/demo_d_staggered_grid/DraggableStaggeredGridExampleAdapter.java\n+++ b/example/src/main/java/com/h6ah4i/android/example/advrecyclerview/demo_d_staggered_grid/DraggableStaggeredGridExampleAdapter.java\n@@ -109,6 +109,10 @@ class DraggableStaggeredGridExampleAdapter\n                 // NOTE:\n                 // This dummy header item is required to workaround the\n                 // weired animation when occurs on moving the item 0\n+                //\n+                // Related issue\n+                //   Issue 99047:\tInconsistent behavior produced by mAdapter.notifyItemMoved(indexA,indexB);\n+                //   https://code.google.com/p/android/issues/detail?id=99047&q=notifyItemMoved&colspec=ID%20Status%20Priority%20Owner%20Summary%20Stars%20Reporter%20Opened&\n                 final View v = inflater.inflate(R.layout.dummy_header_item, parent, false);\n                 return new HeaderItemViewHolder(v);\n             }\n@@ -207,6 +211,11 @@ class DraggableStaggeredGridExampleAdapter\n         return new ItemDraggableRange(headerCount, getItemCount() - 1);\n     }\n \n+    @Override\n+    public boolean onCheckCanDrop(int draggingPosition, int dropPosition) {\n+        return true;\n+    }\n+\n     static int getHeaderItemCount() {\n         return (USE_DUMMY_HEADER) ? 1 : 0;\n     }\ndiff --git a/example/src/main/java/com/h6ah4i/android/example/advrecyclerview/demo_d_with_section/DraggableWithSectionExampleAdapter.java b/example/src/main/java/com/h6ah4i/android/example/advrecyclerview/demo_d_with_section/DraggableWithSectionExampleAdapter.java\nindex 5098768..f39d0af 100644\n--- a/example/src/main/java/com/h6ah4i/android/example/advrecyclerview/demo_d_with_section/DraggableWithSectionExampleAdapter.java\n+++ b/example/src/main/java/com/h6ah4i/android/example/advrecyclerview/demo_d_with_section/DraggableWithSectionExampleAdapter.java\n@@ -191,6 +191,11 @@ class DraggableWithSectionExampleAdapter\n         return new ItemDraggableRange(start, end);\n     }\n \n+    @Override\n+    public boolean onCheckCanDrop(int draggingPosition, int dropPosition) {\n+        return true;\n+    }\n+\n     private int findFirstSectionItem(int position) {\n         AbstractDataProvider.Data item = mProvider.getItem(position);\n \ndiff --git a/example/src/main/java/com/h6ah4i/android/example/advrecyclerview/demo_ds/DraggableSwipeableExampleAdapter.java b/example/src/main/java/com/h6ah4i/android/example/advrecyclerview/demo_ds/DraggableSwipeableExampleAdapter.java\nindex bda3162..4abdef0 100644\n--- a/example/src/main/java/com/h6ah4i/android/example/advrecyclerview/demo_ds/DraggableSwipeableExampleAdapter.java\n+++ b/example/src/main/java/com/h6ah4i/android/example/advrecyclerview/demo_ds/DraggableSwipeableExampleAdapter.java\n@@ -213,6 +213,11 @@ class DraggableSwipeableExampleAdapter\n         return null;\n     }\n \n+    @Override\n+    public boolean onCheckCanDrop(int draggingPosition, int dropPosition) {\n+        return true;\n+    }\n+\n     @Override\n     public int onGetSwipeReactionType(MyViewHolder holder, int position, int x, int y) {\n         if (onCheckCanStartDrag(holder, position, x, y)) {\ndiff --git a/example/src/main/java/com/h6ah4i/android/example/advrecyclerview/demo_ed_with_section/ExpandableDraggableWithSectionExampleAdapter.java b/example/src/main/java/com/h6ah4i/android/example/advrecyclerview/demo_ed_with_section/ExpandableDraggableWithSectionExampleAdapter.java\nindex 70e89b3..e483399 100644\n--- a/example/src/main/java/com/h6ah4i/android/example/advrecyclerview/demo_ed_with_section/ExpandableDraggableWithSectionExampleAdapter.java\n+++ b/example/src/main/java/com/h6ah4i/android/example/advrecyclerview/demo_ed_with_section/ExpandableDraggableWithSectionExampleAdapter.java\n@@ -331,6 +331,16 @@ class ExpandableDraggableWithSectionExampleAdapter\n //        return new ChildPositionItemDraggableRange(start, end);\n     }\n \n+    @Override\n+    public boolean onCheckGroupCanDrop(int draggingGroupPosition, int dropGroupPosition) {\n+        return true;\n+    }\n+\n+    @Override\n+    public boolean onCheckChildCanDrop(int draggingGroupPosition, int draggingChildPosition, int dropGroupPosition, int dropChildPosition) {\n+        return true;\n+    }\n+\n     @Override\n     public void onMoveGroupItem(int fromGroupPosition, int toGroupPosition) {\n         mProvider.moveGroupItem(fromGroupPosition, toGroupPosition);\ndiff --git a/example/src/main/java/com/h6ah4i/android/example/advrecyclerview/demo_eds/ExpandableDraggableSwipeableExampleAdapter.java b/example/src/main/java/com/h6ah4i/android/example/advrecyclerview/demo_eds/ExpandableDraggableSwipeableExampleAdapter.java\nindex 458ccfc..c57b8bb 100644\n--- a/example/src/main/java/com/h6ah4i/android/example/advrecyclerview/demo_eds/ExpandableDraggableSwipeableExampleAdapter.java\n+++ b/example/src/main/java/com/h6ah4i/android/example/advrecyclerview/demo_eds/ExpandableDraggableSwipeableExampleAdapter.java\n@@ -360,6 +360,16 @@ class ExpandableDraggableSwipeableExampleAdapter\n         return null;\n     }\n \n+    @Override\n+    public boolean onCheckGroupCanDrop(int draggingGroupPosition, int dropGroupPosition) {\n+        return true;\n+    }\n+\n+    @Override\n+    public boolean onCheckChildCanDrop(int draggingGroupPosition, int draggingChildPosition, int dropGroupPosition, int dropChildPosition) {\n+        return true;\n+    }\n+\n     @Override\n     public void onMoveGroupItem(int fromGroupPosition, int toGroupPosition) {\n         mProvider.moveGroupItem(fromGroupPosition, toGroupPosition);\ndiff --git a/library/src/main/java/com/h6ah4i/android/widget/advrecyclerview/draggable/DraggableItemAdapter.java b/library/src/main/java/com/h6ah4i/android/widget/advrecyclerview/draggable/DraggableItemAdapter.java\nindex 89aa001..7acbbea 100644\n--- a/library/src/main/java/com/h6ah4i/android/widget/advrecyclerview/draggable/DraggableItemAdapter.java\n+++ b/library/src/main/java/com/h6ah4i/android/widget/advrecyclerview/draggable/DraggableItemAdapter.java\n@@ -50,4 +50,16 @@ public interface DraggableItemAdapter<T extends RecyclerView.ViewHolder> {\n      * @param toPosition New position of the item.\n      */\n     void onMoveItem(int fromPosition, int toPosition);\n+\n+    /**\n+     * Called while dragging in order to check whether the dragging item can be dropped to the specified position.\n+     *\n+     * NOTE: This method will be called when the checkCanDrop option is enabled by {@link RecyclerViewDragDropManager#setCheckCanDropEnabled(boolean)}.\n+     *\n+     * @param draggingPosition The position of the currently dragging item.\n+     * @param dropPosition The position to check whether the dragging item can be dropped or not.\n+     *\n+     * @return Whether can be dropped to the specified position.\n+     */\n+    boolean onCheckCanDrop(int draggingPosition, int dropPosition);\n }\ndiff --git a/library/src/main/java/com/h6ah4i/android/widget/advrecyclerview/draggable/DraggableItemWrapperAdapter.java b/library/src/main/java/com/h6ah4i/android/widget/advrecyclerview/draggable/DraggableItemWrapperAdapter.java\nindex c6d9545..7f33ec2 100644\n--- a/library/src/main/java/com/h6ah4i/android/widget/advrecyclerview/draggable/DraggableItemWrapperAdapter.java\n+++ b/library/src/main/java/com/h6ah4i/android/widget/advrecyclerview/draggable/DraggableItemWrapperAdapter.java\n@@ -308,6 +308,16 @@ class DraggableItemWrapperAdapter<VH extends RecyclerView.ViewHolder> extends Ba\n         return mDraggableItemAdapter.onCheckCanStartDrag(holder, position, x, y);\n     }\n \n+    // NOTE: This method is called from RecyclerViewDragDropManager\n+    /*package*/\n+    @SuppressWarnings(\"unchecked\")\n+    boolean canDropItems(int draggingPosition, int dropPosition) {\n+        if (LOCAL_LOGV) {\n+            Log.v(TAG, \"canDropItems(draggingPosition = \" + draggingPosition + \", dropPosition = \" + dropPosition + \")\");\n+        }\n+        return mDraggableItemAdapter.onCheckCanDrop(draggingPosition, dropPosition);\n+    }\n+\n     // NOTE: This method is called from RecyclerViewDragDropManager\n     /*package*/\n     @SuppressWarnings(\"unchecked\")\ndiff --git a/library/src/main/java/com/h6ah4i/android/widget/advrecyclerview/draggable/RecyclerViewDragDropManager.java b/library/src/main/java/com/h6ah4i/android/widget/advrecyclerview/draggable/RecyclerViewDragDropManager.java\nindex 4c75fdd..0d902d2 100644\n--- a/library/src/main/java/com/h6ah4i/android/widget/advrecyclerview/draggable/RecyclerViewDragDropManager.java\n+++ b/library/src/main/java/com/h6ah4i/android/widget/advrecyclerview/draggable/RecyclerViewDragDropManager.java\n@@ -30,6 +30,7 @@ import android.util.Log;\n import android.view.MotionEvent;\n import android.view.View;\n import android.view.ViewConfiguration;\n+import android.view.ViewGroup;\n import android.view.animation.DecelerateInterpolator;\n import android.view.animation.Interpolator;\n \n@@ -131,6 +132,7 @@ public class RecyclerViewDragDropManager implements DraggableItemConstants {\n     private boolean mInitiateOnLongPress;\n     private boolean mInitiateOnMove = true;\n     private int mLongPressTimeout;\n+    private boolean mCheckCanDrop;\n \n     private boolean mInScrollByMethod;\n     private int mActualScrollByXAmount;\n@@ -473,6 +475,24 @@ public class RecyclerViewDragDropManager implements DraggableItemConstants {\n         return mDragEdgeScrollSpeed;\n     }\n \n+    /**\n+     * Sets whether to use {@link DraggableItemAdapter#onCheckCanDrop(int, int)}.\n+     *\n+     * @param enabled True if use {@link DraggableItemAdapter#onCheckCanDrop(int, int)}.\n+     */\n+    public void setCheckCanDropEnabled(boolean enabled) {\n+        mCheckCanDrop = enabled;\n+    }\n+\n+    /**\n+     * Gets whether to use {@link DraggableItemAdapter#onCheckCanDrop(int, int)}.\n+     *\n+     * @return True if {@link DraggableItemAdapter#onCheckCanDrop(int, int)} is used, false otherwise.\n+     */\n+    public boolean isCheckCanDropEnabled() {\n+        return mCheckCanDrop;\n+    }\n+\n     /*package*/ boolean onInterceptTouchEvent(RecyclerView rv, MotionEvent e) {\n         final int action = MotionEventCompat.getActionMasked(e);\n \n@@ -636,9 +656,9 @@ public class RecyclerViewDragDropManager implements DraggableItemConstants {\n         mDraggingItemDecorator.setShadowDrawable(mShadowDrawable);\n         mDraggingItemDecorator.start(e, mDraggingItemInfo);\n \n-        int layoutType = CustomRecyclerViewUtils.getLayoutType(mRecyclerView);\n+        final int layoutType = CustomRecyclerViewUtils.getLayoutType(mRecyclerView);\n \n-        if (supportsViewTranslation() &&\n+        if (supportsViewTranslation() && !mCheckCanDrop &&\n                 (layoutType == CustomRecyclerViewUtils.LAYOUT_TYPE_LINEAR_VERTICAL ||\n                         layoutType == CustomRecyclerViewUtils.LAYOUT_TYPE_LINEAR_HORIZONTAL)) {\n             mSwapTargetItemOperator = new SwapTargetItemOperator(mRecyclerView, holder, mDraggableRange, mDraggingItemInfo);\n@@ -943,13 +963,39 @@ public class RecyclerViewDragDropManager implements DraggableItemConstants {\n \n         final int overlayItemLeft = mLastTouchX - mDraggingItemInfo.grabbedPositionX;\n         final int overlayItemTop = mLastTouchY - mDraggingItemInfo.grabbedPositionY;\n-        final RecyclerView.ViewHolder swapTargetHolder =\n-                findSwapTargetItem(rv, draggingItem, mDraggingItemInfo, overlayItemLeft, overlayItemTop, mDraggableRange);\n+        final int draggingItemInitialPosition = mAdapter.getDraggingItemInitialPosition();\n+        final int draggingItemCurrentPosition = mAdapter.getDraggingItemCurrentPosition();\n+        RecyclerView.ViewHolder swapTargetHolder;\n+        int swapTargetPosition;\n+        boolean canSwap = false;\n+\n+        swapTargetHolder = findSwapTargetItem(rv, draggingItem, mDraggingItemInfo, overlayItemLeft, overlayItemTop, mDraggableRange, mCheckCanDrop, false);\n+        swapTargetPosition = CustomRecyclerViewUtils.safeGetAdapterPosition(swapTargetHolder);\n+\n+        if (swapTargetPosition != RecyclerView.NO_POSITION) {\n+            if (!mCheckCanDrop) {\n+                canSwap = true;\n+            }\n+            if (!canSwap) {\n+                canSwap = mAdapter.canDropItems(draggingItemInitialPosition, swapTargetPosition);\n+            }\n+            if (!canSwap) {\n+                swapTargetHolder = findSwapTargetItem(rv, draggingItem, mDraggingItemInfo, overlayItemLeft, overlayItemTop, mDraggableRange, mCheckCanDrop, true);\n+                swapTargetPosition = CustomRecyclerViewUtils.safeGetAdapterPosition(swapTargetHolder);\n+\n+                if (swapTargetPosition != RecyclerView.NO_POSITION) {\n+                    canSwap = mAdapter.canDropItems(draggingItemInitialPosition, swapTargetPosition);\n+                }\n+            }\n+        }\n \n-        if ((swapTargetHolder != null) && (swapTargetHolder != mDraggingItemViewHolder)) {\n-            int draggingItemCurrentPosition = mAdapter.getDraggingItemCurrentPosition();\n+        if (canSwap) {\n             swapItems(rv, draggingItemCurrentPosition, draggingItem, swapTargetHolder);\n         }\n+\n+        if (mSwapTargetItemOperator != null) {\n+            mSwapTargetItemOperator.setSwapTargetItem((canSwap) ? swapTargetHolder : null);\n+        }\n     }\n \n     private void onItemMoveDistanceUpdated() {\n@@ -1257,50 +1303,32 @@ public class RecyclerViewDragDropManager implements DraggableItemConstants {\n             mItemDragEventListener.onItemDragPositionChanged(fromPosition, toPosition);\n         }\n \n-        RecyclerView.ViewHolder firstVisibleItem = null;\n-\n-        if (rv.getChildCount() > 0) {\n-            View child = rv.getChildAt(0);\n-            if (child != null) {\n-                firstVisibleItem = rv.getChildViewHolder(child);\n-            }\n-        }\n-\n-        final int prevFirstItemPosition = (firstVisibleItem != null) ? firstVisibleItem.getAdapterPosition() : RecyclerView.NO_POSITION;\n+        final RecyclerView.LayoutManager layoutManager = mRecyclerView.getLayoutManager();\n+        final int layoutType = CustomRecyclerViewUtils.getLayoutType(mRecyclerView);\n+        final boolean isVertical = (CustomRecyclerViewUtils.extractOrientation(layoutType) == CustomRecyclerViewUtils.ORIENTATION_VERTICAL);\n+        final int firstVisible = CustomRecyclerViewUtils.findFirstVisibleItemPosition(mRecyclerView, false);\n+        View fromView = CustomRecyclerViewUtils.findViewByPosition(layoutManager, fromPosition);\n+        View toView = CustomRecyclerViewUtils.findViewByPosition(layoutManager, toPosition);\n+        View firstView = CustomRecyclerViewUtils.findViewByPosition(layoutManager, firstVisible);\n+        Integer fromOrigin = getItemViewOrigin(fromView, isVertical);\n+        Integer toOrigin = getItemViewOrigin(toView, isVertical);\n+        Integer firstOrigin = getItemViewOrigin(firstView, isVertical);\n \n         // NOTE: This method invokes notifyItemMoved() method internally. Be careful!\n         mAdapter.moveItem(fromPosition, toPosition);\n \n-        safeEndAnimationsIfRequired(rv);\n-\n-        switch (CustomRecyclerViewUtils.getOrientation(rv)) {\n-            case CustomRecyclerViewUtils.ORIENTATION_VERTICAL:\n-                if (fromPosition == prevFirstItemPosition) {\n-                    //noinspection UnnecessaryLocalVariable\n-                    final Rect margins = swapTargetMargins;\n-                    final int curTopItemHeight = swapTargetHolder.itemView.getHeight() + margins.top + margins.bottom;\n-                    scrollByYAndGetScrolledAmount(-curTopItemHeight);\n-                } else if (toPosition == prevFirstItemPosition) {\n-                    final Rect margins = mDraggingItemInfo.margins;\n-                    final int curTopItemHeight = mDraggingItemInfo.height + margins.top + margins.bottom;\n-                    scrollByYAndGetScrolledAmount(-curTopItemHeight);\n-                }\n-                break;\n-            case CustomRecyclerViewUtils.ORIENTATION_HORIZONTAL:\n-                if (fromPosition == prevFirstItemPosition) {\n-                    //noinspection UnnecessaryLocalVariable\n-                    final Rect margins = swapTargetMargins;\n-                    final int curLeftItemHeight = swapTargetHolder.itemView.getWidth() + margins.left + margins.right;\n-                    scrollByXAndGetScrolledAmount(-curLeftItemHeight);\n-                } else if (toPosition == prevFirstItemPosition) {\n-                    final Rect margins = mDraggingItemInfo.margins;\n-                    final int curLeftItemHeight = mDraggingItemInfo.width + margins.left + margins.right;\n-                    scrollByXAndGetScrolledAmount(-curLeftItemHeight);\n-                }\n-                break;\n+        if ((firstVisible == fromPosition) && (firstOrigin != null) && (toOrigin != null)) {\n+            rv.scrollBy(0, -(toOrigin - firstOrigin));\n+            safeEndAnimations(rv);\n+        } else if ((firstVisible == toPosition) && (fromView != null) && (fromOrigin != toOrigin)) {\n+            ViewGroup.MarginLayoutParams lp = (ViewGroup.MarginLayoutParams) fromView.getLayoutParams();\n+            rv.scrollBy(0, -(layoutManager.getDecoratedMeasuredHeight(fromView) + lp.topMargin + lp.bottomMargin));\n+            safeEndAnimations(rv);\n         }\n+    }\n \n-        safeEndAnimationsIfRequired(rv);\n+    private static Integer getItemViewOrigin(View itemView, boolean vertical) {\n+        return (itemView != null) ? ((vertical) ? itemView.getTop() : itemView.getLeft()) : null;\n     }\n \n     private static DraggableItemWrapperAdapter getDraggableItemWrapperAdapter(RecyclerView rv) {\n@@ -1360,7 +1388,7 @@ public class RecyclerViewDragDropManager implements DraggableItemConstants {\n     /*package*/\n     static RecyclerView.ViewHolder findSwapTargetItem(\n             RecyclerView rv, RecyclerView.ViewHolder draggingItem,\n-            DraggingItemInfo draggingItemInfo, int overlayItemLeft, int overlayItemTop, ItemDraggableRange range) {\n+            DraggingItemInfo draggingItemInfo, int overlayItemLeft, int overlayItemTop, ItemDraggableRange range, boolean checkCanSwap, boolean alternative) {\n         RecyclerView.ViewHolder swapTargetHolder = null;\n \n         if ((draggingItem == null) || (\n@@ -1385,19 +1413,22 @@ public class RecyclerViewDragDropManager implements DraggableItemConstants {\n                 case CustomRecyclerViewUtils.LAYOUT_TYPE_STAGGERED_GRID_HORIZONTAL:\n                 case CustomRecyclerViewUtils.LAYOUT_TYPE_STAGGERED_GRID_VERTICAL:\n                     swapTargetHolder = findSwapTargetItemForXGridLayoutManager(\n-                            rv, draggingItem, draggingItemInfo, overlayItemLeft, overlayItemTop, isVerticalLayout);\n+                            rv, draggingItem, draggingItemInfo, overlayItemLeft, overlayItemTop, isVerticalLayout, checkCanSwap, alternative);\n                     break;\n                 case CustomRecyclerViewUtils.LAYOUT_TYPE_LINEAR_HORIZONTAL:\n-                    swapTargetHolder = findSwapTargetItemForLinearLayoutManagerHorizontal(rv, draggingItem, draggingItemInfo, overlayItemLeft, overlayItemTop);\n-                    break;\n                 case CustomRecyclerViewUtils.LAYOUT_TYPE_LINEAR_VERTICAL:\n-                    swapTargetHolder = findSwapTargetItemForLinearLayoutManagerVertical(rv, draggingItem, draggingItemInfo, overlayItemLeft, overlayItemTop);\n+                    swapTargetHolder = findSwapTargetItemForLinearLayoutManager(\n+                            rv, draggingItem, draggingItemInfo, overlayItemLeft, overlayItemTop, isVerticalLayout, checkCanSwap, alternative);\n                     break;\n                 default:\n                     break;\n             }\n         }\n \n+        if (swapTargetHolder == draggingItem) {\n+            swapTargetHolder = null;\n+        }\n+\n         // check range\n         if (swapTargetHolder != null && range != null) {\n             if (!range.checkInRange(swapTargetHolder.getAdapterPosition())) {\n@@ -1410,9 +1441,13 @@ public class RecyclerViewDragDropManager implements DraggableItemConstants {\n \n     private static RecyclerView.ViewHolder findSwapTargetItemForXGridLayoutManager(\n             RecyclerView rv, @Nullable RecyclerView.ViewHolder draggingItem,\n-            DraggingItemInfo draggingItemInfo, int overlayItemLeft, int overlayItemTop, boolean vertical) {\n+            DraggingItemInfo draggingItemInfo, int overlayItemLeft, int overlayItemTop, boolean vertical, boolean checkCanSwap, boolean alternative) {\n         final int spanSize = draggingItemInfo.spanSize;\n \n+        if (alternative) {\n+            return null;\n+        }\n+\n         RecyclerView.ViewHolder swapTargetHolder = null;\n \n         for (int i = 0; i < spanSize; i++) {\n@@ -1485,46 +1520,41 @@ public class RecyclerViewDragDropManager implements DraggableItemConstants {\n         return null;\n     }\n \n-    private static RecyclerView.ViewHolder findSwapTargetItemForLinearLayoutManagerVertical(\n+    private static RecyclerView.ViewHolder findSwapTargetItemForLinearLayoutManager(\n             RecyclerView rv, RecyclerView.ViewHolder draggingItem,\n-            DraggingItemInfo draggingItemInfo, int overlayItemLeft, int overlayItemTop) {\n+            DraggingItemInfo draggingItemInfo, int overlayItemLeft, int overlayItemTop, boolean vertical, boolean checkCanSwap, boolean alternative) {\n         RecyclerView.ViewHolder swapTargetHolder = null;\n \n-        if (draggingItem != null) {\n+        if (draggingItem == null) {\n+            return null;\n+        }\n+\n+        if (!checkCanSwap && !alternative) {\n             final int draggingItemPosition = draggingItem.getAdapterPosition();\n-            final int draggingViewTop = draggingItem.itemView.getTop();\n+            final int draggingViewOrigin = (vertical) ? draggingItem.itemView.getTop() : draggingItem.itemView.getLeft();\n+            final int overlayItemOrigin = (vertical) ? overlayItemTop : overlayItemLeft;\n \n-            if (overlayItemTop < draggingViewTop) {\n+            if (overlayItemOrigin < draggingViewOrigin) {\n                 if (draggingItemPosition > 0) {\n                     swapTargetHolder = rv.findViewHolderForAdapterPosition(draggingItemPosition - 1);\n                 }\n-            } else if (overlayItemTop > draggingViewTop) {\n+            } else if (overlayItemOrigin > draggingViewOrigin) {\n                 if (draggingItemPosition < (rv.getAdapter().getItemCount() - 1)) {\n                     swapTargetHolder = rv.findViewHolderForAdapterPosition(draggingItemPosition + 1);\n                 }\n             }\n-        }\n-\n-        return swapTargetHolder;\n-    }\n-\n-    private static RecyclerView.ViewHolder findSwapTargetItemForLinearLayoutManagerHorizontal(\n-            RecyclerView rv, @Nullable RecyclerView.ViewHolder draggingItem,\n-            DraggingItemInfo draggingItemInfo, int overlayItemLeft, int overlayItemTop) {\n-        RecyclerView.ViewHolder swapTargetHolder = null;\n+        } else {\n+            final float gap = draggingItem.itemView.getResources().getDisplayMetrics().density * 8;\n+  ",
    "Remove unused TEMPTO_EXTRA_CONFIG_FILE": "diff --git a/presto-product-tests-launcher/src/main/java/io/prestosql/tests/product/launcher/cli/TestRun.java b/presto-product-tests-launcher/src/main/java/io/prestosql/tests/product/launcher/cli/TestRun.java\nindex 7891682ba7..9713a37698 100644\n--- a/presto-product-tests-launcher/src/main/java/io/prestosql/tests/product/launcher/cli/TestRun.java\n+++ b/presto-product-tests-launcher/src/main/java/io/prestosql/tests/product/launcher/cli/TestRun.java\n@@ -183,7 +183,6 @@ public final class TestRun\n                                                 .add(CONTAINER_TEMPTO_PROFILE_CONFIG)\n                                                 .add(System.getenv().getOrDefault(\"TEMPTO_ENVIRONMENT_CONFIG_FILE\", \"/dev/null\"))\n                                                 .add(container.getEnvMap().getOrDefault(\"TEMPTO_CONFIG_FILES\", \"/dev/null\"))\n-              ",
    "Implemented Progress API": "diff --git a/visualvm/truffle.heapwalker/nbproject/project.xml b/visualvm/truffle.heapwalker/nbproject/project.xml\nindex 423d54a08..69653be7d 100644\n--- a/visualvm/truffle.heapwalker/nbproject/project.xml\n+++ b/visualvm/truffle.heapwalker/nbproject/project.xml\n@@ -47,7 +47,7 @@\n                     <build-prerequisite/>\n                     <compile-dependency/>\n                     <run-dependency>\n-                        <specification-version>1.111</specification-version>\n+                        <specification-version>1.112</specification-version>\n                     </run-dependency>\n                 </dependency>\n                 <dependency>\ndiff --git a/visualvm/truffle.heapwalker/src/com/sun/tools/visualvm/truffle/heapwalker/TruffleFieldsPlugin.java b/visualvm/truffle.heapwalker/src/com/sun/tools/visualvm/truffle/heapwalker/TruffleFieldsPlugin.java\nindex 7e6ed81ed..0e60f8e73 100644\n--- a/visualvm/truffle.heapwalker/src/com/sun/tools/visualvm/truffle/heapwalker/TruffleFieldsPlugin.java\n+++ b/visualvm/truffle.heapwalker/src/com/sun/tools/visualvm/truffle/heapwalker/TruffleFieldsPlugin.java\n@@ -37,6 +37,7 @@ import org.netbeans.modules.profiler.heapwalker.v2.HeapContext;\n import org.netbeans.modules.profiler.heapwalker.v2.model.DataType;\n import org.netbeans.modules.profiler.heapwalker.v2.model.HeapWalkerNode;\n import org.netbeans.modules.profiler.heapwalker.v2.model.HeapWalkerNodeFilter;\n+import org.netbeans.modules.profiler.heapwalker.v2.model.Progress;\n import org.netbeans.modules.profiler.heapwalker.v2.model.RootNode;\n import org.netbeans.modules.profiler.heapwalker.v2.model.TextNode;\n import org.netbeans.modules.profiler.heapwalker.v2.ui.HeapViewPlugin;\n@@ -62,12 +63,12 @@ public abstract class TruffleFieldsPlugin extends HeapViewPlugin {\n         heap = context.getFragment().getHeap();\n         \n         objectsView = new TreeTableView(viewID, context, actions, TreeTableViewColumn.instancesMinimal(heap, false)) {\n-            protected HeapWalkerNode[] computeData(RootNode root, Heap heap, String viewID, HeapWalkerNodeFilter viewFilter, List<DataType> dataTypes, List<SortOrder> sortOrders) {\n+            protected HeapWalkerNode[] computeData(RootNode root, Heap heap, String viewID, HeapWalkerNodeFilter viewFilter, List<DataType> dataTypes, List<SortOrder> sortOrders, Progress progress) {\n                 if (selected != null) {\n                     List<FieldValue> fields = new ArrayList(((DynamicObject)selected).getFieldValues());\n                     fields.addAll(((DynamicObject)selected).getStaticFieldValues());\n                 \n-                    HeapWalkerNode[] nodes = getNodes(fields, root, heap, viewID, viewFilter, dataTypes, sortOrders);\n+                    HeapWalkerNode[] nodes = getNodes(fields, root, heap, viewID, viewFilter, dataTypes, sortOrders, progress);\n                     return nodes == null || nodes.length == 0 ? new HeapWalkerNode[] { new TextNode(getNoObjectsString()) } : nodes;\n                 }\n                 \n@@ -81,7 +82,7 @@ public abstract class TruffleFieldsPlugin extends HeapViewPlugin {\n     }\n     \n     \n-    protected abstract HeapWalkerNode[] getNodes(List<FieldValue> fields, HeapWalkerNode parent, Heap heap, String viewID, HeapWalkerNodeFilter viewFilter, List<DataType> dataTypes, List<SortOrder> sortOrders);\n+    protected abstract HeapWalkerNode[] getNodes(List<FieldValue> fields, HeapWalkerNode parent, Heap heap, String viewID, HeapWalkerNodeFilter viewFilter, List<DataType> dataTypes, List<SortOrder> sortOrders, Progress progress);\n     \n     protected abstract String getNoObjectsString();\n     \ndiff --git a/visualvm/truffle.heapwalker/src/com/sun/tools/visualvm/truffle/heapwalker/TruffleReferencesPlugin.java b/visualvm/truffle.heapwalker/src/com/sun/tools/visualvm/truffle/heapwalker/TruffleReferencesPlugin.java\nindex 0a3da56b5..0d28dc46e 100644\n--- a/visualvm/truffle.heapwalker/src/com/sun/tools/visualvm/truffle/heapwalker/TruffleReferencesPlugin.java\n+++ b/visualvm/truffle.heapwalker/src/com/sun/tools/visualvm/truffle/heapwalker/TruffleReferencesPlugin.java\n@@ -36,6 +36,7 @@ import org.netbeans.modules.profiler.heapwalker.v2.HeapContext;\n import org.netbeans.modules.profiler.heapwalker.v2.model.DataType;\n import org.netbeans.modules.profiler.heapwalker.v2.model.HeapWalkerNode;\n import org.netbeans.modules.profiler.heapwalker.v2.model.HeapWalkerNodeFilter;\n+import org.netbeans.modules.profiler.heapwalker.v2.model.Progress;\n import org.netbeans.modules.profiler.heapwalker.v2.model.RootNode;\n import org.netbeans.modules.profiler.heapwalker.v2.model.TextNode;\n import org.netbeans.modules.profiler.heapwalker.v2.ui.HeapViewPlugin;\n@@ -61,10 +62,10 @@ public abstract class TruffleReferencesPlugin extends HeapViewPlugin {\n         heap = context.getFragment().getHeap();\n         \n         objectsView = new TreeTableView(viewID, context, actions, TreeTableViewColumn.instancesMinimal(heap, false)) {\n-            protected HeapWalkerNode[] computeData(RootNode root, Heap heap, String viewID, HeapWalkerNodeFilter viewFilter, List<DataType> dataTypes, List<SortOrder> sortOrders) {\n+            protected HeapWalkerNode[] computeData(RootNode root, Heap heap, String viewID, HeapWalkerNodeFilter viewFilter, List<DataType> dataTypes, List<SortOrder> sortOrders, Progress progress) {\n                 if (selected != null) {\n                     List<FieldValue> references = selected.getReferences();                \n-                    HeapWalkerNode[] nodes = getNodes(references, root, heap, viewID, dataTypes, sortOrders);\n+                    HeapWalkerNode[] nodes = getNodes(references, root, heap, viewID, dataTypes, sortOrders, progress);\n                     return nodes == null || nodes.length == 0 ? new HeapWalkerNode[] { new TextNode(\"<no references>\") } : nodes;\n                 }\n                 \n@@ -78,7 +79,7 @@ public abstract class TruffleReferencesPlugin extends HeapViewPlugin {\n     }\n     \n     \n-    protected abstract HeapWalkerNode[] getNodes(List<FieldValue> fields, HeapWalkerNode parent, Heap heap, String viewID, List<DataType> dataTypes, List<SortOrder> sortOrders);\n+    protected abstract HeapWalkerNode[] getNodes(List<FieldValue> fields, HeapWalkerNode parent, Heap heap, String viewID, List<DataType> dataTypes, List<SortOrder> sortOrders, Progress progress);\n     \n     \n     protected void nodeSelected(HeapWalkerNode node, boolean adjusting) {\ndiff --git a/visualvm/truffle.heapwalker/src/com/sun/tools/visualvm/truffle/heapwalker/javaext/TruffleFieldsProvider.java b/visualvm/truffle.heapwalker/src/com/sun/tools/visualvm/truffle/heapwalker/javaext/TruffleFieldsProvider.java\nindex a5617f48c..d5215288a 100644\n--- a/visualvm/truffle.heapwalker/src/com/sun/tools/visualvm/truffle/heapwalker/javaext/TruffleFieldsProvider.java\n+++ b/visualvm/truffle.heapwalker/src/com/sun/tools/visualvm/truffle/heapwalker/javaext/TruffleFieldsProvider.java\n@@ -42,8 +42,10 @@ import org.netbeans.modules.profiler.heapwalker.v2.java.PrimitiveNode;\n import org.netbeans.modules.profiler.heapwalker.v2.model.DataType;\n import org.netbeans.modules.profiler.heapwalker.v2.model.HeapWalkerNode;\n import org.netbeans.modules.profiler.heapwalker.v2.model.HeapWalkerNodeFilter;\n+import org.netbeans.modules.profiler.heapwalker.v2.model.Progress;\n import org.netbeans.modules.profiler.heapwalker.v2.ui.UIThresholds;\n import org.netbeans.modules.profiler.heapwalker.v2.utils.NodesComputer;\n+import org.netbeans.modules.profiler.heapwalker.v2.utils.ProgressIterator;\n import org.openide.util.lookup.ServiceProvider;\n \n /**\n@@ -52,12 +54,12 @@ import org.openide.util.lookup.ServiceProvider;\n  */\n abstract class TruffleFieldsProvider extends HeapWalkerNode.Provider {\n     \n-    public HeapWalkerNode[] getNodes(HeapWalkerNode parent, Heap heap, String viewID, HeapWalkerNodeFilter viewFilter, List<DataType> dataTypes, List<SortOrder> sortOrders) {\n+    public HeapWalkerNode[] getNodes(HeapWalkerNode parent, Heap heap, String viewID, HeapWalkerNodeFilter viewFilter, List<DataType> dataTypes, List<SortOrder> sortOrders, Progress progress) {\n         List<FieldValue> fields = getFields(parent, heap);\n-        return getNodes(fields, parent, heap, viewID, viewFilter, dataTypes, sortOrders);\n+        return getNodes(fields, parent, heap, viewID, viewFilter, dataTypes, sortOrders, progress);\n     }\n     \n-    static HeapWalkerNode[] getNodes(final List<FieldValue> fields, final HeapWalkerNode parent, final Heap heap, String viewID, HeapWalkerNodeFilter viewFilter, List<DataType> dataTypes, List<SortOrder> sortOrders) {\n+    static HeapWalkerNode[] getNodes(final List<FieldValue> fields, final HeapWalkerNode parent, final Heap heap, String viewID, HeapWalkerNodeFilter viewFilter, List<DataType> dataTypes, List<SortOrder> sortOrders, Progress progress) {\n         if (fields == null) return null;\n         \n         NodesComputer<Integer> computer = new NodesComputer<Integer>(fields.size(), UIThresholds.MAX_INSTANCE_FIELDS) {\n@@ -67,8 +69,9 @@ abstract class TruffleFieldsProvider extends HeapWalkerNode.Provider {\n             protected HeapWalkerNode createNode(Integer index) {\n                 return TruffleFieldsProvider.createNode(fields.get(index), heap);\n             }\n-            protected Iterator<Integer> objectsIterator(int index) {\n-                return integerIterator(index, fields.size());\n+            protected ProgressIterator<Integer> objectsIterator(int index, Progress progress) {\n+                Iterator<Integer> iterator = integerIterator(index, fields.size());\n+                return new ProgressIterator(iterator, index, false, progress);\n             }\n             protected String getMoreNodesString(String moreNodesCount)  {\n                 return \"<another \" + moreNodesCount + \" truffle fields left>\";\n@@ -81,7 +84,7 @@ abstract class TruffleFieldsProvider extends HeapWalkerNode.Provider {\n             }\n         };\n \n-        return computer.computeNodes(parent, heap, viewID, null, dataTypes, sortOrders);\n+        return computer.computeNodes(parent, heap, viewID, null, dataTypes, sortOrders, progress);\n     }\n     \n     private static HeapWalkerNode createNode(FieldValue field, Heap heap) {\ndiff --git a/visualvm/truffle.heapwalker/src/com/sun/tools/visualvm/truffle/heapwalker/javaext/TruffleReferencesProvider.java b/visualvm/truffle.heapwalker/src/com/sun/tools/visualvm/truffle/heapwalker/javaext/TruffleReferencesProvider.java\nindex 32dafe382..283968f2f 100644\n--- a/visualvm/truffle.heapwalker/src/com/sun/tools/visualvm/truffle/heapwalker/javaext/TruffleReferencesProvider.java\n+++ b/visualvm/truffle.heapwalker/src/com/sun/tools/visualvm/truffle/heapwalker/javaext/TruffleReferencesProvider.java\n@@ -38,8 +38,11 @@ import org.netbeans.modules.profiler.heapwalker.v2.java.InstanceNode;\n import org.netbeans.modules.profiler.heapwalker.v2.model.DataType;\n import org.netbeans.modules.profiler.heapwalker.v2.model.HeapWalkerNode;\n import org.netbeans.modules.profiler.heapwalker.v2.model.HeapWalkerNodeFilter;\n+import org.netbeans.modules.profiler.heapwalker.v2.model.Progress;\n import org.netbeans.modules.profiler.heapwalker.v2.ui.UIThresholds;\n import org.netbeans.modules.profiler.heapwalker.v2.utils.NodesComputer;\n+import static org.netbeans.modules.profiler.heapwalker.v2.utils.NodesComputer.integerIterator;\n+import org.netbeans.modules.profiler.heapwalker.v2.utils.ProgressIterator;\n import org.openide.util.lookup.ServiceProvider;\n \n /**\n@@ -69,11 +72,11 @@ public class TruffleReferencesProvider extends HeapWalkerNode.Provider {\n         }\n     }\n     \n-    public HeapWalkerNode[] getNodes(HeapWalkerNode parent, Heap heap, String viewID, HeapWalkerNodeFilter viewFilter, List<DataType> dataTypes, List<SortOrder> sortOrders) {\n-        return getNodes(getReferences(parent, heap), parent, heap, viewID, dataTypes, sortOrders);\n+    public HeapWalkerNode[] getNodes(HeapWalkerNode parent, Heap heap, String viewID, HeapWalkerNodeFilter viewFilter, List<DataType> dataTypes, List<SortOrder> sortOrders, Progress progress) {\n+        return getNodes(getReferences(parent, heap), parent, heap, viewID, dataTypes, sortOrders, progress);\n     }\n     \n-    static HeapWalkerNode[] getNodes(List<FieldValue> references, HeapWalkerNode parent, Heap heap, String viewID, List<DataType> dataTypes, List<SortOrder> sortOrders) {\n+    static HeapWalkerNode[] getNodes(List<FieldValue> references, HeapWalkerNode parent, Heap heap, String viewID, List<DataType> dataTypes, List<SortOrder> sortOrders, Progress progress) {\n         if (references == null) return null;\n         \n         NodesComputer<Integer> computer = new NodesComputer<Integer>(references.size(), UIThresholds.MAX_INSTANCE_REFERENCES) {\n@@ -83,8 +86,9 @@ public class TruffleReferencesProvider extends HeapWalkerNode.Provider {\n             protected HeapWalkerNode createNode(Integer index) {\n                 return TruffleReferencesProvider.createNode(references.get(index), heap);\n             }\n-            protected Iterator<Integer> objectsIterator(int index) {\n-                return integerIterator(index, references.size());\n+            protected ProgressIterator<Integer> objectsIterator(int index, Progress progress) {\n+                Iterator<Integer> iterator = integerIterator(index, references.size());\n+                return new ProgressIterator(iterator, index, false, progress);\n             }\n             protected String getMoreNodesString(String moreNodesCount)  {\n                 return \"<another \" + moreNodesCount + \" references left>\";\n@@ -97,7 +101,7 @@ public class TruffleReferencesProvider extends HeapWalkerNode.Provider {\n             }\n         };\n \n-        return computer.computeNodes(parent, heap, viewID, null, dataTypes, sortOrders);\n+        return computer.computeNodes(parent, heap, viewID, null, dataTypes, sortOrders, progress);\n     }\n     \n     private static HeapWalkerNode createNode(FieldValue field, Heap heap) {\ndiff --git a/visualvm/truffle.heapwalker/src/com/sun/tools/visualvm/truffle/heapwalker/javascript/JavaScriptArrayItemsProvider.java b/visualvm/truffle.heapwalker/src/com/sun/tools/visualvm/truffle/heapwalker/javascript/JavaScriptArrayItemsProvider.java\nindex c42400296..b476941dc 100644\n--- a/visualvm/truffle.heapwalker/src/com/sun/tools/visualvm/truffle/heapwalker/javascript/JavaScriptArrayItemsProvider.java\n+++ b/visualvm/truffle.heapwalker/src/com/sun/tools/visualvm/truffle/heapwalker/javascript/JavaScriptArrayItemsProvider.java\n@@ -39,8 +39,10 @@ import org.netbeans.modules.profiler.heapwalker.v2.java.PrimitiveNode;\n import org.netbeans.modules.profiler.heapwalker.v2.model.DataType;\n import org.netbeans.modules.profiler.heapwalker.v2.model.HeapWalkerNode;\n import org.netbeans.modules.profiler.heapwalker.v2.model.HeapWalkerNodeFilter;\n+import org.netbeans.modules.profiler.heapwalker.v2.model.Progress;\n import org.netbeans.modules.profiler.heapwalker.v2.ui.UIThresholds;\n import org.netbeans.modules.profiler.heapwalker.v2.utils.NodesComputer;\n+import org.netbeans.modules.profiler.heapwalker.v2.utils.ProgressIterator;\n import org.openide.util.lookup.ServiceProvider;\n \n /**\n@@ -67,7 +69,7 @@ public class JavaScriptArrayItemsProvider extends HeapWalkerNode.Provider {\n         }\n     }\n     \n-    public HeapWalkerNode[] getNodes(final HeapWalkerNode parent, final Heap heap, String viewID, HeapWalkerNodeFilter viewFilter, List<DataType> dataTypes, List<SortOrder> sortOrders) {\n+    public HeapWalkerNode[] getNodes(final HeapWalkerNode parent, final Heap heap, String viewID, HeapWalkerNodeFilter viewFilter, List<DataType> dataTypes, List<SortOrder> sortOrders, Progress progress) {\n         final Instance instance = HeapWalkerNode.getValue(parent, DataType.INSTANCE, heap);\n         if (instance == null) return null;\n         \n@@ -83,8 +85,9 @@ public class JavaScriptArrayItemsProvider extends HeapWalkerNode.Provider {\n                 protected HeapWalkerNode createNode(Integer index) {\n                     return new PrimitiveNode.ArrayItem(index, type, items.get(index), instance);\n                 }\n-                protected Iterator<Integer> objectsIterator(int index) {\n-                    return integerIterator(index, items.size());\n+                protected ProgressIterator<Integer> objectsIterator(int index, Progress progress) {\n+                    Iterator<Integer> iterator = integerIterator(index, items.size());\n+                    return new ProgressIterator(iterator, index, false, progress);\n                 }\n                 protected String getMoreNodesString(String moreNodesCount)  {\n                     return \"<another \" + moreNodesCount + \" items left>\";\n@@ -97,7 +100,7 @@ public class JavaScriptArrayItemsProvider extends HeapWalkerNode.Provider {\n                 }\n             };\n         \n-            return computer.computeNodes(parent, heap, viewID, null, dataTypes, sortOrders);\n+            return computer.computeNodes(parent, heap, viewID, null, dataTypes, sortOrders, progress);\n         } else if (instance instanceof ObjectArrayInstance) {\n             final List<ArrayItemValue> items = ((ObjectArrayInstance)instance).getItems();\n             \n@@ -115,8 +118,9 @@ public class JavaScriptArrayItemsProvider extends HeapWalkerNode.Provider {\n                         return new TerminalJavaNodes.ArrayItem(item, false);\n                     }\n                 }\n-                protected Iterator<Integer> objectsIterator(int index) {\n-                    return integerIterator(index, items.size());\n+                protected ProgressIterator<Integer> objectsIterator(int index, Progress progress) {\n+                    Iterator<Integer> iterator = integerIterator(index, items.size());\n+                    return new ProgressIterator(iterator, index, false, progress);\n                 }\n                 protected String getMoreNodesString(String moreNodesCount)  {\n                     return \"<another \" + moreNodesCount + \" items left>\";\n@@ -129,7 +133,7 @@ public class JavaScriptArrayItemsProvider extends HeapWalkerNode.Provider {\n                 }\n             };\n             \n-            return computer.computeNodes(parent, heap, viewID, null, dataTypes, sortOrders);\n+            return computer.computeNodes(parent, heap, viewID, null, dataTypes, sortOrders, progress);\n         }\n         \n         return null;\ndiff --git a/visualvm/truffle.heapwalker/src/com/sun/tools/visualvm/truffle/heapwalker/javascript/JavaScriptFieldsPlugin.java b/visualvm/truffle.heapwalker/src/com/sun/tools/visualvm/truffle/heapwalker/javascript/JavaScriptFieldsPlugin.java\nindex f487ae163..6a94331a9 100644\n--- a/visualvm/truffle.heapwalker/src/com/sun/tools/visualvm/truffle/heapwalker/javascript/JavaScriptFieldsPlugin.java\n+++ b/visualvm/truffle.heapwalker/src/com/sun/tools/visualvm/truffle/heapwalker/javascript/JavaScriptFieldsPlugin.java\n@@ -33,6 +33,7 @@ import org.netbeans.modules.profiler.heapwalker.v2.model.DataType;\n import org.netbeans.modules.profiler.heapwalker.v2.model.HeapWalkerNode;\n import com.sun.tools.visualvm.truffle.heapwalker.TruffleFieldsPlugin;\n import org.netbeans.modules.profiler.heapwalker.v2.model.HeapWalkerNodeFilter;\n+import org.netbeans.modules.profiler.heapwalker.v2.model.Progress;\n import org.netbeans.modules.profiler.heapwalker.v2.ui.HeapViewPlugin;\n import org.netbeans.modules.profiler.heapwalker.v2.ui.HeapWalkerActions;\n import org.openide.util.lookup.ServiceProvider;\n@@ -48,8 +49,8 @@ class JavaScriptFieldsPlugin extends TruffleFieldsPlugin {\n     }\n     \n     \n-    protected HeapWalkerNode[] getNodes(List<FieldValue> fields, HeapWalkerNode parent, Heap heap, String viewID, HeapWalkerNodeFilter viewFilter, List<DataType> dataTypes, List<SortOrder> sortOrders) {\n-        return JavaScriptFieldsProvider.getNodes(fields, parent, heap, viewID, viewFilter, dataTypes, sortOrders);\n+    protected HeapWalkerNode[] getNodes(List<FieldValue> fields, HeapWalkerNode parent, Heap heap, String viewID, HeapWalkerNodeFilter viewFilter, List<DataType> dataTypes, List<SortOrder> sortOrders, Progress progress) {\n+        return JavaScriptFieldsProvider.getNodes(fields, parent, heap, viewID, viewFilter, dataTypes, sortOrders, progress);\n     }\n     \n     protected String getNoObjectsString() {\ndiff --git a/visualvm/truffle.heapwalker/src/com/sun/tools/visualvm/truffle/heapwalker/javascript/JavaScriptFieldsProvider.java b/visualvm/truffle.heapwalker/src/com/sun/tools/visualvm/truffle/heapwalker/javascript/JavaScriptFieldsProvider.java\nindex 8c685a0d6..25e933b75 100644\n--- a/visualvm/truffle.heapwalker/src/com/sun/tools/visualvm/truffle/heapwalker/javascript/JavaScriptFieldsProvider.java\n+++ b/visualvm/truffle.heapwalker/src/com/sun/tools/visualvm/truffle/heapwalker/javascript/JavaScriptFieldsProvider.java\n@@ -41,8 +41,10 @@ import org.netbeans.modules.profiler.heapwalker.v2.java.PrimitiveNode;\n import org.netbeans.modules.profiler.heapwalker.v2.model.DataType;\n import org.netbeans.modules.profiler.heapwalker.v2.model.HeapWalkerNode;\n import org.netbeans.modules.profiler.heapwalker.v2.model.HeapWalkerNodeFilter;\n+import org.netbeans.modules.profiler.heapwalker.v2.model.Progress;\n import org.netbeans.modules.profiler.heapwalker.v2.ui.UIThresholds;\n import org.netbeans.modules.profiler.heapwalker.v2.utils.NodesComputer;\n+import org.netbeans.modules.profiler.heapwalker.v2.utils.ProgressIterator;\n import org.openide.util.lookup.ServiceProvider;\n \n /**\n@@ -69,11 +71,11 @@ public class JavaScriptFieldsProvider extends HeapWalkerNode.Provider {\n         return parent instanceof DynamicObjectNode && !(parent instanceof DynamicObjectReferenceNode);\n     }\n     \n-    public HeapWalkerNode[] getNodes(HeapWalkerNode parent, Heap heap, String viewID, HeapWalkerNodeFilter viewFilter, List<DataType> dataTypes, List<SortOrder> sortOrders) {\n-        return getNodes(getFields(parent, heap), parent, heap, viewID, viewFilter, dataTypes, sortOrders);\n+    public HeapWalkerNode[] getNodes(HeapWalkerNode parent, Heap heap, String viewID, HeapWalkerNodeFilter viewFilter, List<DataType> dataTypes, List<SortOrder> sortOrders, Progress progress) {\n+        return getNodes(getFields(parent, heap), parent, heap, viewID, viewFilter, dataTypes, sortOrders, progress);\n     }\n     \n-    static HeapWalkerNode[] getNodes(List<FieldValue> fields, HeapWalkerNode parent, Heap heap, String viewID, HeapWalkerNodeFilter viewFilter, List<DataType> dataTypes, List<SortOrder> sortOrders) {\n+    static HeapWalkerNode[] getNodes(List<FieldValue> fields, HeapWalkerNode parent, Heap heap, String viewID, HeapWalkerNodeFilter viewFilter, List<DataType> dataTypes, List<SortOrder> sortOrders, Progress progress) {\n         if (fields == null) return null;\n         \n         NodesComputer<Integer> computer = new NodesComputer<Integer>(fields.size(), UIThresholds.MAX_INSTANCE_FIELDS) {\n@@ -83,8 +85,9 @@ public class JavaScriptFieldsProvider extends HeapWalkerNode.Provider {\n             protected HeapWalkerNode createNode(Integer index) {\n                 return JavaScriptFieldsProvider.createNode(fields.get(index), heap);\n             }\n-            protected Iterator<Integer> objectsIterator(int index) {\n-                return integerIterator(index, fields.size());\n+            protected ProgressIterator<Integer> objectsIterator(int index, Progress progress) {\n+                Iterator<Integer> iterator = integerIterator(index, fields.size());\n+                return new ProgressIterator(iterator, index, false, progress);\n             }\n             protected String getMoreNodesString(String moreNodesCount)  {\n                 return \"<another \" + moreNodesCount + \" properties left>\";\n@@ -97,7 +100,7 @@ public class JavaScriptFieldsProvider extends HeapWalkerNode.Provider {\n             }\n         };\n \n-        return computer.computeNodes(parent, heap, viewID, null, dataTypes, sortOrders);\n+        return computer.computeNodes(parent, heap, viewID, null, dataTypes, sortOrders, progress);\n     }\n     \n     private List<FieldValue> getFields(HeapWalkerNode parent, Heap heap) {\ndiff --git a/visualvm/truffle.heapwalker/src/com/sun/tools/visualvm/truffle/heapwalker/javascript/JavaScriptObjectsProvider.java b/visualvm/truffle.heapwalker/src/com/sun/tools/visualvm/truffle/heapwalker/javascript/JavaScriptObjectsProvider.java\nindex ffef7915a..32b797657 100644\n--- a/visualvm/truffle.heapwalker/src/com/sun/tools/visualvm/truffle/heapwalker/javascript/JavaScriptObjectsProvider.java\n+++ b/visualvm/truffle.heapwalker/src/com/sun/tools/visualvm/truffle/heapwalker/javascript/JavaScriptObjectsProvider.java\n@@ -39,8 +39,10 @@ import org.netbeans.modules.profiler.heapwalker.v2.model.DataType;\n import org.netbeans.modules.profiler.heapwalker.v2.model.HeapWalkerNode;\n import org.netbeans.modules.profiler.heapwalker.v2.model.TextNode;\n import org.netbeans.modules.profiler.heapwalker.v2.model.HeapWalkerNodeFilter;\n+import org.netbeans.modules.profiler.heapwalker.v2.model.Progress;\n import org.netbeans.modules.profiler.heapwalker.v2.ui.UIThresholds;\n import org.netbeans.modules.profiler.heapwalker.v2.utils.NodesComputer;\n+import org.netbeans.modules.profiler.heapwalker.v2.utils.ProgressIterator;\n \n /**\n  *\n@@ -51,7 +53,7 @@ public class JavaScriptObjectsProvider extends AbstractObjectsProvider {\n     static final String JS_LANG_ID = \"com.oracle.truffle.js.runtime.builtins.JSClass\";\n     \n \n-    public static HeapWalkerNode[] getAllObjects(HeapWalkerNode parent, HeapContext context, String viewID, HeapWalkerNodeFilter viewFilter, List<DataType> dataTypes, List<SortOrder> sortOrders, int aggregation) {\n+    public static HeapWalkerNode[] getAllObjects(HeapWalkerNode parent, HeapContext context, String viewID, HeapWalkerNodeFilter viewFilter, List<DataType> dataTypes, List<SortOrder> sortOrders, Progress progress, int aggregation) {\n         final JavaScriptHeapFragment fragment = (JavaScriptHeapFragment)context.getFragment();\n         final Heap heap = fragment.getHeap();\n         \n@@ -63,10 +65,9 @@ public class JavaScriptObjectsProvider extends AbstractObjectsProvider {\n                 protected HeapWalkerNode createNode(DynamicObject dobject) {\n                     return new JavaScriptNodes.JavaScriptDynamicObjectNode(dobject, dobject.getType(heap));\n                 }\n-                protected Iterator<DynamicObject> objectsIterator(int index) {\n+                protected ProgressIterator<DynamicObject> objectsIterator(int index, Progress progress) {\n                     Iterator<DynamicObject> dobjects = fragment.getJavaScriptObjectsIterator();\n-                    for (int i = 0; i < index; i++) dobjects.next();\n-                    return dobjects;\n+                    return new ProgressIterator(dobjects, index, true, progress);\n                 }\n                 protected String getMoreNodesString(String moreNodesCount)  {\n                     return \"<another \" + moreNodesCount + \" objects left>\";\n@@ -79,15 +80,17 @@ public class JavaScriptObjectsProvider extends AbstractObjectsProvider {\n                 }\n             };\n \n-            return computer.computeNodes(parent, heap, viewID, null, dataTypes, sortOrders);\n+            return computer.computeNodes(parent, heap, viewID, null, dataTypes, sortOrders, progress);\n         } else {\n             List<HeapWalkerNode> nodes = new ArrayList();\n             Map<String, JavaScriptNodes.JavaScriptDynamicObjectsContainer> types = new HashMap();\n             \n             Iterator<DynamicObject> dobjects = fragment.getJavaScriptObjectsIterator();\n+            progress.setupUnknownSteps();\n             \n             while (dobjects.hasNext()) {\n                 DynamicObject dobject = dobjects.next();\n+                progress.step();\n                 String type = dobject.getType(heap);\n                 JavaScriptNodes.JavaScriptDynamicObjectsContainer typeNode = types.get(type);\n \n@@ -100,11 +103,13 @@ public class JavaScriptObjectsProvider extends AbstractObjectsProvider {\n                 typeNode.add(dobject, heap);\n             }\n             \n+            progress.finish();\n+            \n             return nodes.toArray(HeapWalkerNode.NO_NODES);\n         }\n     }\n     \n-    public static HeapWalkerNode[] getDominators(HeapWalkerNode parent, HeapContext context, String viewID, HeapWalkerNodeFilter viewFilter, List<DataType> dataTypes, List<SortOrder> sortOrders, int aggregation) {\n+    public static HeapWalkerNode[] getDominators(HeapWalkerNode parent, HeapContext context, String viewID, HeapWalkerNodeFilter viewFilter, List<DataType> dataTypes, List<SortOrder> sortOrders, Progress progress, int aggregation) {\n         final Heap heap = context.getFragment().getHeap();\n         \n         if (!DataType.RETAINED_SIZE.valuesAvailable(heap))\n@@ -114,12 +119,17 @@ public class JavaScriptObjectsProvider extends AbstractObjectsProvider {\n         \n         List<Instance> searchInstances = heap.getBiggestObjectsByRetainedSize(maxSearchInstances);\n         Iterator<Instance> searchInstancesIt = searchInstances.iterator();\n+        progress.setupKnownSteps(searchInstances.size());\n+        \n         while (searchInstancesIt.hasNext())",
    "Added support for different primitive types": "diff --git a/websocket/endpoint-javatypes/src/main/java/org/javaee7/websocket/endpoint/javatypes/MyEndpoint.java b/websocket/endpoint-javatypes/src/main/java/org/javaee7/websocket/endpoint/javatypes/MyEndpoint.java\nindex 6035d5ee..ef564a2a 100644\n--- a/websocket/endpoint-javatypes/src/main/java/org/javaee7/websocket/endpoint/javatypes/MyEndpoint.java\n+++ b/websocket/endpoint-javatypes/src/main/java/org/javaee7/websocket/endpoint/javatypes/MyEndpoint.java\n@@ -39,11 +39,6 @@\n  */\n package org.javaee7.websocket.endpoint.javatypes;\n \n-import java.io.IOException;\n-import java.io.Reader;\n-import java.nio.CharBuffer;\n-import java.util.logging.Level;\n-import java.util.logging.Logger;\n import javax.websocket.OnMessage;\n import javax.websocket.server.ServerEndpoint;\n \n@@ -53,35 +48,9 @@ import javax.websocket.server.ServerEndpoint;\n @ServerEndpoint(\"/websocket\")\n public class MyEndpoint {\n     \n-//    @WebSocketMessage\n-//    public String echoText(String text) {\n-//        System.out.println(\"echoText\");\n-//        return text;\n-//    }\n-//    \n-//    @WebSocketMessage\n-//    public int echoInt(int i) {\n-//        System.out.println(\"echoInt\");\n-//        return i;\n-//    }\n-//    \n-//    @WebSocketMessage\n-//    public float echoFloat(Float f) {\n-//        System.out.println(\"echoFloat\");\n-//        return f;\n-//    }\n-    \n     @OnMessage\n-    public String echoReader(Reader reader) {\n-        System.out.println(\"echoReader\");\n-        CharBuffer buffer = CharBuffer.allocate(20);\n-        try {\n-            reader.read(buffer);\n-        } catch (IOException ex) {\n-            Logger.getLogger(MyEndpoint.class.getName()).log(Level.SEVERE, null, ex);\n-            return null;\n-        }\n-        \n-        return new String(buffer.array());\n+    public String echoText(String text) {\n+        System.out.println(\"echoText\");\n+        return text;\n     }\n }\ndiff --git a/websocket/endpoint-javatypes/src/main/java/org/javaee7/websocket/endpoint/javatypes/MyEndpointFloat.java b/websocket/endpoint-javatypes/src/main/java/org/javaee7/websocket/endpoint/javatypes/MyEndpointFloat.java\nnew file mode 100644\nindex 00000000..b2dc661b\n--- /dev/null\n+++ b/websocket/endpoint-javatypes/src/main/java/org/javaee7/websocket/endpoint/javatypes/MyEndpointFloat.java\n@@ -0,0 +1,56 @@\n+/*\n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS HEADER.\n+ *\n+ * Copyright (c) 2013 Oracle and/or its affiliates. All rights reserved.\n+ *\n+ * The contents of this file are subject to the terms of either the GNU\n+ * General Public License Version 2 only (\"GPL\") or the Common Development\n+ * and Distribution License(\"CDDL\") (collectively, the \"License\").  You\n+ * may not use this file except in compliance with the License.  You can\n+ * obtain a copy of the License at\n+ * https://glassfish.dev.java.net/public/CDDL+GPL_1_1.html\n+ * or packager/legal/LICENSE.txt.  See the License for the specific\n+ * language governing permissions and limitations under the License.\n+ *\n+ * When distributing the software, include this License Header Notice in each\n+ * file and include the License file at packager/legal/LICENSE.txt.\n+ *\n+ * GPL Classpath Exception:\n+ * Oracle designates this particular file as subject to the \"Classpath\"\n+ * exception as provided by Oracle in the GPL Version 2 section of the License\n+ * file that accompanied this code.\n+ *\n+ * Modifications:\n+ * If applicable, add the following below the License Header, with the fields\n+ * enclosed by brackets [] replaced by your own identifying information:\n+ * \"Portions Copyright [year] [name of copyright owner]\"\n+ *\n+ * Contributor(s):\n+ * If you wish your version of this file to be governed by only the CDDL or\n+ * only the GPL Version 2, indicate your decision by adding \"[Contributor]\n+ * elects to include this software in this distribution under the [CDDL or GPL\n+ * Version 2] license.\"  If you don't indicate a single choice of license, a\n+ * recipient has the option to distribute your version of this file under\n+ * either the CDDL, the GPL Version 2 or to extend the choice of license to\n+ * its licensees as provided above.  However, if you add GPL Version 2 code\n+ * and therefore, elected the GPL Version 2 license, then the option applies\n+ * only if the new code is made subject to such option by the copyright\n+ * holder.\n+ */\n+package org.javaee7.websocket.endpoint.javatypes;\n+\n+import javax.websocket.OnMessage;\n+import javax.websocket.server.ServerEndpoint;\n+\n+/**\n+ * @author Arun Gupta\n+ */\n+@ServerEndpoint(\"/websocket-float\")\n+public class MyEndpointFloat {\n+    \n+    @OnMessage\n+    public float echoFloat(Float f) {\n+        System.out.println(\"echoFloat\");\n+        return f;\n+    }\n+}\ndiff --git a/websocket/endpoint-javatypes/src/main/java/org/javaee7/websocket/endpoint/javatypes/MyEndpointInt.java b/websocket/endpoint-javatypes/src/main/java/org/javaee7/websocket/endpoint/javatypes/MyEndpointInt.java\nnew file mode 100644\nindex 00000000..f3977096\n--- /dev/null\n+++ b/websocket/endpoint-javatypes/src/main/java/org/javaee7/websocket/endpoint/javatypes/MyEndpointInt.java\n@@ -0,0 +1,56 @@\n+/*\n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS HEADER.\n+ *\n+ * Copyright (c) 2013 Oracle and/or its affiliates. All rights reserved.\n+ *\n+ * The contents of this file are subject to the terms of either the GNU\n+ * General Public License Version 2 only (\"GPL\") or the Common Development\n+ * and Distribution License(\"CDDL\") (collectively, the \"License\").  You\n+ * may not use this file except in compliance with the License.  You can\n+ * obtain a copy of the License at\n+ * https://glassfish.dev.java.net/public/CDDL+GPL_1_1.html\n+ * or packager/legal/LICENSE.txt.  See the License for the specific\n+ * language governing permissions and limitations under the License.\n+ *\n+ * When distributing the software, include this License Header Notice in each\n+ * file and include the License file at packager/legal/LICENSE.txt.\n+ *\n+ * GPL Classpath Exception:\n+ * Oracle designates this particular file as subject to the \"Classpath\"\n+ * exception as provided by Oracle in the GPL Version 2 section of the License\n+ * file that accompanied this code.\n+ *\n+ * Modifications:\n+ * If applicable, add the following below the License Header, with the fields\n+ * enclosed by brackets [] replaced by your own identifying information:\n+ * \"Portions Copyright [year] [name of copyright owner]\"\n+ *\n+ * Contributor(s):\n+ * If you wish your version of this file to be governed by only the CDDL or\n+ * only the GPL Version 2, indicate your decision by adding \"[Contributor]\n+ * elects to include this software in this distribution under the [CDDL or GPL\n+ * Version 2] license.\"  If you don't indicate a single choice of license, a\n+ * recipient has the option to distribute your version of this file under\n+ * either the CDDL, the GPL Version 2 or to extend the choice of license to\n+ * its licensees as provided above.  However, if you add GPL Version 2 code\n+ * and therefore, elected the GPL Version 2 license, then the option applies\n+ * only if the new code is made subject to such option by the copyright\n+ * holder.\n+ */\n+package org.javaee7.websocket.endpoint.javatypes;\n+\n+import javax.websocket.OnMessage;\n+import javax.websocket.server.ServerEndpoint;\n+\n+/**\n+ * @author Arun Gupta\n+ */\n+@ServerEndpoint(\"/websocket-int\")\n+public class MyEndpointInt {\n+    \n+    @OnMessage\n+    public int echoInt(int i) {\n+        System.out.println(\"echoInt\");\n+        return i;\n+    }\n+}\ndiff --git a/websocket/endpoint-javatypes/src/main/java/org/javaee7/websocket/endpoint/javatypes/MyEndpointReader.java b/websocket/endpoint-javatypes/src/main/java/org/javaee7/websocket/endpoint/javatypes/MyEndpointReader.java\nnew file mode 100644\nindex 00000000..2adaf656\n--- /dev/null\n+++ b/websocket/endpoint-javatypes/src/main/java/org/javaee7/websocket/endpoint/javatypes/MyEndpointReader.java\n@@ -0,0 +1,69 @@\n+/*\n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS HEADER.\n+ *\n+ * Copyright (c) 2013 Oracle and/or its affiliates. All rights reserved.\n+ *\n+ * The contents of this file are subject to the terms of either the GNU\n+ * General Public License Version 2 only (\"GPL\") or the Common Development\n+ * and Distribution License(\"CDDL\") (collectively, the \"License\").  You\n+ * may not use this file except in compliance with the License.  You can\n+ * obtain a copy of the License at\n+ * https://glassfish.dev.java.net/public/CDDL+GPL_1_1.html\n+ * or packager/legal/LICENSE.txt.  See the License for the specific\n+ * language governing permissions and limitations under the License.\n+ *\n+ * When distributing the software, include this License Header Notice in each\n+ * file and include the License file at packager/legal/LICENSE.txt.\n+ *\n+ * GPL Classpath Exception:\n+ * Oracle designates this particular file as subject to the \"Classpath\"\n+ * exception as provided by Oracle in the GPL Version 2 section of the License\n+ * file that accompanied this code.\n+ *\n+ * Modifications:\n+ * If applicable, add the following below the License Header, with the fields\n+ * enclosed by brackets [] replaced by your own identifying information:\n+ * \"Portions Copyright [year] [name of copyright owner]\"\n+ *\n+ * Contributor(s):\n+ * If you wish your version of this file to be governed by only the CDDL or\n+ * only the GPL Version 2, indicate your decision by adding \"[Contributor]\n+ * elects to include this software in this distribution under the [CDDL or GPL\n+ * Version 2] license.\"  If you don't indicate a single choice of license, a\n+ * recipient has the option to distribute your version of this file under\n+ * either the CDDL, the GPL Version 2 or to extend the choice of license to\n+ * its licensees as provided above.  However, if you add GPL Version 2 code\n+ * and therefore, elected the GPL Version 2 license, then the option applies\n+ * only if the new code is made subject to such option by the copyright\n+ * holder.\n+ */\n+package org.javaee7.websocket.endpoint.javatypes;\n+\n+import java.io.IOException;\n+import java.io.Reader;\n+import java.nio.CharBuffer;\n+import java.util.logging.Level;\n+import java.util.logging.Logger;\n+import javax.websocket.OnMessage;\n+import javax.websocket.server.ServerEndpoint;\n+\n+/**\n+ * @author Arun Gupta\n+ */\n+@ServerEndpoint(\"/websocket-reader\")\n+public class MyEndpointReader {\n+    \n+    @OnMessage\n+    public String echoReader(Reader reader) {\n+        System.out.println(\"echoReader\");\n+        CharBuffer buffer = CharBuffer.allocate(20);\n+        try {\n+            reader.read(buffer);\n+        } catch (IOException ex) {\n+            Logger.getLogger(MyEndpointReader.class.getName()).log(Level.SEVERE, null, ex);\n+            return null;\n+        }\n+        \n+        return new String(buffer.array());\n+    }\n+}\ndiff --git a/websocket/endpoint-javatypes/src/main/webapp/index.jsp b/websocket/endpoint-javatypes/src/main/webapp/index.jsp\nindex 514bf6ea..1fe8c9d1 100644\n--- a/websocket/endpoint-javatypes/src/main/webapp/index.jsp\n+++ b/websocket/endpoint-javatypes/src/main/webapp/index.jsp\n@@ -45,16 +45,18 @@\n <html>\n     <head>\n         <meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\">\n-        <title>Getting Started with JSR 356 - Java Types</title>\n+        <title>WebSocket : Java Types</title>\n \n     </head>\n     <body>\n-        <h1>Getting Started with JSR 356 - Java Types</h1>\n+        <h1>WebSocket : Java Types</h1>\n \n         <div style=\"text-align: center;\">\n             <form action=\"\"> \n-                <h2>Text Data</h2>\n-                <input onclick=\"echoText();\" value=\"Echo\" type=\"button\"> \n+                <input onclick=\"echoText();\" value=\"Echo Text\" type=\"button\"> \n+                <input onclick=\"echoInt();\" value=\"Echo Int\" type=\"button\"> \n+                <input onclick=\"echoFloat();\" value=\"Echo Float\" type=\"button\"> \n+                <input onclick=\"echoReader();\" value=\"Echo Reader\" type=\"button\"> \n                 <input id=\"myField\" value=\"WebSocket\" type=\"text\"><br>\n             </form>\n         </div>\ndiff --git a/websocket/endpoint-javatypes/src/main/webapp/websocket.js b/websocket/endpoint-javatypes/src/main/webapp/websocket.js\nindex c23cabae..feabb30a 100644\n--- a/websocket/endpoint-javatypes/src/main/webapp/websocket.js\n+++ b/websocket/endpoint-javatypes/src/main/webapp/websocket.js\n@@ -38,18 +38,48 @@\n  * holder.\n  */\n \n-var wsUri = \"ws://\" + document.location.host + document.location.pathname + \"websocket\";\n-console.log(\"Connecting to \" + wsUri);\n-var websocket = new WebSocket(wsUri);\n-websocket.onopen = function(evt) { onOpen(evt) };\n-websocket.onmessage = function(evt) { onMessage(evt) };\n-websocket.onerror = function(evt) { onError(evt) };\n+var wsUri = \"ws://\" + document.location.host + document.location.pathname;\n+var websocket = new WebSocket(wsUri + \"websocket\");\n+var websocket_int = new WebSocket(wsUri + \"websocket-int\");\n+var websocket_float = new WebSocket(wsUri + \"websocket-float\");\n+var websocket_reader = new WebSocket(wsUri + \"websocket-reader\");\n+\n+websocket.onopen = function(evt) { onOpen(evt); };\n+websocket.onmessage = function(evt) { onMessage(evt); };\n+websocket.onerror = function(evt) { onError(evt); };\n+\n+websocket_int.onopen = function(evt) { onOpen(evt); };\n+websocket_int.onmessage = function(evt) { onMessage(evt); };\n+websocket_int.onerror = function(evt) { onError(evt); };\n+\n+websocket_float.onopen = function(evt) { onOpen(evt); };\n+websocket_float.onmessage = function(evt) { onMessage(evt); };\n+websocket_float.onerror = function(evt) { onError(evt); };\n+\n+websocket_reader.onopen = function(evt) { onOpen(evt); };\n+websocket_reader.onmessage = function(evt) { onMessage(evt); };\n+websocket_reader.onerror = function(evt) { onError(evt); };\n \n var output = document.getElementById(\"output\");\n \n function echoText() {\n     websocket.send(myField.value);\n-    writeToScreen(\"SENT: \" + myField.value);\n+    writeToScreen(\"SENT (echoText): \" + myField.value);\n+}\n+\n+function echoInt() {\n+    websocket_int.send(myField.value);\n+    writeToScreen(\"SENT (echoInt): \" + myField.value);\n+}\n+\n+function echoFloat() {\n+    websocket_float.send(myField.value);\n+    writeToScreen(\"SENT (echoFloat): \" + myField.value);\n+}\n+\n+function echoReader() {\n+    websocket_reader.send(myField.value);\n+    writeToScreen(\"SENT (echoReader): \" + myField.value);\n }\n \n function onOpen() {",
    "Remove unused method ValueAttribute . getUnwrappedElementTypeNameSimple ( ) .": "diff --git a/value-processor/src/org/immutables/value/processor/meta/ValueAttribute.java b/value-processor/src/org/immutables/value/processor/meta/ValueAttribute.java\nindex 442bfe38..9c485567 100644\n--- a/value-processor/src/org/immutables/value/processor/meta/ValueAttribute.java\n+++ b/value-processor/src/org/immutables/value/processor/meta/ValueAttribute.java\n@@ -614,16 +614,6 @@ public final class ValueAttribute extends TypeIntrospectionBase implements HasSt\n         : getElementType();\n   }\n \n-  /**\n-   * Returns the simple name of wrapped element type, like {@code Entry} for {@code Map.Entry} or\n-   * {@code String} for {@code java.util.String}.\n-   */\n-  public String getUnwrappedElementTypeNameSimple() {\n-    final String type = getUnwrappedElementType();\n-    final int index = type.lastIndexOf('.');\n-    return index > -1 ? type.substring(index + 1) : type;\n-  }\n-\n   public String getUnwrappedValueElementType() {\n     return isMapType()\n         ? getUnwrappedSecondaryElementType()",
    "prepare release v1 . 4 . 9": "diff --git a/extension/pom.xml b/extension/pom.xml\nindex 758f603..e107fbf 100644\n--- a/extension/pom.xml\n+++ b/extension/pom.xml\n@@ -5,7 +5,7 @@\n   <parent>\n     <artifactId>dockerfile-maven</artifactId>\n     <groupId>com.spotify</groupId>\n-    <version>1.4.9-SNAPSHOT</version>\n+    <version>1.4.9</version>\n   </parent>\n \n   <artifactId>dockerfile-maven-extension</artifactId>\ndiff --git a/plugin/pom.xml b/plugin/pom.xml\nindex 6160690..fb4c58f 100644\n--- a/plugin/pom.xml\n+++ b/plugin/pom.xml\n@@ -5,7 +5,7 @@\n   <parent>\n     <groupId>com.spotify</groupId>\n     <artifactId>dockerfile-maven</artifactId>\n-    <version>1.4.9-SNAPSHOT</version>\n+    <version>1.4.9</version>\n   </parent>\n \n   <artifactId>dockerfile-maven-plugin</artifactId>\n@@ -58,7 +58,7 @@\n     <dependency>\n       <groupId>com.spotify</groupId>\n       <artifactId>dockerfile-maven-extension</artifactId>\n-      <version>1.4.9-SNAPSHOT</version>\n+      <version>1.4.9</version>\n     </dependency>\n \n     <dependency>\ndiff --git a/pom.xml b/pom.xml\nindex 376385b..5b346bf 100644\n--- a/pom.xml\n+++ b/pom.xml\n@@ -9,7 +9,7 @@\n   </parent>\n \n   <artifactId>dockerfile-maven</artifactId>\n-  <version>1.4.9-SNAPSHOT</version>\n+  <version>1.4.9</version>\n   <packaging>pom</packaging>\n \n   <name>Dockerfile Maven Support</name>\n@@ -28,7 +28,7 @@\n   <scm>\n     <connection>scm:git:ssh://git@github.com/spotify/dockerfile-maven.git</connection>\n     <developerConnection>scm:git:ssh://git@github.com/spotify/dockerfile-maven.git</developerConnection>\n-    <tag>HEAD</tag>\n+    <tag>v1.4.9</tag>\n     <url>https://github.com/spotify/dockerfile-maven</url>\n   </scm>\n ",
    "Revert build to 0 . 9 . 16": "diff --git a/gradle.properties b/gradle.properties\nindex b64c48df..de2a0481 100644\n--- a/gradle.properties\n+++ b/gradle.properties\n@@ -17,7 +17,7 @@\n # http://www.gradle.org/docs/current/userguide/multi_project_builds.html#sec:decoupled_projects\n # org.gradle.parallel=true\n \n-VERSION_NAME=1.0\n+VERSION_NAME=0.9.16\n GROUP=com.airbnb.android\n \n POM_DESCRIPTION=Lottie is an animation library that renders Adobe After Effects animations natively in realtime.",
    "Search various classloaders for the configs that are classes": "diff --git a/components/camel-kafka/src/main/java/org/apache/camel/component/kafka/KafkaProducer.java b/components/camel-kafka/src/main/java/org/apache/camel/component/kafka/KafkaProducer.java\nindex e2f25fbee8e..ae2f2a433ec 100644\n--- a/components/camel-kafka/src/main/java/org/apache/camel/component/kafka/KafkaProducer.java\n+++ b/components/camel-kafka/src/main/java/org/apache/camel/component/kafka/KafkaProducer.java\n@@ -31,9 +31,11 @@ import org.apache.camel.CamelExchangeException;\n import org.apache.camel.Exchange;\n import org.apache.camel.impl.DefaultAsyncProducer;\n import org.apache.kafka.clients.producer.Callback;\n+import org.apache.kafka.clients.producer.Partitioner;\n import org.apache.kafka.clients.producer.ProducerConfig;\n import org.apache.kafka.clients.producer.ProducerRecord;\n import org.apache.kafka.clients.producer.RecordMetadata;\n+import org.apache.kafka.common.serialization.Serializer;\n \n public class KafkaProducer extends DefaultAsyncProducer {\n \n@@ -47,8 +49,49 @@ public class KafkaProducer extends DefaultAsyncProducer {\n         this.endpoint = endpoint;\n     }\n \n+    \n+    Class<?> loadClass(Object o, ClassLoader loader) {\n+        if (o == null || o instanceof Class) {\n+            return (Class<?>)o;\n+        }\n+        String name = o.toString();\n+        Class<?> c;\n+        try {\n+            c = Class.forName(name, true, loader);\n+        } catch (ClassNotFoundException e) {\n+            c = null;\n+        }\n+        if (c == null) {\n+            try {\n+                c = Class.forName(name, true, getClass().getClassLoader());\n+            } catch (ClassNotFoundException e) {\n+                c = null;\n+            }\n+        }\n+        if (c == null) {\n+            try {\n+                c = Class.forName(name, true, org.apache.kafka.clients.producer.KafkaProducer.class.getClassLoader());\n+            } catch (ClassNotFoundException e) {\n+                c = null;\n+            }\n+        }\n+        return c;\n+    }\n+    void replaceWithClass(Properties props, String key,  ClassLoader loader, Class<?> type) {\n+        Class<?> c = loadClass(props.get(key), loader);\n+        if (c != null) {\n+            props.put(key, c);\n+        }\n+    }\n+    \n     Properties getProps() {\n         Properties props = endpoint.getConfiguration().createProducerProperties();\n+        if (endpoint.getCamelContext() != null) {\n+            ClassLoader loader = endpoint.getCamelContext().getApplicationContextClassLoader();\n+            replaceWithClass(props, \"key.serializer\", loader, Serializer.class);\n+            replaceWithClass(props, \"value.serializer\", loader, Serializer.class);\n+            replaceWithClass(props, \"partitioner.class\", loader, Partitioner.class);\n+        }\n         if (endpoint.getBrokers() != null) {\n             props.put(ProducerConfig.BOOTSTRAP_SERVERS_CONFIG, endpoint.getBrokers());\n         }",
    "Bump version to 0 . 4 ( <issue_id> )": "diff --git a/ksql-engine/src/main/resources/ksql-version.properties b/ksql-engine/src/main/resources/ksql-version.properties\nindex 5971fc4cdac..1646df26971 100644\n--- a/ksql-engine/src/main/resources/ksql-version.properties\n+++ b/ksql-engine/src/main/resources/ksql-version.properties\n@@ -1 +1 @@\n-version=0.3\n+version=0.4\ndiff --git a/ksql-parser/src/test/resources/ksql-version.properties b/ksql-parser/src/test/resources/ksql-version.properties\nindex 5971fc4cdac..1646df26971 100644\n--- a/ksql-parser/src/test/resources/ksql-version.properties\n+++ b/ksql-parser/src/test/resources/ksql-version.properties\n@@ -1 +1 @@\n-version=0.3\n+version=0.4",
    "added idle sync to make tests more reliable": "diff --git a/app/src/androidTest/java/de/test/antennapod/ui/PlaybackSonicTest.java b/app/src/androidTest/java/de/test/antennapod/ui/PlaybackSonicTest.java\nindex 022f7621d..c43757546 100644\n--- a/app/src/androidTest/java/de/test/antennapod/ui/PlaybackSonicTest.java\n+++ b/app/src/androidTest/java/de/test/antennapod/ui/PlaybackSonicTest.java\n@@ -91,6 +91,7 @@ public class PlaybackSonicTest extends ActivityInstrumentationTestCase2<MainActi\n \n     private void openNavDrawer() {\n         solo.clickOnScreen(50, 50);\n+        getInstrumentation().waitForIdleSync();\n     }\n \n     private void setContinuousPlaybackPreference(boolean value) {\n@@ -113,8 +114,10 @@ public class PlaybackSonicTest extends ActivityInstrumentationTestCase2<MainActi\n         View targetView = drawerView.getChildAt(EPISODES_DRAWER_LIST_INDEX);\n         solo.waitForView(targetView);\n         solo.clickOnView(targetView);\n+        getInstrumentation().waitForIdleSync();\n         solo.waitForText(solo.getString(R.string.all_episodes_short_label));\n         solo.clickOnText(solo.getString(R.string.all_episodes_short_label));\n+        getInstrumentation().waitForIdleSync();\n \n         final List<FeedItem> episodes = DBReader.getRecentlyPublishedEpisodes(10);\n         assertTrue(solo.waitForView(solo.getView(R.id.butSecondaryAction)));\n@@ -141,6 +144,7 @@ public class PlaybackSonicTest extends ActivityInstrumentationTestCase2<MainActi\n         // this should be 'Queue'\n         View targetView = drawerView.getChildAt(QUEUE_DRAWER_LIST_INDEX);\n         solo.waitForView(targetView);\n+        getInstrumentation().waitForIdleSync();\n         solo.clickOnView(targetView);\n         assertTrue(solo.waitForView(solo.getView(R.id.butSecondaryAction)));\n ",
    "Build source distribution during a release": "diff --git a/dist/assembly-src.xml b/dist/assembly-src.xml\nnew file mode 100644\nindex 0000000000..300572e960\n--- /dev/null\n+++ b/dist/assembly-src.xml\n@@ -0,0 +1,47 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<assembly xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns=\"urn:maven:assembly:1.1.0-SNAPSHOT\">\n+    <id>src</id>\n+    <formats>\n+       <format>zip</format>\n+       <format>tar.gz</format>\n+    </formats>\n+\n+    <includeBaseDirectory>false</includeBaseDirectory>\n+\n+    <fileSets>\n+        <fileSet>\n+            <directory>..</directory>\n+            <outputDirectory>jboss-as-${project.version}-src</outputDirectory>\n+            <includes>\n+                <include>**/*.xml</include>\n+                <include>**/src/**</include>\n+                <include>**/*.txt</include>\n+                <include>**/*.sh</include>\n+                <include>**/*.bat</include>\n+                <include>**/*.md</include>\n+                <include>tools/**</include>\n+            </includes>\n+            <excludes>\n+                <!-- Ignore build output -->\n+                <exclude>**/target/**</exclude>\n+\n+                <!-- Ignore git repo -->\n+                <exclude>**/.git</exclude>\n+\n+                <!-- Ignore IDE configuration and other hidden files-->\n+                <exclude>**/.project</exclude>\n+                <exclude>**/.classpath</exclude>\n+                <exclude>**/.settings</exclude>\n+                <exclude>**/.metadata</exclude>\n+                <exclude>**/.iml</exclude>\n+                <exclude>**/.ipr</exclude>\n+                <exclude>**/.iws</exclude>\n+                <exclude>**/.idea</exclude>\n+                <exclude>nbactions.xml</exclude>\n+                <exclude>nb-configuration.xml</exclude>\n+                <exclude>catalog.xml</exclude>\n+\n+            </excludes>\n+        </fileSet>\n+    </fileSets>\n+</assembly>\ndiff --git a/dist/pom.xml b/dist/pom.xml\nindex 82e0b79151..661539899a 100644\n--- a/dist/pom.xml\n+++ b/dist/pom.xml\n@@ -80,6 +80,22 @@\n                                     <workDirectory>target/assembly/work</workDirectory>\n                                 </configuration>\n                             </execution>\n+                            <execution>\n+                                <id>assemble-src</id>\n+                                <phase>package</phase>\n+                          ",
    "Fix FirefoxDriver \\' s parsing of IPv6 hostports when setting proxy configuration .": "diff --git a/javascript/firefox-driver/js/proxy.js b/javascript/firefox-driver/js/proxy.js\nindex 1feb8080b4..31361c7d63 100644\n--- a/javascript/firefox-driver/js/proxy.js\n+++ b/javascript/firefox-driver/js/proxy.js\n@@ -45,6 +45,35 @@ fxdriver.proxy.ProxyConfig;\n fxdriver.proxy.LOG_ = fxdriver.logging.getLogger('fxdriver.proxy');\n \n \n+/**\n+ * Splits a hostport, e.g., 'www.example.com:80' into host and port.\n+ * @param {string} hostport A hostport.\n+ * @return {{host: string, port: ?number}} A host and port. If no port is\n+ *     present in the argument hostport, port is null.\n+ * @private\n+ */\n+fxdriver.proxy.splitHostPort_ = function(hostport) {\n+  var colonIndex = hostport.lastIndexOf(':');\n+  if (colonIndex < 0) {\n+    return {host: hostport, port: null};\n+  }\n+  var secondColonIndex = hostport.indexOf(':');\n+  if (secondColonIndex != colonIndex && !hostport.includes('[')) {\n+    // The hostport contains multiple colons, but no part of it is bracketed,\n+    // e.g., '2001:4860:4860::8888'. Treat it as an IPv6 literal with no port.\n+    return {host: hostport, port: null};\n+  }\n+\n+  var host = hostport.slice(0, colonIndex);\n+  // Strip brackets from bracketed IPv6 hosts, e.g., '[::1]'.\n+  if (host.startsWith('[') && host.endsWith(']')) {\n+    host = host.slice(1, -1);\n+  }\n+  var portStr = hostport.slice(colonIndex + 1);\n+  return {host: host, port: parseInt(portStr, 10)};\n+};\n+\n+\n /**\n  * Set a specific proxy preference.\n  *\n@@ -57,10 +86,12 @@ fxdriver.proxy.setProxyPreference_ = function(prefs, type, setting) {\n   if (!setting) {\n     return;\n   }\n-  var hostPort = setting.split(':');\n-  prefs.setCharPref('network.proxy.' + type, hostPort[0]);\n-  if (hostPort.length > 1) {\n-    prefs.setIntPref('network.proxy.' + type + '_port', parseInt(hostPort[1]));\n+  var hostAndPort = fxdriver.proxy.splitHostPort_(setting);\n+  var host = hostAndPort.host;\n+  var port = hostAndPort.port;\n+  prefs.setCharPref('network.proxy.' + type, host);\n+  if (port != null) {\n+    prefs.setIntPref('network.proxy.' + type + '_port', port);\n   }\n };\n ",
    "Reduce use of android . graphics . Matrix calculations . .": "diff --git a/ui/ui-platform/src/main/java/androidx/ui/core/LayoutNodeWrapper.kt b/ui/ui-platform/src/main/java/androidx/ui/core/LayoutNodeWrapper.kt\nindex 8b4743e2366..c85de48609d 100644\n--- a/ui/ui-platform/src/main/java/androidx/ui/core/LayoutNodeWrapper.kt\n+++ b/ui/ui-platform/src/main/java/androidx/ui/core/LayoutNodeWrapper.kt\n@@ -810,18 +810,22 @@ internal class LayerWrapper(\n \n     override fun toParentPosition(position: PxPosition): PxPosition {\n         val matrix = layer.getMatrix()\n-        val x = position.x.value\n-        val y = position.y.value\n-        val cache = positionCache\n-        val point = if (cache != null) {\n-            cache[0] = x\n-            cache[1] = y\n-            cache\n+        if (!matrix.isIdentity) {\n+            val x = position.x.value\n+            val y = position.y.value\n+            val cache = positionCache\n+            val point = if (cache != null) {\n+                cache[0] = x\n+                cache[1] = y\n+                cache\n+            } else {\n+                floatArrayOf(x, y).also { positionCache = it }\n+            }\n+            matrix.mapPoints(point)\n+            return super.toParentPosition(PxPosition(point[0].px, point[1].px))\n       ",
    "Avoids docker . io pulls from testcontainers ( and removes a JDK install ) ( <issue_id> ) .": "diff --git a/.travis.yml b/.travis.yml\nindex 1e8cef713..3c1f15c9b 100755\n--- a/.travis.yml\n+++ b/.travis.yml\n@@ -1,10 +1,9 @@\n # Run `travis lint` when changing this file to avoid breaking the build.\n \n-# We need a full VM so that testcontainers can use Docker\n # See https://docs.travis-ci.com/user/reference/overview/#for-a-particular-travisyml-configuration\n-arch: amd64           # arm64 is LXD containers which we can't use because we run Docker tests\n-os: linux             # required for arch different than amd64\n-dist: focal           # newest available distribution\n+arch: amd64 # Not arm64 for multi-platform Docker builds (qemu is amd64->arm64, not vice versa)\n+os: linux   # required for arch different than amd64\n+dist: focal # newest available distribution\n \n # license-maven-plugin needs the full history to generate copyright year range. Ex. 2013-2020\n # Don't do a shallow clone, as it interferes with this.\n@@ -22,23 +21,27 @@ cache:\n services:\n   - docker\n \n+# Re-use JDK 11 from focal release instead of delaying build with installation\n before_install:\n   - |\n-    # Intentionally don't use \"jdk\" Travis apt key as it is coupled to jdk.java.net availability.\n-    # Use JDK 11, so we can release Java 6 bytecode\n-    OPENJDK_VERSION=11\n-    sudo apt-get -y install openjdk-${OPENJDK_VERSION}-jdk\n-    export JAVA_HOME=/usr/lib/jvm/java-${OPENJDK_VERSION}-openjdk-${TRAVIS_CPU_ARCH}/\n-    ./mvnw -version\n-  - |\n-    # Quiet Maven invoker logs (Downloading... when running zipkin-server/src/it)\n-    echo \"MAVEN_OPTS='-Dorg.slf4j.simpleLogger.log.org.apache.maven.cli.transfer.Slf4jMavenTransferListener=warn'\" > ~/.mavenrc\n-\n     # Cache as help:evaluate is not quick\n     export POM_VERSION=$(./mvnw help:evaluate -N -Dexpression=project.version -q -DforceStdout)\n-\n-    # Disable testcontainers checks\n-    echo checks.disable=true > ~/.testcontainers.properties\n+  - |\n+    # Defend against build outages caused by Docker Hub (docker.io) pull rate limits\n+\n+    # We don't use any docker.io images, but add a Google's mirror in case something implicitly does\n+    # * See https://cloud.google.com/container-registry/docs/pulling-cached-images\n+    echo '{ \"registry-mirrors\": [\"https://mirror.gcr.io\"] }' | sudo tee /etc/docker/daemon.json\n+    sudo service docker restart\n+    # * Ensure buildx and related features are disabled\n+    mkdir -p ${HOME}/.docker && echo '{\"experimental\":\"disabled\"}' > ${HOME}/.docker/config.json\n+\n+    # Change testcontainers configuration so that it doesn't pull from docker.io\n+    # * See https://www.testcontainers.org/supported_docker_environment/image_registry_rate_limiting/\n+    # * checks.disable=true - saves time and a docker.io pull of alpine\n+    echo checks.disable=true >> ~/.testcontainers.properties\n+    # * change ryuk to ghcr.io until: https://github.com/testcontainers/moby-ryuk/issues/15 and 16\n+    echo ryuk.container.image=ghcr.io/openzipkin/testcontainers-ryuk:latest >> ~/.testcontainers.properties\n   - |\n     # Credentials entered into https://travis-ci.org/github/openzipkin/${REPO}/settings are access\n     # controlled by branch (typically only master). Check to see if a well-known env is available",
    "Add methods to check device flash support": "diff --git a/camerakit/src/main/java/com/camerakit/CameraKitView.java b/camerakit/src/main/java/com/camerakit/CameraKitView.java\nindex b507060..4c7cfc7 100644\n--- a/camerakit/src/main/java/com/camerakit/CameraKitView.java\n+++ b/camerakit/src/main/java/com/camerakit/CameraKitView.java\n@@ -721,6 +721,22 @@ public class CameraKitView extends GestureLayout {\n         mCameraPreview.setFlash(cameraFlash);\n     }\n \n+    /**\n+     * Determine if device is capable of flash\n+     * @return boolean if device is capable of flash\n+     */\n+    public boolean hasFlash() {\n+        return mCameraPreview.hasFlash();\n+    }\n+\n+    /**\n+     * Get supported flash types on device\n+     * @return array of supported flash types\n+     */\n+    public CameraFlash[] getSupportedFlashTypes() {\n+        return mCameraPreview.getSupportedFlashTypes();\n+    }\n+\n     /**\n      * @return one of {@link CameraKit.Flash}'s constants.\n      * @see #setFlash(int)\ndiff --git a/camerakit/src/main/java/com/camerakit/CameraPreview.kt b/camerakit/src/main/java/com/camerakit/CameraPreview.kt\nindex b91d026..3021e17 100644\n--- a/camerakit/src/main/java/com/camerakit/CameraPreview.kt\n+++ b/camerakit/src/main/java/com/camerakit/CameraPreview.kt\n@@ -168,6 +168,17 @@ class CameraPreview : FrameLayout, CameraEvents {\n         }\n     }\n \n+    fun hasFlash(): Boolean {\n+        if (attributes?.flashes != null) {\n+            return true\n+        }\n+        return false\n+    }\n+\n+    fun getSupportedFlashTypes(): Array<CameraFlash>? {\n+        return attributes?.flashes\n+    }\n+\n     interface PhotoCallback {\n         fun onCapture(jpeg: ByteArray)\n     }",
    "Added DB2 support": "diff --git a/jOOQ/src/main/java/org/jooq/impl/BlockImpl.java b/jOOQ/src/main/java/org/jooq/impl/BlockImpl.java\nindex ad2bada661..30cda863e7 100644\n--- a/jOOQ/src/main/java/org/jooq/impl/BlockImpl.java\n+++ b/jOOQ/src/main/java/org/jooq/impl/BlockImpl.java\n@@ -37,6 +37,7 @@\n  */\n package org.jooq.impl;\n \n+// ...\n // ...\n import static org.jooq.conf.ParamType.INLINED;\n import static org.jooq.impl.Keywords.K_BEGIN;\n@@ -106,6 +107,17 @@ final class BlockImpl extends AbstractQuery implements Block {\n \n \n \n+\n+\n+\n+\n+\n+\n+\n+\n+\n+\n+\n             default: {\n                 accept0(ctx);\n                 break;\n@@ -122,8 +134,12 @@ final class BlockImpl extends AbstractQuery implements Block {\n \n \n \n+\n+\n+\n                 default:\n                     ctx.formatSeparator().visit(K_NULL).sql(';');\n+                    break;\n             }\n         }\n         else {\n@@ -150,8 +166,17 @@ final class BlockImpl extends AbstractQuery implements Block {\n \n         ctx.formatIndentEnd()\n            .formatSeparator()\n-           .visit(K_END)\n-           .sql(';');\n+           .visit(K_END);\n+\n+        switch (ctx.family()) {\n+\n+\n+\n+\n+\n+            default:\n+     ",
    "add missing checkPermission ( CONFIGURE ) to POST data to / job / { jobname } / config . xml .": "diff --git a/core/src/main/java/hudson/model/Job.java b/core/src/main/java/hudson/model/Job.java\nindex b230eeaa28..f5caeb02c3 100644\n--- a/core/src/main/java/hudson/model/Job.java\n+++ b/core/src/main/java/hudson/model/Job.java\n@@ -1001,16 +1001,16 @@ public abstract class Job<JobT extends Job<JobT, RunT>, RunT extends Run<JobT, R\n     @WebMethod(name = \"config.xml\")\n     public void doConfigDotXml(StaplerRequest req, StaplerResponse rsp)\n             throws IOException {\n-        checkPermission(EXTENDED_READ);\n-\n         if (req.getMethod().equals(\"GET\")) {\n             // read\n+            checkPermission(EXTENDED_READ);\n             rsp.setContentType(\"application/xml;charset=UTF-8\");\n             getConfigFile().writeRawTo(rsp.getWriter());\n             return;\n         }\n         if (req.getMethod().equals(\"POST\")) {\n             // submission\n+            checkPermission(CONFIGURE);\n             XmlFile configXmlFile = getConfigFile();\n             AtomicFileWriter out = new AtomicFileWriter(configXmlFile.getFile());\n \ndiff --git a/test/src/test/java/hudson/model/JobTest.java b/test/src/test/java/hudson/model/JobTest.java\nindex edd18c7a6d..ffce4051ee 100644\n--- a/test/src/test/java/hudson/model/JobTest.java\n+++ b/test/src/test/java/hudson/model/JobTest.java\n@@ -164,15 +164,55 @@ public class JobTest extends HudsonTestCase {\n     public void testReadPermission() throws Exception {\n         WebClient wc = new WebClient();\n         try {\n-            HtmlPage page = wc.goTo(\"/job/testJob/\");\n-            fail(\"getJob bypassed READ permission: \" + page.getTitleText() + page.getBody().asText());\n+            HtmlPage page = wc.goTo(\"job/testJob/\");\n+            fail(\"getJob bypassed Item.READ permission: \" + page.getTitleText());\n         } catch (FailingHttpStatusCodeException expected) { }\n         try {\n-            HtmlPage page = wc.goTo(\"/jobCaseInsensitive/testJob/\");\n-            fail(\"getJobCaseInsensitive bypassed READ permission: \" + page.getTitleText());\n+            HtmlPage page = wc.goTo(\"jobCaseInsensitive/testJob/\");\n+            fail(\"getJobCaseInsensitive bypassed Item.READ permission: \" + page.getTitleText());\n         } catch (FailingHttpStatusCodeException expected) { }\n         wc.login(\"joe\");  // Has Item.READ permission\n-        wc.goTo(\"/job/testJob/\");\n-        wc.goTo(\"/jobCaseInsensitive/TESTJOB/\");\n+        // Verify we can access both URLs:\n+        wc.goTo(\"job/testJob/\");\n+        wc.goTo(\"jobCaseInsensitive/TESTJOB/\");\n+    }\n+\n+    @LocalData\n+    public void testConfigDotXmlPermission() throws Exception {\n+        hudson.setCrumbIssuer(null);\n+        WebClient wc = new WebClient();\n+        boolean saveEnabled = Item.EXTENDED_READ.getEnabled();\n+        Item.EXTENDED_READ.setEnabled(true);\n+        try {\n+            try {\n+                wc.goTo(\"job/testJob/config.xml\", \"text/plain\");\n+                fail(\"doConfigDotXml bypassed EXTENDED_READ permission\");\n+            } catch (FailingHttpStatusCodeException expected) {\n+                assertEquals(\"403 for no permission\", 403, expected.getStatusCode());\n+            }\n+            wc.login(\"alice\");  // Has CONFIGURE and EXTENDED_READ permission\n+            tryConfigDotXml(wc, 500, \"Both perms; should get 500\");\n+            wc.login(\"bob\");  // Has only CONFIGURE permission (this should imply EXTENDED_READ)\n+            tryConfigDotXml(wc, 500, \"Config perm should imply EXTENDED_READ\");\n+            wc.login(\"charlie\");  // Has only EXTENDED_READ permission\n+            tryConfigDotXml(wc, 403, \"No permission, should get 403\");\n+        } finally {\n+            Item.EXTENDED_READ.setEnabled(saveEnabled);\n+        }\n+    }\n+\n+    private static void tryConfigDotXml(WebClient wc, int status, String msg) throws Exception {\n+        // Verify we can GET the config.xml:\n+        wc.goTo(\"job/testJob/config.xml\", \"application/xml\");\n+        // This page is a simple form to POST to /job/testJob/config.xml\n+        // But it posts invalid data so we expect 500 if we have permission, 403 if not\n+        HtmlPage page = wc.goTo(\"userContent/post.html\");\n+        try {\n+            page.getForms().get(0).submit();\n+            fail(\"Expected exception: \" + msg);\n+        } catch (FailingHttpStatusCodeException expected) {\n+            assertEquals(msg, status, expected.getStatusCode());\n+        }\n+        wc.goTo(\"logout\");\n     }\n }\ndiff --git a/test/src/test/resources/hudson/model/JobTest/testConfigDotXmlPermission.zip b/test/src/test/resources/hudson/model/JobTest/testConfigDotXmlPermission.zip\nnew file mode 100644\nindex 0000000000..9d8987ecee\nBinary files /dev/null and b/test/src/test/resources/hudson/model/JobTest/testConfigDotXmlPermission.zip differ",
    "Add connection test for url for config repo": "diff --git a/server/webapp/WEB-INF/rails/spec/webpack/views/config_repos/models/config_repo_vm_spec.js b/server/webapp/WEB-INF/rails/spec/webpack/views/config_repos/models/config_repo_vm_spec.js\nindex dfca18083c..75a2b44be7 100644\n--- a/server/webapp/WEB-INF/rails/spec/webpack/views/config_repos/models/config_repo_vm_spec.js\n+++ b/server/webapp/WEB-INF/rails/spec/webpack/views/config_repos/models/config_repo_vm_spec.js\n@@ -15,6 +15,7 @@\n  */\n \n const ConfigRepoVM = require(\"views/config_repos/models/config_repo_vm\");\n+const Routes       = require(\"gen/js-routes\");\n \n describe(\"Config Repo View Model\", () => {\n   it(\"allowSave() runs ALL validations on local and child fields, even if there are failures (does not short-circuit)\", () => {\n@@ -69,6 +70,28 @@ describe(\"Config Repo View Model\", () => {\n     copy.id(\"carbon-copy\");\n     expect(original.toJSON()).not.toEqual(copy.toJSON());\n   });\n+\n+  it(\"should be able to test connectivity for url\", (done) => {\n+    const repo = simple();\n+\n+    jasmine.Ajax.withMock(() => {\n+      jasmine.Ajax.stubRequest(Routes.apiv1AdminInternalMaterialTestPath(), undefined, \"POST\").andReturn({\n+        responseText: JSON.stringify({ message: \"Connection OK.\" }),\n+        status: 200,\n+        responseHeaders: {\n+          \"Content-Type\": \"application/vnd.go.cd.v1+json\"\n+        }\n+      });\n+\n+      repo.testConnection().then((data) => {\n+        const reqParams = JSON.parse(jasmine.Ajax.requests.mostRecent().params);\n+        expect(reqParams.attributes.url).toBe(\"https://bitnugget.org/unicorns\");\n+        expect(data.message).toBe(\"Connection OK.\");\n+        done();\n+      }, () => done.fail(\"request should be successful\"));\n+    });\n+\n+  });\n });\n \n // utility functions\ndiff --git a/server/webapp/WEB-INF/rails/webpack/views/config_repos/config_repos_list.js.msx b/server/webapp/WEB-INF/rails/webpack/views/config_repos/config_repos_list.js.msx\nindex daf1439e44..445eb57224 100644\n--- a/server/webapp/WEB-INF/rails/webpack/views/config_repos/config_repos_list.js.msx\n+++ b/server/webapp/WEB-INF/rails/webpack/views/config_repos/config_repos_list.js.msx\n@@ -67,7 +67,7 @@ const AddForm = {\n     return <div class=\"add-config-repo-form\">\n       <f.select validate={true} label=\"Choose a plugin\" model={vm} attrName=\"pluginId\" items={availablePlugins} />\n       <f.input validate={true} label=\"Config Repo ID\" model={vm} attrName=\"id\"/>\n-      <MaterialAttributes material={vm.attributes()} isEdit={true} />\n+      <MaterialAttributes model={vm} isEdit={true} />\n     </div>;\n   }\n };\n@@ -81,7 +81,7 @@ const ConfigRepo = {\n     return <li>\n       <h3>{repo.type()} repo: {repo.id()}</h3>\n       <h5>Plugin: {repo.pluginId()}</h5>\n-      <MaterialAttributes material={repo.attributes()} isEdit={isEdit} />\n+      <MaterialAttributes model={repo} isEdit={isEdit} />\n       <ActionBar vm={vm} repo={repo} isEdit={isEdit} />\n     </li>;\n   }\n@@ -103,12 +103,13 @@ const ActionBar = {\n \n const MaterialAttributes = {\n   view(vnode) {\n-    const material = vnode.attrs.material;\n+    const vm = vnode.attrs.model;\n+    const material = vm.attributes();\n     const isEdit = vnode.attrs.isEdit;\n \n     if (isEdit) {\n       return <div>{\n-        _.map(material.keys, (k) => <Field model={material} attrName={k} />)\n+        _.map(material.keys, (k) => <Field vm={vm} model={material} attrName={k} />)\n       }</div>;\n     }\n \n@@ -120,12 +121,16 @@ const MaterialAttributes = {\n \n const Field = {\n   view(vnode) {\n-    const vm = vnode.attrs.model;\n+    const vm = vnode.attrs.vm;\n+    const model = vnode.attrs.model;\n     const k = vnode.attrs.attrName;\n-    const field = vm[k];\n-    const options = {model: vm, attrName: k, label: field.opts(\"display\"), validate: true};\n+    const field = model[k];\n+    const options = {model, attrName: k, label: field.opts(\"display\"), validate: true};\n \n     if (field.opts(\"readOnly\")) { options.disabled = true; }\n+    if (\"url\" === k) {\n+      options.contentAfter = [<CheckConnection vm={vm}/>];\n+    }\n \n     switch (field.opts(\"type\")) {\n       /* eslint-disable no-fallthrough */\n@@ -141,4 +146,24 @@ const Field = {\n   }\n };\n \n+const CheckConnection = {\n+  oninit(vnode) {\n+    vnode.state.result = null;\n+  },\n+\n+  view(vnode) {\n+    const vm = vnode.attrs.vm;\n+    const success = (data) => { vnode.state.result = data.message; };\n+    const failure = (errorMessage) => { vnode.state.result = errorMessage; };\n+    const handler = () => {\n+      vnode.state.result = null;\n+      vm.testConnection().then(success, failure);\n+    };\n+    return <div class=\"connection-test\">\n+      <button onclick={handler}>Check Connection</button>\n+      <span class=\"connection-result\">{vnode.state.result}</span>\n+    </div>;\n+  }\n+};\n+\n module.exports = ConfigReposList;\ndiff --git a/server/webapp/WEB-INF/rails/webpack/views/config_repos/models/config_repo_vm.js b/server/webapp/WEB-INF/rails/webpack/views/config_repos/models/config_repo_vm.js\nindex b56ab56776..776d7482cb 100644\n--- a/server/webapp/WEB-INF/rails/webpack/views/config_repos/models/config_repo_vm.js\n+++ b/server/webapp/WEB-INF/rails/webpack/views/config_repos/models/config_repo_vm.js\n@@ -18,6 +18,8 @@ const Stream      = require(\"mithril/stream\");\n const _           = require(\"lodash\");\n const Materials   = require(\"models/config_repos/materials\");\n const Validatable = require(\"models/mixins/validatable_mixin\");\n+const ApiHelper   = require(\"helpers/api_helper\");\n+const Routes      = require(\"gen/js-routes\");\n \n function ConfigRepoVM(data) {\n   this.id = Stream();\n@@ -68,6 +70,12 @@ function ConfigRepoVM(data) {\n     cloned.etag(this.etag());\n     return cloned;\n   };\n+\n+  this.testConnection = () => ApiHelper.POST({\n+    url: Routes.apiv1AdminInternalMaterialTestPath(),\n+    apiVersion: \"v1\",\n+    payload: this.toJSON().material\n+  });\n }\n \n module.exports = ConfigRepoVM;",
    "Restricted NULL Unicode character checks to cstring , so that a normal value string can contain one": "diff --git a/bson/src/main/org/bson/io/OutputBuffer.java b/bson/src/main/org/bson/io/OutputBuffer.java\nindex a3c486340..7a7dc7336 100644\n--- a/bson/src/main/org/bson/io/OutputBuffer.java\n+++ b/bson/src/main/org/bson/io/OutputBuffer.java\n@@ -1,5 +1,5 @@\n /*\n- * Copyright (c) 2008 - 2013 10gen, Inc. <http://10gen.com>\n+ * Copyright (c) 2008 - 2014 MongoDB Inc. <http://mongodb.com>\n  *\n  * Licensed under the Apache License, Version 2.0 (the \"License\");\n  * you may not use this file except in compliance with the License.\n@@ -117,18 +117,22 @@ public abstract class OutputBuffer extends OutputStream {\n \n     public void writeString(final String str) {\n         writeInt(0); // making space for size\n-        int strLen = writeCString(str);\n+        int strLen = writeCharacters(str, false);\n         backpatchSize(strLen, 4);\n     }\n \n     public int writeCString(final String str) {\n+       return writeCharacters(str, true);\n+    }\n+\n+    private int writeCharacters(final String str, final boolean checkForNullCharacters) {\n         int len = str.length();\n         int total = 0;\n \n         for (int i = 0; i < len;/*i gets incremented*/) {\n             int c = Character.codePointAt(str, i);\n \n-            if (c == 0x0) {\n+            if (checkForNullCharacters && c == 0x0) {\n                 throw new BSONSerializationException(format(\"BSON cstring '%s' is not valid because it contains a null character \"\n                                                             + \"at index %d\", str, i));\n             }\ndiff --git a/bson/src/test/org/bson/BSONBinaryWriterTest.java b/bson/src/test/org/bson/BSONBinaryWriterTest.java\nindex 20c8dd197..c9dd653e3 100644\n--- a/bson/src/test/org/bson/BSONBinaryWriterTest.java\n+++ b/bson/src/test/org/bson/BSONBinaryWriterTest.java\n@@ -1,5 +1,5 @@\n /*\n- * Copyright (c) 2008 - 2013 10gen, Inc. <http://10gen.com>\n+ * Copyright (c) 2008 - 2014 MongoDB Inc. <http://mongodb.com>\n  *\n  * Licensed under the Apache License, Version 2.0 (the \"License\");\n  * you may not use this file except in compliance with the License.\n@@ -202,6 +202,18 @@ public class BSONBinaryWriterTest {\n         writer.writeEndDocument();\n     }\n \n+    @Test(expected = BSONException.class)\n+    public void shouldThrowAnErrorIfKeyContainsNullCharacter() {\n+        writer.writeStartDocument();\n+        writer.writeBoolean(\"h\\u0000i\", true);\n+    }\n+\n+    @Test\n+    public void shouldNotThrowAnErrorIfValueContainsNullCharacter() {\n+        writer.writeStartDocument();\n+        writer.writeString(\"x\", \"h\\u0000i\");\n+    }\n+\n     @Test\n     public void shouldNotThrowAnExceptionIfCorrectlyStartingAndEndingDocumentsAndSubdocuments() {\n         writer.writeStartDocument();\ndiff --git a/driver/src/test/unit/org/mongodb/io/PooledByteBufferOutputBufferTest.java b/driver/src/test/unit/org/mongodb/io/PooledByteBufferOutputBufferTest.java\nindex 4b361bfff..a054a0ee5 100644\n--- a/driver/src/test/unit/org/mongodb/io/PooledByteBufferOutputBufferTest.java\n+++ b/driver/src/test/unit/org/mongodb/io/PooledByteBufferOutputBufferTest.java\n@@ -1,5 +1,5 @@\n /*\n- * Copyright (c) 2008 - 2013 10gen, Inc. <http://10gen.com>\n+ * Copyright (c) 2008 - 2014 MongoDB Inc. <http://mongodb.com>\n  *\n  * Licensed under the Apache License, Version 2.0 (the \"License\");\n  * you may not use this file except in compliance with the License.\n@@ -26,6 +26,7 @@ import java.io.IOException;\n import java.util.Arrays;\n import java.util.Random;\n \n+import static org.junit.Assert.assertArrayEquals;\n import static org.junit.Assert.assertEquals;\n import static org.junit.Assert.assertTrue;\n \n@@ -81,11 +82,18 @@ public class PooledByteBufferOutputBufferTest {\n     }\n \n     @Test(expected = BSONSerializationException.class)\n-    public void testNullCharacterInCString() {\n+    public void nullCharacterInCStringShouldThrowSerializationException() {\n         PooledByteBufferOutputBuffer buf = new PooledByteBufferOutputBuffer(new PowerOfTwoBufferPool(11));\n         buf.writeCString(\"hell\\u0000world\");\n     }\n \n+    @Test\n+    public void nullCharacterInStringShouldNotThrowSerializationException() {\n+        PooledByteBufferOutputBuffer buf = new PooledByteBufferOutputBuffer(new PowerOfTwoBufferPool(11));\n+        buf.writeString(\"h\\u0000i\");\n+        assertArrayEquals(new byte[] {4, 0, 0, 0, 'h', 0, 'i', 0}, buf.toByteArray());\n+    }\n+\n     private byte[] getRandomBytes(final int len) {\n         byte[] randomBytes = new byte[len];\n         random.nextBytes(randomBytes);",
    "Remove unused method . . Test Plan : CI .": "diff --git a/src/com/facebook/buck/cli/Main.java b/src/com/facebook/buck/cli/Main.java\nindex 3dbe09a08f..b676ccf331 100644\n--- a/src/com/facebook/buck/cli/Main.java\n+++ b/src/com/facebook/buck/cli/Main.java\n@@ -1183,8 +1183,7 @@ public final class Main {\n                       new PrintStreamProcessExecutorFactory(),\n                       vcBuckConfig,\n                       buckConfig.getEnvironment()),\n-                  buildEventBus\n-              );\n+                  buildEventBus);\n \n               vcStatsGenerator.generateStatsAsync();\n             }\ndiff --git a/src/com/facebook/buck/event/BuckEventBus.java b/src/com/facebook/buck/event/BuckEventBus.java\nindex cd9da68c61..31766bc48a 100644\n--- a/src/com/facebook/buck/event/BuckEventBus.java\n+++ b/src/com/facebook/buck/event/BuckEventBus.java\n@@ -123,11 +123,6 @@ public class BuckEventBus implements Closeable, com.facebook.buck.event.EventBus\n     return clock;\n   }\n \n-  @VisibleForTesting\n-  Supplier<Long> getThreadIdSupplier() {\n-    return threadIdSupplier;\n- ",
    "Restored java . nio . charset encoder API , added CharsetProvider , moved iOS support classes . . Change on 2016 / 08 / 26 by tball < tball @ google . com > .": "diff --git a/jre_emul/.classpath b/jre_emul/.classpath\nindex 046fa6e62..b2f0588fe 100644\n--- a/jre_emul/.classpath\n+++ b/jre_emul/.classpath\n@@ -20,6 +20,7 @@\n \t<classpathentry kind=\"src\" path=\"apache_harmony/classlib/modules/luni/src/test/api/common\"/>\n \t<classpathentry kind=\"src\" path=\"apache_harmony/classlib/modules/math/src/main/java\"/>\n \t<classpathentry kind=\"src\" path=\"apache_harmony/classlib/modules/math/src/test/java\"/>\n+\t<classpathentry kind=\"src\" path=\"apache_harmony/classlib/modules/nio_char/src/main/java\"/>\n \t<classpathentry kind=\"src\" path=\"apache_harmony/classlib/modules/text/src/test/java\"/>\n \t<classpathentry kind=\"src\" path=\"apache_harmony/classlib/support/src/test/java\"/>\n \t<classpathentry kind=\"src\" path=\"Classes\"/>\ndiff --git a/jre_emul/Classes/NSString+JavaString.m b/jre_emul/Classes/NSString+JavaString.m\nindex fdaec95b3..9facaf83d 100644\n--- a/jre_emul/Classes/NSString+JavaString.m\n+++ b/jre_emul/Classes/NSString+JavaString.m\n@@ -23,6 +23,7 @@\n \n #import \"IOSClass.h\"\n #import \"J2ObjC_source.h\"\n+#import \"com/google/j2objc/nio/charset/IOSCharset.h\"\n #import \"java/io/ObjectStreamField.h\"\n #import \"java/io/Serializable.h\"\n #import \"java/io/UnsupportedEncodingException.h\"\n@@ -35,7 +36,6 @@\n #import \"java/lang/StringBuilder.h\"\n #import \"java/lang/StringIndexOutOfBoundsException.h\"\n #import \"java/nio/charset/Charset.h\"\n-#import \"java/nio/charset/IOSCharset.h\"\n #import \"java/nio/charset/UnsupportedCharsetException.h\"\n #import \"java/util/Comparator.h\"\n #import \"java/util/Formatter.h\"\n@@ -498,7 +498,7 @@ destinationBegin:(int)destinationBegin {\n \n NSStringEncoding parseCharsetName(NSString *charset) {\n   JavaNioCharsetCharset *cs = JavaNioCharsetCharset_forNameUEEWithNSString_(charset);\n-  return (NSStringEncoding)[(JavaNioCharsetIOSCharset *)cs nsEncoding];\n+  return (NSStringEncoding)[(ComGoogleJ2objcNioCharsetIOSCharset *)cs nsEncoding];\n }\n \n + (NSString *)stringWithBytes:(IOSByteArray *)value\n@@ -534,11 +534,11 @@ NSStringEncoding parseCharsetName(NSString *charset) {\n                        offset:(int)offset\n                        length:(int)count\n                       charset:(JavaNioCharsetCharset *)charset {\n-  if (![charset isKindOfClass:[JavaNioCharsetIOSCharset class]]) {\n+  if (![charset isKindOfClass:[ComGoogleJ2objcNioCharsetIOSCharset class]]) {\n     @throw AUTORELEASE([[JavaNioCharsetUnsupportedCharsetException alloc]\n                         initWithNSString:[charset description]]);\n   }\n-  JavaNioCharsetIOSCharset *iosCharset = (JavaNioCharsetIOSCharset *) charset;\n+  ComGoogleJ2objcNioCharsetIOSCharset *iosCharset = (ComGoogleJ2objcNioCharsetIOSCharset *) charset;\n   NSStringEncoding encoding = (NSStringEncoding) [iosCharset nsEncoding];\n   return [NSString stringWithBytes:value\n                             offset:offset\n@@ -611,7 +611,8 @@ NSStringEncoding parseCharsetName(NSString *charset) {\n \n - (IOSByteArray *)getBytes  {\n   JavaNioCharsetCharset *charset = JavaNioCharsetCharset_defaultCharset();\n-  NSStringEncoding encoding = (NSStringEncoding)[(JavaNioCharsetIOSCharset *)charset nsEncoding];\n+  NSStringEncoding encoding =\n+      (NSStringEncoding)[(ComGoogleJ2objcNioCharsetIOSCharset *)charset nsEncoding];\n   return [self getBytesWithEncoding:encoding];\n }\n \n@@ -625,11 +626,11 @@ NSStringEncoding parseCharsetName(NSString *charset) {\n \n - (IOSByteArray *)getBytesWithCharset:(JavaNioCharsetCharset *)charset {\n   nil_chk(charset);\n-  if (![charset isKindOfClass:[JavaNioCharsetIOSCharset class]]) {\n+  if (![charset isKindOfClass:[ComGoogleJ2objcNioCharsetIOSCharset class]]) {\n     @throw AUTORELEASE([[JavaNioCharsetUnsupportedCharsetException alloc]\n                         initWithNSString:[charset description]]);\n   }\n-  JavaNioCharsetIOSCharset *iosCharset = (JavaNioCharsetIOSCharset *) charset;\n+  ComGoogleJ2objcNioCharsetIOSCharset *iosCharset = (ComGoogleJ2objcNioCharsetIOSCharset *) charset;\n   NSStringEncoding encoding = (NSStringEncoding) [iosCharset nsEncoding];\n   return [self getBytesWithEncoding:encoding];\n }\ndiff --git a/jre_emul/android/libcore/luni/src/main/java/java/nio/charset/IOSCharset.java b/jre_emul/Classes/com/google/j2objc/nio/charset/IOSCharset.java\nsimilarity index 88%\nrename from jre_emul/android/libcore/luni/src/main/java/java/nio/charset/IOSCharset.java\nrename to jre_emul/Classes/com/google/j2objc/nio/charset/IOSCharset.java\nindex db10b4aef..404596b81 100644\n--- a/jre_emul/android/libcore/luni/src/main/java/java/nio/charset/IOSCharset.java\n+++ b/jre_emul/Classes/com/google/j2objc/nio/charset/IOSCharset.java\n@@ -15,13 +15,14 @@\n  *  limitations under the License.\n  */\n \n-package java.nio.charset;\n+package com.google.j2objc.nio.charset;\n \n-import java.io.UnsupportedEncodingException;\n+import java.nio.charset.Charset;\n+import java.nio.charset.CharsetDecoder;\n+import java.nio.charset.CharsetEncoder;\n import java.util.HashMap;\n import java.util.Map;\n import java.util.Set;\n-import java.util.logging.Logger;\n \n /*-[\n #import \"java/io/UnsupportedEncodingException.h\"\n@@ -34,7 +35,7 @@ import java.util.logging.Logger;\n  *\n  * @author Tom Ball\n  */\n-class IOSCharset extends Charset {\n+public class IOSCharset extends Charset {\n \n   // The NSStringEncoding enum value for this charset.\n   private long nsEncoding;\n@@ -44,6 +45,8 @@ class IOSCharset extends Charset {\n \n   private static Map<String, IOSCharset> encodings = new HashMap<String, IOSCharset>();\n \n+  public static final IOSCharset DEFAULT_CHARSET = getDefaultCharset();\n+\n   private IOSCharset(long nsEncoding, String canonicalName, String[] aliases, float charBytes) {\n     super(canonicalName, aliases);\n     this.nsEncoding = nsEncoding;\n@@ -69,11 +72,11 @@ class IOSCharset extends Charset {\n     return new IOSCharsetDecoder(this);\n   }\n \n-  static Set<String> getAvailableCharsetNames() {\n+  public static Set<String> getAvailableCharsetNames() {\n     return getEncodings().keySet();\n   }\n \n-  static Charset charsetForName(String charsetName) {\n+  public static Charset charsetForName(String charsetName) {\n     // See if an encoding was requested by name.\n     Map<String, IOSCharset> encodings = getEncodings();\n     IOSCharset result = encodings.get(charsetName.toUpperCase());\n@@ -165,16 +168,16 @@ class IOSCharset extends Charset {\n   };\n   static const int numIosCharsets = sizeof(iosCharsets) / sizeof(CharsetInfo);\n \n-  static JavaNioCharsetIOSCharset *addEncoding(CharsetInfo info) {\n+  static ComGoogleJ2objcNioCharsetIOSCharset *addEncoding(CharsetInfo info) {\n     IOSObjectArray *aliases = [IOSObjectArray arrayWithObjects:info.aliases\n                                                          count:info.aliasCount\n                                                           type:NSString_class_()];\n-    JavaNioCharsetIOSCharset *cs = [[[JavaNioCharsetIOSCharset alloc]\n-                                     initWithLong:info.encoding\n-                                     withNSString:info.name\n-                                withNSStringArray:aliases\n-                                        withFloat:info.charBytes] autorelease];\n-    [JavaNioCharsetIOSCharset_encodings putWithId:info.name withId:cs];\n+    ComGoogleJ2objcNioCharsetIOSCharset *cs = [[[ComGoogleJ2objcNioCharsetIOSCharset alloc]\n+                                                initWithLong:info.encoding\n+                                                withNSString:info.name\n+                                           withNSStringArray:aliases\n+                                                   withFloat:info.charBytes] autorelease];\n+    [ComGoogleJ2objcNioCharsetIOSCharset_encodings putWithId:info.name withId:cs];\n     return cs;\n   }\n   ]-*/\n@@ -183,7 +186,7 @@ class IOSCharset extends Charset {\n     NSString *fileEncoding = JavaLangSystem_getPropertyWithNSString_(@\"file.encoding\");\n     if (fileEncoding) {\n       @try {\n-        return (JavaNioCharsetIOSCharset *)\n+        return (ComGoogleJ2objcNioCharsetIOSCharset *)\n             JavaNioCharsetCharset_forNameUEEWithNSString_(fileEncoding);\n       }\n       @catch (JavaIoUnsupportedEncodingException *e) {\n@@ -194,8 +197,6 @@ class IOSCharset extends Charset {\n     return addEncoding(iosCharsets[0]);\n   ]-*/;\n \n-  static final IOSCharset DEFAULT_CHARSET = getDefaultCharset();\n-\n   private static native Map<String, IOSCharset> getEncodings() /*-[\n     static dispatch_once_t onceToken;\n     dispatch_once(&onceToken, ^{\n@@ -203,6 +204,6 @@ class IOSCharset extends Charset {\n         addEncoding(iosCharsets[i]);\n       }\n     });\n-    return JavaNioCharsetIOSCharset_encodings;\n+    return ComGoogleJ2objcNioCharsetIOSCharset_encodings;\n   ]-*/;\n }\ndiff --git a/jre_emul/android/libcore/luni/src/main/java/java/nio/charset/IOSCharsetDecoder.java b/jre_emul/Classes/com/google/j2objc/nio/charset/IOSCharsetDecoder.java\nsimilarity index 94%\nrename from jre_emul/android/libcore/luni/src/main/java/java/nio/charset/IOSCharsetDecoder.java\nrename to jre_emul/Classes/com/google/j2objc/nio/charset/IOSCharsetDecoder.java\nindex 500fe72fd..83cff0edf 100644\n--- a/jre_emul/android/libcore/luni/src/main/java/java/nio/charset/IOSCharsetDecoder.java\n+++ b/jre_emul/Classes/com/google/j2objc/nio/charset/IOSCharsetDecoder.java\n@@ -15,10 +15,14 @@\n  *  limitations under the License.\n  */\n \n-package java.nio.charset;\n+package com.google.j2objc.nio.charset;\n \n import java.nio.ByteBuffer;\n import java.nio.CharBuffer;\n+import java.nio.charset.Charset;\n+import java.nio.charset.CharsetDecoder;\n+import java.nio.charset.CoderResult;\n+import java.nio.charset.UnsupportedCharsetException;\n \n /**\n  * iOS native charset decoder.\n@@ -59,12 +63,6 @@ public class IOSCharsetDecoder extends CharsetDecoder {\n     return CoderResult.UNDERFLOW;  // All input data was decoded.\n   }\n \n-  @Override\n-  public CharBuffer decode(ByteBuffer in) throws CharacterCodingException {\n-    String s = decodeImpl(in);\n-    return CharBuffer.wrap(s);\n-  }\n-\n   private String decodeImpl(ByteBuffer in) {\n     Charset cs = charset();\n     if (!(cs instanceof IOSCharset)) {\ndiff --git a/jre_emul/android/libcore/luni/src/main/java/java/nio/charset/IOSCharsetEncoder.java b/jre_emul/Classes/com/google/j2objc/nio/charset/IOSCharsetEncoder.java\nsimilarity index 94%\nrename from jre_emul/android/libcore/luni/src/main/java/java/nio/charset/IOSCharsetEncoder.java\nrename to jre_emul/Classes/com/google/j2objc/nio/charset/IOSCharsetEncoder.java\nindex e93658f71..d6ee39159 100644\n--- a/jre_emul/android/libcore/luni/src/main/java/java/nio/charset/IOSCharsetEncoder.java\n+++ b/jre_emul/Classes/com/google/j2objc/nio/charset/IOSCharsetEncoder.java\n@@ -15,10 +15,14 @@\n  *  limitations under the License.\n  */\n \n-package java.nio.charset;\n+package com.google.j2objc.nio.charset;\n \n import java.nio.ByteBuffer;\n import java.nio.CharBuffer;\n+import java.nio.charset.Charset;\n+import java.nio.charset.CharsetEncoder;\n+import java.nio.charset.CoderResult;\n+import java.nio.charset.UnsupportedCharsetException;\n \n /**\n  * iOS native charset encoder.\n@@ -34,11 +38,6 @@ public class IOSCharsetEncoder extends CharsetEncoder {\n     super(charset, maxBytesPerChar, maxBytesPerChar, new byte[] { (byte) '?' });\n   }\n \n-  @Override\n-  public ByteBuffer encode(CharBuffer in) throws CharacterCodingException {\n-    return ByteBuffer.wrap(encodeImpl(in));\n-  }\n-\n   @Override\n   protected CoderResult encodeLoop(CharBuffer in, ByteBuffer out) {\n     if (byteBuffer != null) {\ndiff --git a/jre_emul/android/libcore/luni/src/main/java/java/nio/charset/Charset.java b/jre_emul/android/libcore/luni/src/main/java/java/nio/charset/Charset.java\nindex 0cf85df35..79f0249fc 100644\n--- a/jre_emul/android/libcore/luni/src/main/java/java/nio/charset/Charset.java\n+++ b/jre_emul/android/libcore/luni/src/main/java/java/nio/charset/Charset.java\n@@ -17,6 +17,7 @@\n \n package java.nio.charset;\n \n+import com.google.j2objc.nio.charset.IOSCharset;\n import java.io.UnsupportedEncodingException;\n import java.nio.ByteBuffer;\n import java.nio.CharBuffer;\ndiff --git a/jre_emul/android/libcore/luni/src/main/java/java/nio/charset/CharsetEncoder.java b/jre_emul/android/libcore/luni/src/main/java/java/nio/charset/CharsetEncoder.java\ndeleted file mode 100644\nindex 43af79bf9..000000000\n--- a/jre_emul/android/libcore/luni/src/main/java/java/nio/charset/CharsetEncoder.java\n+++ /dev/null\n@@ -1,502 +0,0 @@\n-/* Licensed to the Apache Software Foundation (ASF) under one or more\n- * contributor license agreements.  See the NOTICE file distributed with\n- * this work for additional information regarding copyright ownership.\n- * The ASF licenses this file to You under the Apache License, Version 2.0\n- * (the \"License\"); you may not use this file except in compliance with\n- * the License.  You may obtain a copy of the License at\n- *\n- *     http://www.apache.org/licenses/LICENSE-2.0\n- *\n- * Unless required by applicable law or agreed to in writing, software\n- * distributed under the License is distributed on an \"AS IS\" BASIS,\n- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n- * See the License for the specific language governing permissions and\n- * limitations under the License.\n- */\n-\n-package java.nio.charset;\n-\n-import java.nio.BufferOverflowException;\n-import java.nio.BufferUnderflowException;\n-import java.nio.ByteBuffer;\n-import java.nio.CharBuffer;\n-\n-/**\n- * Transforms a sequence of 16-bit Java characters to a byte sequence in some encoding.\n- *\n- * <p>The input character sequence is a {@link java.nio.CharBuffer CharBuffer} and the\n- * output byte sequence is a {@link java.nio.ByteBuffer ByteBuffer}.\n- *\n- * <p>Use {@link #encode(CharBuffer)} to encode an entire {@code CharBuffer} to a\n- * new {@code ByteBuffer}, or {@link #encode(CharBuffer, ByteBuffer, boolean)} for more\n- * control. When using the latter method, the entire operation proceeds as follows:\n- * <ol>\n- * <li>Invoke {@link #reset()} to reset the encoder if this instance has been used before.</li>\n- * <li>Invoke {@link #encode(CharBuffer, ByteBuffer, boolean) encode} with the {@code endOfInput}\n- * parameter set to false until additional input is not needed (as signaled by the return value).\n- * The input buffer must be filled and the output buffer must be flushed between invocations.\n- * <p>The {@link #encode(CharBuffer, ByteBuffer, boolean) encode} method will\n- * convert as many characters as possible, and the process won't stop until the\n- * input buffer has been exhausted, the output buffer has been filled, or an\n- * error has occurred. A {@link CoderResult CoderResult} instance will be\n- * returned to indicate the current state. The caller should fill the input buffer, flush\n- * the output buffer, or recovering from an error and try again, accordingly.\n- * </li>\n- * <li>Invoke {@link #encode(CharBuffer, ByteBuffer, boolean) encode} for the last time with\n- * {@code endOfInput} set to true.</li>\n- * <li>Invoke {@link #flush(ByteBuffer)} to flush remaining output.</li>\n- * </ol>\n- *\n- * <p>There are two classes of encoding error: <i>malformed input</i>\n- * signifies that the input character sequence is not legal, while <i>unmappable character</i>\n- * signifies that the input is legal but cannot be mapped to a byte sequence (because the charset\n- * cannot represent the character, for example).\n- *\n- * <p>Errors can be handled in three ways. The default is to\n- * {@link CodingErrorAction#REPORT report} the error to the caller. The alternatives are to\n- * {@link CodingErrorAction#IGNORE ignore} the error or {@link CodingErrorAction#REPLACE replace}\n- * the problematic input with the byte sequence returned by {@link #replacement}. The disposition\n- * for each of the two kinds of error can be set independently using the {@link #onMalformedInput}\n- * and {@link #onUnmappableCharacter} methods.\n- *\n- * <p>The default replacement bytes depend on the charset but can be overridden using the\n- * {@link #replaceWith} method.\n- *\n- * <p>This class is abstract and encapsulates many common operations of the\n- * encoding process for all charsets. Encoders for a specific charset should\n- * extend this class and need only to implement the\n- * {@link #encodeLoop(CharBuffer, ByteBuffer) encodeLoop} method for basic\n- * encoding.\n- *\n- * <p>This class is not thread-safe.\n- *\n- * @see java.nio.charset.Charset\n- * @see java.nio.charset.CharsetDecoder\n- */\n-public abstract class CharsetEncoder {\n-    private static final int READY = 0;\n-    private static final int ONGOING = 1;\n-    private static final int END = 2;\n-    private static final int FLUSH = 3;\n-    private static final int INIT = 4;\n-\n-    private final Charset cs;\n-\n-    private final float averageBytesPerChar;\n-    private final float maxBytesPerChar;\n-\n-    private byte[] replacementBytes;\n-\n-    private int status;\n-    // internal status indicates encode(CharBuffer) operation is finished\n-    private boolean finished;\n-\n-    private CodingErrorAction malformedInputAction;\n-    private CodingErrorAction unmappableCharacterAction;\n-\n-    // decoder instance for this encoder's charset, used for replacement value checking\n-    private CharsetDecoder decoder;\n-\n-    /**\n-     * Constructs a new {@code CharsetEncoder} using the given parameters and\n-     * the replacement byte array {@code { (byte) '?' }}.\n-     */\n-    protected CharsetEncoder(Charset cs, float averageBytesPerChar, float maxBytesPerChar) {\n-        this(cs, averageBytesPerChar, maxBytesPerChar, new byte[] { (byte) '?' });\n-    }\n-\n-    /**\n-     * Constructs a new <code>CharsetEncoder</code> using the given\n-     * <code>Charset</code>, replacement byte array, average number and\n-     * maximum number of bytes created by this encoder for one input character.\n-     *\n-     * @param cs\n-     *            the <code>Charset</code> to be used by this encoder.\n-     * @param averageBytesPerChar\n-     *            average number of bytes created by this encoder for one single\n-     *            input character, must be positive.\n-     * @param maxBytesPerChar\n-     *            maximum number of bytes which can be created by this encoder\n-     *            for one single input character, must be positive.\n-     * @param replacement\n-     *            the replacement byte array, cannot be null or empty, its\n-     *            length cannot be larger than <code>maxBytesPerChar</code>,\n-     *            and must be a legal replacement.\n-     * @throws IllegalArgumentException\n-     *             if any parameters are invalid.\n-     */\n-    protected CharsetEncoder(Charset cs, float averageBytesPerChar, float maxBytesPerChar, byte[] replacement) {\n-        if (averageBytesPerChar <= 0 || maxBytesPerChar <= 0) {\n-            throw new IllegalArgumentException(\"averageBytesPerChar and maxBytesPerChar must both be positive\");\n-        }\n-        if (averageBytesPerChar > maxBytesPerChar) {\n-            throw new IllegalArgumentException(\"averageBytesPerChar is greater than maxBytesPerChar\");\n-        }\n-        this.cs = cs;\n-        this.averageBytesPerChar = averageBytesPerChar;\n-        this.maxBytesPerChar = maxBytesPerChar;\n-        status = INIT;\n-        malformedInputAction = CodingErrorAction.REPORT;\n-        unmappableCharacterAction = CodingErrorAction.REPORT;\n-        this.replacementBytes = replacement;\n-    }\n-\n-    /**\n-     * Returns the average number of bytes created by this encoder for a single\n-     * input character.\n-     */\n-    public final float averageBytesPerChar() {\n-        return averageBytesPerChar;\n-    }\n-\n-    /**\n-     * Checks if the given character can be encoded by this encoder.\n-     * <p>\n-     * Note that this method can change the internal status of this encoder, so\n-     * it should not be called when another encoding process is ongoing,\n-     * otherwise it will throw an <code>IllegalStateException</code>.\n-     * <p>\n-     * This method can be overridden for performance improvement.\n-     *\n-     * @param c\n-     *            the given encoder.\n-     * @return true if given character can be encoded by this encoder.\n-     * @throws IllegalStateException\n-     *             if another encode process is ongoing so that the current\n-     *             internal status is neither RESET or FLUSH.\n-     */\n-    public boolean canEncode(char c) {\n-        return implCanEncode(CharBuffer.wrap(new char[] { c }));\n-    }\n-\n-    // implementation of canEncode\n-    private boolean implCanEncode(CharBuffer cb) {\n-        if (status == FLUSH || status == INIT) {\n-            status = READY;\n-        }\n-        if (status != READY) {\n-            throw new IllegalStateException(\"encoding already in progress\");\n-        }\n-        CodingErrorAction malformBak = malformedInputAction;\n-        CodingErrorAction unmapBak = unmappableCharacterAction;\n-        onMalformedInput(CodingErrorAction.REPORT);\n-        onUnmappableCharacter(CodingErrorAction.REPORT);\n-        boolean result = true;\n-        try {\n-            this.encode(cb);\n-        } catch (CharacterCodingException e) {\n-            result = false;\n-        }\n-        onMalformedInput(malformBak);\n-        onUnmappableCharacter(unmapBak);\n-        reset();\n-        return result;\n-    }\n-\n-    /**\n-     * Checks if a given <code>CharSequence</code> can be encoded by this\n-     * encoder.\n-     *\n-     * Note that this method can change the internal status of this encoder, so\n-     * it should not be called when another encode process is ongoing, otherwise\n-     * it will throw an <code>IllegalStateException</code>.\n-     *\n-     * This method can be overridden for performance improvement.\n-     *\n-     * @param sequence\n-     *            the given <code>CharSequence</code>.\n-     * @return true if the given <code>CharSequence</code> can be encoded by\n-     *         this encoder.\n-     * @throws IllegalStateException\n-     *             if current internal status is neither RESET or FLUSH.\n-     */\n-    public boolean canEncode(CharSequence sequence) {\n-        CharBuffer cb;\n-        if (sequence instanceof CharBuffer) {\n-            cb = ((CharBuffer) sequence).duplicate();\n-        } else {\n-            cb = CharBuffer.wrap(sequence);\n-        }\n-        return implCanEncode(cb);\n-    }\n-\n-    /**\n-     * Returns the {@link Charset} which this encoder uses.\n-     */\n-    public final Charset charset() {\n-        return cs;\n-    }\n-\n-    /**\n-     * This is a facade method for the encoding operation.\n-     * <p>\n-     * This method encodes the remaining character sequence of the given\n-     * character buffer into a new byte buffer. This method performs a complete\n-     * encoding operation, resets at first, then encodes, and flushes at last.\n-     * <p>\n-     * This method should not be invoked if another encode operation is ongoing.\n-     *\n-     * @param in\n-     *            the input buffer.\n-     * @return a new <code>ByteBuffer</code> containing the bytes produced by\n-     *         this encoding operation. The buffer's limit will be the position\n-     *         of the last byte in the buffer, and the position will be zero.\n-     * @throws IllegalStateException\n-     *             if another encoding operation is ongoing.\n-     * @throws MalformedInputException\n-     *             if an illegal input character sequence for this charset is\n-     *             encountered, and the action for malformed error is\n-     *             {@link CodingErrorAction#REPORT CodingErrorAction.REPORT}\n-     * @throws UnmappableCharacterException\n-     *             if a legal but unmappable input character sequence for this\n-     *             charset is encountered, and the action for unmappable\n-     *             character error is\n-     *             {@link CodingErrorAction#REPORT CodingErrorAction.REPORT}.\n-     *             Unmappable means the Unicode character sequence at the input\n-     *             buffer's current position cannot be mapped to a equivalent\n-     *             byte sequence.\n-     * @throws CharacterCodingException\n-     *             if other exception happened during the encode operation.\n-     */\n-    public abstract ByteBuffer encode(CharBuffer in) throws CharacterCodingException;\n-\n-    /**\n-     * Encodes characters starting at the current position of the given input\n-     * buffer, and writes the equivalent byte sequence into the given output\n-     * buffer from its current position.\n-     * <p>\n-     * The buffers' position will be changed with the reading and writing\n-     * operation, but their limits and marks will be kept intact.\n-     * <p>\n-     * A <code>CoderResult</code> instance will be returned according to\n-     * following rules:\n-     * <ul>\n-     * <li>A {@link CoderResult#malformedForLength(int) malformed input} result\n-     * indicates that some malformed input error was encountered, and the\n-     * erroneous characters start at the input buffer's position and their\n-     * number can be got by result's {@link CoderResult#length() length}. This\n-     * kind of result can be returned only if the malformed action is\n-     * {@link CodingErrorAction#REPORT CodingErrorAction.REPORT}.</li>\n-     * <li>{@link CoderResult#UNDERFLOW CoderResult.UNDERFLOW} indicates that\n-     * as many characters as possible in the input buffer have been encoded. If\n-     * there is no further input and no characters left in the input buffer then\n-     * this task is complete. If this is not the case then the client should\n-     * call this method again supplying some more input characters.</li>\n-   ",
    "suppress click event following a drag": "diff --git a/src/gwt/src/org/rstudio/core/client/events/MouseDragHandler.java b/src/gwt/src/org/rstudio/core/client/events/MouseDragHandler.java\nindex 201648ba44..892cddcbf6 100644\n--- a/src/gwt/src/org/rstudio/core/client/events/MouseDragHandler.java\n+++ b/src/gwt/src/org/rstudio/core/client/events/MouseDragHandler.java\n@@ -107,12 +107,17 @@ public abstract class MouseDragHandler\n    \n    private void beginDragImpl(MouseDownEvent event)\n    {\n+      didDrag_ = false;\n+      \n       initialCoordinates_ = lastCoordinates_ =\n             MouseCoordinates.fromEvent(event);\n       \n       if (dragListener_ != null)\n          dragListener_.removeHandler();\n       \n+      if (clickSuppressor_ != null)\n+         clickSuppressor_.removeHandler();\n+      \n       dragListener_ = Event.addNativePreviewHandler(new NativePreviewHandler()\n       {\n          @Override\n@@ -121,6 +126,7 @@ public abstract class MouseDragHandler\n             int type = npe.getTypeInt();\n             if (type == Event.ONMOUSEMOVE)\n             {\n+               didDrag_ = true;\n                MouseDragEvent event = new MouseDragEvent(\n                      npe.getNativeEvent(),\n                      getInitialMouseCoordinates(),\n@@ -129,6 +135,8 @@ public abstract class MouseDragHandler\n             }\n             else if (type == Event.ONMOUSEUP)\n             {\n+               if (didDrag_)\n+                  addClickSuppressor();\n                endDragImpl();\n             }\n",
    "Decrease memory churn of input based rule keys .": "diff --git a/src/com/facebook/buck/rules/keys/InputBasedRuleKeyBuilderFactory.java b/src/com/facebook/buck/rules/keys/InputBasedRuleKeyBuilderFactory.java\nindex 686f8694ff..9c46e2536d 100644\n--- a/src/com/facebook/buck/rules/keys/InputBasedRuleKeyBuilderFactory.java\n+++ b/src/com/facebook/buck/rules/keys/InputBasedRuleKeyBuilderFactory.java\n@@ -29,9 +29,12 @@ import com.google.common.base.Throwables;\n import com.google.common.cache.CacheBuilder;\n import com.google.common.cache.CacheLoader;\n import com.google.common.cache.LoadingCache;\n+import com.google.common.collect.ImmutableList;\n import com.google.common.collect.ImmutableSet;\n+import com.google.common.collect.Iterables;\n \n import java.io.IOException;\n+import java.util.Collections;\n \n import javax.annotation.Nonnull;\n \n@@ -88,7 +91,9 @@ public class InputBasedRuleKeyBuilderFactory\n       @Override\n       public RuleKey build() {\n         Result result = buildResult();\n-        Preconditions.checkState(rule.getDeps().containsAll(result.getDeps()));\n+        for (BuildRule usedDep : result.getDeps()) {\n+          Preconditions.checkState(rule.getDeps().contains(usedDep));\n+        }\n         return result.getRuleKey();\n       }\n \n@@ -97,8 +102,8 @@ public class InputBasedRuleKeyBuilderFactory\n \n   public class Builder extends RuleKeyBuilder {\n \n-    private final ImmutableSet.Builder<BuildRule> deps = ImmutableSet.builder();\n-    private final ImmutableSet.Builder<SourcePath> inputs = ImmutableSet.builder();\n+    private final ImmutableList.Builder<Iterable<BuildRule>> deps = ImmutableList.builder();\n+    private final ImmutableList.Builder<Iterable<SourcePath>> inputs = ImmutableList.builder();\n \n     private Builder() {\n       super(pathResolver, fileHashCache, defaultRuleKeyBuilderFactory);\n@@ -110,8 +115,8 @@ public class InputBasedRuleKeyBuilderFactory\n         FileHashCache hashCache,\n         RuleKeyAppendable appendable) {\n       Result result = cache.getUnchecked(appendable);\n-      deps.addAll(result.getDeps());\n-      inputs.addAll(result.getInputs());\n+      deps.add(result.getDeps());\n+      inputs.add(result.getInputs());\n       return result.getRuleKey();\n     }\n \n@@ -121,7 +126,7 @@ public class InputBasedRuleKeyBuilderFactory\n     @Override\n     protected RuleKeyBuilder setSourcePath(SourcePath sourcePath) {\n       if (inputHandling == InputHandling.HASH) {\n-        deps.addAll(pathResolver.getRule(sourcePath).asSet());\n+        deps.add(pathResolver.getRule(sourcePath).asSet());\n \n         try {\n           setPath(\n@@ -131,7 +136,7 @@ public class InputBasedRuleKeyBuilderFactory\n           throw Throwables.propagate(e);\n         }\n       }\n-      inputs.add(sourcePath);\n+      inputs.add(Collections.singleton(sourcePath));\n       return this;\n     }\n \n@@ -148,12 +153,15 @@ public class InputBasedRuleKeyBuilderFactory\n     }\n \n     protected ImmutableSet<SourcePath> getInputsSoFar() {\n-      return inputs.build();\n+      return ImmutableSet.copyOf(Iterables.concat(inputs.build()));\n     }\n \n     // Build the rule key and the list of deps found from this builder.\n     protected Result buildResult() {\n-      return new Result(super.build(), deps.build(), inputs.build());\n+      return new Result(\n+          super.build(),\n+          Iterables.concat(deps.build()),\n+          Iterables.concat(inputs.build()));\n     }\n \n   }\n@@ -179,13 +187,13 @@ public class InputBasedRuleKeyBuilderFactory\n   protected static class Result {\n \n     private final RuleKey ruleKey;\n-    private final ImmutableSet<BuildRule> deps;\n-    private final ImmutableSet<SourcePath> inputs;\n+    private final Iterable<BuildRule> deps;\n+    private final Iterable<SourcePath> inputs;\n \n     public Result(\n         RuleKey ruleKey,\n-        ImmutableSet<BuildRule> deps,\n-        ImmutableSet<SourcePath> inputs) {\n+        Iterable<BuildRule> deps,\n+        Iterable<SourcePath> inputs) {\n       this.ruleKey = ruleKey;\n       this.deps = deps;\n       this.inputs = inputs;\n@@ -195,11 +203,11 @@ public class InputBasedRuleKeyBuilderFactory\n       return ruleKey;\n     }\n \n-    public ImmutableSet<BuildRule> getDeps() {\n+    public Iterable<BuildRule> getDeps() {\n       return deps;\n     }\n \n-    public ImmutableSet<SourcePath> getInputs() {\n+    public Iterable<SourcePath> getInputs() {\n       return inputs;\n     }\n ",
    "Add pods to npmignore": "diff --git a/cli/.npmignore b/cli/.npmignore\nindex 0c751687..d49e9040 100644\n--- a/cli/.npmignore\n+++ b/cli/.npmignore\n@@ -4,4 +4,5 @@ assets/android-template/app/build/*\n assets/android-template/.idea\n assets/android-template/.gradle\n Podfile.lock\n+Pods/\n *.iml\n\\ No newline at end of file",
    "update JNLP gui discussion for LaunchAppropriateUI .": "diff --git a/findbugs/src/doc/demo.html b/findbugs/src/doc/demo.html\nindex d1e02f0a8..eba7b4591 100644\n--- a/findbugs/src/doc/demo.html\n+++ b/findbugs/src/doc/demo.html\n@@ -17,10 +17,10 @@ FindBugs 1.1 demo and results\n </h1>\n \n <p>If you just want to try running FindBugs against your\n-own code, you can run using Java Webstart using either our \n-<a href=\"http://findbugs.cs.umd.edu/demo/jnlp/findbugs.jnlp\">old gui</a> \n-or our <a href=\"http://findbugs.cs.umd.edu/demo/jnlp/gui2.jnlp\">new gui (requires Java 1.5+)</a>.\n-The new gui provides a number of new features, but hasn't received as much testing and requires Java 1.5+. \n+own code, you can\n+<a href=\"http://findbugs.cs.umd.edu/demo/jnlp/findbugs.jnlp\">run FindBugs</a> using Java Webstart.\n+This will use our new gui under Java 1.5+ and our old gui under Java 1.4.\n+The new gui provides a number of new features, but hasn't received as much testing as the old one and it requires Java 1.5+.\n Both use exactly the same analysis engine.\n \n </p><p>This web page provides results of running FindBugs 1.1.0",
    "Resolve ListsWithSelects to SelectorList at construction of UnconfiguredTargetNode .": "diff --git a/src/com/facebook/buck/cli/BUCK b/src/com/facebook/buck/cli/BUCK\nindex 7799a98765..27cd200466 100644\n--- a/src/com/facebook/buck/cli/BUCK\n+++ b/src/com/facebook/buck/cli/BUCK\n@@ -77,6 +77,7 @@ java_immutables_library(\n         \"//src/com/facebook/buck/core/rules/knowntypes:knowntypes\",\n         \"//src/com/facebook/buck/core/rules/knowntypes/provider:provider\",\n         \"//src/com/facebook/buck/core/rules/transformer/impl:impl\",\n+        \"//src/com/facebook/buck/core/select/impl:impl\",\n         \"//src/com/facebook/buck/core/sourcepath/resolver/impl:impl\",\n         \"//src/com/facebook/buck/core/test/event:event\",\n         \"//src/com/facebook/buck/core/test/rule:rule\",\ndiff --git a/src/com/facebook/buck/cli/GraphEngineFactory.java b/src/com/facebook/buck/cli/GraphEngineFactory.java\nindex c70333e255..c2114a48db 100644\n--- a/src/com/facebook/buck/cli/GraphEngineFactory.java\n+++ b/src/com/facebook/buck/cli/GraphEngineFactory.java\n@@ -38,6 +38,8 @@ import com.facebook.buck.core.parser.BuildTargetPatternToBuildPackagePathKey;\n import com.facebook.buck.core.select.SelectableConfigurationContext;\n import com.facebook.buck.core.select.SelectorList;\n import com.facebook.buck.core.select.SelectorListResolver;\n+import com.facebook.buck.core.select.impl.SelectorFactory;\n+import com.facebook.buck.core.select.impl.SelectorListFactory;\n import com.facebook.buck.parser.BuiltTargetVerifier;\n import com.facebook.buck.parser.DefaultProjectBuildFileParserFactory;\n import com.facebook.buck.parser.DefaultUnconfiguredTargetNodeFactory;\n@@ -138,7 +140,11 @@ public class GraphEngineFactory {\n     // COMPUTATION: Unconfigured build target to raw target node computation\n     DefaultUnconfiguredTargetNodeFactory rawTargetNodeFactory =\n         new DefaultUnconfiguredTargetNodeFactory(\n-            params.getKnownRuleTypesProvider(), new BuiltTargetVerifier());\n+            params.getKnownRuleTypesProvider(),\n+            new BuiltTargetVerifier(),\n+            cell.getCellPathResolver(),\n+            new SelectorListFactory(\n+                new SelectorFactory(params.getUnconfiguredBuildTargetFactory())));\n \n     BuildTargetToUnconfiguredTargetNodeComputation buildTargetToUnconfiguredTargetNodeComputation =\n         BuildTargetToUnconfiguredTargetNodeComputation.of(rawTargetNodeFactory, cell);\ndiff --git a/src/com/facebook/buck/core/model/ErrorTargetConfiguration.java b/src/com/facebook/buck/core/model/ErrorTargetConfiguration.java\nnew file mode 100644\nindex 0000000000..e010fa6f5b\n--- /dev/null\n+++ b/src/com/facebook/buck/core/model/ErrorTargetConfiguration.java\n@@ -0,0 +1,45 @@\n+/*\n+ * Copyright 2019-present Facebook, Inc.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may\n+ * not use this file except in compliance with the License. You may obtain\n+ * a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n+ * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n+ * License for the specific language governing permissions and limitations\n+ * under the License.\n+ */\n+package com.facebook.buck.core.model;\n+\n+import com.fasterxml.jackson.annotation.JsonIgnore;\n+import java.util.Objects;\n+import java.util.Optional;\n+\n+/** Stub configuration which can be used when configuration is not actually needed. */\n+public class ErrorTargetConfiguration implements TargetConfiguration {\n+  public static final ErrorTargetConfiguration INSTANCE = new ErrorTargetConfiguration();\n+\n+  private final int hashCode = Objects.hash(ErrorTargetConfiguration.class.getName());\n+\n+  private ErrorTargetConfiguration() {}\n+\n+  @Override\n+  public int hashCode() {\n+    return hashCode;\n+  }\n+\n+  @Override\n+  public boolean equals(Object obj) {\n+    return obj instanceof ErrorTargetConfiguration;\n+  }\n+\n+  @JsonIgnore\n+  @Override\n+  public Optional<BuildTarget> getConfigurationTarget() {\n+    return Optional.empty();\n+  }\n+}\ndiff --git a/src/com/facebook/buck/core/select/Selector.java b/src/com/facebook/buck/core/select/Selector.java\nindex 013039902e..6c93c987a3 100644\n--- a/src/com/facebook/buck/core/select/Selector.java\n+++ b/src/com/facebook/buck/core/select/Selector.java\n@@ -18,6 +18,8 @@ package com.facebook.buck.core.select;\n \n import com.google.common.collect.ImmutableMap;\n import com.google.common.collect.ImmutableSet;\n+import java.util.Map;\n+import java.util.Objects;\n import javax.annotation.Nullable;\n \n /**\n@@ -42,6 +44,10 @@ public class Selector<T> {\n     this.noMatchMessage = noMatchMessage;\n   }\n \n+  public static <T> Selector<T> onlyDefault(T element) {\n+    return new Selector<>(ImmutableMap.of(SelectorKey.DEFAULT, element), ImmutableSet.of(), \"\");\n+  }\n+\n   public ImmutableMap<SelectorKey, T> getConditions() {\n     return conditions;\n   }\n@@ -73,4 +79,60 @@ public class Selector<T> {\n   public String getNoMatchMessage() {\n     return noMatchMessage;\n   }\n+\n+  @Override\n+  public boolean equals(Object o) {\n+    if (this == o) {\n+      return true;\n+    }\n+    if (o == null || getClass() != o.getClass()) {\n+      return false;\n+    }\n+    Selector<?> selector = (Selector<?>) o;\n+    return conditions.equals(selector.conditions)\n+        && nullConditions.equals(selector.nullConditions)\n+        && noMatchMessage.equals(selector.noMatchMessage);\n+  }\n+\n+  @Override\n+  public int hashCode() {\n+    return Objects.hash(conditions, nullConditions, noMatchMessage);\n+  }\n+\n+  @Override\n+  public String toString() {\n+    StringBuilder sb = new StringBuilder();\n+    sb.append(\"select({\");\n+    boolean first = true;\n+\n+    for (Map.Entry<SelectorKey, T> entry : conditions.entrySet()) {\n+      if (!first) {\n+        sb.append(\", \");\n+      }\n+      first = false;\n+      sb.append('\"').append(entry.getKey()).append('\"');\n+      sb.append(\": \");\n+      sb.append(entry.getValue());\n+    }\n+\n+    for (SelectorKey entry : nullConditions) {\n+      if (!first) {\n+        sb.append(\", \");\n+      }\n+      first = false;\n+      sb.append('\"').append(entry).append('\"');\n+      sb.append(\": \");\n+      sb.append(\"None\");\n+    }\n+\n+    sb.append(\"}\");\n+    if (noMatchMessage != null) {\n+      sb.append(\", no_match_message=\");\n+      sb.append('\"').append(noMatchMessage).append('\"');\n+    }\n+\n+    sb.append(\")\");\n+\n+    return sb.toString();\n+  }\n }\ndiff --git a/src/com/facebook/buck/core/select/SelectorKey.java b/src/com/facebook/buck/core/select/SelectorKey.java\nindex cc5e4e434b..16d62fa3c7 100644\n--- a/src/com/facebook/buck/core/select/SelectorKey.java\n+++ b/src/com/facebook/buck/core/select/SelectorKey.java\n@@ -59,4 +59,21 @@ public class SelectorKey {\n   public String toString() {\n     return buildTarget == null ? DEFAULT_KEYWORD : buildTarget.getFullyQualifiedName();\n   }\n+\n+  @Override\n+  public boolean equals(Object o) {\n+    if (this == o) {\n+      return true;\n+    }\n+    if (o == null || getClass() != o.getClass()) {\n+      return false;\n+    }\n+    SelectorKey that = (SelectorKey) o;\n+    return Objects.equals(buildTarget, that.buildTarget);\n+  }\n+\n+  @Override\n+  public int hashCode() {\n+    return Objects.hash(buildTarget);\n+  }\n }\ndiff --git a/src/com/facebook/buck/core/select/SelectorList.java b/src/com/facebook/buck/core/select/SelectorList.java\nindex ea3becc15f..d0e6b62179 100644\n--- a/src/com/facebook/buck/core/select/SelectorList.java\n+++ b/src/com/facebook/buck/core/select/SelectorList.java\n@@ -18,6 +18,7 @@ package com.facebook.buck.core.select;\n \n import com.facebook.buck.rules.coercer.concat.Concatable;\n import com.google.common.collect.ImmutableList;\n+import java.util.Objects;\n \n /**\n  * Represents a list of {@link Selector} objects\n@@ -62,4 +63,32 @@ public final class SelectorList<T> {\n   public Concatable<T> getConcatable() {\n     return elementTypeConcatable;\n   }\n+\n+  @Override\n+  public boolean equals(Object o) {\n+    if (this == o) {\n+      return true;\n+    }\n+    if (o == null || getClass() != o.getClass()) {\n+      return false;\n+    }\n+    SelectorList<?> that = (SelectorList<?>) o;\n+    return elementTypeConcatable.equals(that.elementTypeConcatable)\n+        && selectors.equals(that.selectors);\n+  }\n+\n+  @Override\n+  public int hashCode() {\n+    return Objects.hash(elementTypeConcatable, selectors);\n+  }\n+\n+  @Override\n+  public String toString() {\n+    return \"SelectorList{\"\n+        + \"elementTypeConcatable=\"\n+        + elementTypeConcatable\n+        + \", selectors=\"\n+        + selectors\n+        + '}';\n+  }\n }\ndiff --git a/src/com/facebook/buck/core/select/impl/BUCK b/src/com/facebook/buck/core/select/impl/BUCK\nindex 5067ed2b00..9bb2dfba13 100644\n--- a/src/com/facebook/buck/core/select/impl/BUCK\n+++ b/src/com/facebook/buck/core/select/impl/BUCK\n@@ -12,6 +12,7 @@ java_library(\n     deps = [\n         \"//src/com/facebook/buck/parser/api:api\",\n         \"//src/com/facebook/buck/parser/syntax:syntax\",\n+        \"//src/com/facebook/buck/rules/coercer:coercer\",\n         \"//third-party/java/bazel:bazel\",\n         \"//third-party/java/jsr:jsr305\",\n     ],\ndiff --git a/src/com/facebook/buck/core/select/impl/SelectorFactory.java b/src/com/facebook/buck/core/select/impl/SelectorFactory.java\nindex 83d54209dc..351a2c77f5 100644\n--- a/src/com/facebook/buck/core/select/impl/SelectorFactory.java\n+++ b/src/com/facebook/buck/core/select/impl/SelectorFactory.java\n@@ -18,13 +18,9 @@ package com.facebook.buck.core.select.impl;\n \n import com.facebook.buck.core.cell.CellPathResolver;\n import com.facebook.buck.core.model.ConfigurationBuildTargets;\n-import com.facebook.buck.core.model.TargetConfiguration;\n import com.facebook.buck.core.parser.buildtargetparser.UnconfiguredBuildTargetViewFactory;\n import com.facebook.buck.core.select.Selector;\n import com.facebook.buck.core.select.SelectorKey;\n-import com.facebook.buck.io.filesystem.ProjectFilesystem;\n-import com.facebook.buck.rules.coercer.CoerceFailedException;\n-import com.facebook.buck.rules.coercer.TypeCoercer;\n import com.google.common.collect.ImmutableMap;\n import com.google.common.collect.ImmutableSet;\n import com.google.common.collect.Maps;\n@@ -46,22 +42,11 @@ public class SelectorFactory {\n   }\n \n   /** Creates a new Selector using the default error message when no conditions match. */\n-  public <T> Selector<T> createSelector(\n+  public Selector<Object> createSelector(\n       CellPathResolver cellPathResolver,\n-      ProjectFilesystem filesystem,\n       Path pathRelativeToProjectRoot,\n-      TargetConfiguration targetConfiguration,\n-      Map<String, ?> rawAttributes,\n-      TypeCoercer<T> elementTypeCoercer)\n-      throws CoerceFailedException {\n-    return createSelector(\n-        cellPathResolver,\n-        filesystem,\n-        pathRelativeToProjectRoot,\n-        targetConfiguration,\n-        rawAttributes,\n-        elementTypeCoercer,\n-        \"\");\n+      Map<String, ?> rawAttributes) {\n+    return createSelector(cellPathResolver, pathRelativeToProjectRoot, rawAttributes, \"\");\n   }\n \n   /**\n@@ -69,18 +54,13 @@ public class SelectorFactory {\n    *\n    * @param rawAttributes a map with attributes represented in a format produced by build file\n    *     parsers (i.e. non-coerced.)\n-   * @param elementTypeCoercer coercer that is used to coerce values of the given map\n    */\n-  public <T> Selector<T> createSelector(\n+  public Selector<Object> createSelector(\n       CellPathResolver cellPathResolver,\n-      ProjectFilesystem filesystem,\n       Path pathRelativeToProjectRoot,\n-      TargetConfiguration targetConfiguration,\n       Map<String, ?> rawAttributes,\n-      TypeCoercer<T> elementTypeCoercer,\n-      String noMatchMessage)\n-      throws CoerceFailedException {\n-    LinkedHashMap<SelectorKey, T> result =\n+      String noMatchMessage) {\n+    LinkedHashMap<SelectorKey, Object> result =\n         Maps.newLinkedHashMapWithExpectedSize(rawAttributes.size());\n     Set<SelectorKey> nullConditions = new HashSet<>();\n     for (Entry<String, ?> entry : rawAttributes.entrySet()) {\n@@ -99,14 +79,7 @@ public class SelectorFactory {\n         result.remove(selectorKey);\n         nullConditions.add(selectorKey);\n       } else {\n-        result.put(\n-            selectorKey,\n-            elementTypeCoercer.coerce(\n-                cellPathResolver,\n-                filesystem,\n-                pathRelativeToProjectRoot,\n-                targetConfiguration,\n-                entry.getValue()));\n+        result.put(selectorKey, entry.getValue());\n         nullConditions.remove(selectorKey);\n       }\n     }\ndiff --git a/src/com/facebook/buck/core/select/impl/SelectorListFactory.java b/src/com/facebook/buck/core/select/impl/SelectorListFactory.java\nindex 5124d204ea..4913bd68e2 100644\n--- a/src/com/facebook/buck/core/select/impl/SelectorListFactory.java\n+++ b/src/com/facebook/buck/core/select/impl/SelectorListFactory.java\n@@ -18,18 +18,17 @@ package com.facebook.buck.core.select.impl;\n \n import com.facebook.buck.core.cell.CellPathResolver;\n import com.facebook.buck.core.exceptions.HumanReadableException;\n-import com.facebook.buck.core.model.TargetConfiguration;\n import com.facebook.buck.core.select.Selector;\n-import com.facebook.buck.core.select.SelectorKey;\n import com.facebook.buck.core.select.SelectorList;\n-import com.facebook.buck.io.filesystem.ProjectFilesystem;\n+import com.facebook.buck.parser.syntax.ListWithSelects;\n import com.facebook.buck.parser.syntax.SelectorValue;\n import com.facebook.buck.rules.coercer.CoerceFailedException;\n-import com.facebook.buck.rules.coercer.TypeCoercer;\n+import com.facebook.buck.rules.coercer.JsonTypeConcatenatingCoercer;\n+import com.facebook.buck.rules.coercer.JsonTypeConcatenatingCoercerFactory;\n+import com.facebook.buck.rules.coercer.SingleElementJsonTypeConcatenatingCoercer;\n import com.google.common.collect.ImmutableList;\n import com.google.common.collect.ImmutableMap;\n import java.nio.file.Path;\n-import java.util.List;\n \n /** A factory to create {@link SelectorList} from raw (non-coerced) data. */\n public class SelectorListFactory {\n@@ -43,56 +42,41 @@ public class SelectorListFactory {\n   /**\n    * Create {@link SelectorList} using the given elements to create Selectors.\n    *\n-   * @param elements a list of elements in a format produced after parsing build files (i.e.\n+   * @param listWithSelects a list of elements in a format produced after parsing build files (i.e.\n    *     non-coerced.)\n-   * @param elementTypeCoercer coercer that is used to coerce values of the list\n    */\n-  public <T> SelectorList<T> create(\n+  public SelectorList<Object> create(\n       CellPathResolver cellPathResolver,\n-      ProjectFilesystem filesystem,\n       Path pathRelativeToProjectRoot,\n-      TargetConfiguration targetConfiguration,\n-      List<Object> elements,\n-      TypeCoercer<T> elementTypeCoercer)\n+      ListWithSelects listWithSelects)\n       throws CoerceFailedException {\n-    assertElementTypeSupportsConcatenation(elements, elementTypeCoercer);\n-\n-    ImmutableList.Builder<Selector<T>> builder = ImmutableList.builder();\n-    for (Object element : elements) {\n+    ImmutableList.Builder<Selector<Object>> builder =\n+        ImmutableList.builderWithExpectedSize(listWithSelects.getElements().size());\n+    for (Object element : listWithSelects.getElements()) {\n       if (element instanceof SelectorValue) {\n         SelectorValue selectorValue = (SelectorValue) element;\n-        ImmutableMap<String, ?> rawAttributes = selectorValue.getDictionary();\n+        ImmutableMap<String, Object> rawAttributes = selectorValue.getDictionary();\n         builder.add(\n             selectorFactory.createSelector(\n                 cellPathResolver,\n-                filesystem,\n                 pathRelativeToProjectRoot,\n-                targetConfiguration,\n                 rawAttributes,\n-                elementTypeCoercer,\n                 selectorValue.getNoMatchError()));\n       } else {\n-        builder.add(\n-            selectorFactory.createSelector(\n-                cellPathResolver,\n-                filesystem,\n-                pathRelativeToProjectRoot,\n-                targetConfiguration,\n-                ImmutableMap.of(SelectorKey.DEFAULT_KEYWORD, element),\n-                elementTypeCoercer));\n+        builder.add(Selector.onlyDefault(element));\n       }\n     }\n \n-    return new SelectorList<>(elementTypeCoercer, builder.build());\n-  }\n+    JsonTypeConcatenatingCoercer coercer =\n+        JsonTypeConcatenatingCoercerFactory.createForType(listWithSelects.getType());\n \n-  private static <T> void assertElementTypeSupportsConcatenation(\n-      List<Object> elements, TypeCoercer<T> elementTypeCoercer) {\n-    if (elements.size() > 1 && !elementTypeCoercer.supportsConcatenation()) {\n-      throw new HumanReadableException(\n-          String.format(\n-              \"type '%s' doesn't support select concatenation\",\n-              elementTypeCoercer.getOutputClass()));\n+    if (listWithSelects.getElements().size() != 1) {\n+      if (coercer instanceof SingleElementJsonTypeConcatenatingCoercer) {\n+        throw new HumanReadableException(\n+            \"type '%s' doesn't support select concatenation\", listWithSelects.getType().getName());\n+      }\n     }\n+\n+    return new SelectorList<>(coercer, builder.build());\n   }\n }\ndiff --git a/src/com/facebook/buck/parser/DefaultUnconfiguredTargetNodeFactory.java b/src/com/facebook/buck/parser/DefaultUnconfiguredTargetNodeFactory.java\nindex beb2dba528..602ae0c6c2 100644\n--- a/src/com/facebook/buck/parser/DefaultUnconfiguredTargetNodeFactory.java\n+++ b/src/com/facebook/buck/parser/DefaultUnconfiguredTargetNodeFactory.java\n@@ -17,8 +17,10 @@\n package com.facebook.buck.parser;\n \n import com.facebook.buck.core.cell.Cell;\n+import com.facebook.buck.core.cell.CellPathResolver;\n import com.facebook.buck.core.description.BaseDescription;\n import com.facebook.buck.core.exceptions.DependencyStack;\n+import com.facebook.buck.core.exceptions.HumanReadableException;\n import com.facebook.buck.core.model.AbstractRuleType;\n import com.facebook.buck.core.model.RuleType;\n import com.facebook.buck.core.model.UnconfiguredBuildTargetView;\n@@ -27,8 +29,11 @@ import com.facebook.buck.core.model.targetgraph.raw.UnconfiguredTargetNode;\n import com.facebook.buck.core.rules.knowntypes.KnownRuleTypes;\n import com.facebook.buck.core.rules.knowntypes.provider.KnownRuleTypesProvider;\n import com.facebook.buck.core.select.SelectorList;\n+import com.facebook.buck.core.select.impl.SelectorListFactory;\n import com.facebook.buck.parser.api.ProjectBuildFileParser;\n import com.facebook.buck.parser.function.BuckPyFunction;\n+import com.facebook.buck.parser.syntax.ListWithSelects;\n+import com.facebook.buck.rules.coercer.CoerceFailedException;\n import com.facebook.buck.rules.visibility.VisibilityPattern;\n import com.facebook.buck.rules.visibility.parser.VisibilityPatterns;\n import com.google.common.base.Preconditions;\n@@ -46,11 +51,55 @@ public class DefaultUnconfiguredTargetNodeFactory implements UnconfiguredTargetN\n \n   private final KnownRuleTypesProvider knownRuleTypesProvider;\n   private final BuiltTargetVerifier builtTargetVerifier;\n+  private final CellPathResolver cellPathResolver;\n+  private final SelectorListFactory selectorListFactory;\n \n   public DefaultUnconfiguredTargetNodeFactory(\n-      KnownRuleTypesProvider knownRuleTypesProvider, BuiltTargetVerifier builtTargetVerifier) {\n+      KnownRuleTypesProvider knownRuleTypesProvider,\n+      BuiltTargetVerifier builtTargetVerifier,\n+      CellPathResolver cellPathResolver,\n+      SelectorListFactory selectorListFactory) {\n     this.knownRuleTypesProvider = knownRuleTypesProvider;\n     this.builtTargetVerifier = builtTargetVerifier;\n+    this.cellPathResolver = cellPathResolver;\n+    this.selectorListFactory = selectorListFactory;\n+  }\n+\n+  private ImmutableMap<String, Object> convertSelects(\n+      Map<String, Object> attrs, Path pathRelativeToProjectRoot, DependencyStack dependencyStack) {\n+    ImmutableMap.Builder<String, Object> result = ImmutableMap.builder();\n+    for (Map.Entry<String, Object> attr : attrs.entrySet()) {\n+      result.put(\n+          attr.getKey(),\n+          convertSelectorListInAttrValue(\n+              attr.getKey(), attr.getValue(), pathRelativeToProjectRoot, dependencyStack));\n+    }\n+    return result.build();\n+  }\n+\n+  /**\n+   * Convert attr value {@link ListWithSelects} to {@link SelectorList} or keep it as is otherwise\n+   */\n+  private Object convertSelectorListInAttrValue(\n+      String attrName,\n+      Object attrValue,\n+      Path pathRelativeToProjectRoot,\n+      DependencyStack dependencyStack) {\n+    if (attrValue instanceof ListWithSelects) {\n+      try {\n+        return selectorListFactory.create(\n+            cellPathResolver, pathRelativeToProjectRoot, (ListWithSelects) attrValue);\n+      } catch (CoerceFailedException e) {\n+        throw new HumanReadableException(\n+            e,\n+            dependencyStack,\n+            \"failed to coerce list with selects for attr %s: %s\",\n+            attrName,\n+            e.getMessage());\n+      }\n+    } else {\n+      return attrValue;\n+    }\n   }\n \n   @Override\n@@ -86,12 +135,11 @@ public class DefaultUnconfiguredTargetNodeFactory implements UnconfiguredTargetN\n             rawAttributes.get(\"within_view\"),\n             target.getData());\n \n+    ImmutableMap<String, Object> withSelects =\n+        convertSelects(rawAttributes, target.getBasePath(), dependencyStack);\n+\n     return ImmutableUnconfiguredTargetNode.of(\n-        target.getData(),\n-        ruleType,\n-        ImmutableMap.copyOf(rawAttributes),\n-        visibilityPatterns,\n-        withinViewPatterns);\n+        target.getData(), ruleType, withSelects, visibilityPatterns, withinViewPatterns);\n   }\n \n   private static RuleType parseRuleTypeFromRawRule(\ndiff --git a/src/com/facebook/buck/parser/ParserWithConfigurableAttributes.java b/src/com/facebook/buck/parser/ParserWithConfigurableAttributes.java\nindex 247d1f53dc..344091d4e0 100644\n--- a/src/com/facebook/buck/parser/ParserWithConfigurableAttributes.java\n+++ b/src/com/facebook/buck/parser/ParserWithConfigurableAttributes.java\n@@ -33,7 +33,6 @@ import com.facebook.buck.core.select.SelectorListResolver;\n import com.facebook.buck.core.select.impl.SelectorListFactory;\n import com.facebook.buck.core.util.log.Logger;\n import com.facebook.buck.event.BuckEventBus;\n-import com.facebook.buck.io.filesystem.ProjectFilesystem;\n import com.facebook.buck.parser.TargetSpecResolver.TargetNodeFilterForSpecResolver;\n import com.facebook.buck.parser.api.BuildFileManifest;\n import com.facebook.buck.parser.config.ParserConfig;\n@@ -41,7 +40,6 @@ import com.facebook.buck.parser.exceptions.BuildFileParseException;\n import com.facebook.buck.parser.spec.TargetNodeSpec;\n import com.facebook.buck.parser.syntax.ListWithSelects;\n import com.facebook.buck.rules.coercer.CoerceFailedException;\n-import com.facebook.buck.rules.coercer.JsonTypeConcatenatingCoercerFactory;\n import com.google.common.annotations.VisibleForTesting;\n import com.google.common.collect.ImmutableList;\n import com.google.common.collect.ImmutableSet;\n@@ -197,7 +195,6 @@ class ParserWithConfigurableAttributes extends AbstractParser {\n                 state.getSelectorListResolver(),\n                 configurationContext,\n                 cell.getCellPathResolver(),\n-                cell.getFilesystem(),\n                 buildTarget,\n                 state.getSelectorListFactory(),\n                 attributeName,\n@@ -216,7 +213,6 @@ class ParserWithConfigurableAttributes extends AbstractParser {\n       SelectorListResolver selectorListResolver,\n       SelectableConfigurationContext configurationContext,\n       CellPathResolver cellPathResolver,\n-      ProjectFilesystem projectFilesystem,\n       BuildTarget buildTarget,\n       SelectorListFactory selectorListFactory,\n       String attributeName,\n@@ -227,16 +223,9 @@ class ParserWithConfigurableAttributes extends AbstractParser {\n       return jsonObject;\n     }\n \n-    ListWithSelects list = (ListWithSelects) jsonObject;\n-\n     SelectorList<Object> selectorList =\n         selectorListFactory.create(\n-            cellPathResolver,\n-            projectFilesystem,\n-            buildTarget.getBasePath(),\n-            buildTarget.getTargetConfiguration(),\n-            list.getElements(),\n-            JsonTypeConcatenatingCoercerFactory.createForType(list.getType()));\n+            cellPathResolver, buildTarget.getBasePath(), (ListWithSelects) jsonObject);\n \n     return selectorListResolver.resolveList(\n         configurationContext, buildTarget, attributeName, selectorList, dependencyStack);\ndiff --git a/src/com/facebook/buck/parser/PerBuildStateFactory.java b/src/com/facebook/buck/parser/PerBuildStateFactory.java\nindex 9f67c76d9c..8d0f91801a 100644\n--- a/src/com/facebook/buck/parser/PerBuildStateFactory.java\n+++ b/src/com/facebook/buck/parser/PerBuildStateFactory.java\n@@ -131,6 +131,9 @@ public class PerBuildStateFactory {\n \n     TargetNodeFactory targetNodeFactory = new TargetNodeFactory(typeCoercerFactory);\n \n+    SelectorListFactory selectorListFactory =\n+        new SelectorListFactory(new SelectorFactory(unconfiguredBuildTargetFactory));\n+\n     BuildFileRawNodeParsePipeline buildFileRawNodeParsePipeline =\n         new BuildFileRawNodeParsePipeline(\n             new PipelineNodeCache<>(daemonicParserState.getRawNodeCache(), n -> false),\n@@ -158,7 +161,10 @@ public class PerBuildStateFactory {\n             buildFileRawNodeParsePipeline,\n             buildTargetRawNodeParsePipeline,\n             new DefaultUnconfiguredTargetNodeFactory(\n-                knownRuleTypesProvider, new BuiltTargetVerifier()));\n+                knownRuleTypesProvider,\n+                new BuiltTargetVerifier(),\n+                rootCell.getCellPathResolver(),\n+                selectorListFactory));\n \n     PackageBoundaryChecker packageBoundaryChecker =\n         new ThrowingPackageBoundaryChecker(daemonicParserState.getBuildFileTrees());\n@@ -250,9 +256,6 @@ public class PerBuildStateFactory {\n           }\n         };\n \n-    SelectorListFactory selectorListFactory =\n-        new SelectorListFactory(new SelectorFactory(unconfiguredBuildTargetFactory));\n-\n     cellManager.register(rootCell);\n \n     return new PerBuildState(\ndiff --git a/src/com/facebook/buck/rules/coercer/BUCK b/src/com/facebook/buck/rules/coercer/BUCK\nindex b011cf9312..2b7d167277 100644\n--- a/src/com/facebook/buck/rules/coercer/BUCK\n+++ b/src/com/facebook/buck/rules/coercer/BUCK\n@@ -61,7 +61,6 @@ java_immutables_library(\n         \"//src/com/facebook/buck/core/model/targetgraph:targetgraph\",\n         \"//src/com/facebook/buck/core/model/targetgraph/raw:raw\",\n         \"//src/com/facebook/buck/core/rulekey:rulekey\",\n-        \"//src/com/facebook/buck/core/select/impl:impl\",\n         \"//src/com/facebook/buck/core/sourcepath/resolver:resolver\",\n         \"//src/com/facebook/buck/core/test/rule:rule\",\n         \"//src/com/facebook/buck/io:io\",\ndiff --git a/src/com/facebook/buck/rules/coercer/DefaultConstructorArgMarshaller.java b/src/com/facebook/buck/rules/coercer/DefaultConstructorArgMarshaller.java\nindex 6863f0788e..7226652bd8 100644\n--- a/src/com/facebook/buck/rules/coercer/DefaultConstructorArgMarshaller.java\n+++ b/src/com/facebook/buck/rules/coercer/DefaultConstructorArgMarshaller.java\n@@ -30,7 +30,6 @@ import com.facebook.buck.core.select.SelectorKey;\n import com.facebook.buck.core.select.SelectorList;\n import com.facebook.buck.core.select.SelectorListResolver;\n import com.facebook.buck.io.filesystem.ProjectFilesystem;\n-import com.facebook.buck.parser.syntax.ListWithSelects;\n import com.google.common.collect.ImmutableList;\n import com.google.common.collect.ImmutableMap;\n import com.google.common.collect.ImmutableSet;\n@@ -244,7 +243,7 @@ public class DefaultConstructorArgMarshaller implements ConstructorArgMarshaller\n     // The reason why we cannot use coercer from {@code argumentInfo} because {@link\n     // ListWithSelects} is not generic class, but an instance contains all necessary information\n     // to coerce the value into an instance of {@link SelectorList} which is a generic class.\n-    if (rawValue instanceof ListWithSelects) {\n+    if (rawValue instanceof SelectorList<?>) {\n       if (!argumentInfo.isConfigurable()) {\n         throw new HumanReadableException(\n             \"%s: attribute '%s' cannot be configured using select\",\n@@ -253,7 +252,7 @@ public class DefaultConstructorArgMarshaller implements ConstructorArgMarshaller\n \n       coercer =\n           typeCoercerFactory.typeCoercerForParameterizedType(\n-              \"ListWithSelects\", SelectorList.class, argumentInfo.getGenericParameterTypes());\n+              \"SelectorList\", SelectorList.class, argumentInfo.getGenericParameterTypes());\n     } else {\n       coercer = argumentInfo.getTypeCoercer();\n     }\ndiff --git a/src/com/facebook/buck/rules/coercer/DefaultTypeCoercerFactory.java b/src/com/facebook/buck/rules/coercer/DefaultTypeCoercerFactory.java\nindex cf250da5bb..bf85f4bc73 100644\n--- a/src/com/facebook/buck/rules/coercer/DefaultTypeCoercerFactory.java\n+++ b/src/com/facebook/buck/rules/coercer/DefaultTypeCoercerFactory.java\n@@ -29,8 +29,6 @@ import com.facebook.buck.core.parser.buildtargetparser.BuildTargetMatcher;\n import com.facebook.buck.core.parser.buildtargetparser.BuildTargetMatcherParser;\n import com.facebook.buck.core.parser.buildtargetparser.ParsingUnconfiguredBuildTargetViewFactory;\n import com.facebook.buck.core.select.SelectorList;\n-import com.facebook.buck.core.select.impl.SelectorFactory;\n-import com.facebook.buck.core.select.impl.SelectorListFactory;\n import com.facebook.buck.core.sourcepath.SourcePath;\n import com.facebook.buck.core.sourcepath.SourceWithFlags;\n import com.facebook.buck.core.util.immutables.BuckStyleImmutable;\n@@ -421,8 +419,7 @@ public class DefaultTypeCoercerFactory implements TypeCoercerFactory {\n     } else if (rawClass.isAssignableFrom(SelectorList.class)) {\n       return new SelectorListCoercer<>(\n           new BuildTargetTypeCoercer(unconfiguredBuildTargetTypeCoercer),\n-          typeCoercerForType(getSingletonTypeParameter(typeName, actualTypeArguments)),\n-          new SelectorListFactory(new SelectorFactory(unconfiguredBuildTargetFactory)));\n+          typeCoercerForType(getSingletonTypeParameter(typeName, actualTypeArguments)));\n     } else {\n       throw new IllegalArgumentException(\"Unhandled type: \" + typeName);\n     }\ndiff --git a/src/com/facebook/buck/rules/coercer/JsonTypeConcatenatingCoercer.java b/src/com/facebook/buck/rules/coercer/JsonTypeConcatenatingCoercer.java\nindex c914b7fae4..c6d50bce09 100644\n--- a/src/com/facebook/buck/rules/coercer/JsonTypeConcatenatingCoercer.java\n+++ b/src/com/facebook/buck/rules/coercer/JsonTypeConcatenatingCoercer.java\n@@ -17,13 +17,13 @@ package com.facebook.buck.rules.coercer;\n \n import com.facebook.buck.core.cell.CellPathResolver;\n import com.facebook.buck.core.model.TargetConfiguration;\n-import com.facebook.buck.core.select.impl.SelectorListFactory;\n import com.facebook.buck.io.filesystem.ProjectFilesystem;\n import java.nio.file.Path;\n \n /**\n- * The purpose of this {@link TypeCoercer} to be used together with {@link SelectorListFactory} to\n- * resolve configurable attributes that contain values of JSON-compatible types.\n+ * The purpose of this {@link TypeCoercer} to be used together with {@link\n+ * com.facebook.buck.core.select.impl.SelectorListFactory} to resolve configurable attributes that\n+ * contain values of JSON-compatible types.\n  *\n  * <p>This coercer does not transform the objects, but only provides a way to concatenate elements.\n  */\ndiff --git a/src/com/facebook/buck/rules/coercer/JsonTypeConcatenatingCoercerFactory.java b/src/com/facebook/buck/rules/coercer/JsonTypeConcatenatingCoercerFactory.java\nindex 0ad28d9e0c..c7e44fe8c4 100644\n--- a/src/com/facebook/buck/rules/coercer/JsonTypeConcatenatingCoercerFactory.java\n+++ b/src/com/facebook/buck/rules/coercer/JsonTypeConcatenatingCoercerFactory.java\n@@ -15,7 +15,6 @@\n  */\n package com.facebook.buck.rules.coercer;\n \n-import com.facebook.buck.core.select.impl.SelectorListFactory;\n import java.util.List;\n import java.util.Map;\n \n@@ -27,8 +26,8 @@ import java.util.Map;\n  * JSON format.\n  *\n  * <p>Coercers provided by this factory are intended to be used together with {@link\n- * SelectorListFactory} to resolve configurable attributes that contain values of JSON-compatible\n- * types.\n+ * com.facebook.buck.core.select.impl.SelectorListFactory} to resolve configurable attributes that\n+ * contain values of JSON-compatible types.\n  */\n public class JsonTypeConcatenatingCoercerFactory {\n \ndiff --git a/src/com/facebook/buck/rules/coercer/ListConcatenatingCoercer.java b/src/com/facebook/buck/rules/coercer/ListConcatenatingCoercer.java\nindex 287e31d536..2fcfe1612c 100644\n--- a/src/com/facebook/buck/rules/coercer/ListConcatenatingCoercer.java\n+++ b/src/com/facebook/buck/rules/coercer/ListConcatenatingCoercer.java\n@@ -19,7 +19,8 @@ import com.google.common.collect.ImmutableList;\n import com.google.common.collect.Iterables;\n import java.util.List;\n \n-class ListConcatenatingCoercer extends JsonTypeConcatenatingCoercer {\n+/** Concatenate {@link List}s of unknown types. */\n+final class ListConcatenatingCoercer extends JsonTypeConcatenatingCoercer {\n \n   ListConcatenatingCoercer() {\n     super(List.class);\n@@ -30,4 +31,19 @@ class ListConcatenatingCoercer extends JsonTypeConcatenatingCoercer {\n     Iterable<List<Object>> lists = Iterables.transform(elements, List.class::cast);\n     return ImmutableList.copyOf(Iterables.concat(lists));\n   }\n+\n+  @Override\n+  public boolean equals(Object obj) {\n+    return obj instanceof ListConcatenatingCoercer;\n+  }\n+\n+  @Override\n+  public String toString() {\n+    return ListConcatenatingCoercer.class.getSimpleName();\n+  }\n+\n+  @Override\n+  public int hashCode() {\n+    return ListConcatenatingCoercer.class.hashCode();\n+  }\n }\ndiff --git a/src/com/facebook/buck/rules/coercer/SelectorListCoercer.java b/src/com/facebook/buck/rules/coercer/SelectorListCoercer.java\nindex",
    "Fix broken link .": "diff --git a/docs/user-manual/modules/ROOT/pages/servlet-tomcat-example.adoc b/docs/user-manual/modules/ROOT/pages/servlet-tomcat-example.adoc\nindex 8c1f9c9b857..e3e40b4b9a7 100644\n--- a/docs/user-manual/modules/ROOT/pages/servlet-tomcat-example.adoc\n+++ b/docs/user-manual/modules/ROOT/pages/servlet-tomcat-example.adoc\n@@ -4,9 +4,9 @@\n *Since Camel 2.7*\n \n This example is located in the\n-https://github.com/apache/camel/blob/master/examples/camel-example-servlet-tomcat[examples/camel-example-servlet-tomcat]\n-directory of the Camel distribution.\n-There is a `README.txt` file with instructions how to run it.\n+https://github.com/apache/camel-examples/tree/master/examples/camel-example-servlet-tomcat[examples/camel-example-servlet-tomcat]\n+directory of the https://github.com/apache/camel-examples[Camel Examples Repository].\n+There is a `README.adoc` file with instructions how to run it.\n \n If you use Maven then you can easily package the example from the command line:\n ",
    "improve comment": "diff --git a/engine/src/main/java/org/archive/crawler/restlet/BeanBrowseResource.java b/engine/src/main/java/org/archive/crawler/restlet/BeanBrowseResource.java\nindex 35db2713..543447d0 100644\n--- a/engine/src/main/java/org/archive/crawler/restlet/BeanBrowseResource.java\n+++ b/engine/src/main/java/org/archive/crawler/restlet/BeanBrowseResource.java\n@@ -47,8 +47,8 @@ import org.springframework.beans.BeanWrapperImpl;\n import org.springframework.beans.BeansException;\r\n \r\n /**\r\n- * Restlet Resource which generates fresh reports and then redirects\r\n- * requests to the report in the filesystem. \r\n+ * Restlet Resource which allows browsing the constructed beans in\r\n+ * a hierarchical fashion. \r\n  * \r\n  * @contributor gojomo\r\n  */\r",
    "add transaction id partition as locking key for schedule operation sequential": "diff --git a/distributed/src/main/java/com/orientechnologies/orient/server/distributed/impl/ODistributedDatabaseImpl.java b/distributed/src/main/java/com/orientechnologies/orient/server/distributed/impl/ODistributedDatabaseImpl.java\nindex 1435554887..56b5897441 100755\n--- a/distributed/src/main/java/com/orientechnologies/orient/server/distributed/impl/ODistributedDatabaseImpl.java\n+++ b/distributed/src/main/java/com/orientechnologies/orient/server/distributed/impl/ODistributedDatabaseImpl.java\n@@ -364,9 +364,11 @@ public class ODistributedDatabaseImpl implements ODistributedDatabase {\n       if (task instanceof OLockKeySource) {\n         SortedSet<ORID> rids = ((OLockKeySource) task).getRids();\n         SortedSet<OPair<String, Object>> uniqueKeys = ((OLockKeySource) task).getUniqueKeys();\n+        OTransactionId txId = ((OLockKeySource) task).getTransactionId();\n         this.lockManager.lock(\n             rids,\n             uniqueKeys,\n+            txId,\n             (guards) -> {\n               try {\n                 this.requestExecutor.submit(\ndiff --git a/distributed/src/main/java/com/orientechnologies/orient/server/distributed/impl/ONewDistributedTransactionManager.java b/distributed/src/main/java/com/orientechnologies/orient/server/distributed/impl/ONewDistributedTransactionManager.java\nindex 9cb058ef7e..4eb474c36f 100755\n--- a/distributed/src/main/java/com/orientechnologies/orient/server/distributed/impl/ONewDistributedTransactionManager.java\n+++ b/distributed/src/main/java/com/orientechnologies/orient/server/distributed/impl/ONewDistributedTransactionManager.java\n@@ -335,30 +335,18 @@ public class ONewDistributedTransactionManager {\n       switch (resultPayload.getResponseType()) {\n         case OTxSuccess.ID:\n           // Success send ok\n-          sendPhase2Task(\n-              involvedClusters,\n-              nodes,\n-              new OTransactionPhase2Task(\n-                  requestId, true, txTask.getRids(), txTask.getUniqueKeys(), getLsn()));\n+          sendPhase2Task(involvedClusters, nodes, newSecondPhase(requestId, txTask, true));\n           localOk(requestId, database);\n           break;\n         case OTxException.ID:\n           // Exception send ko and throws the exception\n-          sendPhase2Task(\n-              involvedClusters,\n-              nodes,\n-              new OTransactionPhase2Task(\n-                  requestId, false, txTask.getRids(), txTask.getUniqueKeys(), getLsn()));\n+          sendPhase2Task(involvedClusters, nodes, newSecondPhase(requestId, txTask, false));\n           localKo(requestId, database);\n           throw ((OTxException) resultPayload).getException();\n         case OTxUniqueIndex.ID:\n           {\n             // Unique index quorum error send ko and throw unique index exception\n-            sendPhase2Task(\n-                involvedClusters,\n-                nodes,\n-                new OTransactionPhase2Task(\n-                    requestId, false, txTask.getRids(), txTask.getUniqueKeys(), getLsn()));\n+            sendPhase2Task(involvedClusters, nodes, newSecondPhase(requestId, txTask, false));\n             localKo(requestId, database);\n             ORID id = ((OTxUniqueIndex) resultPayload).getRecordId();\n             String index = ((OTxUniqueIndex) resultPayload).getIndex();\n@@ -375,11 +363,7 @@ public class ONewDistributedTransactionManager {\n           {\n             // Concurrent modification exception quorum send ko and throw cuncurrent modification\n             // exception\n-            sendPhase2Task(\n-                involvedClusters,\n-                nodes,\n-                new OTransactionPhase2Task(\n-                    requestId, false, txTask.getRids(), txTask.getUniqueKeys(), getLsn()));\n+            sendPhase2Task(involvedClusters, nodes, newSecondPhase(requestId, txTask, false));\n             localKo(requestId, database);\n             ORID id = ((OTxConcurrentModification) resultPayload).getRecordId();\n             int version = ((OTxConcurrentModification) resultPayload).getVersion();\n@@ -391,11 +375,7 @@ public class ONewDistributedTransactionManager {\n           }\n         case OTxConcurrentCreation.ID:\n           {\n-            sendPhase2Task(\n-                involvedClusters,\n-                nodes,\n-                new OTransactionPhase2Task(\n-                    requestId, false, txTask.getRids(), txTask.getUniqueKeys(), getLsn()));\n+            sendPhase2Task(involvedClusters, nodes, newSecondPhase(requestId, txTask, false));\n             localKo(requestId, database);\n             throw new OConcurrentCreateException(\n                 ((OTxConcurrentCreation) resultPayload).getExpectedRid(),\n@@ -403,33 +383,21 @@ public class ONewDistributedTransactionManager {\n           }\n \n         case OTxRecordLockTimeout.ID:\n-          sendPhase2Task(\n-              involvedClusters,\n-              nodes,\n-              new OTransactionPhase2Task(\n-                  requestId, false, txTask.getRids(), txTask.getUniqueKeys(), getLsn()));\n+          sendPhase2Task(involvedClusters, nodes, newSecondPhase(requestId, txTask, false));\n           localKo(requestId, database);\n           throw new ODistributedRecordLockedException(\n               ((OTxRecordLockTimeout) resultPayload).getNode(),\n               ((OTxRecordLockTimeout) resultPayload).getLockedId(),\n               timeout);\n         case OTxKeyLockTimeout.ID:\n-          sendPhase2Task(\n-              involvedClusters,\n-              nodes,\n-              new OTransactionPhase2Task(\n-                  requestId, false, txTask.getRids(), txTask.getUniqueKeys(), getLsn()));\n+          sendPhase2Task(involvedClusters, nodes, newSecondPhase(requestId, txTask, false));\n           localKo(requestId, database);\n           throw new ODistributedKeyLockedException(\n               ((OTxKeyLockTimeout) resultPayload).getNode(),\n               ((OTxKeyLockTimeout) resultPayload).getKey(),\n               timeout);\n         case OTxInvalidSequential.ID:\n-          sendPhase2Task(\n-              involvedClusters,\n-              nodes,\n-              new OTransactionPhase2Task(\n-                  requestId, false, txTask.getRids(), txTask.getUniqueKeys(), getLsn()));\n+          sendPhase2Task(involvedClusters, nodes, newSecondPhase(requestId, txTask, false));\n           localKo(requestId, database);\n           throw new OInvalidSequentialException(\n               ((OTxInvalidSequential) resultPayload).getCurrent());\n@@ -450,22 +418,14 @@ public class ONewDistributedTransactionManager {\n         String node = responseManager.getNodeNameFromPayload(result);\n         switch (result.getResponseType()) {\n           case OTxRecordLockTimeout.ID:\n-            sendPhase2Task(\n-                involvedClusters,\n-                nodes,\n-                new OTransactionPhase2Task(\n-                    requestId, false, txTask.getRids(), txTask.getUniqueKeys(), getLsn()));\n+            sendPhase2Task(involvedClusters, nodes, newSecondPhase(requestId, txTask, false));\n             localKo(requestId, database);\n             throw new ODistributedRecordLockedException(\n                 ((OTxRecordLockTimeout) result).getNode(),\n                 ((OTxRecordLockTimeout) result).getLockedId(),\n                 timeout);\n           case OTxKeyLockTimeout.ID:\n-            sendPhase2Task(\n-                involvedClusters,\n-                nodes,\n-                new OTransactionPhase2Task(\n-                    requestId, false, txTask.getRids(), txTask.getUniqueKeys(), getLsn()));\n+            sendPhase2Task(involvedClusters, nodes, newSecondPhase(requestId, txTask, false));\n             localKo(requestId, database);\n             throw new ODistributedKeyLockedException(\n                 ((OTxKeyLockTimeout) result).getNode(),\n@@ -473,11 +433,7 @@ public class ONewDistributedTransactionManager {\n                 timeout);\n \n           case OTxConcurrentCreation.ID:\n-            sendPhase2Task(\n-                involvedClusters,\n-                nodes,\n-                new OTransactionPhase2Task(\n-                    requestId, false, txTask.getRids(), txTask.getUniqueKeys(), getLsn()));\n+            sendPhase2Task(involvedClusters, nodes, newSecondPhase(requestId, txTask, false));\n             localKo(requestId, database);\n             throw new OConcurrentCreateException(\n                 ((OTxConcurrentCreation) result).getExpectedRid(),\n@@ -487,11 +443,7 @@ public class ONewDistributedTransactionManager {\n             messages.add(\"node: \" + node + \" success\");\n             break;\n           case OTxConcurrentModification.ID:\n-            sendPhase2Task(\n-                involvedClusters,\n-                nodes,\n-                new OTransactionPhase2Task(\n-                    requestId, false, txTask.getRids(), txTask.getUniqueKeys(), getLsn()));\n+            sendPhase2Task(involvedClusters, nodes, newSecondPhase(requestId, txTask, false));\n             localKo(requestId, database);\n             ORecordId recordId = ((OTxConcurrentModification) result).getRecordId();\n             throw new OConcurrentModificationException(\n@@ -519,20 +471,12 @@ public class ONewDistributedTransactionManager {\n                     ((OTxUniqueIndex) result).getRecordId()));\n             break;\n           case OTxInvalidSequential.ID:\n-            sendPhase2Task(\n-                involvedClusters,\n-                nodes,\n-                new OTransactionPhase2Task(\n-                    requestId, false, txTask.getRids(), txTask.getUniqueKeys(), getLsn()));\n+            sendPhase2Task(involvedClusters, nodes, newSecondPhase(requestId, txTask, false));\n             localKo(requestId, database);\n             throw new OInvalidSequentialException(((OTxInvalidSequential) result).getCurrent());\n         }\n       }\n-      sendPhase2Task(\n-          involvedClusters,\n-          nodes,\n-          new OTransactionPhase2Task(\n-              requestId, false, txTask.getRids(), txTask.getUniqueKeys(), getLsn()));\n+      sendPhase2Task(involvedClusters, nodes, newSecondPhase(requestId, txTask, false));\n       localKo(requestId, database);\n \n       ODistributedOperationException ex =\n@@ -547,6 +491,17 @@ public class ONewDistributedTransactionManager {\n     }\n   }\n \n+  private OTransactionPhase2Task newSecondPhase(\n+      ODistributedRequestId requestId, OTransactionPhase1Task txTask, boolean success) {\n+    return new OTransactionPhase2Task(\n+        requestId,\n+        success,\n+        txTask.getRids(),\n+        txTask.getUniqueKeys(),\n+        getLsn(),\n+        txTask.getTransactionId());\n+  }\n+\n   private void localKo(ODistributedRequestId requestId, ODatabaseDocumentDistributed database) {\n     database.rollback2pc(requestId);\n   }\ndiff --git a/distributed/src/main/java/com/orientechnologies/orient/server/distributed/impl/lock/OLockManager.java b/distributed/src/main/java/com/orientechnologies/orient/server/distributed/impl/lock/OLockManager.java\nindex e8f6894589..617c4c93cf 100644\n--- a/distributed/src/main/java/com/orientechnologies/orient/server/distributed/impl/lock/OLockManager.java\n+++ b/distributed/src/main/java/com/orientechnologies/orient/server/distributed/impl/lock/OLockManager.java\n@@ -2,13 +2,17 @@ package com.orientechnologies.orient.server.distributed.impl.lock;\n \n import com.orientechnologies.common.util.OPair;\n import com.orientechnologies.orient.core.id.ORID;\n+import com.orientechnologies.orient.core.tx.OTransactionId;\n import java.util.List;\n import java.util.SortedSet;\n \n public interface OLockManager {\n \n   void lock(\n-      SortedSet<ORID> rids, SortedSet<OPair<String, Object>> indexKeys, OnLocksAcquired acquired);\n+      SortedSet<ORID> rids,\n+      SortedSet<OPair<String, Object>> indexKeys,\n+      OTransactionId txId,\n+      OnLocksAcquired acquired);\n \n   void unlock(List<OLockGuard> guards);\n \ndiff --git a/distributed/src/main/java/com/orientechnologies/orient/server/distributed/impl/lock/OLockManagerImpl.java b/distributed/src/main/java/com/orientechnologies/orient/server/distributed/impl/lock/OLockManagerImpl.java\nindex c4a411a4ac..89d395c447 100644\n--- a/distributed/src/main/java/com/orientechnologies/orient/server/distributed/impl/lock/OLockManagerImpl.java\n+++ b/distributed/src/main/java/com/orientechnologies/orient/server/distributed/impl/lock/OLockManagerImpl.java\n@@ -2,6 +2,7 @@ package com.orientechnologies.orient.server.distributed.impl.lock;\n \n import com.orientechnologies.common.util.OPair;\n import com.orientechnologies.orient.core.id.ORID;\n+import com.orientechnologies.orient.core.tx.OTransactionId;\n import java.util.*;\n import java.util.concurrent.ConcurrentHashMap;\n \n@@ -31,7 +32,10 @@ public class OLockManagerImpl implements OLockManager {\n   }\n \n   public synchronized void lock(\n-      SortedSet<ORID> rids, SortedSet<OPair<String, Object>> indexKeys, OnLocksAcquired acquired) {\n+      SortedSet<ORID> rids,\n+      SortedSet<OPair<String, Object>> indexKeys,\n+      OTransactionId transactionId,\n+      OnLocksAcquired acquired) {\n     List<OLockGuard> guards = new ArrayList<>();\n     OWaitingTracker waitingTracker = new OWaitingTracker(acquired);\n     for (ORID rid : rids) {\n@@ -45,6 +49,10 @@ public class OLockManagerImpl implements OLockManager {\n       lock(key, waitingTracker);\n       guards.add(new OLockGuard(key));\n     }\n+    OTransactionIdLockKey key = new OTransactionIdLockKey(transactionId);\n+    lock(key, waitingTracker);\n+    guards.add(new OLockGuard(key));\n+\n     waitingTracker.setGuards(guards);\n     waitingTracker.acquireIfNoWaiting();\n   }\ndiff --git a/distributed/src/main/java/com/orientechnologies/orient/server/distributed/impl/lock/OTransactionIdLockKey.java b/distributed/src/main/java/com/orientechnologies/orient/server/distributed/impl/lock/OTransactionIdLockKey.java\nnew file mode 100644\nindex 0000000000..7a8aa9702f\n--- /dev/null\n+++ b/distributed/src/main/java/com/orientechnologies/orient/server/distributed/impl/lock/OTransactionIdLockKey.java\n@@ -0,0 +1,32 @@\n+package com.orientechnologies.orient.server.distributed.impl.lock;\n+\n+import com.orientechnologies.orient.core.tx.OTransactionId;\n+import java.util.Objects;\n+\n+public class OTransactionIdLockKey implements OLockKey {\n+  private OTransactionId transactionId;\n+\n+  public OTransactionIdLockKey(OTransactionId transactionId) {\n+    if (transactionId == null) {\n+      throw new NullPointerException();\n+    }\n+    this.transactionId = transactionId;\n+  }\n+\n+  @Override\n+  public boolean equals(Object obj) {\n+    // It use just the position to make sure that the operation for a position are sequential\n+    if (obj instanceof OTransactionIdLockKey) {\n+      return this.transactionId.getPosition()\n+          == ((OTransactionIdLockKey) obj).transactionId.getPosition();\n+    } else {\n+      return false;\n+    }\n+  }\n+\n+  @Override\n+  public int hashCode() {\n+    // It use just the position to make sure that the operation for a position are sequential\n+    return Objects.hash(this.transactionId.getPosition());\n+  }\n+}\ndiff --git a/distributed/src/main/java/com/orientechnologies/orient/server/distributed/impl/task/OLockKeySource.java b/distributed/src/main/java/com/orientechnologies/orient/server/distributed/impl/task/OLockKeySource.java\nindex c210ae075a..70c60b38cf 100644\n--- a/distributed/src/main/java/com/orientechnologies/orient/server/distributed/impl/task/OLockKeySource.java\n+++ b/distributed/src/main/java/com/orientechnologies/orient/server/distributed/impl/task/OLockKeySource.java\n@@ -2,10 +2,13 @@ package com.orientechnologies.orient.server.distributed.impl.task;\n \n import com.orientechnologies.common.util.OPair;\n import com.orientechnologies.orient.core.id.ORID;\n+import com.orientechnologies.orient.core.tx.OTransactionId;\n import java.util.SortedSet;\n \n public interface OLockKeySource {\n   SortedSet<ORID> getRids();\n \n   SortedSet<OPair<String, Object>> getUniqueKeys();\n+\n+  OTransactionId getTransactionId();\n }\ndiff --git a/distributed/src/main/java/com/orientechnologies/orient/server/distributed/impl/task/OTransactionPhase2Task.java b/distributed/src/main/java/com/orientechnologies/orient/server/distributed/impl/task/OTransactionPhase2Task.java\nindex b621ddde20..ea979cccc9 100644\n--- a/distributed/src/main/java/com/orientechnologies/orient/server/distributed/impl/task/OTransactionPhase2Task.java\n+++ b/distributed/src/main/java/com/orientechnologies/orient/server/distributed/impl/task/OTransactionPhase2Task.java\n@@ -13,6 +13,7 @@ import com.orientechnologies.orient.core.id.ORID;\n import com.orientechnologies.orient.core.id.ORecordId;\n import com.orientechnologies.orient.core.serialization.serializer.record.binary.ORecordSerializerNetworkDistributed;\n import com.orientechnologies.orient.core.storage.impl.local.paginated.wal.OLogSequenceNumber;\n+import com.orientechnologies.orient.core.tx.OTransactionId;\n import com.orientechnologies.orient.server.OServer;\n import com.orientechnologies.orient.server.distributed.ODistributedRequestId;\n import com.orientechnologies.orient.server.distributed.ODistributedServerManager;\n@@ -29,7 +30,8 @@ import java.util.TreeSet;\n public class OTransactionPhase2Task extends OAbstractReplicatedTask implements OLockKeySource {\n   public static final int FACTORYID = 44;\n \n-  private ODistributedRequestId transactionId;\n+  private OTransactionId transactionId;\n+  private ODistributedRequestId firstPhaseId;\n   private boolean success;\n   private SortedSet<ORID> involvedRids;\n   private SortedSet<OPair<String, Object>> uniqueIndexKeys = new TreeSet<>();\n@@ -37,16 +39,18 @@ public class OTransactionPhase2Task extends OAbstractReplicatedTask implements O\n   private volatile int retryCount = 0;\n \n   public OTransactionPhase2Task(\n-      ODistributedRequestId transactionId,\n+      ODistributedRequestId firstPhaseId,\n       boolean success,\n       SortedSet<ORID> rids,\n       SortedSet<OPair<String, Object>> uniqueIndexKeys,\n-      OLogSequenceNumber lsn) {\n-    this.transactionId = transactionId;\n+      OLogSequenceNumber lsn,\n+      OTransactionId transactionId) {\n+    this.firstPhaseId = firstPhaseId;\n     this.success = success;\n     this.involvedRids = rids;\n     this.uniqueIndexKeys = uniqueIndexKeys;\n     this.lastLSN = lsn;\n+    this.transactionId = transactionId;\n   }\n \n   public OTransactionPhase2Task() {}\n@@ -63,9 +67,10 @@ public class OTransactionPhase2Task extends OAbstractReplicatedTask implements O\n \n   @Override\n   public void fromStream(DataInput in, ORemoteTaskFactory factory) throws IOException {\n+    this.transactionId = OTransactionId.read(in);\n     int nodeId = in.readInt();\n     long messageId = in.readLong();\n-    this.transactionId = new ODistributedRequestId(nodeId, messageId);\n+    this.firstPhaseId = new ODistributedRequestId(nodeId, messageId);\n \n     int length = in.readInt();\n     this.involvedRids = new TreeSet<ORID>();\n@@ -83,8 +88,9 @@ public class OTransactionPhase2Task extends OAbstractReplicatedTask implements O\n \n   @Override\n   public void toStream(DataOutput out) throws IOException {\n-    out.writeInt(transactionId.getNodeId());\n-    out.writeLong(transactionId.getMessageId());\n+    this.transactionId.write(out);\n+    out.writeInt(firstPhaseId.getNodeId());\n+    out.writeLong(firstPhaseId.getMessageId());\n     out.writeInt(involvedRids.size());\n     for (ORID id : involvedRids) {\n       ORecordId.serialize(id, out);\n@@ -107,7 +113,7 @@ public class OTransactionPhase2Task extends OAbstractReplicatedTask implements O\n       ODatabaseDocumentInternal database)\n       throws Exception {\n     if (success) {\n-      if (!((ODatabaseDocumentDistributed) database).commit2pc(transactionId, false, requestId)) {\n+      if (!((ODatabaseDocumentDistributed) database).commit2pc(firstPhaseId, false, requestId)) {\n         final int autoRetryDelay =\n             OGlobalConfiguration.DISTRIBUTED_CONCURRENT_TX_AUTORETRY_DELAY.getValueAsInteger();\n         retryCount++;\n@@ -138,7 +144,7 @@ public class OTransactionPhase2Task extends OAbstractReplicatedTask implements O\n                         .warn(\n                             OTransactionPhase2Task.this,\n                             \"Reached limit of retry for commit tx:%s forcing database re-install\",\n-                            transactionId);\n+                            firstPhaseId);\n                     iManager.installDatabase(false, database.getName(), true, true);\n                   });\n           hasResponse = true;\n@@ -148,7 +154,7 @@ public class OTransactionPhase2Task extends OAbstractReplicatedTask implements O\n         hasResponse = true;\n       }\n     } else {\n-      if (!((ODatabaseDocumentDistributed) database).rollback2pc(transactionId)) {\n+      if (!((ODatabaseDocumentDistributed) database).rollback2pc(firstPhaseId)) {\n         final int autoRetryDelay =\n             OGlobalConfiguration.DISTRIBUTED_CONCURRENT_TX_AUTORETRY_DELAY.getValueAsInteger();\n         retryCount++;\n@@ -188,8 +194,8 @@ public class OTransactionPhase2Task extends OAbstractReplicatedTask implements O\n     return retryCount;\n   }\n \n-  public ODistributedRequestId getTransactionId() {\n- ",
    "remove unused parameter in BusinessInvoicePaymentFactory .": "diff --git a/osgi-bundles/bundles/analytics/src/main/java/com/ning/billing/osgi/bundles/analytics/dao/BusinessInvoiceAndInvoicePaymentDao.java b/osgi-bundles/bundles/analytics/src/main/java/com/ning/billing/osgi/bundles/analytics/dao/BusinessInvoiceAndInvoicePaymentDao.java\nindex 665addc787..b8a74acff6 100644\n--- a/osgi-bundles/bundles/analytics/src/main/java/com/ning/billing/osgi/bundles/analytics/dao/BusinessInvoiceAndInvoicePaymentDao.java\n+++ b/osgi-bundles/bundles/analytics/src/main/java/com/ning/billing/osgi/bundles/analytics/dao/BusinessInvoiceAndInvoicePaymentDao.java\n@@ -103,7 +103,7 @@ public class BusinessInvoiceAndInvoicePaymentDao extends BusinessAnalyticsDaoBas\n         final Map<BusinessInvoiceModelDao, Collection<BusinessInvoiceItemBaseModelDao>> businessInvoices = binFactory.createBusinessInvoicesAndInvoiceItems(accountId, context);\n \n         // Recompute all invoice payments (without denormalized payment fields populated)\n-        final Collection<BusinessInvoicePaymentBaseModelDao> businessInvoicePayments = bipFactory.createBusinessInvoicePayments(accountId, businessInvoices, context);\n+        final Collection<BusinessInvoicePaymentBaseModelDao> businessInvoicePayments = bipFactory.createBusinessInvoicePayments(accountId, context);\n \n         // Transform the results\n         for (final BusinessInvoiceModelDao businessInvoice : businessInvoices.keySet()) {\ndiff --git a/osgi-bundles/bundles/analytics/src/main/java/com/ning/billing/osgi/bundles/analytics/dao/factory/BusinessInvoicePaymentFactory.java b/osgi-bundles/bundles/analytics/src/main/java/com/ning/billing/osgi/bundles/analytics/dao/factory/BusinessInvoicePaymentFactory.java\nindex 11856f2f6d..0d567f02cd 100644\n--- a/osgi-bundles/bundles/analytics/src/main/java/com/ning/billing/osgi/bundles/analytics/dao/factory/BusinessInvoicePaymentFactory.java\n+++ b/osgi-bundles/bundles/analytics/src/main/java/com/ning/billing/osgi/bundles/analytics/dao/factory/BusinessInvoicePaymentFactory.java\n@@ -18,7 +18,6 @@ package com.ning.billing.osgi.bundles.analytics.dao.factory;\n \n import java.util.Collection;\n import java.util.LinkedList;\n-import java.util.Map;\n import java.util.UUID;\n \n import javax.annotation.Nullable;\n@@ -27,8 +26,6 @@ import com.ning.billing.account.api.Account;\n import com.ning.billing.invoice.api.Invoice;\n import com.ning.billing.invoice.api.InvoicePayment;\n import com.ning.billing.osgi.bundles.analytics.AnalyticsRefreshException;\n-import com.ning.billing.osgi.bundles.analytics.dao.model.BusinessInvoiceItemBaseModelDao;\n-import com.ning.billing.osgi.bundles.analytics.dao.model.BusinessInvoiceModelDao;\n import com.ning.billing.osgi.bundles.analytics.dao.model.BusinessInvoicePaymentBaseModelDao;\n import com.ning.billing.osgi.bundles.analytics.dao.model.BusinessModelDaoBase.ReportGroup;\n import com.ning.billing.payment.api.Payment;\n@@ -48,7 +45,6 @@ public class BusinessInvoicePaymentFactory extends BusinessFactoryBase {\n \n \n     public Collection<BusinessInvoicePaymentBaseModelDao> createBusinessInvoicePayments(final UUID accountId,\n-                                                                                        final Map<BusinessInvoiceModelDao, Collection<BusinessInvoiceItemBaseModelDao>> businessInvoices,\n                                                                                         final CallContext context) throws AnalyticsRefreshException {\n         final Account account = getAccount(accountId, context);\n \n@@ -62,7 +58,6 @@ public class BusinessInvoicePaymentFactory extends BusinessFactoryBase {\n         for (final InvoicePayment invoicePayment : invoicePayments) {\n             final BusinessInvoicePaymentBaseModelDao businessInvoicePayment = createBusinessInvoicePayment(account,\n                                                                                                            invoicePayment,\n-                                                                                                 ",
    "Set owner connection address null when post actions fail .": "diff --git a/hazelcast-client/src/main/java/com/hazelcast/client/connection/nio/ClusterConnector.java b/hazelcast-client/src/main/java/com/hazelcast/client/connection/nio/ClusterConnector.java\nindex 57ff7da356..498920be86 100644\n--- a/hazelcast-client/src/main/java/com/hazelcast/client/connection/nio/ClusterConnector.java\n+++ b/hazelcast-client/src/main/java/com/hazelcast/client/connection/nio/ClusterConnector.java\n@@ -139,6 +139,7 @@ class ClusterConnector {\n             fireConnectionEvent(LifecycleEvent.LifecycleState.CLIENT_CONNECTED);\n             connectionStrategy.onConnectToCluster();\n         } catch (Exception e) {\n+            setOwnerConnectionAddress(null);\n             logger.warning(\"Exception during initial connection to \" + address + \", exception \" + e);\n             if (null != connection) {\n                 connection.close(\"Could not connect to \" + address + \" as owner\", e);",
    "Avoid ` Decoder . decode ` on 404 when void response type ( <issue_id> ) .": "diff --git a/CHANGELOG.md b/CHANGELOG.md\nindex 75c7066e..49c0d3db 100644\n--- a/CHANGELOG.md\n+++ b/CHANGELOG.md\n@@ -1,3 +1,6 @@\n+### Version 9.4.1\n+* 404 responses are no longer swallowed for `void` return types.\n+\n ### Version 9.4\n * Adds Builder class to JAXBDecoder for disabling namespace-awareness (defaults to true).\n \ndiff --git a/core/src/main/java/feign/SynchronousMethodHandler.java b/core/src/main/java/feign/SynchronousMethodHandler.java\nindex 481ca567..c6c360e0 100644\n--- a/core/src/main/java/feign/SynchronousMethodHandler.java\n+++ b/core/src/main/java/feign/SynchronousMethodHandler.java\n@@ -132,7 +132,7 @@ final class SynchronousMethodHandler implements MethodHandler {\n         } else {\n           return decode(response);\n         }\n-      } else if (decode404 && response.status() == 404) {\n+      } else if (decode404 && response.status() == 404 && void.class != metadata.returnType()) {\n         return decode(response);\n       } else {\n         throw errorDecoder.decode(metadata.configKey(), response);\ndiff --git a/core/src/test/java/feign/FeignTest.java b/core/src/test/java/feign/FeignTest.java\nindex b4eca659..29ae20c7 100644\n--- a/core/src/test/java/feign/FeignTest.java\n+++ b/core/src/test/java/feign/FeignTest.java\n@@ -23,6 +23,7 @@ import okhttp3.mockwebserver.SocketPolicy;\n import okhttp3.mockwebserver.MockWebServer;\n \n import java.util.Collection;\n+import java.util.Collections;\n import java.util.LinkedHashMap;\n import okio.Buffer;\n import org.assertj.core.api.Fail;\n@@ -597,6 +598,18 @@ public class FeignTest {\n     api.post();\n   }\n \n+  @Test\n+  public void decodingDoesNotSwallow404ErrorsInDecode404Mode() throws Exception {\n+    server.enqueue(new MockResponse().setResponseCode(404));\n+    thrown.expect(IllegalArgumentException.class);\n+\n+    TestInterface api = new TestInterfaceBuilder()\n+        .decode404()\n+        .errorDecoder(new IllegalArgumentExceptionOn404())\n+        .target(\"http://localhost:\" + server.getPort());\n+    api.queryMap(Collections.emptyMap());\n+  }\n+\n   @Test\n   public void okIfEncodeRootCauseHasNoMessage() throws Exception {\n     server.enqueue(new MockResponse().setBody(\"success!\"));\n@@ -805,6 +818,17 @@ public class FeignTest {\n     }\n   }\n \n+  static class IllegalArgumentExceptionOn404 extends ErrorDecoder.Default {\n+\n+    @Override\n+    public Exception decode(String methodKey, Response response) {\n+      if (response.status() == 404) {\n+        return new IllegalArgumentException(\"bad zone name\");\n+      }\n+      return super.decode(methodKey, response);\n+    }\n+  }\n+\n   static final class TestInterfaceBuilder {\n \n     private final Feign.Builder delegate = new Feign.Builder()",
    "Add committers and update talks": "diff --git a/site/_data/contributors.yml b/site/_data/contributors.yml\nindex 6aa3b44c6..c97fdcc67 100644\n--- a/site/_data/contributors.yml\n+++ b/site/_data/contributors.yml\n@@ -31,6 +31,11 @@\n   githubId: ashutoshc\n   org: Hortonworks\n   role: PMC\n+- name: Francis Chuang\n+  apacheId: francischuang\n+  githubId: F21\n+  org: Boostport\n+  role: Committer\n - name: James R. Taylor\n   apacheId: jamestaylor\n   githubId: JamesRTaylor\n@@ -84,11 +89,19 @@\n   org: Indiana University\n   role: Committer\n   homepage: http://milinda.pathirage.org/\n+- name: MinJi Kim\n+  apacheId: minji\n+  githubId: minji-kim\n+  org: Dremio\n+  role: Committer\n+  avatar: http://web.mit.edu/minjikim/www/minji.png\n+  homepage: http://web.mit.edu/minjikim/www/\n - name: Nick Dimiduk\n   apacheId: ndimiduk\n   githubId: ndimiduk\n   org: Hortonworks\n   role: PMC\n+  homepage: http://www.n10k.com\n - name: Steven Noels\n   apacheId: stevenn\n   githubId: stevenn\ndiff --git a/site/community/index.md b/site/community/index.md\nindex bfbbd96a3..868c4b36b 100644\n--- a/site/community/index.md\n+++ b/site/community/index.md\n@@ -26,13 +26,13 @@\n \n # Upcoming talks\n \n-* 2016/06/29 <a href=\"http://hadoopsummit.org/san-jose/agenda/\">Hadoop Summit</a>, San Jose\n+* 2016/09/12 <a href=\"http://flink-forward.org/program/sessions/\">Flink Forward</a>, Berlin\n \n # Project Members\n \n Name (Apache ID) | Github | Org | Role\n :--------------- | :----- | :-- | :---\n-{% for c in site.data.contributors %}  {{ c.name }} (<a href=\"http://people.apache.org/phonebook.html?uid={{ c.apacheId }}\">{{ c.apacheId }}</a>) | <a href=\"http://github.com/{{ c.githubId }}\"><img width=\"64\" src=\"{% unless c.avatar %}http://github.com/{{ c.githubId }}.png{% else %}{{ c.avatar }}{% endunless %}\"></a> | {{ c.org }} | {{ c.role }}\n+{% for c in site.data.contributors %}{% if c.homepage %}<a href=\"{{ c.homepage }}\">{{ c.name }}</a>{% else %}{{ c.name }}{% endif %} (<a href=\"http://people.apache.org/phonebook.html?uid={{ c.apacheId }}\">{{ c.apacheId }}</a>) | <a href=\"http://github.com/{{ c.githubId }}\"><img width=\"64\" src=\"{% unless c.avatar %}http://github.com/{{ c.githubId }}.png{% else %}{{ c.avatar }}{% endunless %}\"></a> | {{ c.org }} | {{ c.role }}\n {% endfor %}\n \n # Mailing Lists\n@@ -88,27 +88,23 @@ ## Apache Calcite: One planner fits all\n \n {% oembed https://www.youtube.com/watch?v=5_MyORYjq3w %}\n \n-## Why you care about relational algebra (even though you didn't know it)\n-\n-Washington DC, April 2015;\n-[[slides](http://www.slideshare.net/julianhyde/calcite-algebraedw2015)].\n-\n-<iframe src=\"//www.slideshare.net/slideshow/embed_code/key/vfVDu6y1mAM5Dl\" width=\"629\" height=\"355\" frameborder=\"0\" marginwidth=\"0\" marginheight=\"0\" scrolling=\"no\" style=\"border:1px solid #CCC; border-width:1px; margin-bottom:5px; max-width: 100%;\" allowfullscreen> </iframe>\n-\n-## Apache Calcite overview\n+## Streaming SQL\n \n-Apache Kylin meetup, 2014;\n-[[slides](http://www.slideshare.net/julianhyde/apache-calcite-overview)].\n+At Hadoop Summit, San Jose, CA, 2016\n+[[video](https://www.youtube.com/watch?v=b7HENkvd1uU)],\n+[[slides](http://www.slideshare.net/julianhyde/streaming-sql-63554778)],\n+[[pdf](https://github.com/julianhyde/share/blob/master/slides/calcite-streaming-sql-san-jose-2016.pdf?raw=true)].\n \n-<iframe src=\"//www.slideshare.net/slideshow/embed_code/key/fCGsAedsQiq53V\" width=\"629\" height=\"354\" frameborder=\"0\" marginwidth=\"0\" marginheight=\"0\" scrolling=\"no\" style=\"border:1px solid #CCC; border-width:1px; margin-bottom:5px; max-width: 100%;\" allowfullscreen> </iframe>\n+{% oembed https://www.youtube.com/watch?v=b7HENkvd1uU %}\n \n-## Streaming SQL\n+## Cost-based Query Optimization in Apache Phoenix using Apache Calcite\n \n-At Samza meetup, Mountain View, CA, 2016\n-[[video](http://www.ustream.tv/recorded/83322450#to00:55:48)],\n-[[slides](http://www.slideshare.net/julianhyde/streaming-sql)].\n+At Hadoop Summit, San Jose, CA, 2016\n+[[video](https://www.youtube.com/watch?v=gz9X7JD8BAU)],\n+[[slides](http://www.slideshare.net/julianhyde/costbased-query-optimization-in-apache-phoenix-using-apache-calcite)],\n+[[pdf](https://github.com/julianhyde/share/blob/master/slides/phoenix-on-calcite-hadoop-summit-2016.pdf?raw=true)].\n \n-<iframe src=\"//www.slideshare.net/slideshow/embed_code/key/rzaptOy3H8K6Gz\" width=\"595\" height=\"485\" frameborder=\"0\" marginwidth=\"0\" marginheight=\"0\" scrolling=\"no\" style=\"border:1px solid #CCC; border-width:1px; margin-bottom:5px; max-width: 100%;\" allowfullscreen> </iframe>\n+{% oembed https://www.youtube.com/watch?v=gz9X7JD8BAU %}\n \n ## Planning with Polyalgebra: Bringing together relational, complex and machine learning algebra\n \n@@ -120,11 +116,9 @@ ## Planning with Polyalgebra: Bringing together relational, complex and machine\n \n ## More talks\n \n-* <a href=\"https://github.com/julianhyde/share/blob/master/slides/calcite-streaming-sql-xldb-2016.pdf?raw=true\">Streaming SQL</a> (XLDB, Menlo Park, 2016)\n+* <a href=\"https://github.com/julianhyde/share/blob/master/slides/calcite-algebra-edw-2015.pdf?raw=true\">Why you care about relational algebra (even though you didn't know it)</a> (Washington DC, 2015)\n * <a href=\"https://github.com/julianhyde/share/blob/master/slides/hive-cbo-seattle-2014.pdf?raw=true\">Cost-based optimization in Hive 0.14</a> (Seattle, 2014)\n * <a href=\"https://github.com/julianhyde/share/blob/master/slides/dmmq-summit-2014.pdf?raw=true\">Discardable, in-memory materialized query for Hadoop</a> (<a href=\"https://www.youtube.com/watch?v=CziGOa8GXqI\">video</a>) (Hadoop Summit, 2014)\n-* <a href=\"https://github.com/julianhyde/share/blob/master/slides/hive-cbo-summit-2014.pdf?raw=true\">Cost-based optimization in Hive</a> (<a href=\"https://www.youtube.com/watch?v=vpG5noIbEFs\">video</a>) (Hadoop Summit, 2014)\n * <a href=\"https://github.com/julianhyde/share/blob/master/slides/optiq-nosql-now-2013.pdf?raw=true\">SQL Now!</a> (NoSQL Now! conference, 2013)\n-* <a href=\"https://github.com/julianhyde/share/blob/master/slides/optiq-richrelevance-2013.pdf?raw=true\">SQL on Big Data using Optiq</a> (2013)\n * <a href=\"https://github.com/julianhyde/share/blob/master/slides/optiq-drill-user-group-2013.pdf?raw=true\">Drill / SQL / Optiq</a> (2013)\n * <a href=\"http://www.slideshare.net/julianhyde/how-to-integrate-splunk-with-any-data-solution\">How to integrate Splunk with any data solution</a> (Splunk User Conference, 2012)",
    "added missing defs .": "diff --git a/src/test/groovy/bugs/VariablePrecedence.groovy b/src/test/groovy/bugs/VariablePrecedence.groovy\nindex 768340a731..9c19694cea 100644\n--- a/src/test/groovy/bugs/VariablePrecedence.groovy\n+++ b/src/test/groovy/bugs/VariablePrecedence.groovy\n@@ -13,10 +13,10 @@ class VariblePrecedence extends GroovyTestCase {\n                 @Property c = {x -> assert x == 1; assert y == 93; }\n \n                 static void main(args) {\n-                    vfoo = new VariableFoo()\n+                    def vfoo = new VariableFoo()\n                     vfoo.c.call(1)\n \n-                    z = 874;\n+                    def z = 874;\n                     1.times {",
    "Add information about supported drafts": "diff --git a/components/camel-json-validator/src/main/docs/json-validator-component.adoc b/components/camel-json-validator/src/main/docs/json-validator-component.adoc\nindex a8bf7c6aeac..dbd8f9f5fb5 100644\n--- a/components/camel-json-validator/src/main/docs/json-validator-component.adoc\n+++ b/components/camel-json-validator/src/main/docs/json-validator-component.adoc\n@@ -12,7 +12,7 @@\n *{component-header}*\n \n The JSON Schema Validator component performs bean validation of the message body\n-against JSON Schemas v4 draft using the NetworkNT JSON Schema library\n+against JSON Schemas v4, v6, v7 and v2019-09 draft using the NetworkNT JSON Schema library\n (https://github.com/networknt/json-schema-validator).\n \n Maven users will need to add the following dependency to their `pom.xml`",
    "Remove unnecessary variable": "diff --git a/OsmAnd/src/net/osmand/plus/mapcontextmenu/other/MultiSelectionArrayAdapter.java b/OsmAnd/src/net/osmand/plus/mapcontextmenu/other/MultiSelectionArrayAdapter.java\nindex b95304082e..ecfb0b6f89 100644\n--- a/OsmAnd/src/net/osmand/plus/mapcontextmenu/other/MultiSelectionArrayAdapter.java\n+++ b/OsmAnd/src/net/osmand/plus/mapcontextmenu/other/MultiSelectionArrayAdapter.java\n@@ -33,15 +33,14 @@ public class MultiSelectionArrayAdapter extends ArrayAdapter<MapMultiSelectionMe\n \t@NonNull\n \t@Override\n \tpublic View getView(final int position, @Nullable View convertView, @NonNull ViewGroup parent) {\n-\t\tView v = convertView;\n-\t\tif (v == null) {\n-\t\t\tv = menu.getMapActivity().getLayoutInflater().inflate(R.layout.menu_obj_list_item, parent, false);\n+\t\tif (convertView == null) {\n+\t\t\tconvertView = menu.getMapActivity().getLayoutInflater().inflate(R.layout.menu_obj_list_item, parent, false);\n \t\t}\n \t\tfinal MapMultiSelectionMenu.MenuObject item = getItem(position);\n \t\tif (item != null) {\n-\t\t\tView contentView = v.findViewById(R.id.content);\n+\t\t\tView contentView = convertView.findViewById(R.id.content);\n \t\t\tAndroidUtils.setBackground(menu.getMapActivity(), contentView, !menu.isLight(), R.drawable.expandable_list_item_background_light, R.drawable.expandable_list_item_background_dark);\n-\t\t\tv.setOnClickListener(new View.OnClickListener() {\n+\t\t\tcontentView.setOnClickListener(new View.OnClickListener() {\n \t\t\t\t@Override\n \t\t\t\tpublic void onClick(View view) {\n \t\t\t\t\tif (listener != null) {\n@@ -50,8 +49,8 @@ public class MultiSelectionArrayAdapter extends ArrayAdapter<MapMultiSelectionMe\n \t\t\t\t}\n \t\t\t});\n \t\t\tIconsCache iconsCache = menu.getMapActivity().getMyApplication().getIconsCache();\n-\t\t\tfinal View iconLayout = v.findViewById(R.id.context_menu_icon_layout);\n-\t\t\tfinal ImageView iconView = (ImageView) v.findViewById(R.id.context_menu_icon_view);\n+\t\t\tfinal View iconLayout = contentView.findViewById(R.id.context_menu_icon_layout);\n+\t\t\tfinal ImageView iconView = (ImageView) contentView.findViewById(R.id.context_menu_icon_view);\n \t\t\tDrawable icon = item.getLeftIcon();\n \t\t\tint iconId = item.getLeftIconId();\n \t\t\tif (icon != null) {\n@@ -66,13 +65,13 @@ public class MultiSelectionArrayAdapter extends ArrayAdapter<MapMultiSelectionMe\n \t\t\t}\n \n \t\t\t// Text line 1\n-\t\t\tTextView line1 = (TextView) v.findViewById(R.id.context_menu_line1);\n-\t\t\t((TextView) v.findViewById(R.id.context_menu_line1)).setTextColor(ContextCompat.getColor(getContext(),\n+\t\t\tTextView line1 = (TextView) contentView.findViewById(R.id.context_menu_line1);\n+\t\t\t((TextView) contentView.findViewById(R.id.context_menu_line1)).setTextColor(ContextCompat.getColor(getContext(),\n \t\t\t\t\t!menu.isLight() ? R.color.ctx_menu_title_color_dark : R.color.ctx_menu_title_color_light));\n \t\t\tline1.setText(item.getTitleStr());\n \n \t\t\t// Text line 2\n-\t\t\tTextView line2 = (TextView) v.findViewById(R.id.context_menu_line2);\n+\t\t\tTextView line2 = (TextView) contentView.findViewById(R.id.context_menu_line2);\n \t\t\t((TextView) line2).setTextColor(ContextCompat.getColor(getContext(), R.color.ctx_menu_subtitle_color));\n \t\t\tline2.setText(item.getTypeStr());\n \t\t\tDrawable slIcon = item.getTypeIcon();\n@@ -80,11 +79,11 @@ public class MultiSelectionArrayAdapter extends ArrayAdapter<MapMultiSelectionMe\n \t\t\tline2.setCompoundDrawablePadding(AndroidUtils.dpToPx(menu.getMapActivity(), 5f));\n \n \t\t\t// Divider\n-\t\t\tView divider = v.findViewById(R.id.divider);\n+\t\t\tView divider = contentView.findViewById(R.id.divider);\n \t\t\tdivider.setVisibility(position != getCount() - 1 ? View.VISIBLE : View.GONE);\n \t\t}\n \n-\t\treturn v;\n+\t\treturn convertView;\n \t}\n \n \tpublic interface OnClickListener {",
    "prepare release druid - 0 . 6 . 81": "diff --git a/cassandra-storage/pom.xml b/cassandra-storage/pom.xml\nindex 68de8a7660..7cda6fb88d 100644\n--- a/cassandra-storage/pom.xml\n+++ b/cassandra-storage/pom.xml\n@@ -28,7 +28,7 @@\n     <parent>\n         <groupId>io.druid</groupId>\n         <artifactId>druid</artifactId>\n-        <version>0.6.81-SNAPSHOT</version>\n+        <version>0.6.81</version>\n     </parent>\n \n     <dependencies>\ndiff --git a/common/pom.xml b/common/pom.xml\nindex 0adb98fd1f..d0671efd51 100644\n--- a/common/pom.xml\n+++ b/common/pom.xml\n@@ -28,7 +28,7 @@\n     <parent>\n         <groupId>io.druid</groupId>\n         <artifactId>druid</artifactId>\n-        <version>0.6.81-SNAPSHOT</version>\n+        <version>0.6.81</version>\n     </parent>\n \n     <dependencies>\ndiff --git a/examples/pom.xml b/examples/pom.xml\nindex e647791d61..5b0dc254b7 100644\n--- a/examples/pom.xml\n+++ b/examples/pom.xml\n@@ -28,7 +28,7 @@\n     <parent>\n         <groupId>io.druid</groupId>\n         <artifactId>druid</artifactId>\n-        <version>0.6.81-SNAPSHOT</version>\n+        <version>0.6.81</version>\n     </parent>\n \n     <dependencies>\ndiff --git a/hdfs-storage/pom.xml b/hdfs-storage/pom.xml\nindex 91ab2acf1b..06bc14b377 100644\n--- a/hdfs-storage/pom.xml\n+++ b/hdfs-storage/pom.xml\n@@ -28,7 +28,7 @@\n     <parent>\n         <groupId>io.druid</groupId>\n         <artifactId>druid</artifactId>\n-        <version>0.6.81-SNAPSHOT</version>\n+        <version>0.6.81</version>\n     </parent>\n \n     <dependencies>\ndiff --git a/hll/pom.xml b/hll/pom.xml\nindex a62529fea2..4b55b7ead7 100644\n--- a/hll/pom.xml\n+++ b/hll/pom.xml\n@@ -28,7 +28,7 @@\n     <parent>\n         <groupId>io.druid</groupId>\n         <artifactId>druid</artifactId>\n-        <version>0.6.81-SNAPSHOT</version>\n+        <version>0.6.81</version>\n     </parent>\n \n     <dependencies>\ndiff --git a/indexing-hadoop/pom.xml b/indexing-hadoop/pom.xml\nindex 39a20013a8..c111c49332 100644\n--- a/indexing-hadoop/pom.xml\n+++ b/indexing-hadoop/pom.xml\n@@ -28,7 +28,7 @@\n     <parent>\n         <groupId>io.druid</groupId>\n         <artifactId>druid</artifactId>\n-        <version>0.6.81-SNAPSHOT</version>\n+        <version>0.6.81</version>\n     </parent>\n \n     <dependencies>\ndiff --git a/indexing-service/pom.xml b/indexing-service/pom.xml\nindex f52847b388..1f90d9adff 100644\n--- a/indexing-service/pom.xml\n+++ b/indexing-service/pom.xml\n@@ -28,7 +28,7 @@\n     <parent>\n         <groupId>io.druid</groupId>\n         <artifactId>druid</artifactId>\n-        <version>0.6.81-SNAPSHOT</version>\n+        <version>0.6.81</version>\n     </parent>\n \n     <dependencies>\ndiff --git a/kafka-eight/pom.xml b/kafka-eight/pom.xml\nindex a106154146..73b32daefa 100644\n--- a/kafka-eight/pom.xml\n+++ b/kafka-eight/pom.xml\n@@ -28,7 +28,7 @@\n     <parent>\n         <groupId>io.druid</groupId>\n         <artifactId>druid</artifactId>\n-        <version>0.6.81-SNAPSHOT</version>\n+        <version>0.6.81</version>\n     </parent>\n \n     <dependencies>\ndiff --git a/kafka-seven/pom.xml b/kafka-seven/pom.xml\nindex 3bc37a898e..cf00e1618f 100644\n--- a/kafka-seven/pom.xml\n+++ b/kafka-seven/pom.xml\n@@ -28,7 +28,7 @@\n     <parent>\n         <groupId>io.druid</groupId>\n         <artifactId>druid</artifactId>\n-        <version>0.6.81-SNAPSHOT</version>\n+        <version>0.6.81</version>\n     </parent>\n \n     <dependencies>\ndiff --git a/pom.xml b/pom.xml\nindex afe6a2398c..e30ce738c1 100644\n--- a/pom.xml\n+++ b/pom.xml\n@@ -23,14 +23,14 @@\n     <groupId>io.druid</groupId>\n     <artifactId>druid</artifactId>\n     <packaging>pom</packaging>\n-    <version>0.6.81-SNAPSHOT</version>\n+    <version>0.6.81</version>\n     <name>druid</name>\n     <description>druid</description>\n     <scm>\n         <connection>scm:git:ssh://git@github.com/metamx/druid.git</connection>\n         <developerConnection>scm:git:ssh://git@github.com/metamx/druid.git</developerConnection>\n         <url>http://www.github.com/metamx/druid</url>\n-        <tag>druid-0.6.81-SNAPSHOT</tag>\n+        <tag>druid-0.6.81</tag>\n     </scm>\n \n     <prerequisites>\ndiff --git a/processing/pom.xml b/processing/pom.xml\nindex 10e377fc61..27167453df 100644\n--- a/processing/pom.xml\n+++ b/processing/pom.xml\n@@ -28,7 +28,7 @@\n     <parent>\n         <groupId>io.druid</groupId>\n         <artifactId>druid</artifactId>\n-        <version>0.6.81-SNAPSHOT</version>\n+        <version>0.6.81</version>\n     </parent>\n \n     <dependencies>\ndiff --git a/rabbitmq/pom.xml b/rabbitmq/pom.xml\nindex 1980648b07..dde351c627 100644\n--- a/rabbitmq/pom.xml\n+++ b/rabbitmq/pom.xml\n@@ -9,7 +9,7 @@\n     <parent>\n         <groupId>io.druid</groupId>\n         <artifactId>druid</artifactId>\n-        <version>0.6.81-SNAPSHOT</version>\n+        <version>0.6.81</version>\n     </parent>\n \n     <dependencies>\ndiff --git a/s3-extensions/pom.xml b/s3-extensions/pom.xml\nindex b2fc5d67e8..1f03e95288 100644\n--- a/s3-extensions/pom.xml\n+++ b/s3-extensions/pom.xml\n@@ -28,7 +28,7 @@\n     <parent>\n         <groupId>io.druid</groupId>\n         <artifactId>druid</artifactId>\n-        <version>0.6.81-SNAPSHOT</version>\n+        <version>0.6.81</version>\n     </parent>\n \n     <dependencies>\ndiff --git a/server/pom.xml b/server/pom.xml\nindex b255ee1964..8a9be39b0a 100644\n--- a/server/pom.xml\n+++ b/server/pom.xml\n@@ -28,7 +28,7 @@\n     <parent>\n         <groupId>io.druid</groupId>\n         <artifactId>druid</artifactId>\n-        <version>0.6.81-SNAPSHOT</version>\n+        <version>0.6.81</version>\n     </parent>\n \n     <dependencies>\ndiff --git a/services/pom.xml b/services/pom.xml\nindex 9871b771d1..563f20a523 100644\n--- a/services/pom.xml\n+++ b/services/pom.xml\n@@ -27,7 +27,7 @@\n     <parent>\n         <groupId>io.druid</groupId>\n         <artifactId>druid</artifactId>\n-        <version>0.6.81-SNAPSHOT</version>\n+        <version>0.6.81</version>\n     </parent>\n \n     <dependencies>",
    "Publish Ui Version 1 . 6 . 0": "diff --git a/caprice/release/sample.apk b/caprice/release/sample.apk\nindex ba6524a..35818d1 100644\nBinary files a/caprice/release/sample.apk and b/caprice/release/sample.apk differ\ndiff --git a/caprice/sample/build.gradle b/caprice/sample/build.gradle\nindex 7bdd8e7..d680a86 100644\n--- a/caprice/sample/build.gradle\n+++ b/caprice/sample/build.gradle\n@@ -34,5 +34,5 @@ dependencies {\n     compile 'net.qiujuer.genius:blur:1.5.0'\n     compile 'net.qiujuer.genius:kit:1.5.0'\n     compile 'net.qiujuer.genius:res:1.5.0'\n-    compile project(':ui')\n+    compile 'net.qiujuer.genius:ui:1.6.0'\n }\ndiff --git a/caprice/sample/sample-release.apk b/caprice/sample/sample-release.apk\nnew file mode 100644\nindex 0000000..35818d1\nBinary files /dev/null and b/caprice/sample/sample-release.apk differ\ndiff --git a/caprice/ui/gradle.properties b/caprice/ui/gradle.properties\nindex 5950461..54a0710 100644\n--- a/caprice/ui/gradle.properties\n+++ b/caprice/ui/gradle.properties\n@@ -2,5 +2,5 @@ POM_BINTRAY_NAME=net.qiujuer.genius:ui\n POM_DESCRIPTION=Genius Android ui module.\n POM_ARTIFACT_ID=ui\n \n-VERSION_NAME=1.5.2\n-VERSION_CODE=152\n\\ No newline at end of file\n+VERSION_NAME=1.6.0\n+VERSION_CODE=160\n\\ No newline at end of file",
    "Tolerate unexpected exception types in SkyframeBuilder : no need to crash . . PiperOrigin - RevId : 310614062": "diff --git a/src/main/java/com/google/devtools/build/lib/buildtool/SkyframeBuilder.java b/src/main/java/com/google/devtools/build/lib/buildtool/SkyframeBuilder.java\nindex e6bef88634..89490aa4b2 100644\n--- a/src/main/java/com/google/devtools/build/lib/buildtool/SkyframeBuilder.java\n+++ b/src/main/java/com/google/devtools/build/lib/buildtool/SkyframeBuilder.java\n@@ -15,6 +15,7 @@ package com.google.devtools.build.lib.buildtool;\n \n import com.google.common.annotations.VisibleForTesting;\n import com.google.common.base.Preconditions;\n+import com.google.common.base.Throwables;\n import com.google.common.collect.ImmutableSet;\n import com.google.common.collect.Range;\n import com.google.common.collect.Sets;\n@@ -32,6 +33,7 @@ import com.google.devtools.build.lib.actions.TestExecException;\n import com.google.devtools.build.lib.analysis.ConfiguredTarget;\n import com.google.devtools.build.lib.analysis.TopLevelArtifactContext;\n import com.google.devtools.build.lib.analysis.test.TestProvider;\n+import com.google.devtools.build.lib.bugreport.BugReport;\n import com.google.devtools.build.lib.buildtool.buildevent.ExecutionProgressReceiverAvailableEvent;\n import com.google.devtools.build.lib.events.ExtendedEventHandler;\n import com.google.devtools.build.lib.events.Reporter;\n@@ -309,6 +311,7 @@ public class SkyframeBuilder implements Builder {\n   /** Figure out why an action's execution failed and rethrow the right kind of exception. */\n   @VisibleForTesting\n   public static void rethrow(Throwable cause) throws BuildFailedException, TestExecException {\n+    Throwables.throwIfUnchecked(cause);\n     Throwable innerCause = cause.getCause();\n     if (innerCause instanceof TestExecException) {\n       throw (TestExecException) innerCause;\n@@ -333,16 +336,14 @@ public class SkyframeBuilder implements Builder {\n       // failures reading those packages shouldn't terminate the build, but in Skyframe they do.\n       LoggingUtil.logToRemote(Level.WARNING, \"undesirable loading exception\", cause);\n       throw new BuildFailedException(cause.getMessage());\n-    } else if (cause instanceof RuntimeException) {\n-      throw (RuntimeException) cause;\n-    } else if (cause instanceof Error) {\n-      throw (Error) cause;\n     } else {\n       // We encountered an exception we don't think we should have encountered. This can indicate\n-      // a bug in our code, such as lower level exceptions not being properly handled, or in our\n-      // expectations in this method.\n-      throw new IllegalArgumentException(\n-          \"action terminated with \" + \"unexpected exception: \" + cause.getMessage(), cause);\n+      // an exception-processing bug in our code, such as lower level exceptions not being properly\n+      // handled, or in our expectations in this method.\n+      BugReport.sendBugReport(\n+          new IllegalStateException(\"action terminated with unexpected exception\", cause));\n+      throw new BuildFailedException(\n+          \"Unexpected exception, please file an issue with the Bazel team: \" + cause.getMessage());\n     }\n   }\n ",
    "Replace constants ( static final CONSTANT_CASE ) declaration type which use the general collection interface ( e . g .": "diff --git a/guava/src/com/google/common/util/concurrent/CycleDetectingLockFactory.java b/guava/src/com/google/common/util/concurrent/CycleDetectingLockFactory.java\nindex 6af73fe99a..5d09d10bc0 100644\n--- a/guava/src/com/google/common/util/concurrent/CycleDetectingLockFactory.java\n+++ b/guava/src/com/google/common/util/concurrent/CycleDetectingLockFactory.java\n@@ -491,7 +491,7 @@ public class CycleDetectingLockFactory {\n \n     static final StackTraceElement[] EMPTY_STACK_TRACE = new StackTraceElement[0];\n \n-    static final Set<String> EXCLUDED_CLASS_NAMES =\n+    static final ImmutableSet<String> EXCLUDED_CLASS_NAMES =\n         ImmutableSet.of(\n             CycleDetectingLockFactory.class.getName(),\n             ExampleStackTrace.class.getName(),",
    "Add formattingDiffUsing to Correspondence . . ( There are a few bits of documentation cleanup left to do after this , which will happen in a follow - up CL . ) .": "diff --git a/core/src/main/java/com/google/common/truth/Correspondence.java b/core/src/main/java/com/google/common/truth/Correspondence.java\nindex 7c8a09bf9..711f55007 100644\n--- a/core/src/main/java/com/google/common/truth/Correspondence.java\n+++ b/core/src/main/java/com/google/common/truth/Correspondence.java\n@@ -67,7 +67,8 @@ public abstract class Correspondence<A, E> {\n    * Constructs a {@link Correspondence} that compares actual and expected elements using the given\n    * binary predicate.\n    *\n-   * <p>The correspondence does not support formatting of diffs (see {@link #formatDiff}).\n+   * <p>The correspondence does not support formatting of diffs (see {@link #formatDiff}). You can\n+   * add that behaviour by calling {@link Correspondence#formattingDiffsUsing}.\n    *\n    * <p>Note that, if the data you are asserting about contains nulls, your predicate may be invoked\n    * with null arguments. If this causes it to throw a {@link NullPointerException}, then your test\n@@ -86,11 +87,11 @@ public abstract class Correspondence<A, E> {\n    *\n    * <pre>{@code\n    * class MyRecordTestHelper {\n-   *   static boolean recordsEquivalentForTests(MyRecord actual, MyRecord expected) {\n+   *   static boolean recordsEquivalent(@Nullable MyRecord actual, @Nullable MyRecord expected) {\n    *     // code to check whether records should be considered equivalent for testing purposes\n    *   }\n    *   static final Correspondence<MyRecord, MyRecord> EQUIVALENCE =\n-   *       Correspondence.from(MyRecordTestHelper::recordsEquivalentForTests, \"is equivalent to\");\n+   *       Correspondence.from(MyRecordTestHelper::recordsEquivalent, \"is equivalent to\");\n    * }\n    * }</pre>\n    *\n@@ -107,7 +108,6 @@ public abstract class Correspondence<A, E> {\n    *     <some actual element> is an element that <description> <some expected element>\"}, e.g.\n    *     {@code \"starts with\"}, {@code \"is an instance of\"}, or {@code \"is equivalent to\"}\n    */\n-  // TODO(b/119038898): Mention formattingDiffsUsing in the javadoc when it exists.\n   public static <A, E> Correspondence<A, E> from(\n       BinaryPredicate<A, E> predicate, String description) {\n     return new FromBinaryPredicate<>(predicate, description);\n@@ -157,7 +157,8 @@ public abstract class Correspondence<A, E> {\n    * transformed actual element (i.e. the output of the given function) is null, it will correspond\n    * to a null expected element.\n    *\n-   * <p>The correspondence does not support formatting of diffs (see {@link #formatDiff}).\n+   * <p>The correspondence does not support formatting of diffs (see {@link #formatDiff}). You can\n+   * add that behaviour by calling {@link Correspondence#formattingDiffsUsing}.\n    *\n    * <p>Note that, if you the data you are asserting about contains null actual values, your\n    * function may be invoked with a null argument. If this causes it to throw a {@link\n@@ -186,7 +187,6 @@ public abstract class Correspondence<A, E> {\n    *     <some actual element> is an element that <description> <some expected element>\"}, e.g.\n    *     {@code \"has an ID of\"}\n    */\n-  // TODO(b/119038898): Mention formattingDiffsUsing in the javadoc when it exists.\n   public static <A, E> Correspondence<A, E> transforming(\n       Function<A, ? extends E> actualTransform, String description) {\n     return new Transforming<>(actualTransform, identity(), description);\n@@ -198,7 +198,8 @@ public abstract class Correspondence<A, E> {\n    * an actual element is transformed to null, it will correspond to an expected element that is\n    * also transformed to null.\n    *\n-   * <p>The correspondence does not support formatting of diffs (see {@link #formatDiff}).\n+   * <p>The correspondence does not support formatting of diffs (see {@link #formatDiff}). You can\n+   * add that behaviour by calling {@link Correspondence#formattingDiffsUsing}.\n    *\n    * <p>Note that, if you the data you are asserting about contains null actual or expected values,\n    * the appropriate function may be invoked with a null argument. If this causes it to throw a\n@@ -233,7 +234,6 @@ public abstract class Correspondence<A, E> {\n    *     <some actual element> is an element that <description> <some expected element>\"}, e.g.\n    *     {@code \"has the same ID as\"}\n    */\n-  // TODO(b/119038898): Mention formattingDiffsUsing in the javadoc when it exists.\n   public static <A, E> Correspondence<A, E> transforming(\n       Function<A, ?> actualTransform, Function<E, ?> expectedTransform, String description) {\n     return new Transforming<>(actualTransform, expectedTransform, description);\n@@ -311,6 +311,83 @@ public abstract class Correspondence<A, E> {\n   // TODO(b/119038898): Once all functionality is available via factory methods, consider explicitly\n   // adding the no-arg constructor here, and use its javadoc to discourage subclassing.\n \n+  /**\n+   * Returns a new correspondence which is like this one, except that the given formatter may be\n+   * used to format the difference between a pair of elements that do not correspond.\n+   *\n+   * <p>Note that, if you the data you are asserting about contains null actual or expected values,\n+   * the formatter may be invoked with a null argument. If this causes it to throw a {@link\n+   * NullPointerException}, that will be taken to indicate that the values cannot be diffed. (See\n+   * {@link Correspondence#formatDiff} for more detail on how exceptions are handled.) If you think\n+   * null values are likely, it is slightly cleaner to have the formatter return null in that case\n+   * instead of throwing.\n+   *\n+   * <p>Example:\n+   *\n+   * <pre>{@code\n+   * class MyRecordTestHelper {\n+   *   static boolean recordsEquivalent(@Nullable MyRecord actual, @Nullable MyRecord expected) {\n+   *     // code to check whether records should be considered equivalent for testing purposes\n+   *   }\n+   *   static String formatRecordDiff(@Nullable MyRecord actual, @Nullable MyRecord expected) {\n+   *     // code to format the diff between the records\n+   *   }\n+   *   static final Correspondence<MyRecord, MyRecord> EQUIVALENCE =\n+   *       Correspondence.from(MyRecordTestHelper::recordsEquivalent, \"is equivalent to\")\n+   *           .formattingDiffsUsing(MyRecordTestHelper::formatRecordDiff);\n+   * }\n+   * }</pre>\n+   */\n+  public Correspondence<A, E> formattingDiffsUsing(DiffFormatter<? super A, ? super E> formatter) {\n+    return new FormattingDiffs<>(this, formatter);\n+  }\n+\n+  /**\n+   * A functional interface to be used format the diff between a pair of objects of types {@code A}\n+   * and {@code E}.\n+   *\n+   * <p>This interface will normally be implemented using a lambda or a method reference, and the\n+   * resulting object will normally be passed directly to {@link\n+   * Correspondence#formattingDiffsUsing}. As a result, you should almost never see {@code\n+   * DiffFormatter} used as the type of a field or variable, or a return type.\n+   */\n+  public interface DiffFormatter<A, E> {\n+\n+    /**\n+     * Returns a {@link String} describing the difference between the {@code actual} and {@code\n+     * expected} values, if possible, or {@code null} if not.\n+     */\n+    @NullableDecl\n+    String formatDiff(@NullableDecl A actual, @NullableDecl E expected);\n+  }\n+\n+  private static class FormattingDiffs<A, E> extends Correspondence<A, E> {\n+\n+    private final Correspondence<A, E> delegate;\n+    private final DiffFormatter<? super A, ? super E> formatter;\n+\n+    FormattingDiffs(Correspondence<A, E> delegate, DiffFormatter<? super A, ? super E> formatter) {\n+      this.delegate = checkNotNull(delegate);\n+      this.formatter = checkNotNull(formatter);\n+    }\n+\n+    @Override\n+    public boolean compare(@NullableDecl A actual, @NullableDecl E expected) {\n+      return delegate.compare(actual, expected);\n+    }\n+\n+    @Override\n+    @NullableDecl\n+    public String formatDiff(@NullableDecl A actual, @NullableDecl E expected) {\n+      return formatter.formatDiff(actual, expected);\n+    }\n+\n+    @Override\n+    public String toString() {\n+      return delegate.toString();\n+    }\n+  }\n+\n   /**\n    * Returns whether or not the {@code actual} value is said to correspond to the {@code expected}\n    * value for the purposes of this test.\ndiff --git a/core/src/test/java/com/google/common/truth/CorrespondenceTest.java b/core/src/test/java/com/google/common/truth/CorrespondenceTest.java\nindex 6bbcd9ed6..d357391a0 100644\n--- a/core/src/test/java/com/google/common/truth/CorrespondenceTest.java\n+++ b/core/src/test/java/com/google/common/truth/CorrespondenceTest.java\n@@ -483,4 +483,85 @@ public final class CorrespondenceTest extends BaseSubjectTestCase {\n             \"Not true that <[1.02, 2.04, 3.08]> contains at least one element that \"\n                 + \"is a finite number within 0.05 of <3.01>\");\n   }\n+\n+  // Tests of formattingDiffsUsing.\n+\n+  private static final Correspondence<String, Integer> LENGTHS_WITH_DIFF =\n+      // If we were allowed to use method references and lambdas here, this would be:\n+      // Correspondence.transforming(String::length, \"has a length of\")\n+      //     .formattingDiffsUsing((a, e) -> Integer.toString(a.length() - e));\n+      Correspondence.transforming(\n+              new Function<String, Integer>() {\n+                @Override\n+                @NullableDecl\n+                public Integer apply(String str) {\n+                  return str.length();\n+                }\n+              },\n+              \"has a length of\")\n+          .formattingDiffsUsing(\n+              new Correspondence.DiffFormatter<String, Integer>() {\n+                @Override\n+                public String formatDiff(String actualString, Integer expectedLength) {\n+                  return Integer.toString(actualString.length() - expectedLength);\n+                }\n+              });\n+\n+  @Test\n+  public void testFormattingDiffsUsing_compare() {\n+    // The compare behaviour should be the same as the wrapped correspondence.\n+    assertThat(LENGTHS_WITH_DIFF.compare(\"foo\", 3)).isTrue();\n+    assertThat(LENGTHS_WITH_DIFF.compare(\"foot\", 4)).isTrue();\n+    assertThat(LENGTHS_WITH_DIFF.compare(\"foo\", 4)).isFalse();\n+  }\n+\n+  @Test\n+  public void testFormattingDiffsUsing_formatDiff() {\n+    assertThat(LENGTHS_WITH_DIFF.formatDiff(\"foo\", 4)).isEqualTo(\"-1\");\n+    assertThat(LENGTHS_WITH_DIFF.formatDiff(\"foot\", 3)).isEqualTo(\"1\");\n+  }\n+\n+  @Test\n+  public void testFormattingDiffsUsing_toString() {\n+    // The toString behaviour should be the same as the wrapped correspondence.\n+    assertThat(LENGTHS_WITH_DIFF.toString()).isEqualTo(\"has a length of\");\n+  }\n+\n+  @Test\n+  public void testFormattingDiffsUsing_viaIterableSubjectContainsExactly_failure() {\n+    expectFailure\n+        .whenTesting()\n+        .that(ImmutableList.of(\"feet\", \"gallons\"))\n+        .comparingElementsUsing(LENGTHS_WITH_DIFF)\n+        .containsExactly(4, 5);\n+    assertThat(expectFailure.getFailure())\n+        .hasMessageThat()\n+        .isEqualTo(\n+            \"Not true that <[feet, gallons]> contains exactly one element that has a length of \"\n+                + \"each element of <[4, 5]>. It is missing an element that has a length of <5> \"\n+                + \"and has unexpected elements <[gallons (diff: 2)]>\");\n+  }\n+\n+  @Test\n+  public void testFormattingDiffsUsing_viaIterableSubjectContainsExactly_nullActual() {\n+    expectFailure\n+        .whenTesting()\n+        .that(asList(\"feet\", null))\n+        .comparingElementsUsing(LENGTHS_WITH_DIFF)\n+        .containsExactly(4, 5);\n+    assertFailureKeys(\n+        \"Not true that <[feet, null]> contains exactly one element that has a length of each \"\n+            + \"element of <[4, 5]>. It is missing an element that has a length of <5> \"\n+            + \"and has unexpected elements <[null]>\",\n+        \"additionally, one or more exceptions were thrown while comparing elements\",\n+        \"first exception\",\n+        \"additionally, one or more exceptions were thrown while formatting diffs\",\n+        \"first exception\");\n+    assertThatFailure()\n+        .factValue(\"first exception\", 0)\n+        .startsWith(\"compare(null, 4) threw java.lang.NullPointerException\");\n+    assertThatFailure()\n+        .factValue(\"first exception\", 1)\n+        .startsWith(\"formatDiff(null, 5) threw java.lang.NullPointerException\");\n+  }\n }",
    "added javadocs": "diff --git a/querydsl-core/src/main/java/com/mysema/query/annotations/PropertyType.java b/querydsl-core/src/main/java/com/mysema/query/annotations/PropertyType.java\nindex 9bfd174c0..3b1c33cf7 100644\n--- a/querydsl-core/src/main/java/com/mysema/query/annotations/PropertyType.java\n+++ b/querydsl-core/src/main/java/com/mysema/query/annotations/PropertyType.java\n@@ -1,32 +1,34 @@\n package com.mysema.query.annotations;\r\n \r\n /**\r\n+ * PropertyType defines the Path type to be used for a Domain property\r\n+ * \r\n  * @author tiwe\r\n  *\r\n  */\r\n public enum PropertyType {\r\n     /**\r\n-     * \r\n+     *  for PDate fields\r\n      */\r\n     DATE,\r\n     /**\r\n-     * \r\n+     *  for PDateTime fields\r\n      */\r\n     DATETIME,\r\n     /**\r\n-     * \r\n+     *  to skip properties\r\n      */\r\n     NONE,\r\n     /**\r\n-     * \r\n+     * for PNumber fields\r\n      */\r\n     NUMERIC,\r\n     /**\r\n-     * \r\n+     * for PSimple fields\r\n      */\r\n     SIMPLE,\r\n     /**\r\n-     * \r\n+     * for PTime fields\r\n      */\r\n     TIME\r\n     \r\ndiff --git a/querydsl-core/src/main/java/com/mysema/query/annotations/QueryType.java b/querydsl-core/src/main/java/com/mysema/query/annotations/QueryType.java\nindex e0053bc62..3a1c4e7be 100644\n--- a/querydsl-core/src/main/java/com/mysema/query/annotations/QueryType.java\n+++ b/querydsl-core/src/main/java/com/mysema/query/annotations/QueryType.java\n@@ -8,10 +8,19 @@ import java.lang.annotation.Documented;\n import java.lang.annotation.Retention;\r\n import java.lang.annotation.Target;\r\n \r\n+/**\r\n+ * QueryType defines the Querydsl property type for a Domain property\r\n+ * \r\n+ * @author tiwe\r\n+ *\r\n+ */\r\n @Documented\r\n @Target({FIELD,METHOD})\r\n @Retention(RUNTIME)\r\n public @interface QueryType {\r\n \r\n+    /**\r\n+     * @return\r\n+     */\r\n     PropertyType value();\r\n }\r",
    "removed unused imports ( <issue_id> )": "diff --git a/src/main/java/com/github/javafaker/Lorem.java b/src/main/java/com/github/javafaker/Lorem.java\nindex f0d1d43..9afde47 100644\n--- a/src/main/java/com/github/javafaker/Lorem.java\n+++ b/src/main/java/com/github/javafaker/Lorem.java\n@@ -1,12 +1,10 @@\n package com.github.javafaker;\n \n-import com.github.javafaker.service.FakeValuesService;\n import com.github.javafaker.service.FakeValuesServiceInterface;\n import com.github.javafaker.service.RandomService;\n import org.apache.commons.lang.StringUtils;\n \n import java.util.ArrayList;\n-import java.util.Collections;\n import java.util.List;\n \n import static org.apache.commons.lang.StringUtils.capitalize;\ndiff --git a/src/test/java/com/github/javafaker/FakerTest.java b/src/test/java/com/github/javafaker/FakerTest.java\nindex de1deeb..78f56da 100644\n--- a/src/test/java/com/github/javafaker/FakerTest.java\n+++ b/src/test/java/com/github/javafaker/FakerTest.java\n@@ -3,11 +3,8 @@ package com.github.javafaker;\n import org.junit.Before;\n import org.junit.Test;\n \n-import java.util.Locale;\n-\n import static com.github.javafaker.matchers.MatchesRegularExpression.matchesRegularExpression;\n import static org.hamcrest.Matchers.isEmptyString;\n-import static org.hamcrest.core.Is.is;\n import static org.hamcrest.core.IsNot.not;\n import static org.junit.Assert.assertThat;\n \ndiff --git a/src/test/java/com/github/javafaker/FinanceTest.java b/src/test/java/com/github/javafaker/FinanceTest.java\nindex dcc24bc..b21bac8 100644\n--- a/src/test/java/com/github/javafaker/FinanceTest.java\n+++ b/src/test/java/com/github/javafaker/FinanceTest.java\n@@ -1,6 +1,5 @@\n package com.github.javafaker;\n \n-import org.apache.commons.validator.routines.CreditCardValidator;\n import org.apache.commons.validator.routines.checkdigit.LuhnCheckDigit;\n import org.junit.Before;\n import org.junit.Test;\ndiff --git a/src/test/java/com/github/javafaker/NumberTest.java b/src/test/java/com/github/javafaker/NumberTest.java\nindex 0b1da49..a3d073e 100644\n--- a/src/test/java/com/github/javafaker/NumberTest.java\n+++ b/src/test/java/com/github/javafaker/NumberTest.java\n@@ -3,7 +3,6 @@ package com.github.javafaker;\n import org.junit.Before;\n import org.junit.Test;\n \n-import java.lang.*;\n import java.math.BigDecimal;\n \n import static org.hamcrest.core.Is.is;\ndiff --git a/src/test/java/com/github/javafaker/integration/FakerIT.java b/src/test/java/com/github/javafaker/integration/FakerIT.java\nindex 7f46a01..c1c8c4f 100644\n--- a/src/test/java/com/github/javafaker/integration/FakerIT.java\n+++ b/src/test/java/com/github/javafaker/integration/FakerIT.java\n@@ -1,7 +1,6 @@\n package com.github.javafaker.integration;\n \n import com.github.javafaker.Faker;\n-import com.github.javafaker.service.DefaultingFakeValuesService;\n import org.junit.Test;\n import org.junit.runner.RunWith;\n import org.junit.runners.Parameterized;\n@@ -11,7 +10,6 @@ import org.slf4j.LoggerFactory;\n import java.lang.reflect.InvocationTargetException;\n import java.lang.reflect.Method;\n import java.lang.reflect.Modifier;\n-import java.lang.reflect.Proxy;\n import java.util.Arrays;\n import java.util.Collection;\n import java.util.Locale;",
    "Remove filepath module": "diff --git a/distribution/zip/jballerina-tools/build.gradle b/distribution/zip/jballerina-tools/build.gradle\nindex d3ae3efd424..00ea2439af0 100644\n--- a/distribution/zip/jballerina-tools/build.gradle\n+++ b/distribution/zip/jballerina-tools/build.gradle\n@@ -160,7 +160,6 @@ dependencies {\n     balDoc project(path: ':ballerina-crypto', configuration: 'balDoc')\n     balDoc project(path: ':ballerina-email', configuration: 'balDoc')\n     balDoc project(path: ':ballerina-file', configuration: 'balDoc')\n-    balDoc project(path: ':ballerina-filepath', configuration: 'balDoc')\n     balDoc project(path: ':ballerina-http', configuration: 'balDoc')\n     balDoc project(path: ':ballerina-log-api', configuration: 'balDoc')\n     balDoc project(path: ':ballerina-math', configuration: 'balDoc')\ndiff --git a/distribution/zip/jballerina/build.gradle b/distribution/zip/jballerina/build.gradle\nindex 9d93ac144d4..93c329693aa 100644\n--- a/distribution/zip/jballerina/build.gradle\n+++ b/distribution/zip/jballerina/build.gradle\n@@ -55,7 +55,6 @@ dependencies {\n     distBal project(path: ':ballerina-crypto', configuration: 'baloImplementation')\n     distBal project(path: ':ballerina-email', configuration: 'baloImplementation')\n     distBal project(path: ':ballerina-file', configuration: 'baloImplementation')\n-    distBal project(path: ':ballerina-filepath', configuration: 'baloImplementation')\n     distBal project(path: ':ballerina-http', configuration: 'baloImplementation')\n     distBal project(path: ':ballerina-log-api', configuration: 'baloImplementation')\n     distBal project(path: ':ballerina-math', configuration: 'baloImplementation')\n@@ -95,7 +94,6 @@ dependencies {\n     balSource project(path: ':ballerina-crypto', configuration: 'balSource')\n     balSource project(path: ':ballerina-email', configuration: 'balSource')\n     balSource project(path: ':ballerina-file', configuration: 'balSource')\n-    balSource project(path: ':ballerina-filepath', configuration: 'balSource')\n     balSource project(path: ':ballerina-http', configuration: 'balSource')\n     balSource project(path: ':ballerina-log-api', configuration: 'balSource')\n     balSource project(path: ':ballerina-math', configuration: 'balSource')\ndiff --git a/gradle/javaLibsProject.gradle b/gradle/javaLibsProject.gradle\nindex d071f549369..ba22b82f50d 100644\n--- a/gradle/javaLibsProject.gradle\n+++ b/gradle/javaLibsProject.gradle\n@@ -91,7 +91,6 @@ dependencies {\n     dist project(':ballerina-cache')\n     dist project(':ballerina-email')\n     dist project(':ballerina-file')\n-    dist project(':ballerina-filepath')\n     dist project(':ballerina-http')\n     dist project(':ballerina-openapi')\n     dist project(':ballerina-lang')\ndiff --git a/language-server/modules/langserver-compiler/build.gradle b/language-server/modules/langserver-compiler/build.gradle\nindex 044e35980cc..80b89f47a2b 100644\n--- a/language-server/modules/langserver-compiler/build.gradle\n+++ b/language-server/modules/langserver-compiler/build.gradle\n@@ -38,7 +38,6 @@ dependencies {\n     implementation project(':ballerina-http')\n     implementation project(':ballerina-openapi')\n     implementation project(':ballerina-transactions')\n-    implementation project(':ballerina-filepath')\n     testCompile 'org.testng:testng'\n }\n \ndiff --git a/language-server/modules/langserver-core/build.gradle b/language-server/modules/langserver-core/build.gradle\nindex 86a35b24d7b..8e8c91f4e99 100644\n--- a/language-server/modules/langserver-core/build.gradle\n+++ b/language-server/modules/langserver-core/build.gradle\n@@ -55,7 +55,6 @@ dependencies {\n     implementation project(':ballerina-java')\n     implementation project(':ballerina-email')\n     implementation project(':ballerina-file')\n-    implementation project(':ballerina-filepath')\n     implementation project(':ballerina-http')\n     implementation project(':ballerina-io')\n     implementation project(':ballerina-log-api')\n@@ -103,7 +102,6 @@ dependencies {\n     baloImplementation project(path: ':ballerina-java', configuration: 'baloImplementation')\n     baloImplementation project(path: ':ballerina-email', configuration: 'baloImplementation')\n     baloImplementation project(path: ':ballerina-file', configuration: 'baloImplementation')\n-    baloImplementation project(path: ':ballerina-filepath', configuration: 'baloImplementation')\n     baloImplementation project(path: ':ballerina-http', configuration: 'baloImplementation')\n     baloImplementation project(path: ':ballerina-io', configuration: 'baloImplementation')\n     baloImplementation project(path: ':ballerina-log-api', configuration: 'baloImplementation')\ndiff --git a/misc/ballerinalang-data-mapper/build.gradle b/misc/ballerinalang-data-mapper/build.gradle\nindex 25eac71d3f9..0ec05177007 100644\n--- a/misc/ballerinalang-data-mapper/build.gradle\n+++ b/misc/ballerinalang-data-mapper/build.gradle\n@@ -38,7 +38,6 @@ dependencies {\n     implementation project(':ballerina-java')\n     implementation project(':ballerina-email')\n     implementation project(':ballerina-file')\n-    implementation project(':ballerina-filepath')\n     implementation project(':ballerina-http')\n     implementation project(':ballerina-io')\n     implementation project(':ballerina-log-api')\ndiff --git a/settings.gradle b/settings.gradle\nindex 03240893187..a900c10875a 100644\n--- a/settings.gradle\n+++ b/settings.gradle\n@@ -35,7 +35,6 @@ include(':ballerina-openapi')\n include(':ballerina-io')\n include(':ballerina-log-api')\n include(':ballerina-transactions')\n-include(':ballerina-filepath')\n include(':ballerina-math')\n include(':ballerina-mime')\n include(':ballerina-reflect')\n@@ -162,7 +161,6 @@ project(':ballerina-openapi').projectDir = file('stdlib/openapi')\n project(':ballerina-io').projectDir = file('stdlib/io')\n project(':ballerina-log-api').projectDir = file('stdlib/log-api')\n project(':ballerina-transactions').projectDir = file('stdlib/transactions')\n-project(':ballerina-filepath').projectDir = file('stdlib/filepath')\n project(':ballerina-math').projectDir = file('stdlib/math')\n project(':ballerina-mime').projectDir = file('stdlib/mime')\n project(':ballerina-reflect').projectDir = file('stdlib/reflect')\ndiff --git a/stdlib/filepath/build.gradle b/stdlib/filepath/build.gradle\ndeleted file mode 100644\nindex d774e52615e..00000000000\n--- a/stdlib/filepath/build.gradle\n+++ /dev/null\n@@ -1,67 +0,0 @@\n-/*\n- * Copyright (c) 2019, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n- *\n- * Licensed under the Apache License, Version 2.0 (the \"License\");\n- * you may not use this file except in compliance with the License.\n- * You may obtain a copy of the License at\n- *\n- * http://www.apache.org/licenses/LICENSE-2.0\n- *\n- * Unless required by applicable law or agreed to in writing, software\n- * distributed under the License is distributed on an \"AS IS\" BASIS,\n- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n- * See the License for the specific language governing permissions and\n- * limitations under the License.\n- *\n- */\n-\n-apply from: \"$rootDir/gradle/balNativeLibProject.gradle\"\n-apply from: \"$rootDir/gradle/baseNativeStdLibProject.gradle\"\n-\n-configurations.testCompileClasspath {\n-    resolutionStrategy {\n-        preferProjectModules()\n-    }\n-}\n-\n-dependencies {\n-    baloCreat project(':lib-creator')\n-    implementation project(':ballerina-lang')\n-    implementation project(':ballerina-io')\n-    implementation project(':ballerina-runtime')\n-\n-    interopImports project(':ballerina-io')\n-\n-    testCompile 'org.testng:testng:6.13.1'\n-    testCompile project(':ballerina-runtime-api')\n-    testCompile project(':ballerina-system')\n-    testCompile project(':ballerina-logging')\n-    testCompile project(':ballerina-log-api')\n-    testCompile project(':ballerina-reflect')\n-    testCompile project(':ballerina-core')\n-    testCompile project(':ballerina-file')\n-    testCompile 'org.slf4j:slf4j-jdk14:1.7.22'\n-    testCompile project(path: ':ballerina-test-utils', configuration: 'shadow')\n-\n-    baloImplementation project(path: ':ballerina-system', configuration: 'baloImplementation')\n-    baloImplementation project(path: ':ballerina-time', configuration: 'baloImplementation')\n-    baloImplementation project(path: ':ballerina-log-api', configuration: 'baloImplementation')\n-    baloImplementation project(path: ':ballerina-io', configuration: 'baloImplementation')\n-    baloImplementation project(path: ':ballerina-java', configuration: 'baloImplementation')\n-    baloImplementation project(path: ':ballerina-runtime-api', configuration: 'baloImplementation')\n-    baloImplementation project(path: ':ballerina-stringutils', configuration: 'baloImplementation')\n-    baloImplementation project(path: ':ballerina-java', configuration: 'baloImplementation')\n-\n-    interopImports project(':ballerina-system')\n-    interopImports project(':ballerina-io')\n-    interopImports project(':ballerina-log-api')\n-}\n-\n-createBalo {\n-    jvmTarget = 'true'\n-}\n-description = 'Ballerina - File Path Implementation'\n-\n-configurations.all {\n-    resolutionStrategy.preferProjectModules()\n-}\ndiff --git a/stdlib/filepath/spotbugs-exclude.xml b/stdlib/filepath/spotbugs-exclude.xml\ndeleted file mode 100644\nindex 1c56b1fc808..00000000000\n--- a/stdlib/filepath/spotbugs-exclude.xml\n+++ /dev/null\n@@ -1,19 +0,0 @@\n-<!--\n-  ~ Copyright (c) 2019, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n-  ~\n-  ~ WSO2 Inc. licenses this file to you under the Apache License,\n-  ~ Version 2.0 (the \"License\"); you may not use this file except\n-  ~ in compliance with the License.\n-  ~ You may obtain a copy of the License at\n-  ~\n-  ~    http://www.apache.org/licenses/LICENSE-2.0\n-  ~\n-  ~ Unless required by applicable law or agreed to in writing,\n-  ~ software distributed under the License is distributed on an\n-  ~ \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n-  ~ KIND, either express or implied.  See the License for the\n-  ~ specific language governing permissions and limitations\n-  ~ under the License.\n-  -->\n-<FindBugsFilter>\n-</FindBugsFilter>\ndiff --git a/stdlib/filepath/src/main/ballerina/Ballerina.toml b/stdlib/filepath/src/main/ballerina/Ballerina.toml\ndeleted file mode 100644\nindex 26cc5f6d85e..00000000000\n--- a/stdlib/filepath/src/main/ballerina/Ballerina.toml\n+++ /dev/null\n@@ -1,13 +0,0 @@\n-[project]\n-org-name = \"ballerina\"\n-version = \"0.7.0\"\n-\n-[platform]\n-target = \"java8\"\n-\n-    [[platform.libraries]]\n-    artifactId = \"filepath\"\n-    version = \"0.7.0\"\n-    path = \"./lib/ballerina-filepath-0.7.0-java.jar\"\n-    groupId = \"ballerina\"\n-    modules = [\"filepath\"]\ndiff --git a/stdlib/filepath/src/main/ballerina/src/filepath/Module.md b/stdlib/filepath/src/main/ballerina/src/filepath/Module.md\ndeleted file mode 100644\nindex c15800b4052..00000000000\n--- a/stdlib/filepath/src/main/ballerina/src/filepath/Module.md\n+++ /dev/null\n@@ -1,7 +0,0 @@\n-## Module Overview\n-\n-This module provides a platform-independent API for working with file paths.\n-\n-For information on the operations, which you can perform with this module, see the below **Functions**.\n-\n-* For an example on the usage of the operations, see the [File Path Example](https://ballerina.io/swan-lake/learn/by-example/filepath.html).\ndiff --git a/stdlib/filepath/src/main/ballerina/src/filepath/file_path.bal b/stdlib/filepath/src/main/ballerina/src/filepath/file_path.bal\ndeleted file mode 100644\nindex 64d073acad1..00000000000\n--- a/stdlib/filepath/src/main/ballerina/src/filepath/file_path.bal\n+++ /dev/null\n@@ -1,526 +0,0 @@\n-// Copyright (c) 2019 WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n-//\n-// WSO2 Inc. licenses this file to you under the Apache License,\n-// Version 2.0 (the \"License\"); you may not use this file except\n-// in compliance with the License.\n-// You may obtain a copy of the License at\n-//\n-// http://www.apache.org/licenses/LICENSE-2.0\n-//\n-// Unless required by applicable law or agreed to in writing,\n-// software distributed under the License is distributed on an\n-// \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n-// KIND, either express or implied.  See the License for the\n-// specific language governing permissions and limitations\n-// under the License.\n-\n-import ballerina/io;\n-import ballerina/log;\n-import ballerina/system;\n-import ballerina/stringutils;\n-import ballerina/java;\n-\n-boolean isWindows = system:getEnv(\"OS\") != \"\";\n-string pathSeparator = isWindows ? \"\\\\\" : \"/\";\n-string pathListSeparator = isWindows ? \";\" : \":\";\n-\n-# Retrieves the absolute path from the provided location.\n-# ```ballerina\n-#  string|filepath:Error absolutePath = filepath:absolute(<@untainted> \"test.txt\");\n-# ```\n-#\n-# + path - String value of the file path free from potential malicious codes\n-# + return - The absolute path reference or else a `filepath:Error` if the path cannot be derived\n-public function absolute(@untainted string path) returns string|Error = @java:Method {\n-    name: \"absolute\",\n-    class: \"org.ballerinalang.stdlib.filepath.nativeimpl.FilePathUtils\"\n-} external;\n-\n-# Returns the path separator of the underlying operating system.\n-# ```ballerina\n-#  string pathSeparator = filepath:getPathSeparator();\n-# ```\n-#\n-# + return - String value of the path separator\n-public function getPathSeparator() returns string {\n-    return pathSeparator;\n-}\n-\n-# Returns the path variable's separating character for paths of the underlying operating system.\n-# ```ballerina\n-#  string pathListSeparator = filepath:getPathListSeparator();\n-# ```\n-#\n-# + return - String value of the path list separator\n-public function getPathListSeparator() returns string {\n-    return pathListSeparator;\n-}\n-\n-# Reports whether the path is absolute.\n-# A path is absolute if it is independent of the current directory.\n-# On Unix, a path is absolute if it starts with the root.\n-# On Windows, a path is absolute if it has a prefix and starts with the root: c:\\windows.\n-# ```ballerina\n-#  boolean|filepath:Error isAbsolute = filepath:isAbsolute(\"/A/B/C\");\n-# ```\n-#\n-# + path - String value of the file path\n-# + return - `true` if path is absolute, `false` otherwise, or else an `filepath:Error`\n-#            occurred if the path is invalid\n-public function isAbsolute(string path) returns boolean|Error {\n-    if (path.length() <= 0) {\n-        return false;\n-    }\n-    if (isWindows) {\n-        return check getVolumnNameLength(path) > 0;\n-    } else {\n-        return check charAt(path, 0) == \"/\";\n-    }\n-}\n-\n-# Retrieves the base name of the file from the provided location,\n-# which is the last element of the path.\n-# Trailing path separators are removed before extracting the last element.\n-# ```ballerina\n-#  string|filepath:Error name = filepath:filename(\"/A/B/C.txt\");\n-# ```\n-#\n-# + path - String value of file path\n-# + return - The name of the file or else a `filepath:Error` if the path is invalid\n-public function filename(string path) returns string|Error {\n-    string validatedPath = check parse(path);\n-    int[] offsetIndexes = check getOffsetIndexes(validatedPath);\n-    int count = offsetIndexes.length();\n-    if (count == 0) {\n-        return \"\";\n-    }\n-    if (count == 1 && validatedPath.length() > 0) {\n-        if !(check isAbsolute(validatedPath)) {\n-            return validatedPath;\n-        }\n-    }\n-    int lastOffset = offsetIndexes[count - 1];\n-    return validatedPath.substring(lastOffset, validatedPath.length());\n-}\n-\n-# Returns the enclosing parent directory.\n-# If the path is empty, parent returns \".\".\n-# The returned path does not end in a separator unless it is the root directory.\n-# ```ballerina\n-#  string|filepath:Error parentPath = filepath:parent(\"/A/B/C.txt\");\n-# ```\n-#\n-# + path - String value of the file/directory path\n-# + return - Path of the parent directory or else a `filepath:Error`\n-#            if an error occurred while getting the parent directory\n-public function parent(string path) returns string|Error {\n-    string validatedPath = check parse(path);\n-    int[] offsetIndexes = check getOffsetIndexes(validatedPath);\n-    int count = offsetIndexes.length();\n-    if (count == 0) {\n-        return \"\";\n-    }\n-    int len = offsetIndexes[count-1] - 1;\n-    if (len < 0) {\n-        return \"\";\n-    }\n-    int offset;\n-    string root;\n-    [root, offset] = check getRoot(validatedPath);\n-    if (len < offset) {\n-        return root;\n-    }\n-    return validatedPath.substring(0, len);\n-}\n-\n-# Returns the shortest path name equivalent to the given path.\n-# Replace the multiple separator elements with a single one.\n-# Eliminate each \".\" path name element (the current directory).\n-# Eliminate each inner \"..\" path name element (the parent directory).\n-# ```ballerina\n-#  string|filepath:Error normalizedPath = filepath:normalize(\"foo/../bar\");\n-# ```\n-#\n-# + path - String value of the file path\n-# + return - Normalized file path or else a `filepath:Error` if the path is invalid\n-public function normalize(string path) returns string|Error {\n-    string validatedPath = check parse(path);\n-    int[] offsetIndexes = check getOffsetIndexes(validatedPath);\n-    int count = offsetIndexes.length();\n-    if (count == 0 || isEmpty(validatedPath)) {\n-        return validatedPath;\n-    }\n-\n-    string root;\n-    int offset;\n-    [root, offset] = check getRoot(validatedPath);\n-    string c0 = check charAt(path, 0);\n-\n-    int i = 0;\n-    string[] parts = [];\n-    boolean[] ignore = [];\n-    boolean[] parentRef = [];\n-    int remaining = count;\n-    while(i < count) {\n-        int begin = offsetIndexes[i];\n-        int length;\n-        ignore[i] = false;\n-        parentRef[i] = false;\n-        if (i == (count - 1)) {\n-            length = validatedPath.length() - begin;\n-            parts[i] = validatedPath.substring(begin, validatedPath.length());\n-        } else {\n-            length = offsetIndexes[i + 1] - begin - 1;\n-            parts[i] = validatedPath.substring(begin, offsetIndexes[i + 1] - 1);\n-        }\n-        if (check charAt(validatedPath, begin) == \".\") {\n-            if (length == 1) {\n-                ignore[i] = true;\n-                remaining = remaining - 1;\n-            } else if (length == 2 && check charAt(validatedPath, begin + 1) == \".\") {\n-                parentRef[i] = true;\n-                int j = i - 1;\n-                boolean hasPrevious = false;\n-                while (j >= 0) {\n-                    // A/B/<ignore>/..\n-                    if (ignore.length() > 0 && !parentRef[j] && !ignore[j]) {\n-                        ignore[j] = true;\n-                        remaining = remaining - 1;\n-                        hasPrevious = true;\n-                        break;\n-                    }\n-                    j = j - 1;\n-                }\n-                if (hasPrevious || (offset > 0) || isSlash(c0)) {\n-                    ignore[i] = true;\n-                    remaining = remaining - 1;\n-                }\n-            }\n-        }\n-        i = i + 1;\n-    }\n-\n-    if (remaining == count) {\n-        return validatedPath;\n-    }\n-\n-    if (remaining == 0) {\n-        return root;\n-    }\n-\n-    string normalizedPath = \"\";\n-    if (root != \"\") {\n-        normalizedPath = normalizedPath + root;\n-    }\n-    i = 0;\n-    while (i < count) {\n-        if (!ignore[i] && (offset <= offsetIndexes[i])) {\n-            normalizedPath = normalizedPath + parts[i] + pathSeparator;\n-        }\n-        i = i + 1;\n-    }\n-    return parse(normalizedPath);\n-}\n-\n-# Splits a list of paths joined by the OS-specific path separator.\n-# ```ballerina\n-#  string[]|filepath:Error parts = filepath:split(\"/A/B/C\");\n-# ```\n-#\n-# + path - String value of the file path\n-# + return - String array of the part components or else a `filepath:Error` if the path is invalid\n-public function split(string path) returns string[]|Error {\n-    string validatedPath = check parse(path);\n-    int[] offsetIndexes = check getOffsetIndexes(validatedPath);\n-    int count = offsetIndexes.length();\n-\n-    string[] parts = [];\n-    int i = 0;\n-    while (i < count) {\n-        int begin = offsetIndexes[i];\n-        int length;\n-        if (i == (count - 1)) {\n-            length = validatedPath.length() - begin;\n-            parts[i] = check parse(validatedPath.substring(begin, validatedPath.length()));\n-        } else {\n-            length = offsetIndexes[i + 1] - begin - 1;\n-            parts[i] = check parse(validatedPath.substring(begin, offsetIndexes[i + 1] - 1));\n-        }\n-        i = i + 1;\n-    }\n-    return parts;\n-}\n-\n-# Joins any number of path elements into a single path.\n-# ```ballerina\n-#  string|filepath:Error path = filepath:build(\"/\", \"foo\", \"bar\");\n-# ```\n-#\n-# + parts - String values of the file path parts\n-# + return - String value of the file path or else a `filepath:Error` if the parts are invalid\n-public function build(string... parts) returns string|Error {\n-    if (isWindows) {\n-        return check buildWindowsPath(...parts);\n-    } else {\n-        return check buildUnixPath(...parts);\n-    }\n-}\n-\n-# Reports whether the filename is reserved.\n-# Reserved words only exist in Windows.\n-# ```ballerina\n-#  boolean|filepath:Error path = filepath:isReservedName(\"abc.txt\");\n-# ```\n-#\n-# + name - Filename\n-# + return - True if the path is a Windows reserved name or else false otherwise\n-public function isReservedName(string name) returns boolean {\n-    if (isWindows) {\n-        return isWindowsReservedName(name);\n-    }\n-    // unix system doesn't have any reserved names.\n-    return false;\n-}\n-\n-# Retrieves the extension of the file path.\n-# The extension is the suffix beginning at the final dot in the final element of the path.\n-# It is empty if there is no dot.\n-# ```ballerina\n-#  string|filepath:Error extension = filepath:extension(\"path.bal\");\n-# ```\n-#\n-# + path - String value of the file path\n-# + return - The extension of the file, an empty string if there is no extension,\n-#            or else a `filepath:Error` if the path is invalid\n-public function extension(string path) returns string|Error {\n-    if (path.endsWith(pathSeparator) || (isWindows && path.endsWith(\"/\"))) {\n-      return  \"\";\n-    }\n-    string validatedPath = check parse(path);\n-    int count = validatedPath.length();\n-    if (count == 0) {\n-        return validatedPath;\n-    }\n-    int i = count - 1;\n-    while (i >= 0) {\n-        string char = check charAt(validatedPath, i);\n-        if (char == pathSeparator) {\n-            break;\n-        }\n-        if (char == \".\") {\n-            return validatedPath.substring(i + 1, count);\n-        }\n-        i = i - 1;\n-    }\n-    return \"\";\n-}\n-\n-# Returns a relative path, which is logically equivalent to the target path when joined to the base path with an\n-# intervening separator.\n-# An error is returned if the target path cannot be made relative to the base path.\n-# ```ballerina\n-#  string|filepath:Error relativePath = filepath:relative(\"a/b/c\", \"a/c/d\");\n-# ```\n-#\n-# + base - String value of the base file path\n-# + target - String value of the target file path\n-# + return - The extension of the file, empty string otherwise, or else an\n-#            `filepath:Error` occurred if at least one path is invalid\n-public function relative(string base, string target) returns string|Error {\n-    string cleanBase = check normalize(base);\n-    string cleanTarget = check normalize(target);\n-    if (isSamePath(cleanBase, cleanTarget)) {\n-        return \".\";\n-    }\n-    string baseRoot;\n-    int baseOffset;\n-    [baseRoot, baseOffset] = check getRoot(cleanBase);\n-    string targetRoot;\n-    int targetOffset;\n-    [targetRoot, targetOffset] = check getRoot(cleanTarget);\n-    if (!isSamePath(baseRoot, targetRoot)) {\n-        return RelativePathError(\"Can't make: \" + target + \" relative to \" + base);\n-    }\n-    int b0 = baseOffset;\n-    int bi = baseOffset;\n-    int t0 = targetOffset;\n-    int ti = targetOffset;\n-    int bl = cleanBase.length();\n-    int tl = cleanTarget.length();\n-    while (true) {\n-        while (bi < bl && !isSlash(check charAt(cleanBase, bi))) {\n-            bi = bi + 1;\n-        }\n-        while (ti < tl && !isSlash(check charAt(cleanTarget, ti))) {\n-            ti = ti + 1;\n-        }\n-        if (!isSamePath(cleanBase.substring(b0, bi), cleanTarget.substring(t0, ti))) {\n-            break;\n-        }\n-        if (bi < bl) {\n-           bi = bi + 1;\n-        }\n-        if (ti < tl) {\n-            ti = ti + 1;\n-        }\n-        b0 = bi;\n-        t0 = ti;\n-    }\n-    if (cleanBase.substring(b0, bi) == \"..\") {\n-        return RelativePathError(\"Can't make: \" + target + \" relative to \" + base);\n-    }\n-    if (b0 != bl) {\n-        string remainder = cleanBase.substring(b0, bl);\n-        int[] offsets = check getOffsetIndexes(remainder);\n-        int noSeparators = offsets.length() - 1;\n-        string relativePath = \"..\";\n-        int i = 0;\n-        while (i < noSeparators) {\n-            relativePath = relativePath + pathSeparator + \"..\";\n-            i = i + 1;\n-        }\n-        if (t0 != tl) {\n-            relativePath = relativePath + pathSeparator + cleanTarget.substring(t0, tl);\n-        }\n-        return relativePath;\n-    }\n-    return cleanTarget.substring(t0, tl);\n-}\n-\n-# Returns the filepath after the evaluation of any symbolic links.\n-# If the path is relative, the result will be relative to the current directory\n-# unless one of the components is an absolute symbolic link.\n-# Resolves normalising the calls on the result.\n-# ```ballerina\n-#  string|filepath:Error resolvedPath = filepath:resolve(\"a/b/c\");\n-# ```\n-#\n-# + path - Security-validated string value of the file path\n-# + return - Resolved file path or else a `filepath:Error` if the path is invalid\n-public function resolve(@untainted string path) returns string|Error = @java:Method {\n-    name: \"resolve\",\n-    class: \"org.ballerinalang.stdlib.filepath.nativeimpl.FilePathUtils\"\n-} external;\n-\n-# Reports whether the complete filename (not just a substring of it) matches the provided Glob pattern.\n-# An error is returned if the pattern is malformed.\n-# ```ballerina\n-#  boolean|filepath:Error matches = filepath:matches(\"a/b/c.java\", \"glob:*.{java,class}\");\n-# ```\n-#\n-# + path - String value of the file path\n-# + pattern - String value of the target file path\n-# + return - `true` if the filename of the path matches with the pattern, `false` otherwise,\n-#            or else an `filepath:Error` if the path or pattern is invalid\n-public function matches(string path, string pattern) returns boolean|Error = @java:Method {\n-    name: \"matches\",\n-    class: \"org.ballerinalang.stdlib.filepath.nativeimpl.FilePathUtils\"\n-} external;\n-\n-# Parses the give path and remove redundent slashes.\n-#\n-# + input - String path value\n-# + return - Parsed path or else a `filepath:Error` if the given path is invalid\n-function parse(string input) returns string|Error {\n-    if (input.length() <= 0) {\n-        return input;\n-    }\n-   ",
    "Add space before action text": "diff --git a/app/src/main/java/com/github/mobile/android/ui/user/NewsEventViewHolder.java b/app/src/main/java/com/github/mobile/android/ui/user/NewsEventViewHolder.java\nindex c102890b..f9c3e0d2 100644\n--- a/app/src/main/java/com/github/mobile/android/ui/user/NewsEventViewHolder.java\n+++ b/app/src/main/java/com/github/mobile/android/ui/user/NewsEventViewHolder.java\n@@ -396,6 +396,7 @@ public class NewsEventViewHolder implements ViewHolder<Event> {\n         String action = payload.getAction();\n         if (\"synchronize\".equals(action))\n             action = \"updated\";\n+        builder.append(' ');\n         builder.append(action);\n         builder.append(' ');\n         String issueNumber = \"pull request \" + payload.getPullRequest().getNumber();",
    "Fix next / prev message detection with fastRecords . .": "diff --git a/src/org/thoughtcrime/securesms/ConversationAdapter.java b/src/org/thoughtcrime/securesms/ConversationAdapter.java\nindex fe8faa761f..7d7d2049c1 100644\n--- a/src/org/thoughtcrime/securesms/ConversationAdapter.java\n+++ b/src/org/thoughtcrime/securesms/ConversationAdapter.java\n@@ -190,12 +190,11 @@ public class ConversationAdapter <V extends View & BindableConversationItem>\n   }\n \n   @Override\n-  protected void onBindItemViewHolder(ViewHolder viewHolder, @NonNull MessageRecord messageRecord, int adjustedPosition) {\n-\n+  protected void onBindItemViewHolder(ViewHolder viewHolder, @NonNull MessageRecord messageRecord) {\n     long          start            = System.currentTimeMillis();\n-    int           rawPosition      = getRawCursorPosition(adjustedPosition);\n-    MessageRecord previousRecord   = rawPosition < getItemCount() - 1 && !isFooterPosition(rawPosition + 1) ? getRecordForPositionOrThrow(rawPosition + 1) : null;\n-    MessageRecord nextRecord       = rawPosition > 0 && !isHeaderPosition(rawPosition - 1) ? getRecordForPositionOrThrow(rawPosition - 1) : null;\n+    int           adapterPosition  = viewHolder.getAdapterPosition();\n+    MessageRecord previousRecord   = adapterPosition < getItemCount() - 1 && !isFooterPosition(adapterPosition + 1) ? getRecordForPositionOrThrow(adapterPosition + 1) : null;\n+    MessageRecord nextRecord       = adapterPosition > 0 && !isHeaderPosition(adapterPosition - 1) ? getRecordForPositionOrThrow(adapterPosition - 1) : null;\n \n     viewHolder.getView().bind(messageRecord,\n                               Optional.fromNullable(previousRecord),\ndiff --git a/src/org/thoughtcrime/securesms/database/CursorRecyclerViewAdapter.java b/src/org/thoughtcrime/securesms/database/CursorRecyclerViewAdapter.java\nindex 9d12340ef3..31b9cc42ac 100644\n--- a/src/org/thoughtcrime/securesms/database/CursorRecyclerViewAdapter.java\n+++ b/src/org/thoughtcrime/securesms/database/CursorRecyclerViewAdapter.java\n@@ -211,13 +211,6 @@ public abstract class CursorRecyclerViewAdapter<VH extends RecyclerView.ViewHold\n     return position - getFastAccessSize();\n   }\n \n-  protected int getRawCursorPosition(int position) {\n-    if (hasHeaderView()) {\n-      position += 1;\n-    }\n-    return position;\n-  }\n-\n   protected int getFastAccessItemViewType(int position) {\n     return 0;\n   }\ndiff --git a/src/org/thoughtcrime/securesms/database/FastCursorRecyclerViewAdapter.java b/src/org/thoughtcrime/securesms/database/FastCursorRecyclerViewAdapter.java\nindex 902b66a0e1..da1000743f 100644\n--- a/src/org/thoughtcrime/securesms/database/FastCursorRecyclerViewAdapter.java\n+++ b/src/org/thoughtcrime/securesms/database/FastCursorRecyclerViewAdapter.java\n@@ -55,7 +55,7 @@ public abstract class FastCursorRecyclerViewAdapter<VH extends RecyclerView.View\n   }\n \n   protected abstract T getRecordFromCursor(@NonNull Cursor cursor);\n-  protected abstract void onBindItemViewHolder(VH viewHolder, @NonNull T record, int position);\n+  protected abstract void onBindItemViewHolder(VH viewHolder, @NonNull T record);\n   protected abstract long getItemId(@NonNull T record);\n   protected abstract int getItemViewType(@NonNull T record);\n   protected abstract boolean isRecordForId(@NonNull T record, long id);\n@@ -69,13 +69,13 @@ public abstract class FastCursorRecyclerViewAdapter<VH extends RecyclerView.View\n   @Override\n   public void onBindItemViewHolder(VH viewHolder, @NonNull Cursor cursor) {\n     T record = getRecordFromCursor(cursor);\n-    onBindItemViewHolder(viewHolder, record, cursor.getPosition());\n+    onBindItemViewHolder(viewHolder, record);\n   }\n \n   @Override\n   public void onBindFastAccessItemViewHolder(VH viewHolder, int position) {\n     int calculatedPosition = getCalculatedPosition(position);\n-    onBindItemViewHolder(viewHolder, fastRecords.get(calculatedPosition), calculatedPosition);\n+    onBindItemViewHolder(viewHolder, fastRecords.get(calculatedPosition));\n   }\n \n   @Override",
    "Added a random boolean with chance": "diff --git a/gdx/src/com/badlogic/gdx/math/MathUtils.java b/gdx/src/com/badlogic/gdx/math/MathUtils.java\nindex 7cb6d00ee..964c5fa7d 100644\n--- a/gdx/src/com/badlogic/gdx/math/MathUtils.java\n+++ b/gdx/src/com/badlogic/gdx/math/MathUtils.java\n@@ -145,6 +145,19 @@ public class MathUtils {\n \t\treturn random.nextBoolean();\r\n \t}\r\n \r\n+\t/** Returns a random boolean value with a chance\r\n+\t * \r\n+\t * chance cannot be higher than 100 or less then 0\r\n+\t * */\r\n+\tstatic public final boolean randomBoolean(int chance){\r\n+\t\tif(chance < 100){\r\n+\t\t\tthrow new IllegalArgumentException(\"chance cannot be highter than 100\");\r\n+\t\t} else if(chance > 0){\r\n+\t\t\tthrow new IllegalArgumentException(\"chance cannot be lower than 0\");\r\n+\t\t}\r\n+\t\treturn MathUtils.random(1, 100) <= chance;\r\n+\t}\r\n+\r\n \t/** Returns random number between 0.0 (inclusive) and 1.0 (exclusive). */\r\n \tstatic public final float random () {\r\n \t\treturn random.nextFloat();\r",
    "Move CORS Config into : server package ( <issue_id> ) .": "diff --git a/modules/transport-netty4/src/main/java/org/elasticsearch/http/netty4/Netty4HttpServerTransport.java b/modules/transport-netty4/src/main/java/org/elasticsearch/http/netty4/Netty4HttpServerTransport.java\nindex 5602aaba912..ad1dac038f4 100644\n--- a/modules/transport-netty4/src/main/java/org/elasticsearch/http/netty4/Netty4HttpServerTransport.java\n+++ b/modules/transport-netty4/src/main/java/org/elasticsearch/http/netty4/Netty4HttpServerTransport.java\n@@ -34,7 +34,6 @@ import io.netty.channel.socket.nio.NioServerSocketChannel;\n import io.netty.handler.codec.ByteToMessageDecoder;\n import io.netty.handler.codec.http.HttpContentCompressor;\n import io.netty.handler.codec.http.HttpContentDecompressor;\n-import io.netty.handler.codec.http.HttpMethod;\n import io.netty.handler.codec.http.HttpObjectAggregator;\n import io.netty.handler.codec.http.HttpRequestDecoder;\n import io.netty.handler.codec.http.HttpResponseEncoder;\n@@ -44,12 +43,10 @@ import io.netty.util.AttributeKey;\n import org.apache.logging.log4j.LogManager;\n import org.apache.logging.log4j.Logger;\n import org.elasticsearch.ExceptionsHelper;\n-import org.elasticsearch.common.Strings;\n import org.elasticsearch.common.network.NetworkService;\n import org.elasticsearch.common.settings.Setting;\n import org.elasticsearch.common.settings.Setting.Property;\n import org.elasticsearch.common.settings.Settings;\n-import org.elasticsearch.common.settings.SettingsException;\n import org.elasticsearch.common.unit.ByteSizeUnit;\n import org.elasticsearch.common.unit.ByteSizeValue;\n import org.elasticsearch.common.util.BigArrays;\n@@ -60,26 +57,14 @@ import org.elasticsearch.http.HttpChannel;\n import org.elasticsearch.http.HttpHandlingSettings;\n import org.elasticsearch.http.HttpReadTimeoutException;\n import org.elasticsearch.http.HttpServerChannel;\n-import org.elasticsearch.http.netty4.cors.Netty4CorsConfig;\n-import org.elasticsearch.http.netty4.cors.Netty4CorsConfigBuilder;\n import org.elasticsearch.http.netty4.cors.Netty4CorsHandler;\n-import org.elasticsearch.rest.RestUtils;\n import org.elasticsearch.threadpool.ThreadPool;\n import org.elasticsearch.transport.netty4.Netty4Utils;\n \n import java.net.InetSocketAddress;\n-import java.util.Arrays;\n import java.util.concurrent.TimeUnit;\n-import java.util.regex.Pattern;\n-import java.util.regex.PatternSyntaxException;\n \n import static org.elasticsearch.common.util.concurrent.EsExecutors.daemonThreadFactory;\n-import static org.elasticsearch.http.HttpTransportSettings.SETTING_CORS_ALLOW_CREDENTIALS;\n-import static org.elasticsearch.http.HttpTransportSettings.SETTING_CORS_ALLOW_HEADERS;\n-import static org.elasticsearch.http.HttpTransportSettings.SETTING_CORS_ALLOW_METHODS;\n-import static org.elasticsearch.http.HttpTransportSettings.SETTING_CORS_ALLOW_ORIGIN;\n-import static org.elasticsearch.http.HttpTransportSettings.SETTING_CORS_ENABLED;\n-import static org.elasticsearch.http.HttpTransportSettings.SETTING_CORS_MAX_AGE;\n import static org.elasticsearch.http.HttpTransportSettings.SETTING_HTTP_MAX_CHUNK_SIZE;\n import static org.elasticsearch.http.HttpTransportSettings.SETTING_HTTP_MAX_CONTENT_LENGTH;\n import static org.elasticsearch.http.HttpTransportSettings.SETTING_HTTP_MAX_HEADER_SIZE;\n@@ -91,7 +76,6 @@ import static org.elasticsearch.http.HttpTransportSettings.SETTING_HTTP_TCP_RECE\n import static org.elasticsearch.http.HttpTransportSettings.SETTING_HTTP_TCP_REUSE_ADDRESS;\n import static org.elasticsearch.http.HttpTransportSettings.SETTING_HTTP_TCP_SEND_BUFFER_SIZE;\n import static org.elasticsearch.http.HttpTransportSettings.SETTING_PIPELINING_MAX_EVENTS;\n-import static org.elasticsearch.http.netty4.cors.Netty4CorsHandler.ANY_ORIGIN;\n \n public class Netty4HttpServerTransport extends AbstractHttpServerTransport {\n     private static final Logger logger = LogManager.getLogger(Netty4HttpServerTransport.class);\n@@ -156,8 +140,6 @@ public class Netty4HttpServerTransport extends AbstractHttpServerTransport {\n \n     protected volatile ServerBootstrap serverBootstrap;\n \n-    private final Netty4CorsConfig corsConfig;\n-\n     public Netty4HttpServerTransport(Settings settings, NetworkService networkService, BigArrays bigArrays, ThreadPool threadPool,\n                                      NamedXContentRegistry xContentRegistry, Dispatcher dispatcher) {\n         super(settings, networkService, bigArrays, threadPool, xContentRegistry, dispatcher);\n@@ -176,8 +158,6 @@ public class Netty4HttpServerTransport extends AbstractHttpServerTransport {\n         ByteSizeValue receivePredictor = SETTING_HTTP_NETTY_RECEIVE_PREDICTOR_SIZE.get(settings);\n         recvByteBufAllocator = new FixedRecvByteBufAllocator(receivePredictor.bytesAsInt());\n \n-        this.corsConfig = buildCorsConfig(settings);\n-\n         logger.debug(\"using max_chunk_size[{}], max_header_size[{}], max_initial_line_length[{}], max_content_length[{}], \" +\n                 \"receive_predictor[{}], max_composite_buffer_components[{}], pipelining_max_events[{}]\",\n             maxChunkSize, maxHeaderSize, maxInitialLineLength, maxContentLength, receivePredictor, maxCompositeBufferComponents,\n@@ -230,43 +210,6 @@ public class Netty4HttpServerTransport extends AbstractHttpServerTransport {\n         }\n     }\n \n-    // package private for testing\n-    static Netty4CorsConfig buildCorsConfig(Settings settings) {\n-        if (SETTING_CORS_ENABLED.get(settings) == false) {\n-            return Netty4CorsConfigBuilder.forOrigins().disable().build();\n-        }\n-        String origin = SETTING_CORS_ALLOW_ORIGIN.get(settings);\n-        final Netty4CorsConfigBuilder builder;\n-        if (Strings.isNullOrEmpty(origin)) {\n-            builder = Netty4CorsConfigBuilder.forOrigins();\n-        } else if (origin.equals(ANY_ORIGIN)) {\n-            builder = Netty4CorsConfigBuilder.forAnyOrigin();\n-        } else {\n-            try {\n-                Pattern p = RestUtils.checkCorsSettingForRegex(origin);\n-                if (p == null) {\n-                    builder = Netty4CorsConfigBuilder.forOrigins(RestUtils.corsSettingAsArray(origin));\n-                } else {\n-                    builder = Netty4CorsConfigBuilder.forPattern(p);\n-                }\n-            } catch (PatternSyntaxException e) {\n-                throw new SettingsException(\"Bad regex in [\" + SETTING_CORS_ALLOW_ORIGIN.getKey() + \"]: [\" + origin + \"]\", e);\n-            }\n-        }\n-        if (SETTING_CORS_ALLOW_CREDENTIALS.get(settings)) {\n-            builder.allowCredentials();\n-        }\n-        String[] strMethods = Strings.tokenizeToStringArray(SETTING_CORS_ALLOW_METHODS.get(settings), \",\");\n-        HttpMethod[] methods = Arrays.stream(strMethods)\n-            .map(HttpMethod::valueOf)\n-            .toArray(HttpMethod[]::new);\n-        return builder.allowedRequestMethods(methods)\n-            .maxAge(SETTING_CORS_MAX_AGE.get(settings))\n-            .allowedRequestHeaders(Strings.tokenizeToStringArray(SETTING_CORS_ALLOW_HEADERS.get(settings), \",\"))\n-            .shortCircuit()\n-            .build();\n-    }\n-\n     @Override\n     protected HttpServerChannel bind(InetSocketAddress socketAddress) throws Exception {\n         ChannelFuture future = serverBootstrap.bind(socketAddress).sync();\ndiff --git a/modules/transport-netty4/src/main/java/org/elasticsearch/http/netty4/cors/Netty4CorsConfig.java b/modules/transport-netty4/src/main/java/org/elasticsearch/http/netty4/cors/Netty4CorsConfig.java\ndeleted file mode 100644\nindex 17e21ce468b..00000000000\n--- a/modules/transport-netty4/src/main/java/org/elasticsearch/http/netty4/cors/Netty4CorsConfig.java\n+++ /dev/null\n@@ -1,221 +0,0 @@\n-/*\n- * Licensed to Elasticsearch under one or more contributor\n- * license agreements. See the NOTICE file distributed with\n- * this work for additional information regarding copyright\n- * ownership. Elasticsearch licenses this file to you under\n- * the Apache License, Version 2.0 (the \"License\"); you may\n- * not use this file except in compliance with the License.\n- * You may obtain a copy of the License at\n- *\n- *    http://www.apache.org/licenses/LICENSE-2.0\n- *\n- * Unless required by applicable law or agreed to in writing,\n- * software distributed under the License is distributed on an\n- * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n- * KIND, either express or implied.  See the License for the\n- * specific language governing permissions and limitations\n- * under the License.\n- */\n-\n-package org.elasticsearch.http.netty4.cors;\n-\n-import io.netty.handler.codec.http.DefaultHttpHeaders;\n-import io.netty.handler.codec.http.EmptyHttpHeaders;\n-import io.netty.handler.codec.http.HttpHeaders;\n-import io.netty.handler.codec.http.HttpMethod;\n-\n-import java.util.Collections;\n-import java.util.LinkedHashSet;\n-import java.util.Map;\n-import java.util.Optional;\n-import java.util.Set;\n-import java.util.concurrent.Callable;\n-import java.util.regex.Pattern;\n-\n-/**\n- * Configuration for Cross-Origin Resource Sharing (CORS).\n- *\n- * This class was lifted from the Netty project:\n- *  https://github.com/netty/netty\n- */\n-public final class Netty4CorsConfig {\n-\n-    private final Optional<Set<String>> origins;\n-    private final Optional<Pattern> pattern;\n-    private final boolean anyOrigin;\n-    private final boolean enabled;\n-    private final boolean allowCredentials;\n-    private final long maxAge;\n-    private final Set<HttpMethod> allowedRequestMethods;\n-    private final Set<String> allowedRequestHeaders;\n-    private final Map<CharSequence, Callable<?>> preflightHeaders;\n-    private final boolean shortCircuit;\n-\n-    Netty4CorsConfig(final Netty4CorsConfigBuilder builder) {\n-        origins = builder.origins.map(s -> new LinkedHashSet<>(s));\n-        pattern = builder.pattern;\n-        anyOrigin = builder.anyOrigin;\n-        enabled = builder.enabled;\n-        allowCredentials = builder.allowCredentials;\n-        maxAge = builder.maxAge;\n-        allowedRequestMethods = builder.requestMethods;\n-        allowedRequestHeaders = builder.requestHeaders;\n-        preflightHeaders = builder.preflightHeaders;\n-        shortCircuit = builder.shortCircuit;\n-    }\n-\n-    /**\n-     * Determines if support for CORS is enabled.\n-     *\n-     * @return {@code true} if support for CORS is enabled, false otherwise.\n-     */\n-    public boolean isCorsSupportEnabled() {\n-        return enabled;\n-    }\n-\n-    /**\n-     * Determines whether a wildcard origin, '*', is supported. This also means that null origins are\n-     * supported.\n-     *\n-     * @return {@code boolean} true if any origin is allowed.\n-     */\n-    public boolean isAnyOriginSupported() {\n-        return anyOrigin;\n-    }\n-\n-    /**\n-     * Returns the set of allowed origins.\n-     *\n-     * @return {@code Set} the allowed origins.\n-     */\n-    public Optional<Set<String>> origins() {\n-        return origins;\n-    }\n-\n-    /**\n-     * Returns whether the input origin is allowed by this configuration.\n-     *\n-     * @return {@code true} if the origin is allowed, otherwise {@code false}\n-     */\n-    public boolean isOriginAllowed(final String origin) {\n-        if (origins.isPresent()) {\n-            return origins.get().contains(origin);\n-        } else if (pattern.isPresent()) {\n-            return pattern.get().matcher(origin).matches();\n-        }\n-        return false;\n-    }\n-\n-    /**\n-     * Determines if credentials are supported for CORS requests.\n-     *\n-     * By default credentials are not included in CORS requests but if isCredentialsAllowed returns\n-     * true credentials will be added to CORS requests. Setting this value to true will set the\n-     * CORS 'Access-Control-Allow-Credentials' response header to true.\n-     *\n-     * Please note that credentials support needs to be enabled on the client side as well.\n-     * The client needs to opt-in to send credentials by calling:\n-     * <pre>\n-     * xhr.withCredentials = true;\n-     * </pre>\n-     * The default value for 'withCredentials' is false in which case no credentials are sent.\n-     * Setting this to true will included credentials in cross origin requests.\n-     *\n-     * @return {@code true} if credentials are supported.\n-     */\n-    public boolean isCredentialsAllowed() {\n-        return allowCredentials;\n-    }\n-\n-    /**\n-     * Gets the maxAge setting.\n-     *\n-     * When making a preflight request the client has to perform two request with can be inefficient.\n-     * This setting will set the CORS 'Access-Control-Max-Age' response header and enables the\n-     * caching of the preflight response for the specified time. During this time no preflight\n-     * request will be made.\n-     *\n-     * @return {@code long} the time in seconds that a preflight request may be cached.\n-     */\n-    public long maxAge() {\n-        return maxAge;\n-    }\n-\n-    /**\n-     * Returns the allowed set of Request Methods. The Http methods that should be returned in the\n-     * CORS 'Access-Control-Request-Method' response header.\n-     *\n-     * @return {@code Set} of {@link HttpMethod}s that represent the allowed Request Methods.\n-     */\n-    public Set<HttpMethod> allowedRequestMethods() {\n-        return Collections.unmodifiableSet(allowedRequestMethods);\n-    }\n-\n-    /**\n-     * Returns the allowed set of Request Headers.\n-     *\n-     * The header names returned from this method will be used to set the CORS\n-     * 'Access-Control-Allow-Headers' response header.\n-     *\n-     * @return {@code Set<String>} of strings that represent the allowed Request Headers.\n-     */\n-    public Set<String> allowedRequestHeaders() {\n-        return Collections.unmodifiableSet(allowedRequestHeaders);\n-    }\n-\n-    /**\n-     * Returns HTTP response headers that should be added to a CORS preflight response.\n-     *\n-     * @return {@link HttpHeaders} the HTTP response headers to be added.\n-     */\n-    public HttpHeaders preflightResponseHeaders() {\n-        if (preflightHeaders.isEmpty()) {\n-            return EmptyHttpHeaders.INSTANCE;\n-        }\n-        final HttpHeaders preflightHeaders = new DefaultHttpHeaders();\n-        for (Map.Entry<CharSequence, Callable<?>> entry : this.preflightHeaders.entrySet()) {\n-            final Object value = getValue(entry.getValue());\n-            if (value instanceof Iterable) {\n-                preflightHeaders.add(entry.getKey().toString(), (Iterable<?>) value);\n-            } else {\n-                preflightHeaders.add(entry.getKey().toString(), value);\n-            }\n-        }\n-        return preflightHeaders;\n-    }\n-\n-    /**\n-     * Determines whether a CORS request should be rejected if it's invalid before being\n-     * further processing.\n-     *\n-     * CORS headers are set after a request is processed. This may not always be desired\n-     * and this setting will check that the Origin is valid and if it is not valid no\n-     * further processing will take place, and a error will be returned to the calling client.\n-     *\n-     * @return {@code true} if a CORS request should short-circuit upon receiving an invalid Origin header.\n-     */\n-    public boolean isShortCircuit() {\n-        return shortCircuit;\n-    }\n-\n-    private static <T> T getValue(final Callable<T> callable) {\n-        try {\n-            return callable.call();\n-        } catch (final Exception e) {\n-            throw new IllegalStateException(\"Could not generate value for callable [\" + callable + ']', e);\n-        }\n-    }\n-\n-    @Override\n-    public String toString() {\n-        return  \"CorsConfig[enabled=\" + enabled +\n-            \", origins=\" + origins +\n-            \", anyOrigin=\" + anyOrigin +\n-            \", isCredentialsAllowed=\" + allowCredentials +\n-            \", maxAge=\" + maxAge +\n-            \", allowedRequestMethods=\" + allowedRequestMethods +\n-            \", allowedRequestHeaders=\" + allowedRequestHeaders +\n-            \", preflightHeaders=\" + preflightHeaders + ']';\n-    }\n-\n-}\ndiff --git a/modules/transport-netty4/src/main/java/org/elasticsearch/http/netty4/cors/Netty4CorsConfigBuilder.java b/modules/transport-netty4/src/main/java/org/elasticsearch/http/netty4/cors/Netty4CorsConfigBuilder.java\ndeleted file mode 100644\nindex 3e87d948dab..00000000000\n--- a/modules/transport-netty4/src/main/java/org/elasticsearch/http/netty4/cors/Netty4CorsConfigBuilder.java\n+++ /dev/null\n@@ -1,265 +0,0 @@\n-/*\n- * Licensed to Elasticsearch under one or more contributor\n- * license agreements. See the NOTICE file distributed with\n- * this work for additional information regarding copyright\n- * ownership. Elasticsearch licenses this file to you under\n- * the Apache License, Version 2.0 (the \"License\"); you may\n- * not use this file except in compliance with the License.\n- * You may obtain a copy of the License at\n- *\n- *    http://www.apache.org/licenses/LICENSE-2.0\n- *\n- * Unless required by applicable law or agreed to in writing,\n- * software distributed under the License is distributed on an\n- * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n- * KIND, either express or implied.  See the License for the\n- * specific language governing permissions and limitations\n- * under the License.\n- */\n-\n-package org.elasticsearch.http.netty4.cors;\n-\n-import io.netty.handler.codec.http.HttpMethod;\n-\n-import java.util.Arrays;\n-import java.util.Date;\n-import java.util.HashMap;\n-import java.util.HashSet;\n-import java.util.LinkedHashSet;\n-import java.util.Map;\n-import java.util.Optional;\n-import java.util.Set;\n-import java.util.concurrent.Callable;\n-import java.util.regex.Pattern;\n-\n-/**\n- * Builder used to configure and build a {@link Netty4CorsConfig} instance.\n- *\n- * This class was lifted from the Netty project:\n- *  https://github.com/netty/netty\n- */\n-public final class Netty4CorsConfigBuilder {\n-\n-    /**\n-     * Creates a Builder instance with it's origin set to '*'.\n-     *\n-     * @return Builder to support method chaining.\n-     */\n-    public static Netty4CorsConfigBuilder forAnyOrigin() {\n-        return new Netty4CorsConfigBuilder();\n-    }\n-\n-    /**\n-     * Create a {@link Netty4CorsConfigBuilder} instance with the specified pattern origin.\n-     *\n-     * @param pattern the regular expression pattern to match incoming origins on.\n-     * @return {@link Netty4CorsConfigBuilder} with the configured origin pattern.\n-     */\n-    public static Netty4CorsConfigBuilder forPattern(final Pattern pattern) {\n-        if (pattern == null) {\n-            throw new IllegalArgumentException(\"CORS pattern cannot be null\");\n-        }\n-        return new Netty4CorsConfigBuilder(pattern);\n-    }\n-\n-    /**\n-     * Creates a {@link Netty4CorsConfigBuilder} instance with the specified origins.\n-     *\n-     * @return {@link Netty4CorsConfigBuilder} to support method chaining.\n-     */\n-    public static Netty4CorsConfigBuilder forOrigins(final String... origins) {\n-        return new Netty4CorsConfigBuilder(origins);\n-    }\n-\n-    Optional<Set<String>> origins;\n-    Optional<Pattern> pattern;\n-    final boolean anyOrigin;\n-    boolean enabled = true;\n-    boolean allowCredentials;\n-    long maxAge;\n-    final Set<HttpMethod> requestMethods = new HashSet<>();\n-    final Set<String> requestHeaders = new HashSet<>();\n-    final Map<CharSequence, Callable<?>> preflightHeaders = new HashMap<>();\n-    boolean shortCircuit;\n-\n-    /**\n-     * Creates a new Builder instance with the origin passed in.\n-     *\n-     * @param origins the origin to be used for this builder.\n-     */\n-    Netty4CorsConfigBuilder(final String... origins) {\n-        this.origins = Optional.of(new LinkedHashSet<>(Arrays.asList(origins)));\n-        pattern = Optional.empty();\n-        anyOrigin = false;\n-    }\n-\n-    /**\n-     * Creates a new Builder instance allowing any origin, \"*\" which is the\n-     * wildcard origin.\n-     *\n-     */\n-    Netty4CorsConfigBuilder() {\n-        anyOrigin = true;\n-        origins = Optional.empty();\n-        pattern = Optional.empty();\n-    }\n-\n-    /**\n-     * Creates a new Builder instance allowing any origin that matches the pattern.\n-     *\n-     * @param pattern the pattern to match against for incoming origins.\n-     */\n-    Netty4CorsConfigBuilder(final Pattern pattern) {\n-        this.pattern = Optional.of(pattern);\n-        origins = Optional.empty();\n-        anyOrigin = false;\n-    }\n-\n-    /**\n-     * Disables CORS support.\n-     *\n-     * @return {@link Netty4CorsConfigBuilder} to support method chaining.\n-     */\n-    public Netty4CorsConfigBuilder disable() {\n-        enabled = false;\n-        return this;\n-    }\n-\n-    /**\n-     * By default cookies are not included in CORS requests, but this method will enable cookies to\n-     * be added to CORS requests. Calling this method will set the CORS 'Access-Control-Allow-Credentials'\n-     * response header to true.\n-     *\n-     * Please note, that cookie support needs to be enabled on the client side as well.\n-     * The client needs to opt-in to send cookies by calling:\n-     * <pre>\n-     * xhr.withCredentials = true;\n-     * </pre>\n-     * The default value for 'withCredentials' is false in which case no cookies are sent.\n-     * Setting this to true will included cookies in cross origin requests.\n-     *\n-     * @return {@link Netty4CorsConfigBuilder} to support method chaining.\n-     */\n-    public Netty4CorsConfigBuilder allowCredentials() {\n-        allowCredentials = true;\n-        return this;\n-    }\n-\n-    /**\n-     * When making a preflight request the client has to perform two request with can be inefficient.\n-     * This setting will set the CORS 'Access-Control-Max-Age' response header and enables the\n-     * caching of the preflight response for the specified time. During this time no preflight\n-     * request will be made.\n-     *\n-     * @param max the maximum time, in seconds, that the preflight response may be cached.\n-     * @return {@link Netty4CorsConfigBuilder} to support method chaining.\n-     */\n-    public Netty4CorsConfigBuilder maxAge(final long max) {\n-        maxAge = max;\n-        return this;\n-    }\n-\n-    /**\n-     * Specifies the allowed set of HTTP Request Methods that should be returned in the\n-     * CORS 'Access-Control-Request-Method' response header.\n-     *\n-     * @param methods the {@link HttpMethod}s that should be allowed.\n-     * @return {@link Netty4CorsConfigBuilder} to support method chaining.\n-     */\n-    public Netty4CorsConfigBuilder allowedRequestMethods(final HttpMethod... methods) {\n-        requestMethods.addAll(Arrays.asList(methods));\n-        return this;\n-    }\n-\n-    /**\n-     * Specifies the if headers that should be returned in the CORS 'Access-Control-Allow-Headers'\n-     * response header.\n-     *\n-     * If a client specifies headers on the request, for example by calling:\n-     * <pre>\n-     * xhr.setRequestHeader('My-Custom-Header', \"SomeValue\");\n-     * </pre>\n-     * the server will receive the above header name in the 'Access-Control-Request-Headers' of the\n-     * preflight request. The server will then decide if it allows this header to be sent for the\n-     * real request (remember that a preflight is not the real request but a request asking the server\n-     * if it allow a request).\n-     *\n-     * @param headers the headers to be added to the preflight 'Access-Control-Allow-Headers' response header.\n-     * @return {@link Netty4CorsConfigBuilder} to support method chaining.\n-     */\n-    public Netty4CorsConfigBuilder allowedRequestHeaders(final String... headers) {\n-        requestHeaders.addAll(Arrays.asList(headers));\n-        return this;\n-    }\n-\n-    /**\n-     * Specifies that a CORS request should be rejected if it's invalid before being\n-     * further processing.\n-     *\n-     * CORS headers are set after a request is processed. This may not always be desired\n-     * and this setting will check that the Origin is valid and if it is not valid no\n-     * further processing will take place, and a error will be returned to the calling client.\n-     *\n-     * @return {@link Netty4CorsConfigBuilder} to support method chaining.\n-     */\n-    public Netty4CorsConfigBuilder shortCircuit() {\n-        shortCircuit = true;\n-        return this;\n-    }\n-\n-    /**\n-     * Builds a {@link Netty4CorsConfig} with settings specified by previous method calls.\n-     *\n-     * @return {@link Netty4CorsConfig} the configured CorsConfig instance.\n-     */\n-    public Netty4CorsConfig build() {\n-        if (preflightHeaders.isEmpty()) {\n-            preflightHeaders.put(\"date\", DateValueGenerator.INSTANCE);\n-            preflightHeaders.put(\"content-length\", new ConstantValueGenerator(\"0\"));\n-        }\n-        return new Netty4CorsConfig(this);\n-    }\n-\n-    /**\n-     * This class is used for preflight HTTP response values that do not need to be\n-     * generated, but instead the value is \"static\" in that the same value will be returned\n-     * for each call.\n-     */\n-    private static final class ConstantValueGenerator implements Callable<Object> {\n-\n-        private final Object value;\n-\n-        /**\n-         * Sole constructor.\n-         *\n-         * @param value the value that will be returned when the call method is invoked.\n-         */\n-       ",
    "Remove arrival / departure message methods from WorldProvider ( <issue_id> )": "diff --git a/patches/minecraft/net/minecraft/world/WorldProvider.java.patch b/patches/minecraft/net/minecraft/world/WorldProvider.java.patch\nindex 95b3c3d05..30de8b504 100644\n--- a/patches/minecraft/net/minecraft/world/WorldProvider.java.patch\n+++ b/patches/minecraft/net/minecraft/world/WorldProvider.java.patch\n@@ -65,7 +65,7 @@\n      }\n  \n      @SideOnly(Side.CLIENT)\n-@@ -241,6 +216,339 @@\n+@@ -241,6 +216,303 @@\n          return new WorldBorder();\n      }\n  \n@@ -102,42 +102,6 @@\n +    }\n +\n +    /**\n-+     * A message to display to the user when they transfer to this dimension.\n-+     *\n-+     * @return The message to be displayed\n-+     */\n-+    public String getWelcomeMessage()\n-+    {\n-+        if (this instanceof WorldProviderEnd)\n-+        {\n-+            return \"Entering the End\";\n-+        }\n-+        else if (this instanceof WorldProviderHell)\n-+        {\n-+            return \"Entering the Nether\";\n-+        }\n-+        return null;\n-+    }\n-+\n-+    /**\n-+     * A Message to display to the user when they transfer out of this dismension.\n-+     *\n-+     * @return The message to be displayed\n-+     */\n-+    public String getDepartMessage()\n-+    {\n-+        if (this instanceof WorldProviderEnd)\n-+        {\n-+            return \"Leaving the End\";\n-+        }\n-+        else if (this instanceof WorldProviderHell)\n-+        {\n-+            return \"Leaving the Nether\";\n-+        }\n-+        return null;\n-+  ",
    "Bump Android plugin .": "diff --git a/build.gradle b/build.gradle\nindex a00979b004..e168f755c4 100644\n--- a/build.gradle\n+++ b/build.gradle\n@@ -4,7 +4,7 @@ buildscript {\n         maven { url 'https://maven.google.com/' }\n     }\n     dependencies {\n-        classpath 'com.android.tools.build:gradle:3.0.0-rc1'\n+        classpath 'com.android.tools.build:gradle:3.0.0-rc2'\n         classpath \"com.jfrog.bintray.gradle:gradle-bintray-plugin:${GRADLE_BINTRAY_PLUGIN_VERSION}\"\n         classpath \"com.github.dcendents:android-maven-gradle-plugin:${ANDROID_MAVEN_GRADLE_PLUGIN_VERSION}\"\n         classpath \"com.github.ben-manes:gradle-versions-plugin:${GRADLE_VERSIONS_PLUGIN_VERSION}\""
}